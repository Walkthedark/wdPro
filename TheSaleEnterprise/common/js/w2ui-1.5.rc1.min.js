var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(b){function g(a){return/^[-+]?[0-9]+$/.test(a)}function a(a){if(null==a)return a;switch(typeof a){case "string":a=String(a).replace(/&/g,"\x26amp;").replace(/>/g,"\x26gt;").replace(/</g,"\x26lt;").replace(/"/g,"\x26quot;");break;case "object":if(Array.isArray(a)){a=b.extend(!0,[],a);for(var c=0;c<a.length;c++)a[c]=this.encodeTags(a[c])}else for(c in a=b.extend(!0,{},a),a)a[c]=this.encodeTags(a[c])}return a}function d(){try{return localStorage.setItem("w2ui_test","w2ui_test"),localStorage.removeItem("w2ui_test"),!0}catch(c){return!1}}var e={};return{version:"1.5.RC1",settings:{locale:"en-us",dateFormat:"m/d/yyyy",timeFormat:"hh:mi pm",datetimeFormat:"m/d/yyyy|hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),fullmonths:"January February March April May June July August September October November December".split(" "),shortdays:"MTWTFSS".split(""),fulldays:"Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),weekStarts:"M",dataType:"HTTPJSON",phrases:{}},isBin:function(a){return/^[0-1]+$/.test(a)},isInt:g,isFloat:function(a){"string"==typeof a&&(a=a.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,"."));return("number"===typeof a||"string"===typeof a&&""!==a)&&!isNaN(Number(a))},isMoney:function(a){var c=w2utils.settings,b=new RegExp("^"+(c.currencyPrefix?"\\"+c.currencyPrefix+"?":"")+"[-+]?"+(c.currencyPrefix?"\\"+c.currencyPrefix+"?":"")+"[0-9]*[\\"+c.decimalSymbol+"]?[0-9]+"+(c.currencySuffix?"\\"+c.currencySuffix+"?":"")+"$","i");"string"===typeof a&&(a=a.replace(new RegExp(c.groupSymbol,"g"),""));return"object"===typeof a||""===a?!1:b.test(a)},isHex:function(a){return/^[a-fA-F0-9]+$/.test(a)},isAlphaNumeric:function(a){return/^[a-zA-Z0-9_-]+$/.test(a)},isEmail:function(a){return/^[a-zA-Z0-9._%-+]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(a)},isDate:function(a,b,d){if(!a)return!1;var c,e,f;null==b&&(b=w2utils.settings.dateFormat);if("function"===typeof a.getUTCFullYear)f=a.getUTCFullYear(),c=a.getUTCMonth()+1,e=a.getUTCDate();else if(parseInt(a)==a&&0<parseInt(a))a=new Date(parseInt(a)),f=a.getUTCFullYear(),c=a.getUTCMonth()+1,e=a.getUTCDate();else{a=String(a);if(/mon/ig.test(b)){b=b.replace(/month/ig,"m").replace(/mon/ig,"m").replace(/dd/ig,"d").replace(/[, ]/ig,"/").replace(/\/\//g,"/").toLowerCase();a=a.replace(/[, ]/ig,"/").replace(/\/\//g,"/").toLowerCase();for(var k=0,u=w2utils.settings.fullmonths.length;k<u;k++){var t=w2utils.settings.fullmonths[k];a=a.replace(new RegExp(t,"ig"),parseInt(k)+1).replace(new RegExp(t.substr(0,3),"ig"),parseInt(k)+1)}}a=a.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/");b=b.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===b&&(c=a[0],e=a[1],f=a[2]);"m/d/yyyy"===b&&(c=a[0],e=a[1],f=a[2]);"dd/mm/yyyy"===b&&(c=a[1],e=a[0],f=a[2]);"d/m/yyyy"===b&&(c=a[1],e=a[0],f=a[2]);"yyyy/dd/mm"===b&&(c=a[2],e=a[1],f=a[0]);"yyyy/d/m"===b&&(c=a[2],e=a[1],f=a[0]);"yyyy/mm/dd"===b&&(c=a[1],e=a[2],f=a[0]);"yyyy/m/d"===b&&(c=a[1],e=a[2],f=a[0]);"mm/dd/yy"===b&&(c=a[0],e=a[1],f=a[2]);"m/d/yy"===b&&(c=a[0],e=a[1],f=parseInt(a[2])+1900);"dd/mm/yy"===b&&(c=a[1],e=a[0],f=parseInt(a[2])+1900);"d/m/yy"===b&&(c=a[1],e=a[0],f=parseInt(a[2])+1900);"yy/dd/mm"===b&&(c=a[2],e=a[1],f=parseInt(a[0])+1900);"yy/d/m"===b&&(c=a[2],e=a[1],f=parseInt(a[0])+1900);"yy/mm/dd"===b&&(c=a[1],e=a[2],f=parseInt(a[0])+1900);"yy/m/d"===b&&(c=a[1],e=a[2],f=parseInt(a[0])+1900)}if(!g(f)||!g(c)||!g(e))return!1;f=+f;c=+c;e=+e;b=new Date(f,c-1,e);return null==c||"Invalid Date"==String(b)||b.getMonth()+1!==c||b.getDate()!==e||b.getFullYear()!==f?!1:!0===d?b:!0},isTime:function(a,d){if(null==a)return!1;var c,e,f;a=String(a);a=a.toUpperCase();e=0<=a.indexOf("AM");var m=(f=0<=a.indexOf("PM"))||e;c=m?12:24;a=a.replace("AM","").replace("PM","");a=b.trim(a);a=a.split(":");var l=parseInt(a[0]||0),u=parseInt(a[1]||0),t=parseInt(a[2]||0);return(!m||1!==a.length)&&2!==a.length&&3!==a.length||""===a[0]||0>l||l>c||!this.isInt(a[0])||2<a[0].length||1<a.length&&(""===a[1]||0>u||59<u||!this.isInt(a[1])||2!==a[1].length)||2<a.length&&(""===a[2]||0>t||59<t||!this.isInt(a[2])||2!==a[2].length)||!m&&c===l&&(0!==u||0!==t)||m&&1===a.length&&0===l?!1:!0===d?(f&&12!==l&&(l+=12),e&&12===l&&(l+=12),{hours:l,minutes:u,seconds:t}):!0},isDateTime:function(a,b,d){null==b&&(b=w2utils.settings.datetimeFormat);b=b.split(" ");if("function"===typeof a.getUTCFullYear)return!0!==d?!0:a;if(parseInt(a)==a&&0<parseInt(a))return a=new Date(parseInt(a)),!0!==d?!0:a;var c=String(a).indexOf(" ");a=[a.substr(0,c),a.substr(c).trim()];b[0]=b[0].trim();b[1]&&(b[1]=b[1].trim());b=w2utils.isDate(a[0],b[0],!0);a=w2utils.isTime(a[1],!0);if(!1!==b&&!1!==a){if(!0!==d)return!0;b.setHours(a.hours);b.setMinutes(a.minutes);b.setSeconds(a.seconds);return b}return!1},age:function(a){if(""===a||null==a)return"";a="function"===typeof a.getUTCFullYear?a:parseInt(a)==a&&0<parseInt(a)?new Date(parseInt(a)):new Date(a);if("Invalid Date"==String(a))return"";a=((new Date).getTime()-a.getTime())/1E3;var c="",b="";0>a?(c=0,b="sec"):60>a?(c=Math.floor(a),b="sec",0>a&&(c=0,b="sec")):3600>a?(c=Math.floor(a/60),b="min"):86400>a?(c=Math.floor(a/60/60),b="hour"):2592E3>a?(c=Math.floor(a/24/60/60),b="day"):31536E3>a?(c=Math.floor(a/30/24/60/60*10)/10,b="month"):126144E3>a?(c=Math.floor(a/365/24/60/60*10)/10,b="year"):126144E3<=a&&(c=Math.floor(a/365.25/24/60/60*10)/10,b="year");return c+" "+b+(1<c?"s":"")},interval:function(a){return 1E3>a?"\x3c 1 sec":6E4>a?Math.floor(a/1E3)+" secs":36E5>a?Math.floor(a/6E4)+" mins":864E5>a?Math.floor(a/36E5*10)/10+" hours":2628E6>a?Math.floor(a/864E5*10)/10+" days":31536E6>a?Math.floor(a/2628E6*10)/10+" months":Math.floor(a/31536E5)/10+" years"},date:function(a){if(""===a||null==a||"object"==typeof a&&!a.getMonth)return"";var c=new Date(a);w2utils.isInt(a)&&(c=new Date(Number(a)));if("Invalid Date"==String(c))return"";var b=w2utils.settings.shortmonths,d=new Date,e=new Date;e.setTime(e.getTime()-864E5);a=b[c.getMonth()]+" "+c.getDate()+", "+c.getFullYear();var d=b[d.getMonth()]+" "+d.getDate()+", "+d.getFullYear(),b=b[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear(),e=c.getHours()-(12<c.getHours()?12:0)+":"+(10>c.getMinutes()?"0":"")+c.getMinutes()+" "+(12<=c.getHours()?"pm":"am"),c=c.getHours()-(12<c.getHours()?12:0)+":"+(10>c.getMinutes()?"0":"")+c.getMinutes()+":"+(10>c.getSeconds()?"0":"")+c.getSeconds()+" "+(12<=c.getHours()?"pm":"am"),m=a;a===d&&(m=e);a===b&&(m=w2utils.lang("Yesterday"));return'\x3cspan title\x3d"'+a+" "+c+'"\x3e'+m+"\x3c/span\x3e"},formatSize:function(a){if(!w2utils.isFloat(a)||""===a)return"";a=parseFloat(a);if(0===a)return 0;var c=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(Math.floor(a/Math.pow(1024,c)*10)/10).toFixed(0===c?0:1)+" "+("Bt KB MB GB TB PB EB ZB".split(" ")[c]||"??")},formatNumber:function(a,b,d){if(null==a||""===a||"object"==typeof a)return"";d={minimumFractionDigits:0,maximumFractionDigits:b,useGrouping:d};if(null==b||0>b)d.minimumFractionDigits=0,d.maximumFractionDigits=20;return parseFloat(a).toLocaleString(w2utils.settings.locale,d)},formatDate:function(a,b){b||(b=this.settings.dateFormat);if(""===a||null==a||"object"==typeof a&&!a.getMonth)return"";var c=new Date(a);w2utils.isInt(a)&&(c=new Date(Number(a)));if("Invalid Date"==String(c))return"";a=c.getFullYear();var d=c.getMonth(),c=c.getDate();return b.toLowerCase().replace("month",w2utils.settings.fullmonths[d]).replace("mon",w2utils.settings.shortmonths[d]).replace(/yyyy/g,a).replace(/yyy/g,a).replace(/yy/g,2E3<a?100+parseInt(String(a).substr(2)):String(a).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+a).replace(/mm/g,(10>d+1?"0":"")+(d+1)).replace(/dd/g,(10>c?"0":"")+c).replace(/th/g,1==c?"st":"th").replace(/th/g,2==c?"nd":"th").replace(/th/g,3==c?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(d+1)).replace(/(^|[^a-z$])d/g,"$1"+c)},formatTime:function(a,b){b||(b=this.settings.timeFormat);if(""===a||null==a||"object"==typeof a&&!a.getMonth)return"";var c=new Date(a);w2utils.isInt(a)&&(c=new Date(Number(a)));w2utils.isTime(a)&&(a=w2utils.isTime(a,!0),c=new Date,c.setHours(a.hours),c.setMinutes(a.minutes));if("Invalid Date"==String(c))return"";a="am";var d=c.getHours(),e=c.getHours(),f=c.getMinutes(),c=c.getSeconds();10>f&&(f="0"+f);10>c&&(c="0"+c);if(-1!==b.indexOf("am")||-1!==b.indexOf("pm"))12<=d&&(a="pm"),12<d&&(d-=12);return b.toLowerCase().replace("am",a).replace("pm",a).replace("hhh",10>d?"0"+d:d).replace("hh24",10>e?"0"+e:e).replace("h24",e).replace("hh",d).replace("mm",f).replace("mi",f).replace("ss",c).replace(/(^|[^a-z$])h/g,"$1"+d).replace(/(^|[^a-z$])m/g,"$1"+f).replace(/(^|[^a-z$])s/g,"$1"+c)},formatDateTime:function(a,b){if(""===a||null==a||"object"==typeof a&&!a.getMonth)return"";"string"!==typeof b?b=[this.settings.dateFormat,this.settings.timeFormat]:(b=b.split(" "),b[0]=b[0].trim(),b[1]=b[1].trim());"h12"==b[1]&&(b[1]="h:m pm");"h24"==b[1]&&(b[1]="h24:m");return this.formatDate(a,b[0])+" "+this.formatTime(a,b[1])},stripTags:function(a){if(null==a)return a;switch(typeof a){case "string":a=String(a).replace(/(<([^>]+)>)/ig,"");break;case "object":if(Array.isArray(a)){a=b.extend(!0,[],a);for(var c=0;c<a.length;c++)a[c]=this.stripTags(a[c])}else for(c in a=b.extend(!0,{},a),a)a[c]=this.stripTags(a[c])}return a},encodeTags:a,decodeTags:function(a){if(null==a)return a;switch(typeof a){case "string":a=String(a).replace(/&gt;/g,"\x3e").replace(/&lt;/g,"\x3c").replace(/&quot;/g,'"').replace(/&amp;/g,"\x26");break;case "object":if(Array.isArray(a)){a=b.extend(!0,[],a);for(var c=0;c<a.length;c++)a[c]=this.decodeTags(a[c])}else for(c in a=b.extend(!0,{},a),a)a[c]=this.decodeTags(a[c])}return a},escapeId:function(a){return""===a||null==a?"":String(a).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")},transition:function(a,d,e,h){var c=b(a).width(),f=b(a).height();if(a&&d){a.parentNode.style.cssText+="perspective: 900px; overflow: hidden;";a.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden";d.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden";switch(e){case "slide-left":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)";d.style.cssText+="overflow: hidden; transform: translate3d("+c+"px, 0, 0)";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)";a.style.cssText+="transition: 0.5s; transform: translate3d(-"+c+"px, 0, 0)"},1);break;case "slide-right":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)";d.style.cssText+="overflow: hidden; transform: translate3d(-"+c+"px, 0, 0)";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; transform: translate3d(0px, 0, 0)";a.style.cssText+="transition: 0.5s; transform: translate3d("+c+"px, 0, 0)"},1);break;case "slide-down":a.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)";d.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)";a.style.cssText+="transition: 0.5s; transform: translate3d(0, "+f+"px, 0)"},1);break;case "slide-up":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)";d.style.cssText+="overflow: hidden; transform: translate3d(0, "+f+"px, 0)";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)";a.style.cssText+="transition: 0.5s; transform: translate3d(0, 0, 0)"},1);break;case "flip-left":a.style.cssText+="overflow: hidden; transform: rotateY(0deg)";d.style.cssText+="overflow: hidden; transform: rotateY(-180deg)";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; transform: rotateY(0deg)";a.style.cssText+="transition: 0.5s; transform: rotateY(180deg)"},1);break;case "flip-right":a.style.cssText+="overflow: hidden; transform: rotateY(0deg)";d.style.cssText+="overflow: hidden; transform: rotateY(180deg)";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; transform: rotateY(0deg)";a.style.cssText+="transition: 0.5s; transform: rotateY(-180deg)"},1);break;case "flip-down":a.style.cssText+="overflow: hidden; transform: rotateX(0deg)";d.style.cssText+="overflow: hidden; transform: rotateX(180deg)";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; transform: rotateX(0deg)";a.style.cssText+="transition: 0.5s; transform: rotateX(-180deg)"},1);break;case "flip-up":a.style.cssText+="overflow: hidden; transform: rotateX(0deg)";d.style.cssText+="overflow: hidden; transform: rotateX(-180deg)";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; transform: rotateX(0deg)";a.style.cssText+="transition: 0.5s; transform: rotateX(180deg)"},1);break;case "pop-in":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)";d.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; transform: scale(1); opacity: 1;";a.style.cssText+="transition: 0.5s;"},1);break;case "pop-out":a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;";d.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;";b(d).show();window.setTimeout(function(){d.style.cssText+="transition: 0.5s; opacity: 1;";a.style.cssText+="transition: 0.5s; transform: scale(1.7); opacity: 0;"},1);break;default:a.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",d.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",b(d).show(),window.setTimeout(function(){d.style.cssText+="transition: 0.5s; opacity: 1;";a.style.cssText+="transition: 0.5s"},1)}setTimeout(function(){"slide-down"===e&&(b(a).css("z-index","1019"),b(d).css("z-index","1020"));d&&b(d).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""}));a&&b(a).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""}));"function"===typeof h&&h()},500)}else console.log("ERROR: Cannot do transition when one of the divs is null")},lock:function(a,d,e){var c={};"object"===typeof d?c=d:(c.msg=d,c.spinner=e);c.msg||0===c.msg||(c.msg="");w2utils.unlock(a);b(a).prepend('\x3cdiv class\x3d"w2ui-lock"\x3e\x3c/div\x3e\x3cdiv class\x3d"w2ui-lock-msg"\x3e\x3c/div\x3e');d=b(a).find(".w2ui-lock");a=b(a).find(".w2ui-lock-msg");c.msg||a.css({"background-color":"transparent",border:"0px"});!0===c.spinner&&(c.msg='\x3cdiv class\x3d"w2ui-spinner" '+(c.msg?"":'style\x3d"width: 35px; height: 35px"')+"\x3e\x3c/div\x3e"+c.msg);null!=c.opacity&&d.css("opacity",c.opacity);"function"==typeof d.fadeIn?(d.fadeIn(200),a.html(c.msg).fadeIn(200)):(d.show(),a.html(c.msg).show(0))},unlock:function(a,d){g(d)?(b(a).find(".w2ui-lock").fadeOut(d),setTimeout(function(){b(a).find(".w2ui-lock").remove();b(a).find(".w2ui-lock-msg").remove()},d)):(b(a).find(".w2ui-lock").remove(),b(a).find(".w2ui-lock-msg").remove())},message:function(a,d){function c(c,d){if(null==m&&(m=d.trigger({phase:"before",type:"open",target:"self"}),!0===m.isCancelled)){q.css("z-index",q.data("old-z-index"));b(a.box).find("#w2ui-message"+v).remove();return}var f=c.data("prev_focus");c.remove();f&&0<f.length?f.focus():e&&e.focus&&e.focus();q.css("z-index",q.data("old-z-index"));d.trigger(b.extend(m,{phase:"after"}))}var e=this,f,m;b().w2tag();d||(d={width:200,height:100});null==d.on&&b.extend(d,w2utils.event);null==d.width&&(d.width=200);null==d.height&&(d.height=100);var l=parseInt(b(a.box).width()),u=parseInt(b(a.box).height()),t=parseInt(b(a.box).find(a.title).css("height")||0);d.width>l&&(d.width=l-10);d.height>u-t&&(d.height=u-10-t);d.originalWidth=d.width;d.originalHeight=d.height;0>parseInt(d.width)&&(d.width=l+d.width);10>parseInt(d.width)&&(d.width=10);0>parseInt(d.height)&&(d.height=u+d.height-t);10>parseInt(d.height)&&(d.height=10);null==d.hideOnClick&&(d.hideOnClick=!1);var g=b(a.box).data("options")||{};if(null==d.width||d.width>g.width-10)d.width=g.width-10;if(null==d.height||d.height>g.height-t-5)d.height=g.height-t-5;0>d.originalHeight&&(d.height=u+d.originalHeight-t);0>d.originalWidth&&(d.width=l+2*d.originalWidth);var q=b(a.box).find(a.title),u=b(a.box).find(".w2ui-message.w2ui-closing");0<b(a.box).find(".w2ui-message.w2ui-closing").length&&(clearTimeout(f),c(u,u.data("options")||{}));var v=b(a.box).find(".w2ui-message").length;if(""===b.trim(d.html)&&""===b.trim(d.body)&&""===b.trim(d.buttons)){if(0!==v){var p=b(a.box).find("#w2ui-message"+(v-1));d=p.data("options")||{};m=d.trigger({phase:"before",type:"close",target:"self"});!0!==m.isCancelled&&(p.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+d.height+"px)"})).addClass("w2ui-closing"),1==v?this.unlock&&(a.param?this.unlock(a.param,150):this.unlock(150)):b(a.box).find("#w2ui-message"+(v-2)).css("z-index",1500),f=setTimeout(function(){c(p,d)},150))}}else{if(""!==b.trim(d.body)||""!==b.trim(d.buttons))d.html='\x3cdiv class\x3d"w2ui-message-body"\x3e'+(d.body||"")+'\x3c/div\x3e\x3cdiv class\x3d"w2ui-message-buttons"\x3e'+(d.buttons||"")+"\x3c/div\x3e";b(a.box).find(".w2ui-message").css("z-index",1390);q.data("old-z-index",q.css("z-index"));q.css("z-index",1501);b(a.box).find(a.body).before('\x3cdiv id\x3d"w2ui-message'+v+'" onmousedown\x3d"event.stopPropagation();"    class\x3d"w2ui-message" style\x3d"display: none; z-index: 1500; '+(0===q.length?"top: 0px;":"top: "+w2utils.getSize(q,"height")+"px;")+(null!=d.width?"width: "+d.width+"px; left: "+(l-d.width)/2+"px;":"left: 10px; right: 10px;")+(null!=d.height?"height: "+d.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===d.hideOnClick?a.param?'onclick\x3d"'+a.path+".message('"+a.param+"');\"":'onclick\x3d"'+a.path+'.message();"':"")+"\x3e\x3c/div\x3e");b(a.box).find("#w2ui-message"+v).data("options",d).data("prev_focus",b(":focus"));var r=b(a.box).find("#w2ui-message"+v).css("display");b(a.box).find("#w2ui-message"+v).css(w2utils.cssPrefix({transform:"none"==r?"translateY(-"+d.height+"px)":"translateY(0px)"}));"none"==r&&(b(a.box).find("#w2ui-message"+v).show().html(d.html),d.box=b(a.box).find("#w2ui-message"+v),m=d.trigger({phase:"before",type:"open",target:"self"}),!0===m.isCancelled?(q.css("z-index",q.data("old-z-index")),b(a.box).find("#w2ui-message"+v).remove()):(setTimeout(function(){b(a.box).find("#w2ui-message"+v).css(w2utils.cssPrefix({transform:"none"==r?"translateY(0px)":"translateY(-"+d.height+"px)"}))},1),0===v&&this.lock&&(a.param?this.lock(a.param):this.lock()),setTimeout(function(){b(a.box).find("#w2ui-message"+v).css(w2utils.cssPrefix({transition:"0s"}));d.trigger(b.extend(m,{phase:"after"}))},350)))}},lang:function(a){var b=this.settings.phrases[a];return null==b?a:b},locale:function(a){a||(a="en-us");"string"!==typeof a?w2utils.settings=b.extend(!0,w2utils.settings,a):(5===a.length&&(a="locale/"+a+".json"),w2utils.settings.phrases={},b.ajax({url:a,type:"GET",dataType:"JSON",async:!1,success:function(a,d,c){w2utils.settings=b.extend(!0,w2utils.settings,a)},error:function(b,d,c){console.log("ERROR: Cannot load locale "+a)}}))},getSize:function(a,d){a=b(a);var c=parseInt(a.css("border-left-width"))||0,e=parseInt(a.css("border-right-width"))||0,f=parseInt(a.css("border-top-width"))||0,m=parseInt(a.css("border-bottom-width"))||0,l=parseInt(a.css("margin-left"))||0,u=parseInt(a.css("margin-right"))||0,g=parseInt(a.css("margin-top"))||0,w=parseInt(a.css("margin-bottom"))||0,q=parseInt(a.css("padding-left"))||0,v=parseInt(a.css("padding-right"))||0,p=parseInt(a.css("padding-top"))||0,r=parseInt(a.css("padding-bottom"))||0;switch(d){case "top":return f+g+p;case "bottom":return m+w+r;case "left":return c+l+q;case "right":return e+u+v;case "width":return c+e+l+u+q+v+parseInt(a.width());case "height":return f+m+g+w+p+r+parseInt(a.height());case "+width":return c+e+l+u+q+v;case "+height":return f+m+g+w+p+r}return 0},getStrWidth:function(d,e){d='\x3cdiv id\x3d"_tmp_width" style\x3d"position: absolute; top: -900px;'+(e||"")+'"\x3e'+a(d)+"\x3c/div\x3e";b("body").append(d);d=b("#_tmp_width").width();b("#_tmp_width").remove();return d},scrollBarSize:function(){if(e.scrollBarSize)return e.scrollBarSize;b("body").append('\x3cdiv id\x3d"_scrollbar_width" style\x3d"position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;"\x3e    \x3cdiv style\x3d"height: 120px"\x3e1\x3c/div\x3e\x3c/div\x3e');e.scrollBarSize=100-b("#_scrollbar_width \x3e div").width();b("#_scrollbar_width").remove();0<=String(navigator.userAgent).indexOf("MSIE")&&(e.scrollBarSize/=2);return e.scrollBarSize},checkName:function(a,b){return a&&null!=a.name?null!=w2ui[a.name]?(console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+a.name+")."),!1):w2utils.isAlphaNumeric(a.name)?!0:(console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),!1):(console.log('ERROR: The parameter "name" is required but not supplied in $().'+b+"()."),!1)},checkUniqueId:function(a,d,e,h){b.isArray(d)||(d=[d]);for(var c=0;c<d.length;c++)if(d[c].id===a)return console.log('ERROR: The parameter "id\x3d'+a+'" is not unique within the current '+e+". (obj: "+h+")"),!1;return!0},cssPrefix:function(a,d,e){var c={},f={},k="";b.isPlainObject(a)?(c=a,!0===d&&(e=!0)):c[a]=d;for(var l in c)f[l]=c[l],f["-webkit-"+l]=c[l],f["-moz-"+l]=c[l].replace("-webkit-","-moz-"),f["-ms-"+l]=c[l].replace("-webkit-","-ms-"),f["-o-"+l]=c[l].replace("-webkit-","-o-");if(!0===e)for(l in f)k+=l+": "+f[l]+"; ";else k=f;return k},getCursorPosition:function(a){if(null==a)return null;var b=0,d=a.ownerDocument||a.document,c=d.defaultView||d.parentWindow,e;a.tagName&&"INPUT"==a.tagName.toUpperCase()&&a.selectionStart?b=a.selectionStart:c.getSelection?(e=c.getSelection(),0<e.rangeCount&&(d=e.getRangeAt(0),b=d.cloneRange(),b.selectNodeContents(a),b.setEnd(d.endContainer,d.endOffset),b=b.toString().length)):(e=d.selection)&&"Control"!=e.type&&(b=e.createRange(),d=d.body.createTextRange(),d.moveToElementText(a),d.setEndPoint("EndToEnd",b),b=d.text.length);return b},setCursorPosition:function(a,d,e){var c=document.createRange(),f,k=window.getSelection();if(null!=a){for(var l=0;l<a.childNodes.length;l++){var u=b(a.childNodes[l]).text();a.childNodes[l].tagName&&(u=b(a.childNodes[l]).html(),u=u.replace(/&lt;/g,"\x3c").replace(/&gt;/g,"\x3e").replace(/&amp;/g,"\x26").replace(/&quot;/g,'"').replace(/&nbsp;/g," "));if(d<=u.length){f=a.childNodes[l];f.childNodes&&0<f.childNodes.length&&(f=f.childNodes[0]);f.childNodes&&0<f.childNodes.length&&(f=f.childNodes[0]);break}else d-=u.length}null!=f&&(d>f.length&&(d=f.length),c.setStart(f,d),e?c.setEnd(f,e):c.collapse(!0),k.removeAllRanges(),k.addRange(c))}},testLocalStorage:d,hasLocalStorage:d(),isIOS:-1!=navigator.userAgent.toLowerCase().indexOf("iphone")||-1!=navigator.userAgent.toLowerCase().indexOf("ipod")||-1!=navigator.userAgent.toLowerCase().indexOf("ipad")?!0:!1,isIE:-1!=navigator.userAgent.toLowerCase().indexOf("msie")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")?!0:!1}}(jQuery);w2utils.formatters={number:function(b,g){20<parseInt(g)&&(g=20);0>parseInt(g)&&(g=0);return null==b||""===b?"":w2utils.formatNumber(parseFloat(b),g,!0)},"float":function(b,g){return w2utils.formatters.number(b,g)},"int":function(b,g){return w2utils.formatters.number(b,0)},money:function(b,g){if(null==b||""===b)return"";b=w2utils.formatNumber(Number(b),w2utils.settings.currencyPrecision||2);return(w2utils.settings.currencyPrefix||"")+b+(w2utils.settings.currencySuffix||"")},currency:function(b,g){return w2utils.formatters.money(b,g)},percent:function(b,g){return null==b||""===b?"":w2utils.formatNumber(b,g||1)+"%"},size:function(b,g){return null==b||""===b?"":w2utils.formatSize(parseInt(b))},date:function(b,g){""===g&&(g=w2utils.settings.dateFormat);if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,g,!0);!1===a&&(a=w2utils.isDate(b,g,!0));return'\x3cspan title\x3d"'+a+'"\x3e'+w2utils.formatDate(a,g)+"\x3c/span\x3e"},datetime:function(b,g){""===g&&(g=w2utils.settings.datetimeFormat);if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,g,!0);!1===a&&(a=w2utils.isDate(b,g,!0));return'\x3cspan title\x3d"'+a+'"\x3e'+w2utils.formatDateTime(a,g)+"\x3c/span\x3e"},time:function(b,g){""===g&&(g=w2utils.settings.timeFormat);"h12"===g&&(g="hh:mi pm");"h24"===g&&(g="h24:mi");if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,g,!0);!1===a&&(a=w2utils.isDate(b,g,!0));return'\x3cspan title\x3d"'+a+'"\x3e'+w2utils.formatTime(b,g)+"\x3c/span\x3e"},timestamp:function(b,g){""===g&&(g=w2utils.settings.datetimeFormat);if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,g,!0);!1===a&&(a=w2utils.isDate(b,g,!0));return a.toString?a.toString():""},gmt:function(b,g){""===g&&(g=w2utils.settings.datetimeFormat);if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,g,!0);!1===a&&(a=w2utils.isDate(b,g,!0));return a.toUTCString?a.toUTCString():""},age:function(b,g){if(null==b||0===b||""===b)return"";var a=w2utils.isDateTime(b,null,!0);!1===a&&(a=w2utils.isDate(b,null,!0));return'\x3cspan title\x3d"'+a+'"\x3e'+w2utils.age(b)+(g?" "+g:"")+"\x3c/span\x3e"},interval:function(b,g){return null==b||0===b||""===b?"":w2utils.interval(b)+(g?" "+g:"")},toggle:function(b,g){return b?"Yes":""},password:function(b,g){g="";if(b)for(var a=0;a<b.length;a++)g+="*";return g}};w2utils.event={on:function(b,g){var a=jQuery,d;if("string"==typeof b&&-1!=b.indexOf(".")){var e=b.split(".");b=e[0];d=e[1]}"string"==typeof b&&-1!=b.indexOf(":")&&(e=b.split(":"),-1!=["complete","done"].indexOf(b[1])&&(b[1]="after"),b={type:e[0],execute:e[1]});a.isPlainObject(b)||(b={type:b,scope:d});b=a.extend({type:null,execute:"before",target:null,onComplete:null},b);b.type?g?(a.isArray(this.handlers)||(this.handlers=[]),this.handlers.push({edata:b,handler:g})):console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(b,g){var a=jQuery,d;if("string"==typeof b&&-1!=b.indexOf(".")){var e=b.split(".");b=e[0];d=e[1]}"string"==typeof b&&-1!=b.indexOf(":")&&(e=b.split(":"),-1!=["complete","done"].indexOf(b[1])&&(b[1]="after"),b={type:e[0],execute:e[1]});a.isPlainObject(b)||(b={type:b});b=a.extend({},{type:null,execute:"before",target:null,onComplete:null},b);if(b.type||d){g||(g=null);for(var a=[],e=0,c=this.handlers.length;e<c;e++){var f=this.handlers[e];(f.edata.type!==b.type&&"*"!==b.type&&(null==f.edata.scope||""!=b.type)||f.edata.target!==b.target&&null!=b.target||f.edata.execute!==b.execute&&null!=b.execute||f.handler!==g&&null!=g&&(null==d||f.edata.scope!=d))&&a.push(f)}this.handlers=a}else console.log("ERROR: You must specify event type when calling .off() method of "+this.name)},trigger:function(b){var g=jQuery;b=g.extend({type:null,phase:"before",target:null,doneHandlers:[]},b,{isStopped:!1,isCancelled:!1,done:function(a){this.doneHandlers.push(a)},preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}});"before"===b.phase&&(b.onComplete=null);var a,d;null==b.target&&(b.target=null);g.isArray(this.handlers)||(this.handlers=[]);for(var e=this.handlers.length-1;0<=e;e--){var c=this.handlers[e];if(!(c.edata.type!==b.type&&"*"!==c.edata.type||c.edata.target!==b.target&&null!=c.edata.target||c.edata.execute!==b.phase&&"*"!==c.edata.execute&&"*"!==c.edata.phase)&&(b=g.extend({},c.edata,b),a=[],(d=(new RegExp(/\((.*?)\)/)).exec(c.handler))&&(a=d[1].split(/\s*,\s*/)),2===a.length?c.handler.call(this,b.target,b):c.handler.call(this,b),!0===b.isStopped||!0===b.stop))return b}e="on"+b.type.substr(0,1).toUpperCase()+b.type.substr(1);if("before"===b.phase&&"function"===typeof this[e]&&(g=this[e],a=[],(d=(new RegExp(/\((.*?)\)/)).exec(g))&&(a=d[1].split(/\s*,\s*/)),2===a.length?g.call(this,b.target,b):g.call(this,b),!0===b.isStopped||!0===b.stop)||null!=b.object&&"before"===b.phase&&"function"===typeof b.object[e]&&(g=b.object[e],a=[],(d=(new RegExp(/\((.*?)\)/)).exec(g))&&(a=d[1].split(/\s*,\s*/)),2===a.length?g.call(this,b.target,b):g.call(this,b),!0===b.isStopped||!0===b.stop))return b;if("after"===b.phase)for("function"===typeof b.onComplete&&b.onComplete.call(this,b),a=0;a<b.doneHandlers.length;a++)"function"==typeof b.doneHandlers[a]&&b.doneHandlers[a].call(this,b);return b}};(function(b){b.fn.w2render=function(g){0<b(this).length&&("string"===typeof g&&w2ui[g]&&w2ui[g].render(b(this)[0]),"object"===typeof g&&g.render(b(this)[0]))};b.fn.w2destroy=function(b){!b&&0<this.length&&(b=this.attr("name"));"string"===typeof b&&w2ui[b]&&w2ui[b].destroy();"object"===typeof b&&b.destroy()};b.fn.w2marker=function(){function g(a,b){for(;-1!=b.innerHTML.indexOf('\x3cspan class\x3d"w2ui-marker"\x3e');)b.innerHTML=b.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/ig,"$1")}var a=Array.prototype.slice.call(arguments,0);Array.isArray(a[0])&&(a=a[0]);return 0!==a.length&&a[0]?b(this).each(function(b,e){function d(a){return'\x3cspan class\x3d"w2ui-marker"\x3e'+a+"\x3c/span\x3e"}g(b,e);for(b=0;b<a.length;b++){var f=a[b];"string"!==typeof f&&(f=String(f));f=f.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$\x26").replace(/&/g,"\x26amp;").replace(/</g,"\x26gt;").replace(/>/g,"\x26lt;");e.innerHTML=e.innerHTML.replace(new RegExp(f+"(?!([^\x3c]+)?\x3e)","gi"),d)}}):b(this).each(g)};b.fn.w2tag=function(g,a){1==arguments.length&&"object"==typeof g&&(a=g,null!=a.html&&(g=a.html));a=b.extend({id:null,html:g,position:"right|top",align:"none",left:0,top:0,style:"",css:{},className:"",inputClass:"",onShow:null,onHide:null,hideOnKeyPress:!0,hideOnBlur:!1,hideOnClick:!1},a);null!=a.name&&null==a.id&&(a.id=a.name);""!==a["class"]&&""===a.inputClass&&(a.inputClass=a["class"]);if(0===b(this).length)b(".w2ui-tag").each(function(a,e){a=b(e).data("options");null==a&&(a={});b(b(e).data("taged-el")).removeClass(a.inputClass).removeData("w2tag").removeData("checkIfMoved");clearInterval(b(e).data("timer"));b(e).remove()});else return b(this).each(function(d,e){function c(){h=b("#w2ui-tag-"+k);if(!(0>=h.length)&&(clearInterval(h.data("timer")),h.remove(),b(document).off(".w2tag"),b(e).off(".w2tag",c).removeClass(a.inputClass).removeData("w2tag").removeData("checkIfMoved"),0<b(e).length&&(b(e)[0].style.cssText=n),"function"===typeof a.onHide))a.onHide()}function f(d,k){var l=b(e).offset();if(0===b(e).length||0===l.left&&0===l.top||0===h.find(".w2ui-tag-body").length)clearInterval(h.data("timer")),c();else{k||setTimeout(f,100);var n="w2ui-tag-right",m=parseInt(l.left+e.offsetWidth+(a.left?a.left:0)),q=parseInt(l.top+(a.top?a.top:0)),g=h.find(".w2ui-tag-body"),p=g[0].offsetWidth,r=g[0].offsetHeight;"string"==typeof a.position&&-1!=a.position.indexOf("|")&&(a.position=a.position.split("|"));if("top"==a.position)n="w2ui-tag-top",m=parseInt(l.left+(a.left?a.left:0))-14,q=parseInt(l.top+(a.top?a.top:0))-r-10;else if("bottom"==a.position)n="w2ui-tag-bottom",m=parseInt(l.left+(a.left?a.left:0))-14,q=parseInt(l.top+e.offsetHeight+(a.top?a.top:0))+10;else if("left"==a.position)n="w2ui-tag-left",m=parseInt(l.left+(a.left?a.left:0))-p-20,q=parseInt(l.top+(a.top?a.top:0));else if(Array.isArray(a.position)){for(var x=window.innerWidth,z=window.innerHeight,y=0;y<a.position.length;y++){var B=a.position[y];if("right"==B){if(n="w2ui-tag-right",m=parseInt(l.left+e.offsetWidth+(a.left?a.left:0)),q=parseInt(l.top+(a.top?a.top:0)),m+p<=x)break}else if("left"==B){if(n="w2ui-tag-left",m=parseInt(l.left+(a.left?a.left:0))-p-20,q=parseInt(l.top+(a.top?a.top:0)),0<=m)break}else if("top"==B){if(n="w2ui-tag-top",m=parseInt(l.left+(a.left?a.left:0))-14,q=parseInt(l.top+(a.top?a.top:0))-r-10,m+p<=x&&0<=q)break}else if("bottom"==B&&(n="w2ui-tag-bottom",m=parseInt(l.left+(a.left?a.left:0))-14,q=parseInt(l.top+e.offsetHeight+(a.top?a.top:0))+10,m+p<=x&&q+r<=z))break}g.data("posClass")!==n&&g.removeClass("w2ui-tag-right w2ui-tag-left w2ui-tag-top w2ui-tag-bottom").addClass(n).data("posClass",n)}h.data("position")!==m+"x"+q&&!0!==d&&h.css(w2utils.cssPrefix({transition:k?"0s":".2s"})).css({left:m+"px",top:q+"px"}).data("position",m+"x"+q);return{left:m,top:q,posClass:n}}}d=a.id?a.id:e.id;var k=w2utils.escapeId(d),h=b("#w2ui-tag-"+k);if(""===g||null==g)h.css("opacity",0),clearInterval(h.data("timer")),h.remove();else{if(0!==h.length)a=b.extend(h.data("options"),a),h.data("options",a),h.find(".w2ui-tag-body").attr("style",a.style).addClass(a.className).html(a.html),f(!0);else{var n="";0<b(e).length&&(n=b(e)[0].style.cssText);b("body").append('\x3cdiv onclick\x3d"event.stopPropagation()" style\x3d"display:none;" id\x3d"w2ui-tag-'+d+'"        class\x3d"w2ui-tag '+(0<b(e).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length?"w2ui-tag-popup":"")+'"\x3e   \x3cdiv style\x3d"margin: -2px 0px 0px -2px; white-space: nowrap;"\x3e      \x3cdiv class\x3d"w2ui-tag-body '+a.className+'" style\x3d"'+(a.style||"")+'"\x3e'+g+"\x3c/div\x3e   \x3c/div\x3e\x3c/div\x3e");h=b("#w2ui-tag-"+k);b(e).data("w2tag",h.get(0)).data("checkIfMoved",f)}setTimeout(function(){h.css("display","block");if(b(e).offset()){var d=f(!0);if(null!=d){h.css({opacity:"1",left:d.left+"px",top:d.top+"px"}).data("options",a).data("taged-el",e).data("position",d.left+"x"+d.top).data("timer",setTimeout(f,100)).find(".w2ui-tag-body").addClass(d.posClass);b(e).css(a.css).off(".w2tag").addClass(a.inputClass);if(a.hideOnKeyPress)b(e).on("keypress.w2tag",c);if(a.hideOnBlur)b(e).on("blur.w2tag",c);if(a.hideOnClick)b(document).on("click.w2tag",c);if("function"===typeof a.onShow)a.onShow()}}},1)}})};b.fn.w2overlay=function(g,a){function d(){var a=b("#w2ui-overlay"+k);if(a.data("element")===f[0]&&0!==a.length){var c=b(f).offset()||{},c=c.left+"x"+c.top;a.data("position")!==c?e():setTimeout(d,250)}}function e(d){if(!d||0===d.button)if(d=b("#w2ui-overlay"+k),!0===d.data("keepOpen"))d.removeData("keepOpen");else{var c;"function"===typeof a.onHide&&(c=a.onHide());!1!==c&&(d.remove(),b(document).off("click",e),clearInterval(d.data("timer")))}}function c(){var d=b("#w2ui-overlay"+k),e=d.find(" \x3e div"),h=b("#w2ui-overlay"+k+" div.menu");h.css("overflow-y","hidden");if(0<d.length){e.height("auto").width("auto");var n=!1,g=e.height(),q=e.width();a.width&&a.width<q&&(q=a.width);30>q&&(q=30);a.tmp.contentHeight&&(g=parseInt(a.tmp.contentHeight),e.height(g),setTimeout(function(){var a=e.find("div.menu");g>a.height()&&e.find("div.menu").css("overflow-y","hidden")},1),setTimeout(function(){var a=e.find("div.menu");"auto"!=a.css("overflow-y")&&a.css("overflow-y","auto")},10));a.tmp.contentWidth&&"both"!=a.align&&(q=parseInt(a.tmp.contentWidth),e.width(q),setTimeout(function(){q>e.find("div.menu \x3e table").width()&&e.find("div.menu \x3e table").css("overflow-x","hidden")},1),setTimeout(function(){e.find("div.menu \x3e table").css("overflow-x","auto")},10));var v=a.left,p=a.width,r=a.tipLeft;switch(a.align){case "both":0===a.width&&(a.width=w2utils.getSize(b(f),"width"));a.maxWidth&&a.width>a.maxWidth&&(a.width=a.maxWidth);break;case "right":v=w2utils.getSize(b(f),"width")-q+10,r=q-40}var p=30!==q||p?a.width?a.width:"auto":30,x=(q-17)/2;"auto"!=p&&(x=(p-17)/2);25>x&&(v=25-x,r=Math.floor(x));var z,y;a.contextMenu?(z=a.pageX+8,y=a.pageY-0,v=a.pageY):(x=f.offset()||{},z=(25<x.left?x.left:25)+v,y=x.top+w2utils.getSize(f,"height")+a.top+7,v=x.top);d.css({left:z+"px",top:y+"px","min-width":p,"min-height":a.height?a.height:"auto"});x=e.offset()||{};p=window.innerHeight+b(document).scrollTop()-x.top-7;z=window.innerWidth+b(document).scrollLeft()-x.left-7;a.contextMenu&&(p=window.innerHeight+b(document).scrollTop()-a.pageY-15,z=window.innerWidth+b(document).scrollLeft()-a.pageX);-50<p&&210>p||!0===a.openAbove?(a.contextMenu?(p=a.pageY-7,z=5):(p=x.top-b(document).scrollTop()-7,z=24),a.maxHeight&&p>a.maxHeight&&(p=a.maxHeight),g>p&&(n=!0,e.height(p).width(q).css({"overflow-y":"auto"}),g=p),d.addClass("bottom-arrow"),d.css("top",v-g-z+a.top+"px")):(a.maxHeight&&p>a.maxHeight&&(p=a.maxHeight),g>p&&(n=!0,e.height(p).width(q).css({"overflow-y":"auto"})),d.addClass("top-arrow"));d.find("\x3estyle").html("#w2ui-overlay"+k+":before { margin-left: "+parseInt(r)+"px; }#w2ui-overlay"+k+":after { margin-left: "+parseInt(r)+"px; }");q=e.width();z=window.innerWidth+b(document).scrollLeft()-x.left-7;a.maxWidth&&z>a.maxWidth&&(z=a.maxWidth);q>z&&"both"!==a.align&&(a.align="right",setTimeout(function(){c()},1));(a.contextMenu||a.noTip)&&d.find("\x3estyle").html("#w2ui-overlay"+k+":before { display: none; }#w2ui-overlay"+k+":after { display: none; }");n&&"both"!=a.align&&e.width(q+w2utils.scrollBarSize()+2)}h.css("overflow-y","auto")}var f=this,k="";1==arguments.length&&(a="object"==typeof g?g:{html:g});2==arguments.length&&(a.html=g);b.isPlainObject(a)||(a={});a=b.extend({},{name:null,html:"",align:"none",left:0,top:0,tipLeft:30,noTip:!1,selectable:!1,width:0,height:0,maxWidth:null,maxHeight:null,contextMenu:!1,pageX:null,pageY:null,originalEvent:null,style:"","class":"",overlayStyle:"",onShow:null,onHide:null,openAbove:!1,tmp:{}},a);a.name&&(k="-"+a.name);var h;if(0===this.length||""===a.html||null==a.html)return 0<b("#w2ui-overlay"+k).length?(h=b("#w2ui-overlay"+k)[0].hide,"function"===typeof h&&h()):b("#w2ui-overlay"+k).remove(),b(this);0<b("#w2ui-overlay"+k).length&&(h=b("#w2ui-overlay"+k)[0].hide,b(document).off(".w2overlayHide"),"function"===typeof h&&h());0<f.length&&(null==f[0].tagName||"BODY"==f[0].tagName.toUpperCase())&&(a.contextMenu=!0);a.contextMenu&&a.originalEvent&&(a.pageX=a.originalEvent.pageX,a.pageY=a.originalEvent.pageY);!a.contextMenu||null!=a.pageX&&null!=a.pageY||console.log("ERROR: to display menu at mouse location, pass options.pageX and options.pageY.");b("body").append('\x3cdiv id\x3d"w2ui-overlay'+k+'" style\x3d"display: none; left: 0px; top: 0px; '+a.overlayStyle+'"        class\x3d"w2ui-reset w2ui-overlay '+(0<b(this).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length?"w2ui-overlay-popup":"")+'"\x3e    \x3cstyle\x3e\x3c/style\x3e    \x3cdiv style\x3d"min-width: 100%; '+a.style+'" class\x3d"'+a["class"]+'"\x3e\x3c/div\x3e\x3c/div\x3e');h=b("#w2ui-overlay"+k);var n=h.find(" \x3e div");n.html(a.html);n=n.css("background-color");null!=n&&"rgba(0, 0, 0, 0)"!==n&&"transparent"!==n&&h.css({"background-color":n,"border-color":n});n=b(f).offset()||{};h.data("element",0<f.length?f[0]:null).data("options",a).data("position",n.left+"x"+n.top).fadeIn("fast").on("click",function(a){"LABEL"==a.target.tagName.toUpperCase()&&a.stopPropagation()}).on("mousedown",function(d){b("#w2ui-overlay"+k).data("keepOpen",!0);-1!=["INPUT","TEXTAREA","SELECT"].indexOf(d.target.tagName.toUpperCase())||a.selectable||d.preventDefault()});h[0].hide=e;h[0].resize=c;setTimeout(function(){c();b(document).off(".w2overlayHide").on("click.w2overlayHide",e);if("function"===typeof a.onShow)a.onShow()},10);d();return b(this)};b.fn.w2menu=function(g,a){function d(){setTimeout(function(){b("#w2ui-overlay"+h+" tr.w2ui-selected").removeClass("w2ui-selected");var d=b("#w2ui-overlay"+h+" tr[index\x3d"+a.index+"]"),c=b("#w2ui-overlay"+h+" div.menu").scrollTop();d.addClass("w2ui-selected");a.tmp&&(a.tmp.contentHeight=b("#w2ui-overlay"+h+" table").height()+(a.search?50:10));a.tmp&&(a.tmp.contentWidth=b("#w2ui-overlay"+h+" table").width());0<b("#w2ui-overlay"+h).length&&b("#w2ui-overlay"+h)[0].resize();if(0<d.length){var e=d[0].offsetTop-5,f=b("#w2ui-overlay"+h+" div.menu").height();b("#w2ui-overlay"+h+" div.menu").scrollTop(c);(e<c||e+d.height()>c+f)&&b("#w2ui-overlay"+h+" div.menu").animate({scrollTop:e-(f-2*d.height())/2},200,"linear")}},1)}function e(c){var e=this.value,f=!1;switch(c.keyCode){case 13:b("#w2ui-overlay"+h).remove();b.fn.w2menuClick(c,a.index);break;case 9:case 27:b("#w2ui-overlay"+h).remove();b.fn.w2menuClick(c,-1);break;case 38:a.index=w2utils.isInt(a.index)?parseInt(a.index):0;for(a.index--;0<a.index&&a.items[a.index].hidden;)a.index--;if(0===a.index&&a.items[a.index].hidden)for(;a.items[a.index]&&a.items[a.index].hidden;)a.index++;0>a.index&&(a.index=0);f=!0;break;case 40:a.index=w2utils.isInt(a.index)?parseInt(a.index):0;for(a.index++;a.index<a.items.length-1&&a.items[a.index].hidden;)a.index++;if(a.index===a.items.length-1&&a.items[a.index].hidden)for(;a.items[a.index]&&a.items[a.index].hidden;)a.index--;a.index>=a.items.length&&(a.index=a.items.length-1);f=!0}if(!f){for(f=c=0;f<a.items.length;f++){var l=a.items[f],n="",u="";-1!==["is","begins with"].indexOf(a.match)&&(n="^");-1!==["is","ends with"].indexOf(a.match)&&(u="$");try{(new RegExp(n+e+u,"i")).test(l[a.itemText])||"..."===l[a.itemText]?l.hidden=!1:l.hidden=!0}catch(x){}"enum"===k.type&&-1!==b.inArray(l[a.itemId],ids)&&(l.hidden=!0);!0!==l.hidden&&c++}for(a.index=0;a.index<a.items.length-1&&a.items[a.index].hidden;)a.index++;0>=c&&(a.index=-1)}b(k).w2menu("refresh",a);d()}function c(){if(a.spinner)return'\x3ctable class\x3d"w2ui-drop-menu"\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd style\x3d"padding: 5px 10px 10px 10px; text-align: center"\x3e    \x3cdiv class\x3d"w2ui-spinner" style\x3d"width: 18px; height: 18px; position: relative; top: 5px;"\x3e\x3c/div\x3e     \x3cdiv style\x3d"display: inline-block; padding: 3px; color: #999;"\x3e'+w2utils.lang("Loading...")+"\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e";for(var b=0,d='\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" class\x3d"w2ui-drop-menu"\x3e\x3ctbody\x3e',c=0;c<a.items.length;c++){var e=a.items[c],f={id:e[a.itemId],text:e[a.itemText]};a.itemIco&&(f.icon=e[a.itemIco]);a.itemImg&&(f.img=e[a.itemImg]);a.itemTip&&(f.tooltip=e[a.itemTip]);a.itemDisabled&&(f.disabled=e[a.itemDisabled]);["radio","check"].indexOf(a.type);if(!a.tmpHideList||!a.tmpHideList[c]){var e="",k=f.text;f.img&&(e='\x3ctd class\x3d"menu-icon"\x3e\x3cdiv class\x3d"w2ui-tb-image w2ui-icon '+f.img+'"\x3e\x3c/div\x3e\x3c/td\x3e');f.icon&&(e='\x3ctd class\x3d"menu-icon" align\x3d"center"\x3e\x3cspan class\x3d"w2ui-icon '+f.icon+'"\x3e\x3c/span\x3e\x3c/td\x3e');if(null==k||""===k||/^-+$/.test(k))d+='\x3ctr\x3e\x3ctd colspan\x3d"3" style\x3d"padding: 6px; pointer-events: none"\x3e\x3cdiv style\x3d"border-top: 1px solid silver;"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e';else{var l=0===b%2?"w2ui-item-even":"w2ui-item-odd";!0!==a.altRows&&(l="");var h=1;""===e&&h++;null==f.count&&null==f.hotkey&&h++;null==f.tooltip&&null!=f.hint&&(f.tooltip=f.hint);d+='\x3ctr index\x3d"'+c+'" style\x3d"'+(f.style?f.style:"")+'" '+(f.tooltip?'title\x3d"'+w2utils.lang(f.tooltip)+'"':"")+'        class\x3d"'+l+" "+(a.index===c?"w2ui-selected":"")+" "+(!0===f.disabled?"w2ui-disabled":"")+'"        onmousedown\x3d"if ('+(!0===f.disabled?"true":"false")+") return;               jQuery.fn.w2menuDown(event, '"+c+'\');"        onclick\x3d"event.stopPropagation();                if ('+(!0===f.disabled?"true":"false")+") return;               jQuery.fn.w2menuClick(event, '"+c+"');\"\x3e"+e+'   \x3ctd class\x3d"menu-text" colspan\x3d"'+h+'"\x3e'+w2utils.lang(k)+'\x3c/td\x3e   \x3ctd class\x3d"menu-count"\x3e'+(null!=f.count?"\x3cspan\x3e"+f.count+"\x3c/span\x3e":"")+(null!=f.hotkey?'\x3cspan class\x3d"hotkey"\x3e'+f.hotkey+"\x3c/span\x3e":"")+"\x3c/td\x3e\x3c/tr\x3e";b++}}}delete a.tmpHideList;0===b&&(d+='\x3ctr\x3e\x3ctd style\x3d"padding: 13px; color: #999; text-align: center"\x3e'+a.msgNoItems+"\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e");return d+"\x3c/tbody\x3e\x3c/table\x3e"}a&&"function"==typeof a.items&&(a.items=a.items());var f={type:"normal",index:null,items:[],itemId:0,itemText:1,itemIco:null,itemImg:null,render:null,msgNoItems:"No items",onSelect:null,tmp:{}},k=this,h="";if("refresh"===g)0<b("#w2ui-overlay"+h).length?(a=b.extend(b.fn.w2menuOptions,a),f=b("#w2ui-overlay"+h+" div.menu").scrollTop(),b("#w2ui-overlay"+h+" div.menu").html(c()),b("#w2ui-overlay"+h+" div.menu").scrollTop(f),d()):b(this).w2menu(a);else if("refresh-index"===g){var n=b("#w2ui-overlay"+h+" div.menu"),m=n.find("tr[index\x3d"+a.index+"]"),f=n.scrollTop();n.find("tr.w2ui-selected").removeClass("w2ui-selected");m.addClass("w2ui-selected");if(0<m.length){var l=m[0].offsetTop-5,u=n.height();n.scrollTop(f);(l<f||l+m.height()>f+u)&&n.animate({scrollTop:l-(u-2*m.height())/2},200,"linear")}d()}else{1===arguments.length?a=g:a.items=g;"object"!==typeof a&&(a={});a=b.extend({},f,a);b.fn.w2menuOptions=a;a.name&&(h="-"+a.name);"function"===typeof a.select&&"function"!==typeof a.onSelect&&(a.onSelect=a.select);"function"===typeof a.onRender&&"function"!==typeof a.render&&(a.render=a.onRender);b.fn.w2menuClick=function(d,c){var e=!1;-1!=["radio","check"].indexOf(a.type)&&(d.shiftKey||d.metaKey||d.ctrlKey)&&(e=!0);"function"===typeof a.onSelect&&setTimeout(function(){a.onSelect({index:c,options:a,item:a.items[c],keepOpen:e,originalEvent:d})},10);var f=b("#w2ui-overlay"+h);f.removeData("keepOpen");"function"!==typeof f[0].hide||e||f[0].hide()};b.fn.w2menuDown=function(d,c){d=b(d.target).parents("tr");var e=d.find(".w2ui-icon");if("check"==a.type||"radio"==a.type)c=a.items[c],c.checked=!c.checked,c.checked?("radio"==a.type&&e.parents("table").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),e.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"==a.type&&e.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty");d.parent().find("tr").removeClass("w2ui-selected");d.addClass("w2ui-selected")};f="";if(a.search)for(f+='\x3cdiv style\x3d"position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;"\x3e    \x3cdiv class\x3d"w2ui-icon icon-search" style\x3d"position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"\x3e\x3c/div\x3e    \x3cinput id\x3d"menu-search" type\x3d"text" style\x3d"width: 100%; outline: none; padding-left: 20px;" onclick\x3d"event.stopPropagation();"/\x3e\x3c/div\x3e',a.style+=";background-color: #ECECEC",n=a.index=0;n<a.items.length;n++)a.items[n].hidden=!1;f+='\x3cdiv class\x3d"menu" style\x3d"position: absolute; top: '+(a.search?40:0)+'px; bottom: 0px; width: 100%;"\x3e'+c()+"\x3c/div\x3e";f=b(this).w2overlay(f,a);setTimeout(function(){b("#w2ui-overlay"+h+" #menu-search").on("keyup",e).on("keydown",function(a){9===a.keyCode&&(a.stopPropagation(),a.preventDefault())});if(a.search){if(-1!=["text","password"].indexOf(b(k)[0].type)||"TEXTAREA"==b(k)[0].tagName.toUpperCase())return;b("#w2ui-overlay"+h+" #menu-search").focus()}d()},200);d();return f}};b.fn.w2color=function(g,a){function d(a){for(var b='\x3cdiv class\x3d"w2ui-color" onmousedown\x3d"event.stopPropagation(); event.preventDefault()"\x3e\x3ctable cellspacing\x3d"5"\x3e\x3ctbody\x3e',d=0;d<f.length-1;d++){for(var b=b+"\x3ctr\x3e",e=0;e<f[d].length;e++)b+='\x3ctd\x3e    \x3cdiv class\x3d"color '+(""===f[d][e]?"no-color":"")+'" style\x3d"background-color: #'+f[d][e]+';"        name\x3d"'+f[d][e]+'" index\x3d"'+d+":"+e+'"\x3e'+(a.color==f[d][e]?"\x26#149;":"\x26#160;")+"    \x3c/div\x3e\x3c/td\x3e",a.color==f[d][e]&&(c=[d,e]);b+="\x3c/tr\x3e";2>d&&(b+='\x3ctr\x3e\x3ctd style\x3d"height: 8px" colspan\x3d"8"\x3e\x3c/td\x3e\x3c/tr\x3e')}d=f[f.length-1];b+='\x3ctr\x3e\x3ctd style\x3d"height: 8px" colspan\x3d"8"\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e   \x3ctd colspan\x3d"4" style\x3d"text-align: left"\x3e\x3cinput placeholder\x3d"#FFF000" style\x3d"margin-left: 1px; width: 74px" maxlength\x3d"7"/\x3e\x3c/td\x3e   \x3ctd\x3e\x3cdiv class\x3d"color" style\x3d"background-color: #'+d[0]+';" name\x3d"'+d[0]+'" index\x3d"8:0"\x3e'+(a.color==d[0]?"\x26#149;":"\x26#160;")+'\x3c/div\x3e\x3c/td\x3e   \x3ctd\x3e\x3cdiv class\x3d"color" style\x3d"background-color: #'+d[1]+';" name\x3d"'+d[1]+'" index\x3d"8:0"\x3e'+(a.color==d[1]?"\x26#149;":"\x26#160;")+'\x3c/div\x3e\x3c/td\x3e   \x3ctd\x3e\x3cdiv class\x3d"color" style\x3d"background-color: #'+d[2]+';" name\x3d"'+d[2]+'" index\x3d"8:0"\x3e'+(a.color==d[2]?"\x26#149;":"\x26#160;")+'\x3c/div\x3e\x3c/td\x3e   \x3ctd\x3e\x3cdiv class\x3d"color" style\x3d"background-color: #'+d[3]+';" name\x3d"'+d[3]+'" index\x3d"8:0"\x3e'+(a.color==d[3]?"\x26#149;":"\x26#160;")+'\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd style\x3d"height: 4px" colspan\x3d"8"\x3e\x3c/td\x3e\x3c/tr\x3e';return b+"\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e"}var e=b(this)[0],c=[-1,-1];null==b.fn.w2colorPalette&&(b.fn.w2colorPalette=["000000 555555 888888 BBBBBB DDDDDD EEEEEE F7F7F7 FFFFFF".split(" "),"FF011B FF9838 FFFD59 01FD55 00FFFE 006CE7 9B24F4 FF21F5".split(" "),"FFEAEA FCEFE1 FCF5E1 EBF7E7 E9F3F5 ECF4FC EAE6F4 F5E7ED".split(" "),"F4CCCC FCE5CD FFF2CC D9EAD3 D0E0E3 CFE2F3 D9D1E9 EAD1DC".split(" "),"EA9899 F9CB9C FEE599 B6D7A8 A2C4C9 9FC5E8 B4A7D6 D5A6BD".split(" "),"E06666 F6B26B FED966 93C47D 76A5AF 6FA8DC 8E7CC3 C27BA0".split(" "),"CC0814 E69138 F1C232 6AA84F 45818E 3D85C6 674EA7 A54D79".split(" "),"99050C B45F17 BF901F 37761D 124F5C 0A5394 351C75 741B47".split(" "),["F2F2F2","F2F2F2","F2F2F2","F2F2F2","F2F2F2"]]);var f=b.fn.w2colorPalette;"string"==typeof g&&(g={color:g,transparent:!0});g.transparent&&"555555"==f[0][1]&&(f[0].splice(1,1),f[0].push(""));g.transparent||"555555"==f[0][1]||(f[0].splice(1,0,"555555"),f[0].pop());g.color&&(g.color=String(g.color).toUpperCase());0===b("#w2ui-overlay").length?b(e).w2overlay(d(g),{onHide:function(){"function"==typeof a&&a(b(e).data("_color"));b(e).removeData("_color")}}):b("#w2ui-overlay .w2ui-color").parent().html(d(g));b("#w2ui-overlay .color").off(".w2color").on("mousedown.w2color",function(a){var d=b(a.originalEvent.target).attr("name");c=b(a.originalEvent.target).attr("index").split(":");b(e).data("_color",d)}).on("mouseup.w2color",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)});b("#w2ui-overlay input").off(".w2color").on("mousedown.w2color",function(a){b("#w2ui-overlay").data("keepOpen",!0);setTimeout(function(){b("#w2ui-overlay").data("keepOpen",!0)},10);a.stopPropagation()}).on("keyup.w2color",function(a){""!==this.value&&"#"!==this.value[0]&&(this.value="#"+this.value)}).on("change.w2color",function(d){d=this.value;"#"==d.substr(0,1)&&(d=d.substr(1));6!=d.length?b(this).w2tag("Invalid color."):(b.fn.w2colorPalette[f.length-1].unshift(d.toUpperCase()),b(e).w2color(g,a),setTimeout(function(){b("#w2ui-overlay input")[0].focus()},100))}).w2field("hex");e.nav=function(a){switch(a){case "up":c[0]--;break;case "down":c[0]++;break;case "right":c[1]++;break;case "left":c[1]--}0>c[0]&&(c[0]=0);c[0]>f.length-2&&(c[0]=f.length-2);0>c[1]&&(c[1]=0);c[1]>f[0].length-1&&(c[1]=f[0].length-1);color=f[c[0]][c[1]];b(e).data("_color",color);return color}}})(jQuery);(function(b){var g=function(a){this.box=this.name=null;this.header="";this.columns=[];this.columnGroups=[];this.records=[];this.summary=[];this.searches=[];this.searchData=[];this.sortData=[];this.toolbar={};this.stateId=null;this.show={header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarInput:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!0,selectionBorder:!0,skipRecords:!0,saveRestoreState:!0};this.hasFocus=!1;this.autoLoad=!0;this.hasNextRec=!1;this.fixedBody=!0;this.headRowHeight=this.recordHeight=30;this.lineNumberWidth=null;this.vs_start=150;this.vs_extra=15;this.keyboard=!0;this.selectType="row";this.multiSort=this.multiSelect=this.multiSearch=!0;this.reorderRows=this.reorderColumns=!1;this.markSearch=!0;this.columnTooltip="normal";this.disableCVS=!1;this.textSearch="contains";this.total=this.ExpendCol=this.canExpend=0;this.limit=100;this.offset=0;this.style="";this.ranges=[];this.menu=[];this.parser=this.recid=this.method=null;this.last={field:"",caption:"",logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null,isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)};b.extend(!0,this,w2obj.grid,a)};b.fn.w2grid=function(a){if(b.isPlainObject(a)){if(w2utils.checkName(a,"w2grid")){var d=a.columns,e=a.columnGroups,c=a.records,f=a.searches,k=a.searchData,h=a.sortData,n=a.toolbar,m=new g(a);b.extend(m,{records:[],columns:[],searches:[],toolbar:{},sortData:[],searchData:[],handlers:[]});null!=m.onExpand&&(m.show.expandColumn=!0);b.extend(!0,m.toolbar,n);m.columns=d;e&&(m.columnGroups=e);if(f)for(d=0;d<f.length;d++)m.searches[d]=b.extend(!0,{},f[d]);if(k)for(d=0;d<k.length;d++)m.searchData[d]=b.extend(!0,{},k[d]);if(h)for(d=0;d<h.length;d++)m.sortData[d]=b.extend(!0,{},h[d]);c&&(m.records=c);a.canExpend&&(m.canExpend=a.canExpend,2==m.canExpend&&(0<$F.sL(a.ExpendCol)?m.ExpendCol=a.ExpendCol:$F.info("\u6811\u5f62\u8868\u683c\u672a\u6307\u5b9a\u6269\u5c55\u5217KEY")));m.newKey=((new Date).getTime()+"").substring(5);for(c=0;c<m.columns.length;c++)f=m.columns[c],k=f.searchable,null!=k&&!1!==k&&null==m.getSearch(f.field)&&(b.isPlainObject(k)?m.addSearch(b.extend({field:f.field,caption:f.caption,type:"text"},k)):(k=f.searchable,h="",!0===f.searchable&&(k="text",h='size\x3d"20"'),m.addSearch({field:f.field,caption:f.caption,type:k,attr:h})));m.initToolbar();0!==b(this).length&&m.render(b(this)[0]);return w2ui[m.name]=m}}else return m=w2ui[b(this).attr("name")],m?0<arguments.length?(m[a]&&m[a].apply(m,Array.prototype.slice.call(arguments,1)),this):m:null};g.prototype={msgEmpty:"",buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"\u91cd\u7f6e"},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"\u663e\u793a\u3001\u9690\u85cf\u5217",arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:"\x3cdiv class\x3d\"w2ui-icon icon-search-down w2ui-search-down\" onclick\x3d\"var obj \x3d w2ui[jQuery(this).parents('div.w2ui-grid').attr('name')]; obj.searchShowFields();\"\x3e\x3c/div\x3e"},"search-go":{type:"drop",id:"w2ui-search-advanced",icon:"w2ui-icon-search",text:"\u67e5\u8be2",tooltip:"\u6253\u5f00\u67e5\u8be2\u9875\u9762"},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",disabled:!0},"delete":{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},operators:{text:["is","begins","contains","ends"],number:["is","between",{oper:"less",text:"less than"},{oper:"more",text:"more than"}],date:["is","between",{oper:"less",text:"before"},{oper:"more",text:"after"}],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],"enum":["in","not in"]},operatorsMap:{text:"text","int":"number","float":"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text","enum":"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},onAdd:null,onEdit:null,onRequest:null,onLoad:null,onDelete:null,onSave:null,onSelect:null,onUnselect:null,onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onColumnClick:null,onColumnDblClick:null,onColumnResize:null,onSort:null,onSearch:null,onSearchOpen:null,onChange:null,onRestore:null,onExpand:null,onCollapse:null,onError:null,onKeydown:null,onToolbar:null,onColumnOnOff:null,onCopy:null,onPaste:null,onSelectionExtend:null,onEditField:null,onRender:null,onRefresh:null,onReload:null,onResize:null,onDestroy:null,onStateSave:null,onStateRestore:null,onFocus:null,onBlur:null,onReorderRow:null,onImgClick:null,getChildParId:function(a){var b=this.records.mapSubList;if(b&&b.hasOwnProperty("####ParListInfo")&&b["####ParListInfo"].hasOwnProperty(a.recid))return b["####ParListInfo"][a.recid];if(a.w2ui&&a.w2ui.parent_recid)return a.w2ui.parent_recid},setChildParId:function(a,b){var d=this.records.mapSubList;d&&d.hasOwnProperty(b)?(d.hasOwnProperty("####ParListInfo")||(d["####ParListInfo"]={}),a.recid==b?console.err("par recid\x3d\x3d current recid"):d["####ParListInfo"][a.recid]=b):a.w2ui&&(a.w2ui.parent_recid=b)},getChild:function(a){if(void 0!=a)if(1==this.canExpend){if(void 0!=a.recid){var b=this.records.mapSubList;if(b&&b.hasOwnProperty(a.recid))return b[a.recid]}if(a.w2ui)return a.w2ui.children}else if(2==this.canExpend&&(a=a[this.ExpendCol],(b=this.records.mapSubList)&&b.hasOwnProperty(a)))return b[a]},getChildExpend:function(a){if(1==this.canExpend){if(void 0!=a.recid){var b=this.records.mapSubList;if(b&&b.hasOwnProperty(a.recid))return b["####ParExpend"]&&b["####ParExpend"].hasOwnProperty(a.recid)?b["####ParExpend"][a.recid]:!1}if(a.w2ui&&a.w2ui.expanded)return a.w2ui.expanded}else if(2==this.canExpend){var e=a[this.ExpendCol];if((b=this.records.mapSubList)&&b.hasOwnProperty(e)&&b["####ParExpend"]&&b["####ParExpend"].hasOwnProperty(a.recid))return b["####ParExpend"][a.recid]}return!1},setChildExpend:function(a,b){if(1==this.canExpend){if(void 0!=a.recid){var d=this.records.mapSubList;if(d&&d.hasOwnProperty(a.recid)){d.hasOwnProperty("####ParExpend")||(d["####ParExpend"]={});d["####ParExpend"][a.recid]=b;return}}a.w2ui&&(a.w2ui.expanded=b)}else if(2==this.canExpend){var c=a[this.ExpendCol];void 0!=a.recid&&(d=this.records.mapSubList)&&d.hasOwnProperty(c)&&(d.hasOwnProperty("####ParExpend")||(d["####ParExpend"]={}),d["####ParExpend"][a.recid]=b)}},refreshSubRec:function(a){this.collapseAllRow(!0);this.records.mapSubList=a;this.refresh()},add:function(a,d){b.isArray(a)||(a=[a]);for(var e=0,c=0;c<a.length;c++){var f=a[c];f&&f.w2ui&&!0===f.w2ui.summary?d?this.summary.unshift(f):this.summary.push(f):d?this.records.unshift(f):this.records.push(f);e++}this.total=this.getTotalRec();this.localSearch();this.refreshBody();this.resizeRecords();return e},find:function(a,b){return[]},reloadRecData:function(a){$F.isArray(a)?this.records=a:this.records=[];this.total=this.getTotalRec();this.refresh()},set:function(a,d,e){"object"==typeof a&&(e=d,d=a,a=null);if(null==a)this.records=d,!0!==e&&this.refresh();else{var c=this.get(a,!0);if(null==c)return!1;this.records[c]&&this.records[c].recid==a?b.extend(!0,this.records[c],d):b.extend(!0,this.summary[c],d);!0!==e&&this.refreshRow(a,c)}return!0},setGridDisable:function(a){this.disEdit=a?!0:!1},get:function(a,d){if(b.isArray(a)){for(var e=[],c=0;c<this.records.length;c++)-1!=b.inArray(this.records[c].recid,a)&&(!0===d?e.push(c):e.push(this.records[c]));for(c=0;c<this.summary.length;c++)-1!=b.inArray(this.summary[c].recid,a)&&(!0===d?e.push(c):e.push(this.summary[c]));return e}for(c=0;c<this.records.length;c++)if(this.records[c].recid==a)return!0===d?c:this.records[c];for(c=0;c<this.summary.length;c++)if(this.summary[c].recid==a)return!0===d?c:this.summary[c];return null},rowDataUpChk:function(a){if(void 0==a)if(a=this.getSelection(!0),1==a.length)a=a[0];else return-10;a=$F.strToInt(a);if(1>a)return-9;if(a>=this.records.length)return-8;var b=this.records[a],e=this.records[a-1],c=this.getChildParId(b);void 0==c&&(c="");e=this.getChildParId(e);void 0==e&&(e="");if((c!=e||$F.sL(c)!=$F.sL(e))&&0!=$F.sL(c))if(c=this.get(c,!1),c=this.getChild(c)){if(0==c.length)return-13;if(c[0].recid==b.recid)return-11}else return-13;return a},rowDataUp:function(a){a=this.rowDataUpChk(a);if(0<a){var b=this.getChildParId(this.records[a]);void 0==b&&(b="");var e=-1,c=!1;this.getChildExpend(this.records[a])&&(this.collapse(this.records[a].recid,!0),c=!0);for(var f=a-1;-1<f;f--){var k=this.getChildParId(this.records[f]);void 0==k&&(k="");if(k==b&&$F.sL(b)==$F.sL(k)){e=f;break}}if(-1<e){if(0<$F.sL(b)){var f=this.get(b),h=this.getChild(f);if(h)for(b=this.records[a].recid,f=0;f<h.length;f++)if(h[f].recid==b){b=h.splice(f,1);h.splice(f-1,0,b[0]);break}}h=this.records.splice(a,1);this.records.splice(e,0,h[0]);this.last.selection.indexes[0]=e}c&&this.expand(h[0].recid,!0);this.refresh();return e}return a},rowDataDownChk:function(a){if(void 0==a)if(a=this.getSelection(!0),1==a.length)a=a[0];else return-10;a=$F.strToInt(a);if(0>a)return-9;if(a+1>=this.records.length)return-8;var b=this.records[a],e=this.records[a+1],c=this.getChildParId(b);void 0==c&&(c="");e=this.getChildParId(e);void 0==e&&(e="");if((c!=e||$F.sL(c)!=$F.sL(e))&&0!=$F.sL(c))if(c=this.get(c,!1),c=this.getChild(c)){if(0==c.length)return-13;if(c[c.length-1].recid==b.recid)return-12}else return-13;return a},rowDataDown:function(a){var b=this.rowDataDownChk(a);if(0<=b){var e=this.getChildParId(this.records[b]);void 0==e&&(e="");a=-1;var c=!1;this.getChildExpend(this.records[b])&&(this.collapse(this.records[b].recid,!0),c=!0);for(var f=b+1;f<this.records.length;f++){var k=this.getChildParId(this.records[f]);void 0==k&&(k="");if(k==e&&$F.sL(e)==$F.sL(k)){a=f;break}}if(-1<a){if(0<$F.sL(e)&&(f=this.get(e),e=this.getChild(f)))for(k=this.records[b].recid,f=0;f<e.length;f++)if(e[f].recid==k){k=e.splice(f,1);e.splice(f+1,0,k[0]);break}f=!1;this.getChildExpend(this.records[a])&&(this.collapse(this.records[a].recid,!0),f=!0);b=this.records.splice(b,1);this.records.splice(a,0,b[0]);f&&this.expand(this.records[a-1].recid,!0);this.last.selection.indexes[0]=this.get(b[0].recid,!0)}else return this.expand(this.records[b].recid,!0),this.refresh(),-8;c&&this.expand(b[0].recid,!0);this.refresh();return a}return b},getParentRow:function(a){if(-1<a&&a<this.records.length&&(a=this.getChildParId(this.records[a]),void 0==a&&(a=""),0<$F.sL(a)))return this.get(a)},removeRows:function(a,d){var e=0;if(b.isArray(a))for(var c=0;c<a.length;c++){var f=$F.strToInt(a[c]);if(0>f||f>=this.records.length)$F.err("w2Grid","delete failed \u6307\u5b9a\u884c\u4e0d\u5b58\u5728\uff1a"+f);else{var k=this.getChildParId(this.records[f]);void 0==k&&(k="");if(0<$F.sL(k)&&(k=this.get(k),k=this.getChild(k)))for(var h=this.records[f].recid,c=0;c<k.length;c++)if(k[c].recid==h){k.splice(c,1);break}this.getChildExpend(this.records[f])&&this.collapse(this.records[f].recid,!0);d?this.records[f].editFlag=2==this.records[f].editFlag?4:3:this.records.splice(f,1);e++}}else if(f=$F.strToInt(a),0>f||f>=this.records.length)$F.err("w2Grid","delete failed \u6307\u5b9a\u884c\u4e0d\u5b58\u5728\uff1a"+f);else{k=this.getChildParId(this.records[f]);void 0==k&&(k="");if(0<$F.sL(k)&&(k=this.get(k),k=this.getChild(k)))for(h=this.records[f].recid,c=0;c<k.length;c++)if(k[c].recid==h){k.splice(c,1);break}d?this.records[f].editFlag=2==this.records[f].editFlag?4:3:this.records.splice(f,1);e++}this.localSearch();this.refresh();return e},remove:function(){for(var a=0,b=0;b<arguments.length;b++){for(var e=this.records.length-1;0<=e;e--)this.records[e].recid==arguments[b]&&(this.records.splice(e,1),a++);for(e=this.summary.length-1;0<=e;e--)this.summary[e].recid==arguments[b]&&(this.summary.splice(e,1),a++)}this.localSearch();this.refresh();return a},addColumn:function(a,d){var e=0;1==arguments.length?(d=a,a=this.columns.length):("string"==typeof a&&(a=this.getColumn(a,!0)),null==a&&(a=this.columns.length));b.isArray(d)||(d=[d]);for(var c=0;c<d.length;c++){this.columns.splice(a,0,d[c]);if(d[c].searchable){var f=d[c].searchable,k="";!0===d[c].searchable&&(f="text",k='size\x3d"20"');this.addSearch({field:d[c].field,caption:d[c].caption,type:f,attr:k})}a++;e++}this.refresh();return e},removeColumn:function(){for(var a=0,b=0;b<arguments.length;b++)for(var e=this.columns.length-1;0<=e;e--)this.columns[e].field==arguments[b]&&(this.columns[e].searchable&&this.removeSearch(arguments[b]),this.columns.splice(e,1),a++);this.refresh();return a},getColumn:function(a,b){if(0===arguments.length){for(var d=[],c=0;c<this.columns.length;c++)d.push(this.columns[c].field);return d}for(c=0;c<this.columns.length;c++)if(this.columns[c].field==a)return!0===b?c:this.columns[c];return null},toggleColumn:function(){for(var a=0,b=0;b<arguments.length;b++)for(var e=this.columns.length-1;0<=e;e--){var c=this.columns[e];c.field==arguments[b]&&(c.hidden=!c.hidden,a++)}this.refreshBody();this.resizeRecords();return a},showColumn:function(){for(var a=0,b=0;b<arguments.length;b++)for(var e=this.columns.length-1;0<=e;e--){var c=this.columns[e];c.gridMinWidth&&delete c.gridMinWidth;c.field==arguments[b]&&!1!==c.hidden&&(c.hidden=!1,a++)}this.refreshBody();this.resizeRecords();return a},hideColumn:function(){for(var a=0,b=0;b<arguments.length;b++)for(var e=this.columns.length-1;0<=e;e--){var c=this.columns[e];c.field==arguments[b]&&!0!==c.hidden&&(c.hidden=!0,a++)}this.refreshBody();this.resizeRecords();return a},addSearch:function(a,d){var e=0;1==arguments.length?(d=a,a=this.searches.length):("string"==typeof a&&(a=this.getSearch(a,!0)),null==a&&(a=this.searches.length));b.isArray(d)||(d=[d]);for(var c=0;c<d.length;c++)this.searches.splice(a,0,d[c]),a++,e++;this.searchClose();return e},removeSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var e=this.searches.length-1;0<=e;e--)this.searches[e].field==arguments[b]&&(this.searches.splice(e,1),a++);this.searchClose();return a},getSearch:function(a,b){if(0===arguments.length){for(var d=[],c=0;c<this.searches.length;c++)d.push(this.searches[c].field);return d}for(c=0;c<this.searches.length;c++)if(this.searches[c].field==a)return!0===b?c:this.searches[c];return null},toggleSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var e=this.searches.length-1;0<=e;e--)this.searches[e].field==arguments[b]&&(this.searches[e].hidden=!this.searches[e].hidden,a++);this.searchClose();return a},showSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var e=this.searches.length-1;0<=e;e--)this.searches[e].field==arguments[b]&&!1!==this.searches[e].hidden&&(this.searches[e].hidden=!1,a++);this.searchClose();return a},hideSearch:function(){for(var a=0,b=0;b<arguments.length;b++)for(var e=this.searches.length-1;0<=e;e--)this.searches[e].field==arguments[b]&&!0!==this.searches[e].hidden&&(this.searches[e].hidden=!0,a++);this.searchClose();return a},getSearchData:function(a){for(var b=0;b<this.searchData.length;b++)if(this.searchData[b].field==a)return this.searchData[b];return null},localSort:function(a,d){function e(a,b){if(!(a.w2ui&&null!=n.getChildParId(a)||b.w2ui&&null!=n.getChildParId(b)))return f(a,b);a=c(a);b=c(b);for(var d=0;d<Math.min(a.length,b.length);d++){var e=f(a[d],b[d]);if(0!==e)return e}if(a.length>b.length)return 1;if(a.length<b.length)return-1;console.log("ERROR: two paths should not be equal.");return 0}function c(a){if(!a.w2ui||null==n.getChildParId(a))return[a];if(a&&a.w2ui._path)return a.w2ui._path;var b=n.get(n.getChildParId(a));return b?c(b).concat(a):(console.log("ERROR: no parent record: "+n.getChildParId(a)),[a])}function f(a,d){if(a===d)return 0;for(var c=0;c<n.sortData.length;c++){var e=n.sortData[c].field;n.sortData[c].field_&&(e=n.sortData[c].field_);var f=a[e],l=d[e];-1!=String(e).indexOf(".")&&(f=n.parseField(a,e),l=n.parseField(d,e));(e=n.getColumn(e))&&null!=e.editable&&(b.isPlainObject(f)&&f.text&&(f=f.text),b.isPlainObject(l)&&l.text&&(l=l.text));f=k(f,l,c,n.sortData[c].direction);if(0!==f)return f}f=k(a.recid,d.recid,-1,"asc");return 0!==f?f:0}function k(a,d,c,e){if(a===d)return 0;if((null==a||""===a)&&null!=d&&""!==d)return 1;if(null!=a&&""!==a&&(null==d||""===d))return-1;c="asc"==e?1:-1;if(typeof a!=typeof d)return typeof a>typeof d?c:-c;if(a.constructor.name!=d.constructor.name)return a.constructor.name>d.constructor.name?c:-c;a&&"object"==typeof a&&(a=a.valueOf());d&&"object"==typeof d&&(d=d.valueOf());e={}.toString;a&&"object"==typeof a&&a.toString!=e&&(a=String(a));d&&"object"==typeof d&&d.toString!=e&&(d=String(d));"string"==typeof a&&(a=b.trim(a.toLowerCase()));"string"==typeof d&&(d=b.trim(d.toLowerCase()));return a>d?c:a<d?-c:0}if(!b.isEmptyObject(this.sortData)){var h=(new Date).getTime(),n=this;n.selectionSave();d||n.reset();for(var m=0;m<this.sortData.length;m++){var l=this.getColumn(this.sortData[m].field);if(!l)return;"string"==typeof l.render&&(-1!=["date","age"].indexOf(l.render.split(":")[0])&&(this.sortData[m].field_=l.field+"_"),-1!=["time"].indexOf(l.render.split(":")[0])&&(this.sortData[m].field_=l.field+"_"))}(function(){for(var a=0;a<n.records.length;a++){var b=n.records[a];null!=n.getChildParId(b)&&(b.w2ui._path=c(b))}})();this.records.sort(function(a,b){return e(a,b)});(function(){for(var a=0;a<n.records.length;a++){var b=n.records[a];null!=n.getChildParId(b)&&(b.w2ui._path=null)}})();n.selectionRestore(d);h=(new Date).getTime()-h;!0!==a&&n.show.statusSort&&setTimeout(function(){n.status(w2utils.lang("Sorting took")+" "+h/1E3+" "+w2utils.lang("sec"))},10);return h}},getTotalRec:function(){return this.records.length},localSearch:function(a){function d(a){for(var c=0,e=0;e<f.searchData.length;e++){var l=f.searchData[e],h=f.getSearch(l.field);if(null!=l){null==h&&(h={field:l.field,type:l.type});var n=f.parseField(a,h.field),m=null===n||void 0===n||"object"==typeof n&&n.toString==k?"":String(n).toLowerCase();if(null!=l.value)if(b.isArray(l.value))var g=l.value[0],x=l.value[1];else var g=String(l.value).toLowerCase();switch(l.operator){case "is":f.parseField(a,h.field)==l.value?c++:"date"==h.type?(h=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),m=w2utils.formatDate(h,"yyyy-mm-dd"),g=w2utils.formatDate(w2utils.isDate(g,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"),m==g&&c++):"time"==h.type?(h=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),m=w2utils.formatTime(h,"hh24:mi"),g=w2utils.formatTime(g,"hh24:mi"),m==g&&c++):"datetime"==h.type&&(h=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),m=w2utils.formatDateTime(h,"yyyy-mm-dd|hh24:mm:ss"),g=w2utils.formatDateTime(w2utils.isDateTime(g,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),m==g&&c++);break;case "between":-1!=["int","float","money","currency","percent"].indexOf(h.type)?parseFloat(f.parseField(a,h.field))>=parseFloat(g)&&parseFloat(f.parseField(a,h.field))<=parseFloat(x)&&c++:"date"==h.type?(m=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),g=w2utils.isDate(g,w2utils.settings.dateFormat,!0),x=w2utils.isDate(x,w2utils.settings.dateFormat,!0),null!=x&&(x=new Date(x.getTime()+864E5)),m>=g&&m<x&&c++):"time"==h.type?(m=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),g=w2utils.isTime(g,!0),x=w2utils.isTime(x,!0),g=(new Date).setHours(g.hours,g.minutes,g.seconds?g.seconds:0,0),x=(new Date).setHours(x.hours,x.minutes,x.seconds?x.seconds:0,0),m>=g&&m<x&&c++):"datetime"==h.type&&(m=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),g=w2utils.isDateTime(g,w2utils.settings.datetimeFormat,!0),(x=w2utils.isDateTime(x,w2utils.settings.datetimeFormat,!0))&&(x=new Date(x.getTime()+864E5)),m>=g&&m<x&&c++);break;case "less":-1!=["int","float","money","currency","percent"].indexOf(h.type)?parseFloat(f.parseField(a,h.field))<=parseFloat(l.value)&&c++:"date"==h.type?(h=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),m=w2utils.formatDate(h,"yyyy-mm-dd"),g=w2utils.formatDate(w2utils.isDate(g,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"),m<=g&&c++):"time"==h.type?(h=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),m=w2utils.formatTime(h,"hh24:mi"),g=w2utils.formatTime(g,"hh24:mi"),m<=g&&c++):"datetime"==h.type&&(h=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),m=w2utils.formatDateTime(h,"yyyy-mm-dd|hh24:mm:ss"),g=w2utils.formatDateTime(w2utils.isDateTime(g,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),m.length==g.length&&m<=g&&c++);break;case "more":-1!=["int","float","money","currency","percent"].indexOf(h.type)?parseFloat(f.parseField(a,h.field))>=parseFloat(l.value)&&c++:"date"==h.type?(h=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),m=w2utils.formatDate(h,"yyyy-mm-dd"),g=w2utils.formatDate(w2utils.isDate(g,w2utils.settings.dateFormat,!0),"yyyy-mm-dd"),m>=g&&c++):"time"==h.type?(h=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),m=w2utils.formatTime(h,"hh24:mi"),g=w2utils.formatTime(g,"hh24:mi"),m>=g&&c++):"datetime"==h.type&&(h=f.parseField(a,h.field+"_")instanceof Date?f.parseField(a,h.field+"_"):f.parseField(a,h.field),m=w2utils.formatDateTime(h,"yyyy-mm-dd|hh24:mm:ss"),g=w2utils.formatDateTime(w2utils.isDateTime(g,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss"),m.length==g.length&&m>=g&&c++);break;case "in":h=l.value;l.svalue&&(h=l.svalue);-1!==h.indexOf(w2utils.isFloat(m)?parseFloat(m):m)&&c++;-1!==h.indexOf(w2utils.isFloat(n)?parseFloat(n):n)&&c++;break;case "not in":h=l.value;l.svalue&&(h=l.svalue);-1==h.indexOf(w2utils.isFloat(m)?parseFloat(m):m)&&c++;-1==h.indexOf(w2utils.isFloat(n)?parseFloat(n):n)&&c++;break;case "begins":case "begins with":0===m.indexOf(g)&&c++;break;case "contains":0<=m.indexOf(g)&&c++;break;case "null":null==f.parseField(a,h.field)&&c++;break;case "not null":null!=f.parseField(a,h.field)&&c++;break;case "ends":case "ends with":l=m.lastIndexOf(g),-1!==l&&l==m.length-g.length&&c++}}}if("OR"==f.last.logic&&0!==c||"AND"==f.last.logic&&c==f.searchData.length)return!0;if((c=f.getChild(a))&&!0!==f.getChildExpend(a))for(a=0;a<c.length;a++)if(d(c[a]))return!0;return!1}function e(a){if(void 0!==a&&!h[a]&&(h[a]=!0,a=f.get(a,!0),null!=a&&-1==b.inArray(a,f.last.searchIds))){var d=f.records[a];d&&d.w2ui&&e(f.getChildParId(d));f.last.searchIds.push(a)}}var c=(new Date).getTime(),f=this,k={}.toString,h={};this.total=this.getTotalRec();this.last.searchIds=[];if(0<this.searchData.length){for(var n=this.total=0;n<this.records.length;n++){var m=this.records[n];d(m)&&(m&&m.w2ui&&e(f.getChildParId(m)),this.last.searchIds.push(n))}this.total=this.last.searchIds.length}c=(new Date).getTime()-c;!0!==a&&f.show.statusSearch&&setTimeout(function(){f.status(w2utils.lang("Search took")+" "+c/1E3+" "+w2utils.lang("sec"))},10);return c},getRangeData:function(a,b){var d=this.get(a[0].recid,!0),c=this.get(a[1].recid,!0),f=a[0].column;a=a[1].column;var k=[];if(f==a)for(;d<=c;d++){var h=this.records[d],n=h[this.columns[f].field]||null;!0!==b?k.push(n):k.push({data:n,column:f,index:d,record:h})}else if(d==c)for(var h=this.records[d],m=f;m<=a;m++)n=h[this.columns[m].field]||null,!0!==b?k.push(n):k.push({data:n,column:m,index:d,record:h});else for(;d<=c;d++)for(h=this.records[d],k.push([]),m=f;m<=a;m++)n=h[this.columns[m].field],!0!==b?k[k.length-1].push(n):k[k.length-1].push({data:n,column:m,index:d,record:h});return k},addRange:function(a){var d=0;if("row"==this.selectType)return d;b.isArray(a)||(a=[a]);for(var e=0;e<a.length;e++){"object"!=typeof a[e]&&(a[e]={name:"selection"});if("selection"==a[e].name){if(!1===this.show.selectionBorder)continue;var c=this.getSelection();if(0===c.length){this.removeRange("selection");continue}else var f=c[0],c=c[c.length-1]}else f=a[e].range[0],c=a[e].range[1];if(f){for(var f={name:a[e].name,range:[{recid:f.recid,column:f.column},{recid:c.recid,column:c.column}],style:a[e].style||""},c=!1,k=0;k<this.ranges.length;k++)if(this.ranges[k].name==a[e].name){c=k;break}!1!==c?this.ranges[c]=f:this.ranges.push(f);d++}}this.refreshRanges();return d},removeRange:function(){for(var a=0,d=0;d<arguments.length;d++){var e=arguments[d];b("#grid_"+this.name+"_"+e,this.box).remove();b("#grid_"+this.name+"_f"+e,this.box).remove();for(var c=this.ranges.length-1;0<=c;c--)this.ranges[c].name==e&&(this.ranges.splice(c,1),a++)}return a},refreshRanges:function(){function a(a){var d=e.last.move;if(d&&"expand"==d.type){d.divX=a.screenX-d.x;d.divY=a.screenY-d.y;var c;a=a.originalEvent.target;"TD"!=a.tagName.toUpperCase()&&(a=b(a).parents("td")[0]);null!=b(a).attr("col")&&(c=parseInt(b(a).attr("col")));a=b(a).parents("tr")[0];a=b(a).attr("recid");if(d.newRange[1].recid!=a||d.newRange[1].column!=c){var f=b.extend({},d.newRange);d.newRange=[{recid:d.recid,column:d.column},{recid:a,column:c}];y=e.trigger(b.extend(y,{originalRange:d.originalRange,newRange:d.newRange}));!0===y.isCancelled?(d.newRange=f,y.newRange=f):(e.removeRange("grid-selection-expand"),e.addRange({name:"grid-selection-expand",range:y.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"}))}}}function d(c){e.removeRange("grid-selection-expand");delete e.last.move;b(document).off("mousemove",a);b(document).off("mouseup",d);e.trigger(b.extend(y,{phase:"after"}))}if(0!==this.ranges.length){for(var e=this,c=(new Date).getTime(),f=b("#grid_"+this.name+"_frecords",e.box),k=b("#grid_"+this.name+"_records",e.box),h=0;h<this.ranges.length;h++){var n=this.ranges[h],m=n.range[0],l=n.range[1];null==m.index&&(m.index=this.get(m.recid,!0));null==l.index&&(l.index=this.get(l.recid,!0));var g=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(m.recid)+' td[col\x3d"'+m.column+'"]',e.box),t=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(l.recid)+' td[col\x3d"'+l.column+'"]',e.box),w=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(m.recid)+' td[col\x3d"'+m.column+'"]',e.box),q=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(l.recid)+' td[col\x3d"'+l.column+'"]',e.box),v=l.column;m.column<this.last.colStart&&l.column>this.last.colStart&&(g=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(m.recid)+' td[col\x3d"start"]',e.box));m.column<this.last.colEnd&&l.column>this.last.colEnd&&(v='"end"',t=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(l.recid)+' td[col\x3d"end"]',e.box));var p=parseInt(b("#grid_"+this.name+"_rec_top",e.box).next().attr("index")),r=parseInt(b("#grid_"+this.name+"_rec_bottom",e.box).prev().attr("index")),x=parseInt(b("#grid_"+this.name+"_frec_top",e.box).next().attr("index")),z=parseInt(b("#grid_"+this.name+"_frec_bottom",e.box).prev().attr("index"));0===g.length&&m.index<p&&l.index>p&&(g=b("#grid_"+this.name+"_rec_top").next().find("td[col\x3d"+m.column+"]"));0===t.length&&l.index>r&&m.index<r&&(t=b("#grid_"+this.name+"_rec_bottom",e.box).prev().find("td[col\x3d"+v+"]"));0===w.length&&m.index<x&&l.index>x&&(w=b("#grid_"+this.name+"_frec_top",e.box).next().find("td[col\x3d"+m.column+"]"));0===q.length&&l.index>z&&m.index<z&&(q=b("#grid_"+this.name+"_frec_bottom",e.box).prev().find("td[col\x3d"+l.column+"]"));p=b(this.box).find("#grid_"+this.name+"_editable").find(".w2ui-input");v=p.attr("recid");p=p.attr("column");if("selection"!=n.name||n.range[0].recid!=v||n.range[0].column!=p)v=b("#grid_"+this.name+"_f"+n.name,e.box),0<w.length||0<q.length?(0===v.length?(f.append('\x3cdiv id\x3d"grid_'+this.name+"_f"+n.name+'" class\x3d"w2ui-selection" style\x3d"'+n.style+'"\x3e'+("selection"==n.name?'\x3cdiv id\x3d"grid_'+this.name+'_resizer" class\x3d"w2ui-selection-resizer"\x3e\x3c/div\x3e':"")+"\x3c/div\x3e"),v=b("#grid_"+this.name+"_f"+n.name,e.box)):(v.attr("style",n.style),v.find(".w2ui-selection-resizer").show()),0===q.length&&(q=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(l.recid)+" td:last-child",e.box),0===q.length&&(q=b("#grid_"+this.name+"_frec_bottom td:first-child",e.box)),v.css("border-right","0px"),v.find(".w2ui-selection-resizer").hide()),null!=m.recid&&null!=l.recid&&0<w.length&&0<q.length?(p=w.position().left-1+f.scrollLeft(),r=w.position().top-1+f.scrollTop(),v.show().css({left:(0<p?p:0)+"px",top:(0<r?r:0)+"px",width:q.position().left-w.position().left+q.width()+3+"px",height:q.position().top-w.position().top+q.height()+3+"px"})):v.hide()):v.hide(),v=b("#grid_"+this.name+"_"+n.name,e.box),0<g.length||0<t.length?(0===v.length?(k.append('\x3cdiv id\x3d"grid_'+this.name+"_"+n.name+'" class\x3d"w2ui-selection" style\x3d"'+n.style+'"\x3e'+("selection"==n.name?'\x3cdiv id\x3d"grid_'+this.name+'_resizer" class\x3d"w2ui-selection-resizer"\x3e\x3c/div\x3e':"")+"\x3c/div\x3e"),v=b("#grid_"+this.name+"_"+n.name,e.box)):v.attr("style",n.style),0===g.length&&(g=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(m.recid)+" td:first-child",e.box),0===g.length&&(g=b("#grid_"+this.name+"_rec_top td:first-child",e.box))),0!==q.length&&v.css("border-left","0px"),null!=m.recid&&null!=l.recid&&0<g.length&&0<t.length?(p=g.position().left-1+k.scrollLeft(),r=g.position().top-1+k.scrollTop(),v.show().css({left:(0<p?p:0)+"px",top:(0<r?r:0)+"px",width:t.position().left-g.position().left+t.width()+3+"px",height:t.position().top-g.position().top+t.height()+3+"px"})):v.hide()):v.hide()}b(this.box).find(".w2ui-selection-resizer").off("mousedown").on("mousedown",function(c){var f=e.getSelection();e.last.move={type:"expand",x:c.screenX,y:c.screenY,divX:0,divY:0,recid:f[0].recid,column:f[0].column,originalRange:[{recid:f[0].recid,column:f[0].column},{recid:f[f.length-1].recid,column:f[f.length-1].column}],newRange:[{recid:f[0].recid,column:f[0].column},{recid:f[f.length-1].recid,column:f[f.length-1].column}]};b(document).off("mousemove",a).on("mousemove",a);b(document).off("mouseup",d).on("mouseup",d);c.preventDefault()}).off("dblclick").on("dblclick",function(a){a=e.trigger({phase:"before",type:"resizerDblClick",target:e.name,originalEvent:a});!0!==a.isCancelled&&e.trigger(b.extend(a,{phase:"after"}))});var y={phase:"before",type:"selectionExtend",target:e.name,originalRange:null,newRange:null};return(new Date).getTime()-c}},selectbyRow:function(a){if(this.records){var b=this.records.length;this.selectNone();-1<a&&a<b&&(void 0==this.records[a].recid&&(this.records[a].recid=this.getNewRecId()),this.select(this.records[a].recid),this.trigger({phase:"before",target:this.name,type:"click",rowData:this.records[a],row:a,recid:this.records[a].recid,column:""}))}},select:function(){if(0===arguments.length)return 0;(new Date).getTime();var a=0,d=this.last.selection;this.multiSelect||this.selectNone();var e={phase:"before",type:"select",target:this.name};1==arguments.length?(e.multiple=!1,b.isPlainObject(arguments[0])?(e.recid=arguments[0].recid,e.column=arguments[0].column):e.recid=arguments[0]):(e.multiple=!0,e.recids=Array.prototype.slice.call(arguments,0));e=this.trigger(e);if(!0===e.isCancelled)return 0;if("row"==this.selectType)for(var c=0;c<arguments.length;c++){var f="object"==typeof arguments[c]?arguments[c].recid:arguments[c],k=this.get(f,!0);if(null!=k){var h=null,n=null;if(0!==this.searchData.length||k+1>=this.last.range_start&&k+1<=this.last.range_end)h=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(f),this.box),n=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(f),this.box);"row"==this.selectType&&-1==d.indexes.indexOf(k)&&(d.indexes.push(k),h&&n&&(h.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),n.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),h.find(".w2ui-grid-select-check").prop("checked",!0)),a++)}}else{for(var m={},c=0;c<arguments.length;c++)if(f="object"==typeof arguments[c]?arguments[c].recid:arguments[c],k="object"==typeof arguments[c]?arguments[c].column:null,m[f]=m[f]||[],b.isArray(k))m[f]=k;else if(w2utils.isInt(k))m[f].push(k);else for(k=0;k<this.columns.length;k++)this.columns[k].hidden||m[f].push(parseInt(k));c=[];for(f in m)if(k=this.get(f,!0),null!=k){n=h=null;k+1>=this.last.range_start&&k+1<=this.last.range_end&&(h=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(f),this.box),n=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(f),this.box));var l=d.columns[k]||[];-1==d.indexes.indexOf(k)&&d.indexes.push(k);for(var g=0;g<m[f].length;g++)-1==l.indexOf(m[f][g])&&l.push(m[f][g]);l.sort(function(a,b){return a-b});for(g=0;g<m[f].length;g++){var t=m[f][g];-1==c.indexOf(t)&&c.push(t);h&&(h.find("#grid_"+this.name+"_data_"+k+"_"+t).addClass("w2ui-selected"),h.find(".w2ui-col-number").addClass("w2ui-row-selected"),h.data("selected","yes"),h.find(".w2ui-grid-select-check").prop("checked",!0));n&&(n.find("#grid_"+this.name+"_data_"+k+"_"+t).addClass("w2ui-selected"),n.find(".w2ui-col-number").addClass("w2ui-row-selected"),n.data("selected","yes"),n.find(".w2ui-grid-select-check").prop("checked",!0));a++}d.columns[k]=l}for(f=0;f<c.length;f++)b(this.box).find("#grid_"+this.name+"_column_"+c[f]+" .w2ui-col-header").addClass("w2ui-col-selected")}d.indexes.sort(function(a,b){return a-b});f=0<d.indexes.length&&0!==this.searchData.length&&d.indexes.length==this.last.searchIds.length;0<this.records.length&&d.indexes.length==this.records.length||f?b("#grid_"+this.name+"_check_all",this.box).prop("checked",!0):b("#grid_"+this.name+"_check_all",this.box).prop("checked",!1);this.status();this.addRange("selection");this.trigger(b.extend(e,{phase:"after"}));return a},unselect:function(){for(var a=0,d=this.last.selection,e=0;e<arguments.length;e++){var c="object"==typeof arguments[e]?arguments[e].recid:arguments[e],f=this.get(c);if(null!=f){var k=this.get(f.recid,!0),h=b("#grid_"+this.name+"_frec_"+w2utils.escapeId(c),this.box),n=b("#grid_"+this.name+"_rec_"+w2utils.escapeId(c),this.box);if("row"==this.selectType){if(-1==d.indexes.indexOf(k))continue;var m=this.trigger({phase:"before",type:"unselect",target:this.name,recid:c,index:k});if(!0===m.isCancelled)continue;d.indexes.splice(d.indexes.indexOf(k),1);h.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected");n.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected");0!=h.length&&(h[0].style.cssText="height: "+this.recordHeight+"px; "+h.attr("custom_style"),n[0].style.cssText="height: "+this.recordHeight+"px; "+n.attr("custom_style"));h.find(".w2ui-grid-select-check").prop("checked",!1);a++}else{var l=arguments[e].column;if(!w2utils.isInt(l)){a=[];for(f=0;f<this.columns.length;f++)this.columns[f].hidden||a.push({recid:c,column:f});return this.unselect.apply(this,a)}var g=d.columns[k];if(!b.isArray(g)||-1==g.indexOf(l))continue;m=this.trigger({phase:"before",type:"unselect",target:this.name,recid:c,column:l});if(!0===m.isCancelled)continue;g.splice(g.indexOf(l),1);b("#grid_"+this.name+"_rec_"+w2utils.escapeId(c),this.box).find(" \x3e td[col\x3d"+l+"]").removeClass("w2ui-selected w2ui-inactive");b("#grid_"+this.name+"_frec_"+w2utils.escapeId(c),this.box).find(" \x3e td[col\x3d"+l+"]").removeClass("w2ui-selected w2ui-inactive");for(var t=!1,w=!1,q=this.getSelection(),f=0;f<q.length;f++)q[f].column==l&&(t=!0),q[f].recid==c&&(w=!0);t||b(this.box).find(".w2ui-grid-columns td[col\x3d"+l+"] .w2ui-col-header, .w2ui-grid-fcolumns td[col\x3d"+l+"] .w2ui-col-header").removeClass("w2ui-col-selected");w||b("#grid_"+this.name+"_frec_"+w2utils.escapeId(c),this.box).find(".w2ui-col-number").removeClass("w2ui-row-selected");a++;0===g.length&&(delete d.columns[k],d.indexes.splice(d.indexes.indexOf(k),1),h.removeData("selected"),h.find(".w2ui-grid-select-check").prop("checked",!1),n.removeData("selected"))}this.trigger(b.extend(m,{phase:"after"}))}}c=0<d.indexes.length&&0!==this.searchData.length&&d.indexes.length==this.last.searchIds.length;0<this.records.length&&d.indexes.length==this.records.length||c?b("#grid_"+this.name+"_check_all",this.box).prop("checked",!0):b("#grid_"+this.name+"_check_all",this.box).prop("checked",!1);this.status();this.addRange("selection");return a},selectAll:function(){var a=(new Date).getTime();if(!1!==this.multiSelect){var d=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(!0!==d.isCancelled){for(var e=this.last.selection,c=[],f=0;f<this.columns.length;f++)c.push(f);e.indexes=[];if(0!==this.searchData.length)for(f=0;f<this.last.searchIds.length;f++)e.indexes.push(this.last.searchIds[f]),"row"!=this.selectType&&(e.columns[this.last.searchIds[f]]=c.slice());else{var k=this.records.length;0!=this.searchData.length&&(k=this.last.searchIds.length);for(f=0;f<k;f++)e.indexes.push(f),"row"!=this.selectType&&(e.columns[f]=c.slice())}"row"==this.selectType?(b(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected")):(b(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),b(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),b(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"));b(this.box).find("input.w2ui-grid-select-check").prop("checked",!0);e=this.getSelection();1==e.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit");1<=e.length?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete");this.addRange("selection");b("#grid_"+this.name+"_check_all",this.box).prop("checked",!0);this.trigger(b.extend(d,{phase:"after"}));return(new Date).getTime()-a}}},selectNone:function(){var a=(new Date).getTime(),d=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(!0!==d.isCancelled){var e=this.last.selection;"row"==this.selectType?(b(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected")):(b(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),b(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),b(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected"));b(this.box).find("input.w2ui-grid-select-check").prop("checked",!1);e.indexes=[];e.columns={};this.toolbar.disable("w2ui-edit","w2ui-delete");this.removeRange("selection");b("#grid_"+this.name+"_check_all",this.box).prop("checked",!1);this.trigger(b.extend(d,{phase:"after"}));return(new Date).getTime()-a}},getSelection:function(a){var b=[],e=this.last.selection;if("row"==this.selectType)for(var c=0;c<e.indexes.length;c++)this.records[e.indexes[c]]&&(!0===a?b.push(e.indexes[c]):b.push(this.records[e.indexes[c]].recid));else for(var f={},c=0;c<e.indexes.length;c++){var k=e.columns[e.indexes[c]];if(this.records[e.indexes[c]])for(var h=0;h<k.length;h++)!0===a?f.hasOwnProperty("a"+e.indexes[c])||(f["a"+e.indexes[c]]=1,b.push(e.indexes[c])):b.push({recid:this.records[e.indexes[c]].recid,index:parseInt(e.indexes[c]),column:k[h]})}return b},search:function(a,d){for(var e=[],c=this.last.multi,f=this.last.logic,k=this.last.field,h=this.last.search,n=!1,m=0;m<this.searches.length;m++)this.searches[m].hidden&&(e.push({field:this.searches[m].field,operator:this.searches[m].operator||"is",type:this.searches[m].type,value:this.searches[m].value||""}),n=!0);if(0===arguments.length){h="";for(m=0;m<this.searches.length;m++){var l=this.searches[m],c=b("#grid_"+this.name+"_operator_"+m).val(),g=b("#grid_"+this.name+"_field_"+m),t=b("#grid_"+this.name+"_field2_"+m),f=g.val(),w=t.val(),q=null,v=null;if(-1!=["int","float","money","currency","percent"].indexOf(l.type)){var p=g.data("w2field"),t=t.data("w2field");p&&(f=p.clean(f));t&&(w=t.clean(w))}if(-1!=["list","enum"].indexOf(l.type))if(f=g.data("selected")||{},b.isArray(f)){q=[];for(p=0;p<f.length;p++)q.push(w2utils.isFloat(f[p].id)?parseFloat(f[p].id):String(f[p].id).toLowerCase()),delete f[p].hidden;b.isEmptyObject(f)&&(f="")}else v=f.text||"",f=f.id||"";if(""!==f&&null!=f||null!=w&&""!==w){g={field:l.field,type:l.type,operator:c};"between"==c?b.extend(g,{value:[f,w]}):"in"==c&&"string"==typeof f?b.extend(g,{value:f.split(",")}):"not in"==c&&"string"==typeof f?b.extend(g,{value:f.split(",")}):b.extend(g,{value:f});q&&b.extend(g,{svalue:q});v&&b.extend(g,{text:v});try{"date"==l.type&&"between"==c&&(g.value[0]=f,g.value[1]=w),"date"==l.type&&"is"==c&&(g.value=f)}catch(x){}e.push(g)}}c=!0;f="AND"}if("string"==typeof a&&(1==arguments.length&&(d=a,a="all"),k=a,h=d,c=!1,f=n?"AND":"OR",null!=d))if("all"==a.toLowerCase())if(0<this.searches.length)for(m=0;m<this.searches.length;m++){l=this.searches[m];if("text"==l.type||"alphanumeric"==l.type&&w2utils.isAlphaNumeric(d)||"int"==l.type&&w2utils.isInt(d)||"float"==l.type&&w2utils.isFloat(d)||"percent"==l.type&&w2utils.isFloat(d)||("hex"==l.type||"color"==l.type)&&w2utils.isHex(d)||"currency"==l.type&&w2utils.isMoney(d)||"money"==l.type&&w2utils.isMoney(d)||"date"==l.type&&w2utils.isDate(d)||"time"==l.type&&w2utils.isTime(d)||"datetime"==l.type&&w2utils.isDateTime(d)||"enum"==l.type&&w2utils.isAlphaNumeric(d)||"list"==l.type&&w2utils.isAlphaNumeric(d))g={field:l.field,type:l.type,operator:null!=l.operator?l.operator:"text"==l.type?this.textSearch:"is",value:d},""!=b.trim(d)&&e.push(g);-1!=["int","float","money","currency","percent"].indexOf(l.type)&&2==b.trim(String(d)).split("-").length&&(n=b.trim(String(d)).split("-"),g={field:l.field,type:l.type,operator:null!=l.operator?l.operator:"between",value:[n[0],n[1]]},e.push(g));if(-1!=["list","enum"].indexOf(l.type)){n=[];for(p=0;p<l.options.items;p++){g=l.options.items[p];try{var r=new RegExp(d,"i");r.test(g)&&n.push(p);g.text&&r.test(g.text)&&n.push(g.id)}catch(x){}}0<n.length&&(g={field:l.field,type:l.type,operator:null!=l.operator?l.operator:"in",value:n},e.push(g))}}else for(m=0;m<this.columns.length;m++)g={field:this.columns[m].field,type:"text",operator:this.textSearch,value:d},e.push(g);else if(m=b("#grid_"+this.name+"_search_all",this.box),l=this.getSearch(a),null==l&&(l={field:a,type:"text"}),l.field==a&&(this.last.caption=l.caption),""!==d){r=this.textSearch;n=d;-1!=["date","time","datetime"].indexOf(l.type)&&(r="is");-1!=["list","enum"].indexOf(l.type)&&(r="is",n=(g=m.data("selected"))&&!b.isEmptyObject(g)?g.id:"");if("int"==l.type&&""!==d&&(r="is",-1!=String(d).indexOf("-")&&(g=d.split("-"),2==g.length&&(r="between",n=[parseInt(g[0]),parseInt(g[1])])),-1!=String(d).indexOf(",")))for(g=d.split(","),r="in",n=[],m=0;m<g.length;m++)n.push(g[m]);null!=l.operator&&(r=l.operator);g={field:l.field,type:l.type,operator:r,value:n};e.push(g)}if(b.isArray(a))for(l="AND","string"==typeof d&&(l=d.toUpperCase(),"OR"!=l&&"AND"!=l&&(l="AND")),h="",c=!0,f=l,m=0;m<a.length;m++){r=a[m];l=this.getSearch(r.field);null==l&&(l={type:"text",operator:"begins"});if(b.isArray(r.value))for(p=0;p<r.value.length;p++)"string"==typeof r.value[p]&&(r.value[p]=r.value[p].toLowerCase());e.push(b.extend(!0,{},l,r))}e=this.trigger({phase:"before",type:"search",multi:0===arguments.length?!0:!1,target:this.name,searchData:e,searchField:a?a:"multi",searchValue:a?d:"multi"});!0!==e.isCancelled&&(this.searchData=e.searchData,this.last.field=k,this.last.search=h,this.last.multi=c,this.last.logic=f,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),this.localSearch(),this.refresh(),this.trigger(b.extend(e,{phase:"after"})))},searchOpen:function(){if(this.box&&0!==this.searches.length){var a=this,d=this.trigger({phase:"before",type:"searchOpen",target:this.name});!0===d.isCancelled?setTimeout(function(){a.toolbar.uncheck("w2ui-search-advanced")},1):b("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced",a.box).w2overlay({html:this.getSearchesHTML(),name:this.name+"-searchOverlay",left:-10,"class":"w2ui-grid-searches",onShow:function(){a.initSearches();b("#w2ui-overlay-"+a.name+"-searchOverlay .w2ui-grid-searches").data("grid-name",a.name);var e=b("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel\x3dsearch]");0<e.length&&e[0].focus();a.trigger(b.extend(d,{phase:"after"}))}})}},searchClose:function(){this.box&&0!==this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced"),b().w2overlay({name:this.name+"-searchOverlay"}),b().w2overlay({name:this.name+"-searchOverlay"}))},searchReset:function(a){for(var d=[],e=!1,c=0;c<this.searches.length;c++)this.searches[c].hidden&&(d.push({field:this.searches[c].field,operator:this.searches[c].operator||"is",type:this.searches[c].type,value:this.searches[c].value||""}),e=!0);d=this.trigger({phase:"before",type:"search",reset:!0,target:this.name,searchData:d});if(!0!==d.isCancelled){this.searchData=d.searchData;this.last.search="";this.last.logic=e?"AND":"OR";if(0<this.searches.length)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("\u6240\u6709\u5b57\u6bb5");else{for(e=0;e<this.searches.length&&(this.searches[e].hidden||!1===this.searches[e].simple);)e++;e>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[e].field,this.last.caption=this.searches[e].caption)}this.last.multi=!1;this.last.xhr_offset=0;this.last.scrollTop=0;this.last.scrollLeft=0;this.last.selection.indexes=[];this.last.selection.columns={};this.searchClose();b("#grid_"+this.name+"_search_all",this.box).val("").removeData("selected");a||this.reload();this.trigger(b.extend(d,{phase:"after"}))}},searchShowFields:function(){for(var a=this,d=b("#grid_"+this.name+"_search_all"),e='\x3cdiv class\x3d"w2ui-select-field"\x3e\x3ctable\x3e\x3ctbody\x3e',c=-1;c<this.searches.length;c++){var f=this.searches[c];if(-1==c){if(!this.multiSearch||!this.show.searchAll)continue;f={field:"all",caption:w2utils.lang("\u6240\u6709\u5b57\u6bb5")}}else if(!0===this.searches[c].hidden||!1===this.searches[c].simple)continue;e+="\x3ctr "+(w2utils.isIOS?"onTouchStart":"onClick")+"\x3d\"w2ui['"+this.name+"'].initAllField('"+f.field+"');      event.stopPropagation(); jQuery('#grid_"+this.name+"_search_all').w2overlay({ name: '"+this.name+'-searchFields\' });"\x3e   \x3ctd\x3e       \x3cspan class\x3d"w2ui-column-check w2ui-icon-'+(f.field==this.last.field?"check":"empty")+'"\x3e\x3c/span\x3e   \x3c/td\x3e   \x3ctd\x3e'+f.caption+"\x3c/td\x3e\x3c/tr\x3e"}e+="\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e";setTimeout(function(){b(d).w2overlay({html:e,name:a.name+"-searchFields",left:-10})},1)},initAllField:function(a,d){var e=b("#grid_"+this.name+"_search_all",this.box);if("all"==a)a={field:"all",caption:w2utils.lang("\u6240\u6709\u5b57\u6bb5")},e.w2field("clear"),e.change();else{a=this.getSearch(a);if(null==a)return;var c=a.type;-1!=["enum","select"].indexOf(c)&&(c="list");e.w2field(c,b.extend({},a.options,{suffix:"",autoFormat:!1,selected:d}));-1!=["list","enum","date","time","datetime"].indexOf(a.type)&&(this.last.search="",this.last.item="",e.val(""))}""!=this.last.search?(this.last.caption=a.caption,this.search(a.field,this.last.search)):(this.last.field=a.field,this.last.caption=a.caption);e.attr("placeholder",w2utils.lang(a.caption));b().w2overlay({name:this.name+"-searchFields"})},clear:function(a){this.total=0;this.records=[];this.summary=[];this.last.xhr_offset=0;this.reset(!0);a||this.refresh()},reset:function(a){this.last.scrollTop=0;this.last.scrollLeft=0;this.last.selection={indexes:[],columns:{}};this.last.range_start=null;this.last.range_end=null;b("#grid_"+this.name+"_records",this.box).prop("scrollTop",0);a||this.refresh()},reload:function(a){this.selectionSave();this.reset(!0);this.localSearch();this.selectionRestore();"function"==typeof a&&a({status:"success"})},error:function(a){var d=this.trigger({target:this.name,type:"error",message:a,xhr:this.last.xhr});!0===d.isCancelled?"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}):(this.message(a),this.trigger(b.extend(d,{phase:"after"})))},getChanges:function(){for(var a=[],d=0;d<this.records.length;d++){var e=this.records[d];e&&e.w2ui&&null!=e.w2ui.changes&&a.push(b.extend(!0,{recid:e.recid},e.w2ui.changes))}return a},mergeChanges:function(){for(var a=this.getChanges(),b=0;b<a.length;b++){var e=this.get(a[b].recid),c;for(c in a[b])if("recid"!=c){"object"===typeof a[b][c]&&(a[b][c]=a[b][c].text);try{-1!=c.indexOf(".")?eval("record['"+c.replace(/\./g,"']['")+"'] \x3d changes[c][s]"):e[c]=a[b][c]}catch(f){console.log("ERROR: Cannot merge. ",f.message||"",f)}e&&e.w2ui&&delete e.w2ui.changes}}this.refresh()},save:function(){var a=this.getChanges(),a=this.trigger({phase:"before",target:this.name,type:"save",changes:a});!0!==a.isCancelled&&(this.mergeChanges(),this.trigger(b.extend(a,{phase:"after"})))},editField:function(a,d,e,c,f){function k(a){try{var d="DIV"==this.tagName.toUpperCase()?b(this).text():this.value,c=b("#grid_"+h.name+"_editable",h.box),e="font-family: "+b(this).css("font-family")+"; font-size: "+b(this).css("font-size")+"; white-space: pre;",f=w2utils.getStrWidth(d,e);f+20>c.width()&&c.width(f+20)}catch(E){}}var h=this;if(!h.disEdit){var n;void 0==h.records[f]?n=f:h.records[f].recid==a?n=f:(n=h.get(a,!0),null==n&&n==h.records.length);var m=h.getCellEditable(n,d);if(m){var l=h.records[n];void 0==l&&n==h.records.length&&h.emptyNewRow&&(l=[]);var g=h.columns[d];f=!0===g.frozen?"_f":"_";if(-1!=["enum","file"].indexOf(m.type))console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');else{var t=h.trigger({phase:"before",type:"editField",target:h.name,rowData:l,colInfo:g,recid:a,column:d,value:e,index:n,originalEvent:c});if(!0!==t.isCancelled&&(e=t.value,this.selectNone(),this.select({recid:a,column:d}),this.last.edit_col=d,-1==["checkbox","check"].indexOf(m.type))){var w=b("#grid_"+h.name+f+"rec_"+w2utils.escapeId(a),h.box),q=w.find("[col\x3d"+d+"] \x3e div");b(this.box).find("div.w2ui-edit-box").remove();"row"!=this.selectType&&(b("#grid_"+this.name+f+"selection",h.box).attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('\x3cdiv style\x3d"position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"\x3e\x3c/div\x3e').find(".w2ui-selection-resizer").remove(),q=b("#grid_"+this.name+"_editable \x3ediv:first-child",h.box));null==m.inTag&&(m.inTag="");null==m.outTag&&(m.outTag="");null==m.style&&(m.style="");null==m.items&&(m.items=[]);var v=l&&l.w2ui&&l.w2ui.changes&&null!=l.w2ui.changes[g.field]?w2utils.stripTags(l.w2ui.changes[g.field]):w2utils.stripTags(l[g.field]);null==v&&(v="");var p="object"!=typeof v?v:"";null!=t.old_value&&(p=t.old_value);null!=e&&(v=e);c=null!=g.style?g.style+";":"";"string"==typeof g.render&&-1!="number int float money percent size".split(" ").indexOf(g.render.split(":")[0])&&(c+="text-align: right;");0<m.items.length&&!b.isPlainObject(m.items[0])&&(m.items=w2obj.field.prototype.normMenu(m.items));switch(m.type){case "select":e='\x3coption value\x3d""\x3e\x3c/option\x3e';if(m.relF){f=m.relF.show;for(var w=m.relF.val,r=0;r<m.items.length;r++)e+='\x3coption value\x3d"'+m.items[r][w]+'"'+(m.items[r][w]==v?' selected\x3d"selected"':"")+"\x3e"+m.items[r][f]+"\x3c/option\x3e"}else for(r=0;r<m.items.length;r++)e+='\x3coption value\x3d"'+m.items[r][0]+'"'+(m.items[r][0]==v?' selected\x3d"selected"':"")+"\x3e"+m.items[r][1]+"\x3c/option\x3e";q.addClass("w2ui-editable").html('\x3cselect id\x3d"grid_'+h.name+"_edit_"+a+"_"+d+'" column\x3d"'+d+'" class\x3d"w2ui-input"    style\x3d"width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 1px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+c+m.style+'"     field\x3d"'+g.field+'" recid\x3d"'+a+'"     '+m.inTag+"\x3e"+e+"\x3c/select\x3e"+m.outTag);setTimeout(function(){q.find("select").on("click",function(a){a.stopImmediatePropagation()}).on("change",function(a){delete h.last.move}).on("blur",function(a){1!=b(this).data("keep-open")&&h.editChange.call(h,this,n,d,a)})},10);break;case "dynselect":e='\x3coption value\x3d""\x3e\x3c/option\x3e';b.isFunction(m.dynGetData)&&m.dynGetData(m,l,n,d);f=1;var w=0,x;m.relF&&(f=m.relF.show,w=m.relF.val);void 0!=m.valcol?(v=l[m.valcol],x=w):x=f;for(r=0;r<m.items.length;r++)e+='\x3coption value\x3d"'+m.items[r][w]+'"'+(m.items[r][x]+""==v?' selected\x3d"selected"':"")+"\x3e"+m.items[r][f]+"\x3c/option\x3e";q.addClass("w2ui-editable").html('\x3cselect id\x3d"grid_'+h.name+"_edit_"+a+"_"+d+'" column\x3d"'+d+'" class\x3d"w2ui-input"    style\x3d"width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 1px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+c+m.style+'"     field\x3d"'+g.field+'" recid\x3d"'+a+'"     '+m.inTag+"\x3e"+e+"\x3c/select\x3e"+m.outTag);setTimeout(function(){q.find("select").on("click",function(a){a.stopImmediatePropagation()}).on("change",function(a){delete h.last.move}).on("blur",function(a){1!=b(this).data("keep-open")&&h.editChange.call(h,this,n,d,a)})},10);break;case "autoselect":w=f=c="";0<$F.sL(m.ico)&&(f='\x3ci class\x3d"selico fa '+(1<m.ico.length?m.ico:"fa-podcast")+'" style\x3d"margin-left: -15px;cursor: pointer;"\x3e\x3c/i\x3e',w=";padding-right: 20px;");m.tip&&0<(m.tip+"").length&&(c=' placeholder\x3d"'+m.tip+'"');q.addClass("w2ui-editable").html('\x3cinput class\x3d"w2ui-input" type\x3d"text"   style\x3d"width: 100%;height: 100%;pointer-events: auto; padding:3px; margin: 1px; border-left: 0; border-right: 0; border-radius: 0px; outline: none; font-family: inherit;'+w+m.style+'" '+c+" /\x3e"+f);0<f.length&&(b(".selico",q).on("mousedown",function(){b(z).data("keep-open",!0);setTimeout(function(){b(z).data("keep-open",!1)},100)}),b(".selico",q).off("click").on("click",function(a){a.stopImmediatePropagation();b.isFunction(m.btnClick)&&m.btnClick(b(z).val(),n,d,l,n==h.records.length?1:0,function(a){1==a?b(z).data("keep-open",!0):2==a&&(b(z).data("keep-open",!1),b(z).focus())})}));c={cache:!1,empty:!1,highlightMatches:!0,lblF:1,valF:0,source:[]};m.relF&&(c.lblF=m.relF.show,c.valF=m.relF.val);b.isFunction(m.getSql)?(c.fireURLDyn="1",c.fireQuery=function(a){var d={};d.url=1==$T.transFlag?"transData?url\x3d"+encodeURIComponent($T.dataUrl+"/RunPageDoLX"):$T.dataUrl+"/RunPageDoLX";if(b.isFunction(m.getSql)){var c={pId:"",sqlId:"",paras:{}};m.getSql(c);d.para={token:$T.runkey,dbPool:"",pId:c.pId,sqlId:c.sqlId,para:c.paras,lxValue:a};return d}}):b.isFunction(m.getData)&&(c.source=m.getData(b(z).val(),n,d,l,n==h.records.length?1:0));var z=q.find("input").get(0);b(z).autocompleter(c);null==e&&b(z).val("object"!=typeof v?v:"");setTimeout(function(){b(z).on("blur",function(a){1==b(this).data("keep-open")?b(z).focus():(b.isFunction(m.vaild)&&0==m.vaild(b(z).val())&&b(z).val(""),h.editChange.call(h,z,n,d,a),b(z).autocompleter("destroy"))})},10);null!=e&&b(z).val("object"!=typeof v?v:"");break;case "div":f=w.find("[col\x3d"+d+"] \x3e div");f="font-family: "+f.css("font-family")+"; font-size: "+f.css("font-size")+";";q.addClass("w2ui-editable").html('\x3cdiv id\x3d"grid_'+h.name+"_edit_"+a+"_"+d+'" class\x3d"w2ui-input"    contenteditable style\x3d"'+f+c+m.style+'" autocorrect\x3d"off" autocomplete\x3d"off" spellcheck\x3d"false"     field\x3d"'+g.field+'" recid\x3d"'+a+'" column\x3d"'+d+'" '+m.inTag+"\x3e\x3c/div\x3e"+m.outTag);null==e&&q.find("div.w2ui-input").text("object"!=typeof v?v:"");z=q.find("div.w2ui-input").get(0);setTimeout(function(){var a=z;b(a).on("blur",function(c){1!=b(this).data("keep-open")&&h.editChange.call(h,a,n,d,c)})},10);null!=e&&b(z).text("object"!=typeof v?v:"");break;default:f=w.find("[col\x3d"+d+"] \x3e div"),f="font-family: "+f.css("font-family")+"; font-size: "+f.css("font-size"),r=w="","textCmd"==m.type&&(w='\x3ci class\x3d"selico fa '+(m.ico&&0<m.ico.length?m.ico:"fa-podcast")+'" style\x3d"margin-left: -15px;cursor: pointer;"\x3e\x3c/i\x3e',r=";padding-right: 20px;"),q.addClass("w2ui-editable").html("\x3cinput  "+(m.readonly?"readonly\x3d'true'":"")+' id\x3d"grid_'+h.name+"_edit_"+a+"_"+d+'" autocorrect\x3d"off" autocomplete\x3d"off" spellcheck\x3d"false" type\x3d"text"     style\x3d"'+f+"; width: 100%; height: 100%; padding: 3px; border-color: transparent; outline: none; border-radius: 0; "+r+"       pointer-events: auto; "+c+m.style+'"     field\x3d"'+g.field+'" recid\x3d"'+a+'" column\x3d"'+d+'" class\x3d"w2ui-input"'+m.inTag+"/\x3e"+w+m.outTag),"number"==m.type&&(v=w2utils.formatNumber(v)),"date"==m.type&&(v=w2utils.formatDate(w2utils.isDate(v,m.format,!0),m.format)),"textCmd"==m.type&&(b(".selico",q).on("mousedown",function(){b(z).data("keep-open",!0);setTimeout(function(){b(z).data("keep-open",!1)},100)}),b(".selico",q).off("click").on("click",function(a){a.stopImmediatePropagation();b.isFunction(m.btnClick)&&m.btnClick(b(z).val(),n,d,l,n==h.records.length?1:0,function(a){1==a?b(z).data("keep-open",!0):2==a&&(b(z).data("keep-open",!1),b(z).focus())})})),null==e&&q.find("input").val("object"!=typeof v?v:""),z=q.find("input").get(0),b(z).w2field(m.type,b.extend(m,{selected:v})),setTimeout(function(){var a=z;"list"==m.type&&(a=b(b(z).data("w2field").helpers.focus).find("input"),"object"!=typeof v&&""!=v&&a.val(v).css({opacity:1}).prev().css({opacity:1}),q.find("input").on("change",function(a){h.editChange.call(h,z,n,d,a)}));b(a).on("blur",function(a){1==b(this).data("keep-open")?b(z).focus():h.editChange.call(h,z,n,d,a)})},10),null!=e&&b(z).val("object"!=typeof v?v:"")}setTimeout(function(){q.find("input, select, div.w2ui-input").data("old_value",p).on("mousedown",function(a){a.stopPropagation()}).on("click",function(a){"div"==m.type?k.call(q.find("div.w2ui-input")[0],null):k.call(q.find("input, select")[0],null)}).on("paste",function(a){var b=a.originalEvent;a.preventDefault();a=b.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,a)}).on("keydown",function(c){var e=this,f="DIV"==e.tagName.toUpperCase()?b(e).text():b(e).val();switch(c.keyCode){case 8:"list"!=m.type||b(z).data("w2field")||c.preventDefault();break;case 9:case 13:c.preventDefault();break;case 37:0===w2utils.getCursorPosition(e)&&c.preventDefault();break;case 39:w2utils.getCursorPosition(e)==f.length&&(w2utils.setCursorPosition(e,f.length),c.preventDefault())}setTimeout(function(){switch(c.keyCode){case 13:if(g.field&&l[g.field]!=b(e).val()&&!0===h.trigger({phase:"before",type:"changeEnter",target:h.name,relField:g.field,column:d,value:b(e).val(),index:n,recData:l,originalEvent:c}).isCancelled)return!0;for(var f=a,m=c.shiftKey?h.prevCell(n,d,!0):h.nextCell(n,d,!0),u=h.getCellEditable(n,m);null==u&&null!=m;)m=c.shiftKey?h.prevCell(n,m,!0):h.nextCell(n,m,!0),u=h.getCellEditable(n,m);u=0;if(null==m){var t=c.shiftKey?h.prevRow(n,d):h.nextRow(n,d);if(t||0===t)u=c.shiftKey?-1:1;if(null!=t&&t!=n)for(h.records[t]?f=h.records[t].recid:h.emptyNewRow&&(f=h.NewRecId),t=0;t<h.columns.length;t++){var q=h.getCellEditable(n,t);if(null!=q&&-1==["checkbox","check","faImg"].indexOf(q.type)&&(m=parseInt(t),!c.shiftKey))break}}!1===f&&(f=a);null==m&&(m=d);e.blur();var w=n+u;setTimeout(function(){"row"!=h.selectType?(h.selectNone(),h.select({recid:f,column:m})):h.editField(f,m,null,c,w);h.scrollIntoView(w)},1);c.preventDefault&&c.preventDefault();break;case 38:if((u=h.getCellEditable(n,d))&&("select"==u.type||"dynselect"==u.type||"autoselect"==u.type))break;var p=h.prevRow(n,d);if(null==p)break;e.blur();setTimeout(function(){null!=p&&p!=n&&setTimeout(function(){"row"!=h.selectType?(h.selectNone(),h.select({recid:h.records[p].recid,column:d})):h.records[p]?h.editField(h.records[p].recid,d,null,c,p):h.emptyNewRow?h.editField(h.NewRecId,d,null,c,p):h.selectNone();h.scrollIntoView(p)},1);"DIV"==e.tagName.toUpperCase()&&c.preventDefault()},1);break;case 40:if((u=h.getCellEditable(n,d))&&("select"==u.type||"dynselect"==u.type||"autoselect"==u.type))break;p=h.nextRow(n,d);if(null==p)break;e.blur();setTimeout(function(){null!=p&&p!=n&&setTimeout(function(){"row"!=h.selectType?(h.selectNone(),h.select({recid:h.records[p].recid,column:d})):h.records[p]?h.editField(h.records[p].recid,d,null,c,p):h.emptyNewRow?h.editField(h.NewRecId,d,null,c,p):h.selectNone();h.scrollIntoView(p)},1);"DIV"==e.tagName.toUpperCase()&&c.preventDefault()},1);break;case 27:u=h.parseField(l,g.field),l&&l.w2ui&&l.w2ui.changes&&null!=l.w2ui.changes[g.field]&&(u=l.w2ui.changes[g.field]),null!=b(e).data("old_value")&&(u=b(e).data("old_value")),"DIV"==e.tagName.toUpperCase()?b(e).text(null!=u?u:""):e.value=null!=u?u:"",e.blur(),setTimeout(function(){h.select({recid:a,column:d})},1)}k.call(e,c)},1)}).on("keyup",function(a){k.call(this,a)});setTimeout(function(){var a=q.find(".w2ui-input");if(0<b(a).length){var c=b(a).val().length;"div"==m.type&&(c=b(a).text().length);0<a.length&&(a.focus(),h.scrollIntoView(n),clearTimeout(h.last.kbd_timer),"SELECT"!=a[0].tagName&&w2utils.setCursorPosition(a[0],c),a[0].resize=k,k.call(a[0],null))}},50);h.trigger(b.extend(t,{phase:"after",input:q.find("input, select, div.w2ui-input")}))},5)}}}}},imgClick:function(a,d,e,c){b.isFunction(this.onImgClick)&&(a=0>d,d=0>d?-d-1:d,a=a?this.summary:this.records,this.onImgClick(d,e,a[d],a))},icoClick:function(a,d,e,c){b.isFunction(this.onIcoClick)&&(a=0>d,d=0>d?-d-1:d,a=a?this.summary:this.records,this.onIcoClick(d,e,a[d],a))},cellLblClick:function(a,d,e,c){b.isFunction(this.onLblClick)&&(c=0>d,d=0>d?-d-1:d,c=c?this.summary:this.records,this.onLblClick(d,e,c[d],c,b(a).text()))},editChange:function(a,d,e,c){var f=this;setTimeout(function(){var a=b(f.box).find("#grid_"+f.name+"_focus");a.is(":focus")||a.focus()},10);var k=0>d;d=0>d?-d-1:d;var h=k?this.summary:this.records,n=h[d],m,l=0;n?m=n.recid:d==f.records.length&&f.emptyNewRow&&(m=f.NewRecId,l=1);var g=this.columns[e],t=a.tagName&&"DIV"==a.tagName.toUpperCase()?b(a).text():a.value,w=void 0;g&&g.editable&&"dynselect"==g.editable.type&&(w=t,t=b(a).find("option:selected").text());var q=this.parseField(n,g.field),v=b(a).data("w2field");if(v){"list"==v.type&&(t=b(a).data("selected"));if(b.isEmptyObject(t)||null==t)t="";b.isPlainObject(t)||(t=v.clean(t))}if("checkbox"==a.type){if(g.editable.onlyChk&&a.checked&&(b('tr[index!\x3d"'+d+'"] [col\x3d'+e+"] input[type\x3dcheckbox]:checked",f.box).prop("checked",!1),void 0!=g.field))for(var t=void 0!=g.editable.check?g.editable.check:1,v=void 0!=g.editable.unCheck?g.editable.unCheck:0,p=h.length,r=0;r<p;r++)r!=d&&h[r][g.field]==t&&(h[r][g.field]=v);t=a.checked?void 0!=g.editable.check?g.editable.check:1:void 0!=g.editable.unCheck?g.editable.unCheck:0}a={phase:"before",type:"change",target:this.name,input_id:a.id,recid:m,index:d,column:e,originalEvent:c.originalEvent?c.originalEvent:c,relField:g.field,value_new:t,value_previous:n&&n.w2ui&&n.w2ui.changes&&n.w2ui.changes.hasOwnProperty(g.field)?n.w2ui.changes[g.field]:q,value_original:q};void 0!=w&&(a.value_data=w);""!=t&&l&&(n=[],n.recid=m,n.editFlag=2,h.push(n),f.total=f.getTotalRec(),b.isFunction(f.newRowEvent)&&f.newRowEvent(n,f.records),h=b("#grid_"+f.name+"_rec_bottom",f.box),l=b("#grid_"+f.name+"_frec_bottom",f.box),w=this.getRecordHTML(this.records.length,this.records.length+1),h.before(w[1]),l.before(w[0]),this.last.range_end++,this.total=this.getTotalRec(),this.resizeRecords());a.rowData=n;h=b("#grid_"+this.name+(!0===g.frozen?"_frec_":"_rec_")+w2utils.escapeId(m),f.box);null!=b(c.target).data("old_value")&&(a.value_previous=b(c.target).data("old_value"));for(;;){t=a.value_new;if("object"!=typeof t&&String(q)!=String(t)||"object"==typeof t&&t.id!=q&&("object"!=typeof q||null==q||t.id!=q.id)){if(a=this.trigger(b.extend(a,{type:"change",phase:"before"})),!0!==a.isCancelled){if(t!==a.value_new)continue;g&&g.editable&&void 0!=g.editable.valcol&&(a.refreshRow=!0,n[g.editable.valcol]=a.value_data);n[g.field]=a.value_new;n.editFlag?1>n.editFlag&&(n.editFlag=1):n.editFlag=1;this.trigger(b.extend(a,{phase:"after",onComplete:this.onComplete}))}}else if(a=this.trigger(b.extend(a,{type:"restore",phase:"before"})),!0!==a.isCancelled){if(t!==a.value_new)continue;n&&n.w2ui&&n.w2ui.changes&&delete n.w2ui.changes[g.field];n&&n.w2ui&&b.isEmptyObject(n.w2ui.changes)&&delete n.w2ui.changes;this.trigger(b.extend(a,{phase:"after"}))}break}c=b(h).find("[col\x3d"+e+"]");if(!k)if(n&&n.w2ui&&n.w2ui.changes&&null!=n.w2ui.changes[g.field]?c.addClass("w2ui-changed"):c.removeClass("w2ui-changed"),a.refreshRow)for(e=f.columns.length,m=b("#grid_"+f.name+(!0===g.frozen?"_rec_":"_frec_")+w2utils.escapeId(m),f.box),g=0;g<e;g++)n=b(h).find("[col\x3d"+g+"]"),0==n.length&&(n=m.find("[col\x3d"+g+"]")),c=this.getCellHTML(d,g,k),b("div",n).attr("title")!=b("div",c).attr("title")&&n.replaceWith(c);else c.replaceWith(this.getCellHTML(d,e,k));b(this.box).find("div.w2ui-edit-box").remove();this.show.toolbarSave&&(0<this.getChanges().length?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"))},click:function(a,d,e){if(void 0!=d){if(void 0==e){var c=b(d.target).parents("tr");if(void 0==c.attr("line"))return;e=c.attr("line")-1}var f=(new Date).getTime(),k=null,c=this;if(!(1==this.last.cancelClick||d&&d.altKey))if("object"==typeof a&&(k=a.column,a=a.recid),null==d&&(d={}),350>f-parseInt(this.last.click_time)&&this.last.click_recid==a&&"click"==d.type)this.dblClick(a,d,e);else{if(null==k&&d.target){var h=d.target;"TD"!=h.tagName.toUpperCase()&&(h=b(h).parents("td")[0]);null!=b(h).attr("col")&&(k=parseInt(b(h).attr("col")))}if(h=this.getCellEditable(e,k)){if("faImg"==h.type)return;this.editField(a,k,null,d,e)}this.last.bubbleEl&&(b(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);this.last.click_time=f;var n=this.last.click_recid;this.last.click_recid=a;e=this.trigger({phase:"before",target:this.name,type:"click",rowData:c.records[e],row:e,recid:a,column:k,originalEvent:d});if(!0!==e.isCancelled){c=this;h=this.getSelection();b("#grid_"+this.name+"_check_all",c.box).prop("checked",!1);var g=this.get(a,!0),f=[];c.last.sel_ind=g;c.last.sel_col=k;c.last.sel_recid=a;c.last.sel_type="click";if(d.shiftKey&&0<h.length&&c.multiSelect){if(h[0].recid)for(d=this.get(h[0].recid,!0),a=this.get(a,!0),k>h[0].column?g=h[0].column:(g=k,k=h[0].column),h=g;h<=k;h++)f.push(h);else d=this.get(n,!0),a=this.get(a,!0);k=[];d>a&&(h=d,d=a,a=h);for(;d<=a;d++)if(!(0<this.searchData.length&&-1==b.inArray(d,this.last.searchIds)))if("row"==this.selectType)k.push(this.records[d].recid);else for(h=0;h<f.length;h++)k.push({recid:this.records[d].recid,column:f[h]});this.select.apply(this,k)}else if(f=this.last.selection,n=-1!=f.indexes.indexOf(g)?!0:!1,!n){var l=!1;b(d.target).parents("td").hasClass("w2ui-col-select")&&(l=!0);(d.ctrlKey||d.shiftKey||d.metaKey||l)&&this.multiSelect||this.showSelectColumn?("row"!=this.selectType&&-1==b.inArray(k,f.columns[g])&&(n=!1),!0===n?this.unselect({recid:a,column:k}):this.select({recid:a,column:k})):("row"!=this.selectType&&-1==b.inArray(k,f.columns[g])&&(n=!1),300<h.length?this.selectNone():this.unselect.apply(this,h),!0===n&&1==h.length?this.unselect({recid:a,column:k}):this.select({recid:a,column:k}))}this.status();c.initResize();this.trigger(b.extend(e,{phase:"after"}))}}}},columnClick:function(a,d){var e=this.trigger({phase:"before",type:"columnClick",target:this.name,field:a,originalEvent:d});if(!0!==e.isCancelled){if("row"==this.selectType){var c=this.getColumn(a);c&&c.sortable&&this.sort(a,null,d&&(d.ctrlKey||d.metaKey)?!0:!1);"line-number"==e.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll())}else if("line-number"==e.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{d.shiftKey||d.metaKey||d.ctrlKey||this.selectNone();var f=this.getSelection(),c=this.getColumn(e.field,!0);a=[];var k=[];if(0!=f.length&&d.shiftKey)for(d=c,e=f[0].column,d>e&&(d=f[0].column,e=c),c=d;c<=e;c++)k.push(c);else k.push(c);e=this.trigger({phase:"before",type:"columnSelect",target:this.name,columns:k});if(!0!==e.isCancelled){for(c=0;c<this.records.length;c++)a.push({recid:this.records[c].recid,column:k});this.select.apply(this,a)}this.trigger(b.extend(e,{phase:"after"}))}this.trigger(b.extend(e,{phase:"after"}))}},columnDblClick:function(a,d){a=this.trigger({phase:"before",type:"columnDblClick",target:this.name,field:a,originalEvent:d});!0!==a.isCancelled&&this.trigger(b.extend(a,{phase:"after"}))},focus:function(a){var d=this;a=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:a});if(!0===a.isCancelled)return!1;this.hasFocus=!0;b(this.box).find(".w2ui-inactive").removeClass("w2ui-inactive");setTimeout(function(){var a=b(d.box).find("#grid_"+d.name+"_focus");a.is(":focus")||a.focus()},10);this.trigger(b.extend(a,{phase:"after"}))},blur:function(a){a=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:a});if(!0===a.isCancelled)return!1;this.hasFocus=!1;b(this.box).find(".w2ui-selected").addClass("w2ui-inactive");b(this.box).find(".w2ui-selection").addClass("w2ui-inactive");this.trigger(b.extend(a,{phase:"after"}))},keydown:function(a){function d(){var a=Math.floor(h[0].scrollTop/c.recordHeight)+1;if(!c.records[a]||2>a)a=0;c.select({recid:c.records[a].recid,column:0})}function e(){if("click"!=c.last.sel_type)return!1;if("row"!=c.selectType){if(c.last.sel_type="key",1<n.length){for(var a=0;a<n.length;a++)if(n[a].recid==c.last.sel_recid&&n[a].column==c.last.sel_col){n.splice(a,1);break}c.unselect.apply(c,n);return!0}}else if(c.last.sel_type="key",1<n.length)return n.splice(n.indexOf(c.records[c.last.sel_ind].recid),1),c.unselect.apply(c,n),!0;return!1}var c=this;if(!0===c.keyboard){var f=c.trigger({phase:"before",type:"keydown",target:c.name,originalEvent:a});if(!0!==f.isCancelled)if(0<b(this.box).find("\x3e.w2ui-message").length)27==a.keyCode&&this.message();else{var k=!1,h=b("#grid_"+c.name+"_records",c.box),n=c.getSelection();0===n.length&&(k=!0);var g=n[0]||null,l=[],u=n[n.length-1];if("object"==typeof g&&null!=g){for(var g=n[0].recid,l=[],t=0;n[t]&&n[t].recid==g;)l.push(n[t].column),t++;u=n[n.length-1].recid}var t=c.get(g,!0),w=c.get(u,!0);c.get(g);var q=b("#grid_"+c.name+"_rec_"+(null!=t?w2utils.escapeId(c.records[t].recid,c.box):"none")),v=!1,u=a.keyCode,p=a.shiftKey;switch(u){case 8:case 46:if(this.show.toolbarDelete||this.onDelete)c["delete"]();v=!0;a.stopPropagation();break;case 27:c.selectNone();v=!0;break;case 65:if(!a.metaKey&&!a.ctrlKey)break;c.selectAll();v=!0;break;case 13:if("row"==this.selectType&&!0===c.show.expandColumn)0>=q.length||(c.toggle(g,a),v=!0);else{for(p=0;p<this.columns.length;p++)if(this.getCellEditable(t,p)){l.push(parseInt(p));break}"row"==this.selectType&&this.last.edit_col&&(l=[this.last.edit_col]);0<l.length&&(c.editField(g,l[0],null,a),v=!0)}break;case 37:if(k){d();break}if("row"==this.selectType){if(0>=q.length)break;var r;this.records[t]?(r=this.getChildParId(this.records[t]),k=this.records[t].w2ui||{}):k={};!k||null==r||Array.isArray(c.getChild(this.records[t]))&&0!==c.getChild(this.records[t]).length&&c.getChildExpend(this.records[t])?c.collapse(g,a):(c.unselect(g),c.collapse(r,a),c.select(r))}else if(r=c.prevCell(t,l[0]),p||null!=r||(this.selectNone(),r=0),null!=r)if(p&&c.multiSelect){if(e())return;k=[];v=[];w=[];if(0===l.indexOf(this.last.sel_col)&&1<l.length){for(p=0;p<n.length;p++)-1==k.indexOf(n[p].recid)&&k.push(n[p].recid),w.push({recid:n[p].recid,column:l[l.length-1]});c.unselect.apply(c,w);c.scrollIntoView(t,l[l.length-1],!0)}else{for(p=0;p<n.length;p++)-1==k.indexOf(n[p].recid)&&k.push(n[p].recid),v.push({recid:n[p].recid,column:r});c.select.apply(c,v);c.scrollIntoView(t,r,!0)}}else a.metaKey=!1,c.click({recid:g,column:r},a),c.scrollIntoView(t,r,!0);else if(!p)if(1<n.length)c.selectNone();else for(t=1;t<n.length;t++)c.unselect(n[t]);v=!0;break;case 39:if(k){d();break}if("row"==this.selectType){if(0>=q.length)break;c.expand(g,a)}else if(r=c.nextCell(t,l[l.length-1]),p||null!=r||(this.selectNone(),r=this.columns.length-1),null!=r)if(p&&39==u&&c.multiSelect){if(e())return;k=[];v=[];w=[];if(l.indexOf(this.last.sel_col)==l.length-1&&1<l.length){for(p=0;p<n.length;p++)-1==k.indexOf(n[p].recid)&&k.push(n[p].recid),w.push({recid:n[p].recid,column:l[0]});c.unselect.apply(c,w);c.scrollIntoView(t,l[0],!0)}else{for(p=0;p<n.length;p++)-1==k.indexOf(n[p].recid)&&k.push(n[p].recid),v.push({recid:n[p].recid,column:r});c.select.apply(c,v);c.scrollIntoView(t,r,!0)}}else a.metaKey=!1,c.click({recid:g,column:r},a),c.scrollIntoView(t,r,!0);else if(!p)if(1<n.length)c.selectNone();else for(t=0;t<n.length-1;t++)c.unselect(n[t]);v=!0;break;case 38:k&&d();if(0>=q.length)break;r=c.prevRow(t,l[0]);p||null!=r||(r=0!=this.searchData.length?this.last.searchIds[0]:0);if(null!=r){if(p&&c.multiSelect){if(e())return;if("row"==c.selectType)c.last.sel_ind>r&&c.last.sel_ind!=w?c.unselect(c.records[w].recid):c.select(c.records[r].recid);else if(c.last.sel_ind>r&&c.last.sel_ind!=w){r=w;k=[];for(p=0;p<l.length;p++)k.push({recid:c.records[r].recid,column:l[p]});c.unselect.apply(c,k)}else{k=[];for(p=0;p<l.length;p++)k.push({recid:c.records[r].recid,column:l[p]});c.select.apply(c,k)}}else 300<n.length?this.selectNone():this.unselect.apply(this,n),c.records[r]&&c.click({recid:c.records[r].recid,column:l[0]},a,r);c.scrollIntoView(r);a.preventDefault&&a.preventDefault()}else if(!p)if(1<n.length)c.selectNone();else for(t=1;t<n.length;t++)c.unselect(n[t]);break;case 40:k&&d();if(0>=q.length)break;r=c.nextRow(w,l[0]);p||null!=r||(r=0!=this.searchData.length?this.last.searchIds[this.last.searchIds.length-1]:this.records.length-1);if(null!=r){if(p&&c.multiSelect){if(e())return;if("row"==c.selectType)this.last.sel_ind<r&&this.last.sel_ind!=t?c.unselect(c.records[t].recid):c.select(c.records[r].recid);else if(this.last.sel_ind<r&&this.last.sel_ind!=t){r=t;k=[];for(p=0;p<l.length;p++)k.push({recid:c.records[r].recid,column:l[p]});c.unselect.apply(c,k)}else{k=[];for(p=0;p<l.length;p++)k.push({recid:c.records[r].recid,column:l[p]});c.select.apply(c,k)}}else 300<n.length?this.selectNone():this.unselect.apply(this,n),c.records[r]?c.click({recid:c.records[r].recid,column:l[0]},a,r):c.emptyNewRow&&c.click({recid:c.NewRecId,column:l[0]},a,r);c.scrollIntoView(r);v=!0}else if(!p)if(1<n.length)c.selectNone();else for(t=0;t<n.length-1;t++)c.unselect(n[t]);break;case 17:case 91:if(k)break;c.last.isSafari&&(c.last.copy_event=c.copy(!1,a),b("#grid_"+c.name+"_focus",c.box).val(c.last.copy_event.text).select());break;case 67:if(a.metaKey||a.ctrlKey)c.last.isSafari||(c.last.copy_event=c.copy(!1,a),b("#grid_"+c.name+"_focus",c.box).val(c.last.copy_event.text).select()),c.copy(c.last.copy_event,a);break;case 88:k||!a.ctrlKey&&!a.metaKey||(c.last.isSafari||(c.last.copy_event=c.copy(!1,a),b("#grid_"+c.name+"_focus",c.box).val(c.last.copy_event.text).select()),c.copy(c.last.copy_event,a),setTimeout(function(){c["delete"](!0)},100))}k=[32,187,189,192,219,220,221,186,222,188,190,191];for(p=48;111>=p;p++)k.push(p);-1==k.indexOf(u)||a.ctrlKey||a.metaKey||v||(0===l.length&&l.push(0),v=!1,setTimeout(function(){var d=b("#grid_"+c.name+"_focus",c.box),e=d.val();d.val("");c.editField(g,l[0],e,a)},1));v&&a.preventDefault&&a.preventDefault();c.trigger(b.extend(f,{phase:"after"}))}}},scrollIntoView:function(a,d,e){var c=this.records.length;0!=this.searchData.length&&(c=this.last.searchIds.length);if(0!==c){if(null==a){var f=this.getSelection();if(0===f.length)return;b.isPlainObject(f[0])?(a=f[0].index,d=f[0].column):a=this.get(f[0],!0)}var f=b("#grid_"+this.name+"_records",this.box),k=this.last.searchIds.length;0<k&&(a=this.last.searchIds.indexOf(a));f.height()<this.recordHeight*(0<k?k:c)&&0<f.length&&(c=Math.floor(f[0].scrollTop/this.recordHeight),k=c+Math.floor(f.height()/this.recordHeight),a==c&&(!0===e?f.prop({scrollTop:f.scrollTop()-f.height()/1.3}):(f.stop(),f.animate({scrollTop:f.scrollTop()-f.height()/1.3},250,"linear"))),a==k&&(!0===e?f.prop({scrollTop:f.scrollTop()+f.height()/1.3}):(f.stop(),f.animate({scrollTop:f.scrollTop()+f.height()/1.3},250,"linear"))),a<c||a>k)&&(!0===e?f.prop({scrollTop:(a-1)*this.recordHeight}):(f.stop(),f.animate({scrollTop:(a-1)*this.recordHeight},250,"linear")));if(null!=d){for(var c=a=0,k=w2utils.scrollBarSize(),h=0;h<=d;h++){var n=this.columns[h];n.frozen||n.hidden||(a=c,c+=parseInt(n.sizeCalculated))}f.width()<c-f.scrollLeft()?!0===e?f.prop({scrollLeft:a-k}):f.animate({scrollLeft:a-k},250,"linear"):a<f.scrollLeft()&&(!0===e?f.prop({scrollLeft:c-f.width()+2*k}):f.animate({scrollLeft:c-f.width()+2*k},250,"linear"))}}},dblClick:function(a,d,e){var c=null;"object"==typeof a&&(c=a.column,a=a.recid);null==d&&(d={});null==c&&d.target&&(c=d.target,"TD"!=c.tagName.toUpperCase()&&(c=b(c).parents("td")[0]),c=parseInt(b(c).attr("col")));e=e?e:this.get(a,!0);var f=this.records[e];d=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:a,rowIndex:e,rowData:f,column:c,originalEvent:d});!0!==d.isCancelled&&(this.selectNone(),this.getCellEditable(e,c)||(this.select({recid:a,column:c}),(this.show.expandColumn||this.getChild(f))&&this.toggle(a)),this.trigger(b.extend(d,{phase:"after"})))},contextMenu:function(a,d,e){var c=this;if("text"!=c.last.userSelect){null==e&&(e={offsetX:0,offsetY:0,target:b("#grid_"+c.name+"_rec_"+a,c.box)[0]});null==e.offsetX&&(e.offsetX=e.layerX-e.target.offsetLeft,e.offsetY=e.layerY-e.target.offsetTop);w2utils.isFloat(a)&&(a=parseFloat(a));var f=this.getSelection();if("row"==this.selectType)-1==f.indexOf(a)&&c.click(a);else{d=b(e.target);"TD"!=d[0].tagName.toUpperCase()&&(d=b(e.target).parents("td"));var k=!1;d=d.attr("col");for(var h=0;h<f.length;h++)if(f[h].recid==a||f[h].column==d)k=!0;k||null==a||c.click({recid:a,column:d});k||null==d||c.columnClick(this.columns[d].field,e)}f=c.trigger({phase:"before",type:"contextMenu",target:c.name,originalEvent:e,recid:a,column:d});!0!==f.isCancelled&&(0<c.menu.length&&b(c.box).find(e.target).w2menu(c.menu,{originalEvent:e,contextMenu:!0,onSelect:function(b){c.menuClick(a,parseInt(b.index),b.originalEvent)}}),e.preventDefault&&e.preventDefault(),c.trigger(b.extend(f,{phase:"after"})))}},menuClick:function(a,d,e){a=this.trigger({phase:"before",type:"menuClick",target:this.name,originalEvent:e,recid:a,menuIndex:d,menuItem:this.menu[d]});!0!==a.isCancelled&&this.trigger(b.extend(a,{phase:"after"}))},toggle:function(a){var b=this.get(a);return!0===this.getChildExpend(b)?this.collapse(a):this.expand(a)},expandAllRow:function(){for(var a=this,b=a.records.length-1;0<=b;b--){var e=a.records[b],c=a.getChild(e);Array.isArray(c)&&(void 0==e.recid&&(e.recid=this.getNewRecId()),!0!==a.getChildExpend(e)&&0!==c.length&&(a.setChildExpend(e,!0),c.forEach(function(b){b.w2ui=b.w2ui||{};void 0==b.recid&&(b.recid=e.recid+"_"+a.getNewRecId());a.setChildParId(b,e.recid)}),this.records.splice.apply(this.records,[b+1,0].concat(c)),this.total+=c.length))}0<a.searchData.length&&a.localSearch(!0);a.refresh()},expand:function(a,d){var e=this,c=this.get(a,!0),f=this.records[c];f.w2ui=f.w2ui||{};var k=w2utils.escapeId(a),h=e.getChild(f);if(Array.isArray(h)){if(!0===e.getChildExpend(f)||0===h.length)return!1;var n=this.trigger({phase:"before",type:"expand",target:this.name,recid:a});if(!0===n.isCancelled)return!1;e.setChildExpend(f,!0);h.forEach(function(a){a.w2ui=a.w2ui||{};void 0==a.recid&&(a.recid=f.recid+"_"+e.getNewRecId());e.setChildParId(a,f.recid)});this.records.splice.apply(this.records,[c+1,0].concat(h));this.total+=h.length;0<this.searchData.length&&this.localSearch(!0);d||this.refresh();this.trigger(b.extend(n,{phase:"after"}))}else{if(0<b("#grid_"+this.name+"_rec_"+k+"_expanded_row",e.box).length||!0!==this.show.expandColumn||"none"==e.getChildExpend(f))return!1;b("#grid_"+this.name+"_rec_"+k,e.box).after('\x3ctr id\x3d"grid_'+this.name+"_rec_"+a+'_expanded_row" class\x3d"w2ui-expanded-row"\x3e    \x3ctd colspan\x3d"100" class\x3d"w2ui-expanded2"\x3e        \x3cdiv id\x3d"grid_'+this.name+"_rec_"+a+'_expanded"\x3e\x3c/div\x3e    \x3c/td\x3e    \x3ctd class\x3d"w2ui-grid-data-last"\x3e\x3c/td\x3e\x3c/tr\x3e');b("#grid_"+this.name+"_frec_"+k,e.box).after('\x3ctr id\x3d"grid_'+this.name+"_frec_"+a+'_expanded_row" class\x3d"w2ui-expanded-row"\x3e'+(this.show.lineNumbers?'\x3ctd class\x3d"w2ui-col-number"\x3e\x3c/td\x3e':"")+'    \x3ctd class\x3d"w2ui-grid-data w2ui-expanded1" colspan\x3d"100"\x3e       \x3cdiv id\x3d"grid_'+this.name+"_frec_"+a+'_expanded"\x3e\x3c/div\x3e   \x3c/td\x3e\x3c/tr\x3e');n=this.trigger({phase:"before",type:"expand",target:this.name,recid:a,box_id:"grid_"+this.name+"_rec_"+a+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+k+"_expanded"});if(!0===n.isCancelled)return b("#grid_"+this.name+"_rec_"+k+"_expanded_row",e.box).remove(),b("#grid_"+this.name+"_frec_"+k+"_expanded_row",e.box).remove(),!1;d=b(this.box).find("#grid_"+this.name+"_rec_"+a+"_expanded");c=b(this.box).find("#grid_"+this.name+"_frec_"+a+"_expanded");h=d.find("\x3e div:first-child").height();d.height()<h&&d.css({height:h+"px"});c.height()<h&&c.css({height:h+"px"});b("#grid_"+this.name+"_rec_"+k,e.box).attr("expanded","yes").addClass("w2ui-expanded");b("#grid_"+this.name+"_frec_"+k,e.box).attr("expanded","yes").addClass("w2ui-expanded");b("#grid_"+this.name+"_cell_"+this.get(a,!0)+"_expand div",e.box).html("-");e.setChildExpend(f,!0);this.trigger(b.extend(n,{phase:"after"}));this.resizeRecords()}return!0},collapseAllRow:function(a){collapseOne(this.records,0);this.total=this.getTotalRec();a||this.refresh()},collapseOne:function(a,b){if(!(a.length<=b)){var d=this,c=a[b],f=d.getChild(c);if(Array.isArray(f)){var k=function(a){d.setChildExpend(a,!1);a=d.getChild(a);for(var b=0;b<a.length;b++){var c=a[b];d.getChildExpend(c)&&k(c)}};if(!0!==d.getChildExpend(c)){d.collapseOne(a,b+1);return}k(c);for(f=[];null!=c;c=this.get(d.getChildParId(c)))f.push(d.getChildParId(c));for(var h=c=ind+1;!(a.length<=h+1||0<=f.indexOf(d.getChildParId(a[h+1])));)h++;a.splice(c,h-c+1);0<this.searchData.length&&this.localSearch(!0)}d.collapseOne(a,b+1)}},collapse:function(a,d){function e(a){c.setChildExpend(a,!1);a=c.getChild(a);for(var b=0;b<a.length;b++){var d=a[b];c.getChildExpend(d)&&e(d)}}var c=this,f=this.get(a,!0),k=this.records[f];k.w2ui=k.w2ui||{};var h=w2utils.escapeId(a),n=c.getChild(k);if(Array.isArray(n)){if(!0!==c.getChildExpend(k))return!1;var g=this.trigger({phase:"before",type:"collapse",target:this.name,recid:a});if(!0===g.isCancelled)return!1;e(k);a=[];for(n=k;null!=n;n=this.get(c.getChildParId(n)))a.push(c.getChildParId(n));for(n=f+=1;!(this.records.length<=n+1||0<=a.indexOf(c.getChildParId(this.records[n+1])));)n++;this.records.splice(f,n-f+1);this.total-=n-f+1;0<this.searchData.length&&this.localSearch(!0);d||this.refresh();c.trigger(b.extend(g,{phase:"after"}))}else{if(0===b("#grid_"+this.name+"_rec_"+h+"_expanded_row",c.box).length||!0!==this.show.expandColumn)return!1;g=this.trigger({phase:"before",type:"collapse",target:this.name,recid:a,box_id:"grid_"+this.name+"_rec_"+h+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+h+"_expanded"});if(!0===g.isCancelled)return!1;b("#grid_"+this.name+"_rec_"+h,c.box).removeAttr("expanded").removeClass("w2ui-expanded");b("#grid_"+this.name+"_frec_"+h,c.box).removeAttr("expanded").removeClass("w2ui-expanded");b("#grid_"+this.name+"_cell_"+this.get(a,!0)+"_expand div",c.box).html("+");b("#grid_"+c.name+"_rec_"+h+"_expanded",c.box).css("height","0px");b("#grid_"+c.name+"_frec_"+h+"_expanded",c.box).css("height","0px");setTimeout(function(){b("#grid_"+c.name+"_rec_"+h+"_expanded_row",c.box).remove();b("#grid_"+c.name+"_frec_"+h+"_expanded_row",c.box).remove();c.setChildExpend(k,!1);c.trigger(b.extend(g,{phase:"after"}));c.resizeRecords()},300)}return!0},sort:function(a,d,e){var c=this.trigger({phase:"before",type:"sort",target:this.name,field:a,direction:d,multiField:e});if(!0!==c.isCancelled){if(null!=a){for(var f=this.sortData.length,k=0;k<this.sortData.length;k++)if(this.sortData[k].field==a){f=k;break}if(null==d)if(null==this.sortData[f])d="asc";else switch(String(this.sortData[f].direction)){case "asc":d="desc";break;case "desc":d="asc";break;default:d="asc"}!1===this.multiSort&&(this.sortData=[],f=0);1!=e&&(this.sortData=[],f=0);null==this.sortData[f]&&(this.sortData[f]={});this.sortData[f].field=a;this.sortData[f].direction=d}else this.sortData=[];this.localSort(!0,!0);0<this.searchData.length&&this.localSearch(!0);this.last.scrollTop=0;b("#grid_"+this.name+"_records",this.box).prop("scrollTop",0);this.trigger(b.extend(c,{phase:"after"}));this.refresh()}},copy:function(a,d){if(b.isPlainObject(a))return this.trigger(b.extend(a,{phase:"after"})),a.text;var e=this.getSelection();if(0===e.length)return"";var c="";if("object"==typeof e[0]){for(var f=e[0].column,k=e[0].column,h=[],n=0;n<e.length;n++)e[n].column<f&&(f=e[n].column),e[n].column>k&&(k=e[n].column),-1==h.indexOf(e[n].index)&&h.push(e[n].index);h.sort(function(a,b){return a-b});for(e=0;e<h.length;e++){for(var g=h[e],l=f;l<=k;l++){var u=this.columns[l];!0!==u.hidden&&(c+=w2utils.stripTags(this.getCellHTML(g,l))+"\t")}c=c.substr(0,c.length-1);c+="\n"}}else{for(l=0;l<this.columns.length;l++)u=this.columns[l],!0!==u.hidden&&(f=u.caption?u.caption:u.field,u.caption&&3>u.caption.length&&u.tooltip&&(f=u.tooltip),c+='"'+w2utils.stripTags(f)+'"\t');c=c.substr(0,c.length-1);c+="\n";for(n=0;n<e.length;n++){g=this.get(e[n],!0);for(l=0;l<this.columns.length;l++)u=this.columns[l],!0!==u.hidden&&(c+='"'+w2utils.stripTags(this.getCellHTML(g,l))+'"\t');c=c.substr(0,c.length-1);c+="\n"}}c=c.substr(0,c.length-1);if(null==a){a=this.trigger({phase:"before",type:"copy",target:this.name,text:c,originalEvent:d});if(!0===a.isCancelled)return"";c=a.text;this.trigger(b.extend(a,{phase:"after"}));return c}if(!1===a){a=this.trigger({phase:"before",type:"copy",target:this.name,text:c,originalEvent:d});if(!0===a.isCancelled)return"";c=a.text;return a}},pasteDataFunc:function(a,d){$F.isArray(this.records)||(this.records=[]);d=d.split("\n");var e=this.trigger({phase:"before",type:"paste",target:this.name,text:d,index:-1,column:0});if(!0!==e.isCancelled){var c=0;if(1==this.pasteToData)for(var f=0;f<d.length;f++){for(var k=d[f].split("\t"),h=[],n=0,g=0;g<k.length;g++)0<$F.sL(k[g])&&(n=1),h.push(k[g]);1==n&&(c++,h.editFlag=2,this.records.push(h))}else{for(var l=[],f=0;f<this.columns.length;f++)!this.columns[f]||this.columns[f].editable&&"faImg"==this.columns[f].editable.type||l.push(this.columns[f].field);for(f=0;f<d.length;f++){k=d[f].split("\t");h=[];for(g=n=0;g<k.length;g++)void 0!==l[g]&&(0<$F.sL(k[g])&&(n=1),h[l[g]]=k[g]);1==n&&(c++,h.editFlag=2,this.records.push(h))}}this.selectNone();this.total=this.getTotalRec();this.refresh();this.trigger(b.extend(e,{phase:"after"}));$F.info("\u6210\u529f\u7c98\u8d34["+c+"]")}$F.busyHide(a)},paste:function(a){var b=this;if(b.canPaste&&!b.disEdit&&0<$F.sL(a)){var e=$F.newGuid();$F.busyShow("\u6b63\u5728\u5904\u7406\u7c98\u8d34\u6570\u636e...",e);setTimeout(function(){b.pasteDataFunc(e,a)},100)}},resize:function(){var a=this,d=(new Date).getTime();if(a.box&&b(a.box).attr("name")==a.name)if(b(a.box).is(":hidden"))void 0==a.intVSize&&(a.intVSize=setInterval(function(){0==b(a.box).is(":hidden")&&(clearInterval(a.intVSize),a.resize(),a.intVSize=void 0)},200));else{b(this.box).find("\x3e div.w2ui-grid-box").css("width",b(this.box).width()).css("height",b(this.box).height());var e=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==e.isCancelled)return a.resizeBoxes(),a.resizeRecords(),a.toolbar&&a.toolbar.resize&&a.toolbar.resize(),this.trigger(b.extend(e,{phase:"after"})),(new Date).getTime()-d}},update:function(a){var d=(new Date).getTime();if(null==this.box)return 0;if(null==a)for(var e=this.last.range_start-1;e<=this.last.range_end-1;e++){if(!(0>e)){var c=this.records[e]||{};c.w2ui||(c.w2ui={});for(var f=0;f<this.columns.length;f++){var k=b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(c.recid)),h=b(this.box).find("#grid_"+this.name+"_data_"+e+"_"+f);h.replaceWith(this.getCellHTML(e,f,!1));h=b(this.box).find("#grid_"+this.name+"_data_"+e+"_"+f);null==c.w2ui.style||b.isEmptyObject(c.w2ui.style)?h.attr("style",""):("string"==typeof c.w2ui.style&&k.attr("style",c.w2ui.style),b.isPlainObject(c.w2ui.style)&&"string"==typeof c.w2ui.style[f]&&h.attr("style",c.w2ui.style[f]));null==c.w2ui["class"]||b.isEmptyObject(c.w2ui["class"])||("string"==typeof c.w2ui["class"]&&k.addClass(c.w2ui["class"]),b.isPlainObject(c.w2ui["class"])&&"string"==typeof c.w2ui["class"][f]&&h.addClass(c.w2ui["class"][f]))}}}else for(var n=0;n<a.length;n++)e=a[n].index,f=a[n].column,0>e||(null==e||null==f?console.log("ERROR: Wrong argument for grid.update(cells), cells should be [{ index: X, column: Y }, ...]"):(c=this.records[e]||{},k=b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(c.recid)),h=b(this.box).find("#grid_"+this.name+"_data_"+e+"_"+f),c.w2ui||(c.w2ui={}),h.replaceWith(this.getCellHTML(e,f,!1)),h=b(this.box).find("#grid_"+this.name+"_data_"+e+"_"+f),null==c.w2ui.style||b.isEmptyObject(c.w2ui.style)?h.attr("style",""):("string"==typeof c.w2ui.style&&k.attr("style",c.w2ui.style),b.isPlainObject(c.w2ui.style)&&"string"==typeof c.w2ui.style[f]&&h.attr("style",c.w2ui.style[f])),null==c.w2ui["class"]||b.isEmptyObject(c.w2ui["class"])||("string"==typeof c.w2ui["class"]&&k.addClass(c.w2ui["class"]),b.isPlainObject(c.w2ui["class"])&&"string"==typeof c.w2ui["class"][f]&&h.addClass(c.w2ui["class"][f]))));return(new Date).getTime()-d},refreshCell:function(a,d){var e=this.get(a,!0);a=this.records[e]&&this.records[e].recid==a?!1:!0;d=this.getColumn(d,!0);var c=a?this.summary[e]:this.records[e],f=this.columns[d],k=b(this.box).find("#grid_"+this.name+"_data_"+e+"_"+d);if(null==c)return!1;k.replaceWith(this.getCellHTML(e,d,a));k=b(this.box).find("#grid_"+this.name+"_data_"+e+"_"+d);c.w2ui&&c.w2ui.changes&&null!=c.w2ui.changes[f.field]?k.addClass("w2ui-changed"):k.removeClass("w2ui-changed");c.w2ui&&null!=c.w2ui.style&&!b.isEmptyObject(c.w2ui.style)?("string"==typeof c.w2ui.style&&b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(c.recid)).attr("style",c.w2ui.style),b.isPlainObject(c.w2ui.style)&&"string"==typeof c.w2ui.style[d]&&k.attr("style",c.w2ui.style[d])):k.attr("style","");c.w2ui&&null!=c.w2ui["class"]&&!b.isEmptyObject(c.w2ui["class"])&&("string"==typeof c.w2ui["class"]&&b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(c.recid)).addClass(c.w2ui["class"]),b.isPlainObject(c.w2ui["class"])&&"string"==typeof c.w2ui["class"][d]&&k.addClass(c.w2ui["class"][d]))},refreshRowByIndex:function(a,d){var e=b(this.box).find("tr[id^\x3dgrid_"+this.name+"_frec_][index\x3d"+a+"]"),c=b(this.box).find("tr[id^\x3dgrid_"+this.name+"_rec_][index\x3d"+a+"]");0<e.length?(d=e.attr("line"),d=this.getRecordHTML(a,d,!1,!0),b(e).replaceWith(d[0]),b(c).replaceWith(d[1]),d=this.records[a].w2ui?this.records[a].w2ui.style:"","string"==typeof d&&(e=b(this.box).find("tr[id^\x3dgrid_"+this.name+"_frec_][index\x3d"+a+"]"),c=b(this.box).find("tr[id^\x3dgrid_"+this.name+"_rec_][index\x3d"+a+"]"),e.attr("custom_style",d),c.attr("custom_style",d),e.hasClass("w2ui-selected")&&(d=d.replace("background-color","none")),e[0].style.cssText="height: "+this.recordHeight+"px;"+d,c[0].style.cssText="height: "+this.recordHeight+"px;"+d)):this.refreshRow(d)},refreshRow:function(a,d){var e=b(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(a)),c=b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a));if(0<e.length){null==d&&(d=this.get(a,!0));var f=e.attr("line"),k=this.records[d]&&this.records[d].recid==a?!1:!0;if(0<this.searchData.length)for(var h=0;h<this.last.searchIds.length;h++)this.last.searchIds[h]==d&&(d=h);f=this.getRecordHTML(d,f,k);b(e).replaceWith(f[0]);b(c).replaceWith(f[1]);d=this.records[d].w2ui?this.records[d].w2ui.style:"";"string"==typeof d&&(e=b(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(a)),c=b(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(a)),e.attr("custom_style",d),c.attr("custom_style",d),e.hasClass("w2ui-selected")&&(d=d.replace("background-color","none")),e[0].style.cssText="height: "+this.recordHeight+"px;"+d,c[0].style.cssText="height: "+this.recordHeight+"px;"+d);k&&this.resize()}},refresh:function(){var a=this,d=(new Date).getTime();a.last.colStart=-1;a.last.colEnd=-1;0>=this.total&&0===this.searchData.length&&(this.total=this.getTotalRec());this.toolbar.disable("w2ui-edit","w2ui-delete");if(this.box){var e=this.trigger({phase:"before",target:this.name,type:"refresh"});if(!0!==e.isCancelled){this.show.header?b("#grid_"+this.name+"_header",a.box).html(this.header+"\x26#160;").show():b("#grid_"+this.name+"_header",a.box).hide();if(this.show.toolbar){if(!(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked)&&(b("#grid_"+this.name+"_toolbar",a.box).show(),"object"==typeof this.toolbar))for(var c=this.toolbar.items,f=0;f<c.length;f++)"w2ui-search"!=c[f].id&&"break"!=c[f].type&&this.toolbar.refresh(c[f].id)}else b("#grid_"+this.name+"_toolbar",a.box).hide();this.searchClose();f=b("#grid_"+a.name+"_search_all",a.box);!this.multiSearch&&"all"==this.last.field&&0<this.searches.length&&(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption);for(c=0;c<this.searches.length;c++)this.searches[c].field==this.last.field&&(this.last.caption=this.searches[c].caption);this.last.multi?(f.attr("placeholder","["+w2utils.lang("\u7ec4\u5408\u67e5\u8be2")+"]"),f.w2field("clear")):f.attr("placeholder",w2utils.lang(this.last.caption));if(f.val()!=this.last.search){var k=this.last.search;(c=f.data("w2field"))&&(k=c.format(k));f.val(k)}a.refreshBody();this.show.footer?b("#grid_"+this.name+"_footer",a.box).html(this.getFooterHTML()).show():b("#grid_"+this.name+"_footer",a.box).hide();var h=b("#grid_"+this.name+"_searchClear",a.box);h.hide();this.searchData.some(function(b){b=a.getSearch(b.field);if(a.last.multi||b&&!b.hidden&&"list"!=b.type)return h.show(),!0});c=this.last.selection;f=0<c.indexes.length&&0!==this.searchData.length&&c.indexes.length==this.last.searchIds.length;0<this.records.length&&c.indexes.length==this.records.length||f?b("#grid_"+this.name+"_check_all",a.box).prop("checked",!0):b("#grid_"+this.name+"_check_all",a.box).prop("checked",!1);this.status();c=a.find({"w2ui.expanded":!0},!0);for(f=0;f<c.length;f++)Array.isArray(a.getChild(a.records[c[f]]))||a.setChildExpend(a.records[c[f]],!1);a.markSearch&&setTimeout(function(){for(var c=[],d=0;d<a.searchData.length;d++){var e=a.searchData[d],f=a.getSearch(e.field);f&&!f.hidden&&-1==c.indexOf(e.value)&&c.push(e.value)}0<c.length&&b(a.box).find(".w2ui-grid-data \x3e div").w2marker(c)},50);this.show.toolbarSave&&(0<this.getChanges().length?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"));this.trigger(b.extend(e,{phase:"after"}));a.resize();a.addRange("selection");setTimeout(function(){a.resize();a.scroll()},1);a.reorderColumns&&!a.last.columnDrag?a.last.columnDrag=a.initColumnDrag():!a.reorderColumns&&a.last.columnDrag&&a.last.columnDrag.remove();a.nextPageShow();return(new Date).getTime()-d}}},newResetPage:function(){this.pageIndex=0;this.total=this.getTotalRec()},refreshBody:function(){var a=this.find({"w2ui.summary":!0},!0);if(0<a.length){for(var d=0;d<a.length;d++)this.summary.push(this.records[a[d]]);for(d=a.length-1;0<=d;d--)this.records.splice(a[d],1)}this.scroll();a=this.getRecordsHTML();d=this.getColumnsHTML();a='\x3cdiv id\x3d"grid_'+this.name+'_frecords" class\x3d"w2ui-grid-frecords" style\x3d"margin-bottom: '+(w2utils.scrollBarSize()-1)+'px;"\x3e'+a[0]+'\x3c/div\x3e\x3cdiv id\x3d"grid_'+this.name+'_records" class\x3d"w2ui-grid-records scroll" onscroll\x3d"w2ui[\''+this.name+"'].scroll(event);\"\x3e"+a[1]+'\x3c/div\x3e\x3cdiv id\x3d"grid_'+this.name+'_scroll1" class\x3d"w2ui-grid-scroll1" style\x3d"height: '+w2utils.scrollBarSize()+'px"\x3e\x3c/div\x3e\x3cdiv id\x3d"grid_'+this.name+'_fcolumns" class\x3d"w2ui-grid-fcolumns"\x3e    \x3ctable\x3e\x3ctbody\x3e'+d[0]+'\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv id\x3d"grid_'+this.name+'_columns" class\x3d"w2ui-grid-columns"\x3e    \x3ctable\x3e\x3ctbody\x3e'+d[1]+"\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e";b("#grid_"+this.name+"_body",this.box).html(a);0===this.records.length&&this.msgEmpty?b("#grid_"+this.name+"_body",this.box).append('\x3cdiv id\x3d"grid_'+this.name+'_empty_msg" class\x3d"w2ui-grid-empty-msg"\x3e\x3cdiv\x3e'+this.msgEmpty+"\x3c/div\x3e\x3c/div\x3e"):0<b("#grid_"+this.name+"_empty_msg",this.box).length&&b("#grid_"+this.name+"_empty_msg",this.box).remove();0<this.summary.length?(a=this.getSummaryHTML(),b("#grid_"+this.name+"_fsummary",this.box).html(a[0]).show(),b("#grid_"+this.name+"_summary",this.box).html(a[1]).show()):(b("#grid_"+this.name+"_fsummary",this.box).hide(),b("#grid_"+this.name+"_summary",this.box).hide())},render:function(a){function d(a){var d=c.last.move;if(d&&-1!=["select","select-column"].indexOf(d.type)&&(d.divX=a.screenX-d.x,d.divY=a.screenY-d.y,!(1>=Math.abs(d.divX)&&1>=Math.abs(d.divY))))if(c.last.cancelClick=!0,1==c.reorderRows&&c.last.move.reorder){var e=b(a.target).parents("tr"),f=e.attr("recid"),e=e.attr("index");if(f!=d.from){b("#grid_"+c.name+"_rec_"+d.recid,c.box);var h=b("#grid_"+c.name+"_rec_"+f,c.box);b(c.box).find(".tmp-ghost").css("border-top","0px");h.addClass("tmp-ghost").css("border-top","2px solid #769EFC");d.lastY=a.screenY;d.to=f;d.toIndex=e}e=b("#grid_"+c.name+"_ghost",c.box);h=b(c.box).find(".w2ui-grid-records");e.css({top:d.pos.top+d.divY+h.scrollTop(),left:d.pos.left})}else if(d.start&&d.recid&&(c.selectNone(),d.start=!1),h=[],f="TR"==a.target.tagName.toUpperCase()?b(a.target).attr("recid"):b(a.target).parents("tr").attr("recid"),null==f){if(!("row"==c.selectType||c.last.move&&"select"==c.last.move.type))if(e=parseInt(b(a.target).parents("td").attr("col")),isNaN(e))c.removeRange("column-selection"),b(c.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),b(c.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete d.colRange;else{h=e+"-"+e;d.column<e&&(h=d.column+"-"+e);d.column>e&&(h=e+"-"+d.column);a=[];e=h.split("-");for(f=parseInt(e[0]);f<=parseInt(e[1]);f++)a.push(f);if(d.colRange!=h&&(m=c.trigger({phase:"before",type:"columnSelect",target:c.name,columns:a,isCancelled:!1}),!0!==m.isCancelled)){null==d.colRange&&c.selectNone();e=h.split("-");b(c.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(a=parseInt(e[0]);a<=parseInt(e[1]);a++)b(c.box).find("#grid_"+c.name+"_column_"+a+" .w2ui-col-header").addClass("w2ui-col-selected");b(c.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected");d.colRange=h;c.removeRange("column-selection");c.addRange({name:"column-selection",range:[{recid:c.records[0].recid,column:e[0]},{recid:c.records[c.records.length-1].recid,column:e[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}else{var k=c.get(d.recid,!0);if(!(null==k||c.records[k]&&c.records[k].recid!=d.recid)&&(f=c.get(f,!0),null!=f)){var l=parseInt(d.column);a=parseInt("TD"==a.target.tagName.toUpperCase()?b(a.target).attr("col"):b(a.target).parents("td").attr("col"));isNaN(l)&&isNaN(a)&&(l=0,a=c.columns.length-1);k>f&&(e=k,k=f,f=e);e="ind1:"+k+",ind2;"+f+",col1:"+l+",col2:"+a;if(d.range!=e){d.range=e;for(d=k;d<=f;d++)if(!(0<c.last.searchIds.length&&-1==c.last.searchIds.indexOf(d)))if("row"!=c.selectType)for(l>a&&(e=l,l=a,a=e),e=l;e<=a;e++)c.columns[e].hidden||h.push({recid:c.records[d].recid,column:parseInt(e)});else h.push(c.records[d].recid);if("row"!=c.selectType){d=c.getSelection();e=[];for(a=0;a<h.length;a++){f=!1;for(l=0;l<d.length;l++)h[a].recid==d[l].recid&&h[a].column==d[l].column&&(f=!0);f||e.push({recid:h[a].recid,column:h[a].column})}c.select.apply(c,e);e=[];for(l=0;l<d.length;l++){f=!1;for(a=0;a<h.length;a++)h[a].recid==d[l].recid&&h[a].column==d[l].column&&(f=!0);f||e.push({recid:d[l].recid,column:d[l].column})}c.unselect.apply(c,e)}else if(c.multiSelect){d=c.getSelection();for(a=0;a<h.length;a++)-1==d.indexOf(h[a])&&c.select(h[a]);for(l=0;l<d.length;l++)-1==h.indexOf(d[l])&&c.unselect(d[l])}}}}}function e(a){var f=c.last.move;setTimeout(function(){delete c.last.cancelClick},1);if(!b(a.target).parents().hasClass(".w2ui-head")&&!b(a.target).hasClass(".w2ui-head")){if(f&&-1!=["select","select-column"].indexOf(f.type)){if(null!=f.colRange&&!0!==m.isCancelled){a=f.colRange.split("-");for(var h=[],k=0;k<c.records.length;k++){for(var l=[],g=parseInt(a[0]);g<=parseInt(a[1]);g++)l.push(g);h.push({recid:c.records[k].recid,column:l})}c.removeRange("column-selection");c.trigger(b.extend(m,{phase:"after"}));c.select.apply(c,h)}if(1==c.reorderRows&&c.last.move.reorder){h=c.trigger({phase:"before",target:c.name,type:"reorderRow",dataId:f.dataId,recid:f.from,moveAfter:f.to,toIndex:f.toIndex});if(!0===h.isCancelled){b("#grid_"+c.name+"_ghost",c.box).remove();c.refresh();return}k=c.get(f.from,!0);f=c.get(f.to,!0);a=c.records[k];null!=k&&null!=f&&(c.records.splice(k,1),k>f?c.records.splice(f,0,a):c.records.splice(f-1,0,a));b("#grid_"+c.name+"_ghost",c.box).remove();c.refresh();c.trigger(b.extend(h,{phase:"after"}))}}delete c.last.move;b(document).off("mousemove",d);b(document).off("mouseup",e)}}var c=this,f=(new Date).getTime();null!=a&&(0<b(this.box).find("#grid_"+this.name+"_body").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=a);if(this.box&&(a=this.trigger({phase:"before",target:this.name,type:"render",box:a}),!0!==a.isCancelled)){this.reset(!0);if(!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("\u6240\u6709\u5b57\u6bb5");else{for(var k=0;k<this.searches.length&&(this.searches[k].hidden||!1===this.searches[k].simple);)k++;k>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[k].field,this.last.caption=this.searches[k].caption)}b(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid").html('\x3cdiv class\x3d"w2ui-grid-box"\x3e    \x3cdiv id\x3d"grid_'+this.name+'_header" class\x3d"w2ui-grid-header"\x3e\x3c/div\x3e    \x3cdiv id\x3d"grid_'+this.name+'_toolbar" class\x3d"w2ui-grid-toolbar"\x3e\x3c/div\x3e    \x3cdiv id\x3d"grid_'+this.name+'_body" class\x3d"w2ui-grid-body"\x3e\x3c/div\x3e    \x3cdiv id\x3d"grid_'+this.name+'_fsummary" class\x3d"w2ui-grid-body w2ui-grid-summary"\x3e\x3c/div\x3e    \x3cdiv id\x3d"grid_'+this.name+'_summary" class\x3d"w2ui-grid-body w2ui-grid-summary"\x3e\x3c/div\x3e    \x3cdiv id\x3d"grid_'+this.name+'_footer" class\x3d"w2ui-grid-footer"\x3e\x3c/div\x3e    \x3ctextarea id\x3d"grid_'+this.name+'_focus" class\x3d"w2ui-grid-focus-input"\x3e\x3c/textarea\x3e\x3c/div\x3e');"row"!=this.selectType&&b(this.box).addClass("w2ui-ss");0<b(this.box).length&&(b(this.box)[0].style.cssText+=this.style);this.initToolbar();null!=this.toolbar&&this.toolbar.render(b("#grid_"+this.name+"_toolbar",this.box)[0]);if(this.last.field&&"all"!=this.last.field){var h=this.searchData;setTimeout(function(){c.initAllField(c.last.field,1==h.length?h[0].value:null)},1)}b("#grid_"+this.name+"_footer",this.box).html(this.getFooterHTML());this.last.state||(this.last.state=this.stateSave(!0));this.stateRestore();for(var k=!1,g=0;g<this.searches.length;g++)if(this.searches[g].hidden){k=!0;break}k?(this.searchReset(!1),setTimeout(function(){c.searchReset()},1)):this.reload();b(this.box).find("#grid_"+this.name+"_focus").on("focus",function(a){clearTimeout(c.last.kbd_timer);c.hasFocus||c.focus()}).on("blur",function(a){clearTimeout(c.last.kbd_timer);c.last.kbd_timer=setTimeout(function(){c.hasFocus&&c.blur()},100)}).on("paste",function(a){var b=this;setTimeout(function(){w2ui[c.name].paste(b.value);b.value=""},1)}).on("keydown",function(a){w2ui[c.name].keydown.call(w2ui[c.name],a)});var m;b(this.box).on("mousedown",function(a){if(1==a.which&&("text"==c.last.userSelect&&(delete c.last.userSelect,b(c.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","none"))),"row"!=c.selectType||!b(a.target).parents().hasClass("w2ui-head")&&!b(a.target).hasClass("w2ui-head"))&&(!c.last.move||"expand"!=c.last.move.type)){if(a.altKey)b(c.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","text")),c.selectNone(),c.last.move={type:"text-select"},c.last.userSelect="text";else if(c.multiSelect||c.reorderRows){for(var f=a.target,h=a.offsetX-10,k=a.offsetY-10,l=!1;f&&(!f.classList||!f.classList.contains("w2ui-grid"));)f.tagName&&"TD"==f.tagName.toUpperCase()&&(l=!0),f.tagName&&"TR"!=f.tagName.toUpperCase()&&1==l&&(h+=f.offsetLeft,k+=f.offsetTop),f=f.parentNode;c.last.move={x:a.screenX,y:a.screenY,divX:0,divY:0,focusX:h,focusY:k,recid:b(a.target).parents("tr").attr("recid"),dataId:b(a.target).parents("tr").attr("index"),column:parseInt("TD"==a.target.tagName.toUpperCase()?b(a.target).attr("col"):b(a.target).parents("td").attr("col")),type:"select",ghost:!1,start:!0};null==c.last.move.recid&&(c.last.move.type="select-column");var g=a.target,n=b(c.box).find("#grid_"+c.name+"_focus");if(c.last.move){f=c.last.move.focusX;h=c.last.move.focusY;k=b(g).parents("table").parent();if(k.hasClass("w2ui-grid-records")||k.hasClass("w2ui-grid-frecords")||k.hasClass("w2ui-grid-columns")||k.hasClass("w2ui-grid-fcolumns")||k.hasClass("w2ui-grid-summary"))f=c.last.move.focusX-b(c.box).find("#grid_"+c.name+"_records").scrollLeft(),h=c.last.move.focusY-b(c.box).find("#grid_"+c.name+"_records").scrollTop();if(b(g).hasClass("w2ui-grid-footer")||0<b(g).parents("div.w2ui-grid-footer").length)h=b(c.box).find("#grid_"+c.name+"_footer").position().top;n.css({left:f-10,top:h})}setTimeout(function(){-1!=["INPUT","TEXTAREA","SELECT"].indexOf(g.tagName.toUpperCase())?b(g).focus():n.is(":focus")||n.focus()},50)}1==c.reorderRows&&(f=a.target,"TD"!=f.tagName.toUpperCase()&&(f=b(f).parents("td")[0]),b(f).hasClass("w2ui-col-number")?(c.selectNone(),c.last.move.reorder=!0,f=b(c.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),h=b(c.box).find(".w2ui-odd.w2ui-empty-record").css("background-color"),b(c.box).find(".w2ui-even td").not(".w2ui-col-number").css("background-color",f),b(c.box).find(".w2ui-odd td").not(".w2ui-col-number").css("background-color",h),h=c.last.move,h.ghost||(k=b("#grid_"+c.name+"_rec_"+h.recid,c.box),f=k.parents("table").find("tr:first-child").clone(),h.offsetY=a.offsetY,h.from=h.recid,h.pos=k.position(),h.ghost=b(k).clone(!0),h.ghost.removeAttr("id"),k.find("td").remove(),k.append('\x3ctd colspan\x3d"1000" style\x3d"height: '+c.recordHeight+'px; background-color: #eee; border-bottom: 1px dashed #aaa; border-top: 1px dashed #aaa;"\x3e\x3c/td\x3e'),k=b(c.box).find(".w2ui-grid-records"),k.append('\x3ctable id\x3d"grid_'+c.name+'_ghost" style\x3d"position: absolute; z-index: 999999; opacity: 0.7; pointer-events: none;"\x3e\x3c/table\x3e'),b("#grid_"+c.name+"_ghost").append(f).append(h.ghost)),f=b("#grid_"+c.name+"_ghost",c.box),k=b(c.box).find(".w2ui-grid-records"),f.css({top:(h.pos?h.pos.top:0)+k.scrollTop(),left:h.pos?h.pos.left:0,"border-top":"1px solid #aaa","border-bottom":"1px solid #aaa"})):c.last.move.reorder=!1);b(document).on("mousemove",d);b(document).on("mouseup",e);a.stopPropagation()}});this.trigger(b.extend(a,{phase:"after"}));if(0===b(".w2ui-layout").length)b(window).off("resize.w2ui-"+this.name).on("resize.w2ui-"+this.name,function(a){w2ui[c.name].resize()});return(new Date).getTime()-f}},destroy:function(){void 0!=this.intVSize&&clearInterval(this.intVSize);var a=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==a.isCancelled&&(b(window).off("resize.w2ui-"+this.name),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),0<b(this.box).find("#grid_"+this.name+"_body").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=void 0,delete w2ui[this.name],this.trigger(b.extend(a,{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){for(var a='\x3cdiv class\x3d"w2ui-col-on-off"\x3e\x3ctable\x3e\x3ctbody\x3e\x3ctr id\x3d"grid_'+this.name+'_column_ln_check" onclick\x3d"w2ui[\''+this.name+'\'].columnOnOff(event, \'line-numbers\'); event.stopPropagation();"\x3e   \x3ctd style\x3d"width: 30px; text-align: center; padding-right: 3px; color: #888;"\x3e      \x3cspan class\x3d"w2ui-column-check w2ui-icon-'+(this.show.lineNumbers?"check":"empty")+'"\x3e\x3c/span\x3e   \x3c/td\x3e   \x3ctd onclick\x3d"jQuery(\'.w2ui-overlay\')[0].hide();"\x3e      \x3clabel\x3e'+w2utils.lang("#")+"\x3c/label\x3e   \x3c/td\x3e\x3c/tr\x3e",b=0;b<this.columns.length;b++){var e=this.columns[b],c=this.columns[b].caption;!1!==e.hideable&&(!c&&this.columns[b].tooltip&&(c=this.columns[b].tooltip),c||(c="- column "+(parseInt(b)+1)+" -"),a+='\x3ctr id\x3d"grid_'+this.name+"_column_"+b+'_check"        onclick\x3d"w2ui[\''+this.name+"'].columnOnOff(event, '"+e.field+'\'); event.stopPropagation();"\x3e   \x3ctd style\x3d"width: 30px; text-align: center; padding-right: 3px; color: #888;"\x3e      \x3cspan class\x3d"w2ui-column-check w2ui-icon-'+(e.hidden?"empty":"check")+'"\x3e\x3c/span\x3e   \x3c/td\x3e   \x3ctd onclick\x3d"jQuery(\'.w2ui-overlay\')[0].hide();"\x3e       \x3clabel\x3e'+w2utils.stripTags(c)+"\x3c/label\x3e   \x3c/td\x3e\x3c/tr\x3e")}this.show.saveRestoreState&&(a+='\x3ctr\x3e\x3ctd colspan\x3d"2" onclick\x3d"var obj \x3d w2ui[\''+this.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateSave();\"\x3e    \x3cdiv style\x3d\"cursor: pointer; padding: 4px 8px; cursor: default\"\x3e"+w2utils.lang("Save Grid State")+'\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d"2" onclick\x3d"var obj \x3d w2ui[\''+this.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateReset();\"\x3e    \x3cdiv style\x3d\"cursor: pointer; padding: 4px 8px; cursor: default\"\x3e"+w2utils.lang("Restore Default State")+"\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e");a+="\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e";this.toolbar.get("w2ui-column-on-off").html=a}},initColumnDrag:function(a){function d(){g.pressed=!1;clearTimeout(g.timeout)}function e(a){g.timeout&&clearTimeout(g.timeout);var d=this;g.pressed=!0;g.timeout=setTimeout(function(){if(g.pressed){var e,k,l;e=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"].concat(["w2ui-head-last"]);if(b(a.originalEvent.target).parents().hasClass("w2ui-head")){l=0;for(var n=e.length;l<n;l++)if(b(a.originalEvent.target).parents().hasClass(e[l]))return;g.numberPreColumnsPresent=b(h.box).find(".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select").length;g.columnHead=e=b(a.originalEvent.target).parents(".w2ui-head");k=parseInt(e.attr("col"),10);e=h.trigger({type:"columnDragStart",phase:"before",originalEvent:a,origColumnNumber:k,target:e[0]});if(!0===e.isCancelled)return!1;k=g.columns=b(h.box).find(".w2ui-head:not(.w2ui-head-last)");b(document).on("mouseup",f);b(document).on("mousemove",c);g.originalPos=parseInt(b(a.originalEvent.target).parent(".w2ui-head").attr("col"),10);g.ghost=b(d).clone(!0);b(g.ghost).find('[col]:not([col\x3d"'+g.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove();b(g.ghost).find(".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select").remove();b(g.ghost).find(".w2ui-grid-body").css({top:0});l=b(g.ghost).find('[col\x3d"'+g.originalPos+'"]');b(document.body).append(g.ghost);b(g.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:l.width(),height:b(h.box).find(".w2ui-grid-body:first").height(),left:a.pageX,top:a.pageY,opacity:.8},0);g.offsets=[];l=0;for(n=k.length;l<n;l++)g.offsets.push(b(k[l]).offset().left);h.trigger(b.extend(e,{phase:"after"}))}}},150)}function c(a){if(g.pressed){var d=a.originalEvent.pageX;a=a.originalEvent.pageY;var c=g.offsets,e=b(".w2ui-head:not(.w2ui-head-last)").width();g.targetInt=Math.max(g.numberPreColumnsPresent,k(d,c,e));c=g.targetInt;g.marker||g.markerLeft||(g.marker=b('\x3cdiv class\x3d"col-intersection-marker"\x3e\x3cdiv class\x3d"top-marker"\x3e\x3c/div\x3e\x3cdiv class\x3d"bottom-marker"\x3e\x3c/div\x3e\x3c/div\x3e'),g.markerLeft=b('\x3cdiv class\x3d"col-intersection-marker"\x3e\x3cdiv class\x3d"top-marker"\x3e\x3c/div\x3e\x3cdiv class\x3d"bottom-marker"\x3e\x3c/div\x3e\x3c/div\x3e'));g.lastInt&&g.lastInt===c||(g.lastInt=c,g.marker.remove(),g.markerLeft.remove(),b(".w2ui-head").removeClass("w2ui-col-intersection"),c>=g.columns.length?(b(g.columns[g.columns.length-1]).children("div:last").append(g.marker.addClass("right").removeClass("left")),b(g.columns[g.columns.length-1]).addClass("w2ui-col-intersection")):c<=g.numberPreColumnsPresent?(b(g.columns[g.numberPreColumnsPresent]).prepend(g.marker.addClass("left").removeClass("right")).css({position:"relative"}),b(g.columns[g.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):(b(g.columns[c]).children("div:last").prepend(g.marker.addClass("left").removeClass("right")),b(g.columns[c]).prev().children("div:last").append(g.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),b(g.columns[c-1]).addClass("w2ui-col-intersection")));b(g.ghost).css({left:d-10,top:a-10})}}function f(a){g.pressed=!1;var d,e,k,n,m=b(".w2ui-grid-ghost");a=h.trigger({type:"columnDragEnd",phase:"before",originalEvent:a,target:g.columnHead[0]});if(!0===a.isCancelled)return!1;e=h.columns[g.originalPos];k=h.columns;n=b(g.columns[Math.min(g.lastInt,g.columns.length-1)]);d=g.lastInt<g.columns.length?parseInt(n.attr("col")):k.length;d!==g.originalPos+1&&d!==g.originalPos&&n&&n.length?(b(g.ghost).animate({top:b(h.box).offset().top,left:n.offset().left,width:0,height:0,opacity:.2},300,function(){b(this).remove();m.remove()}),k.splice(d,0,b.extend({},e)),k.splice(k.indexOf(e),1)):(b(g.ghost).remove(),m.remove());b(document).off("mouseup",f);b(document).off("mousemove",c);g.marker&&g.marker.remove();g={};h.refresh();h.trigger(b.extend(a,{phase:"after",targetColumnNumber:d-1}))}function k(a,b,d){if(a<=b[0])return 0;if(a>=b[b.length-1]+d)return b.length;for(var c=0,e=b.length;c<e;c++){var f=b[c+1]||b[c]+d,h=(f-b[c])/2+b[c];if(a>b[c]&&a<=h)return c;if(a>h&&a<=f)return c+1}return intersection}if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var h=this,g={lastInt:null,pressed:!1,timeout:null,columnHead:null};b(h.box).on("mousedown",e);b(h.box).on("mouseup",d);return{remove:function(){b(h.box).off("mousedown",e);b(h.box).off("mouseup",d);b(h.box).find(".w2ui-head").removeAttr("draggable");h.last.columnDrag=!1}}},columnOnOff:function(a,d){var e=b(a.target).parents("tr").find(".w2ui-column-check"),c=this.trigger({phase:"before",target:this.name,type:"columnOnOff",field:d,originalEvent:a});if(!0!==c.isCancelled){for(var f=this,k=f.find({"w2ui.expanded":!0},!0),h=0;h<k.length;h++)Array.isArray(this.getChild(this.records[h]))||f.setChildExpend(f.records[h],!1);"line-numbers"==d?(this.show.lineNumbers=!this.show.lineNumbers,this.show.lineNumbers?e.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"):e.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.refreshBody(),this.resizeRecords()):(d=this.getColumn(d),d.hidden?(e.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"),this.showColumn(d.field)):(e.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.hideColumn(d.field)));a.shiftKey||a.metaKey||a.ctrlKey||setTimeout(function(){b().w2overlay({name:f.name+"_toolbar"})},150);this.trigger(b.extend(c,{phase:"after"}))}},scrollToColumn:function(a){if(null!=a){for(var b=0,e=!1,c=0;c<this.columns.length;c++){var f=this.columns[c];if(f.field==a){e=!0;break}f.frozen||f.hidden||(f=parseInt(f.sizeCalculated?f.sizeCalculated:f.size),b+=f)}e&&(this.last.scrollLeft=b+1,this.scroll())}},initToolbar:function(){var a=this;if(null==this.toolbar.render){var d=this.toolbar.items;this.toolbar.items=[];this.toolbar=b().w2toolbar(b.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this}));this.show.toolbarReload&&this.toolbar.items.push(b.extend(!0,{},this.buttons.reload));this.show.toolbarColumns&&this.toolbar.items.push(b.extend(!0,{},this.buttons.columns));(this.show.toolbarReload||this.show.toolbarColumns)&&this.toolbar.items.push({type:"break",id:"w2ui-break0"});if(this.show.toolbarInput){var e='\x3cdiv class\x3d"w2ui-toolbar-search"\x3e\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctbody\x3e\x3ctr\x3e    \x3ctd\x3e'+this.buttons.search.html+'\x3c/td\x3e    \x3ctd\x3e        \x3cinput type\x3d"text" id\x3d"grid_'+this.name+'_search_all" class\x3d"w2ui-search-all" tabindex\x3d"-1"             placeholder\x3d"'+w2utils.lang(this.last.caption)+'" value\x3d"'+this.last.search+'"            onfocus\x3d"clearTimeout(w2ui[\''+this.name+'\'].last.kbd_timer);"            onkeydown\x3d"if (event.keyCode \x3d\x3d 13 \x26amp;\x26amp; w2utils.isIE) this.onchange();"            onchange\x3d"                var grid \x3d w2ui[\''+this.name+"'];                 var val \x3d this.value;                 var sel \x3d jQuery(this).data('selected');                var fld \x3d jQuery(this).data('w2field');                 if (fld) val \x3d fld.clean(val);                if (fld \x26amp;\x26amp; fld.type \x3d\x3d 'list' \x26amp;\x26amp; sel \x26amp;\x26amp; typeof sel.id \x3d\x3d 'undefined') {                   grid.searchReset();                } else {                   grid.search(grid.last.field, val);                }            \"/\x3e    \x3c/td\x3e    \x3ctd\x3e        \x3cdiv class\x3d\"w2ui-search-clear\" id\x3d\"grid_"+this.name+'_searchClear"               onclick\x3d"var obj \x3d w2ui[\''+this.name+'\']; obj.searchReset();" style\x3d"display: none"        \x3e\x26#160;\x26#160;\x3c/div\x3e    \x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e';this.toolbar.items.push({type:"html",id:"w2ui-search",html:e})}this.show.toolbarSearch&&this.multiSearch&&0<this.searches.length&&this.toolbar.items.push(b.extend(!0,{},this.buttons["search-go"]));(this.show.toolbarSearch||this.show.toolbarInput)&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"});this.show.toolbarAdd&&this.toolbar.items.push(b.extend(!0,{},this.buttons.add));this.show.toolbarEdit&&this.toolbar.items.push(b.extend(!0,{},this.buttons.edit));this.show.toolbarDelete&&this.toolbar.items.push(b.extend(!0,{},this.buttons["delete"]));this.show.toolbarSave&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push(b.extend(!0,{},this.buttons.save)));if(d)for(e=0;e<d.length;e++)this.toolbar.items.push(d[e]);a=this;this.toolbar.on("click",function(d){var c=a.trigger({phase:"before",type:"toolbar",target:d.target,originalEvent:d});if(!0!==c.isCancelled){var e=d.target;switch(e){case "w2ui-reload":d=a.trigger({phase:"before",type:"reload",target:a.name});if(!0===d.isCancelled)return!1;a.reload();a.trigger(b.extend(d,{phase:"after"}));break;case "w2ui-column-on-off":a.initColumnOnOff();a.initResize();a.resize();break;case "w2ui-search-advanced":var h=this;if(this.get(e).checked)a.searchClose(),setTimeout(function(){h.uncheck(e)},1);else{var g=function(){!0!==b("#w2ui-overlay-"+a.name+"-searchOverlay",a.box).data("keepOpen")&&(h.uncheck(e),b(document).off("click","body",g))};a.searchOpen();d.originalEvent.stopPropagation();b(document).on("click","body",g)}break;case "w2ui-add":c=a.trigger({phase:"before",target:a.name,type:"add",recid:null});a.trigger(b.extend(c,{phase:"after"}));setTimeout(function(){b().w2tag()},20);break;case "w2ui-edit":c=a.getSelection();d=null;1==c.length&&(d=c[0]);c=a.trigger({phase:"before",target:a.name,type:"edit",recid:d});a.trigger(b.extend(c,{phase:"after"}));setTimeout(function(){b().w2tag()},20);break;case "w2ui-delete":a["delete"]();break;case "w2ui-save":a.save()}a.trigger(b.extend(c,{phase:"after"}))}})}},initResize:function(){var a=this;b(this.box).find(".w2ui-resizer").off("click").on("click",function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault&&a.preventDefault()}).off("mousedown").on("mousedown",function(d){d||(d=window.event);a.resizing=!0;a.last.tmp={x:d.screenX,y:d.screenY,gx:d.screenX,gy:d.screenY,col:parseInt(b(this).attr("name"))};d.stopPropagation?d.stopPropagation():d.cancelBubble=!0;d.preventDefault&&d.preventDefault();for(var e=0;e<a.columns.length;e++)a.columns[e].hidden||(null==a.columns[e].sizeOriginal&&(a.columns[e].sizeOriginal=a.columns[e].size),a.columns[e].size=a.columns[e].sizeCalculated);var c={phase:"before",type:"columnResize",target:a.name,column:a.last.tmp.col,field:a.columns[a.last.tmp.col].field},c=a.trigger(b.extend(c,{resizeBy:0,originalEvent:d}));b(document).on("mousemove","body",function(d){1==a.resizing&&(d||(d=window.event),c=a.trigger(b.extend(c,{resizeBy:d.screenX-a.last.tmp.gx,originalEvent:d})),!0===c.isCancelled?c.isCancelled=!1:(a.last.tmp.x=d.screenX-a.last.tmp.x,a.last.tmp.y=d.screenY-a.last.tmp.y,a.columns[a.last.tmp.col].size=parseInt(a.columns[a.last.tmp.col].size)+a.last.tmp.x+"px",a.resizeRecords(),a.scroll(),a.last.tmp.x=d.screenX,a.last.tmp.y=d.screenY))});b(document).on("mouseup","body",function(d){delete a.resizing;b(document).off("mousemove","body");b(document).off("mouseup","body");a.resizeRecords();a.scroll();a.trigger(b.extend(c,{phase:"after",originalEvent:d}))})}).each(function(a,e){a=b(e).parent();b(e).css({height:"25px","margin-left":a.width()-3+"px"})})},resizeBoxes:function(){var a=b("#grid_"+this.name+"_header",this.box),d=b("#grid_"+this.name+"_toolbar",this.box),e=b("#grid_"+this.name+"_fsummary",this.box),c=b("#grid_"+this.name+"_summary",this.box),f=b("#grid_"+this.name+"_footer",this.box),k=b("#grid_"+this.name+"_body",this.box);this.show.header&&a.css({top:"0px",left:"0px",right:"0px"});this.show.toolbar&&d.css({top:0+(this.show.header?w2utils.getSize(a,"height"):0)+"px",left:"0px",right:"0px"});0<this.summary.length&&(e.css({bottom:0+(this.show.footer?w2utils.getSize(f,"height"):0)+"px"}),c.css({bottom:0+(this.show.footer?w2utils.getSize(f,"height"):0)+"px",right:"0px"}));this.show.footer&&f.css({bottom:"0px",left:"0px",right:"0px"});k.css({top:0+(this.show.header?w2utils.getSize(a,"height"):0)+(this.show.toolbar?w2utils.getSize(d,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(f,"height"):0)+(0<this.summary.length?w2utils.getSize(c,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){function a(a,d,c){var e;e=""+('\x3ctr class\x3d"'+(a%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style\x3d"height: '+d+'px"\x3e');c.show.lineNumbers&&(e+='\x3ctd class\x3d"w2ui-col-number"\x3e\x3c/td\x3e');c.show.selectColumn&&(e+='\x3ctd class\x3d"w2ui-grid-data w2ui-col-select"\x3e\x3c/td\x3e');c.show.expandColumn&&(e+='\x3ctd class\x3d"w2ui-grid-data w2ui-col-expand"\x3e\x3c/td\x3e');a=""+('\x3ctr class\x3d"'+(a%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style\x3d"height: '+d+'px"\x3e')+'\x3ctd class\x3d"w2ui-grid-data-spacer" col\x3d"start" style\x3d"border-right: 0"\x3e\x3c/td\x3e';for(var f=0;f<c.columns.length;f++){var h=c.columns[f];if(!(h.hidden||f<c.last.colStart||f>c.last.colEnd)||h.frozen)d='\x3ctd class\x3d"w2ui-grid-data" '+(null!=h.attr?h.attr:"")+' col\x3d"'+f+'"\x3e\x3c/td\x3e',h.frozen?e+=d:a+=d}e+='\x3ctd class\x3d"w2ui-grid-data-last"\x3e\x3c/td\x3e \x3c/tr\x3e';a+='\x3ctd class\x3d"w2ui-grid-data-last" col\x3d"end"\x3e\x3c/td\x3e \x3c/tr\x3e';b("#grid_"+c.name+"_frecords \x3e table",this.box).append(e);b("#grid_"+c.name+"_records \x3e table",this.box).append(a)}var d=this;b(this.box).find(".w2ui-empty-record").remove();var e=b(this.box),c=b(this.box).find("\x3e div.w2ui-grid-box"),f=b("#grid_"+this.name+"_header",e),k=b("#grid_"+this.name+"_toolbar",e),h=b("#grid_"+this.name+"_summary",e),g=b("#grid_"+this.name+"_fsummary",e),m=b("#grid_"+this.name+"_footer",e),l=b("#grid_"+this.name+"_body",e),u=b("#grid_"+this.name+"_columns",e),t=b("#grid_"+this.name+"_fcolumns",e),w=b("#grid_"+this.name+"_records",e),q=b("#grid_"+this.name+"_frecords",e),v=b("#grid_"+this.name+"_scroll1",e),p=8*String(this.total).length+10;34>p&&(p=34);null!=this.lineNumberWidth&&(p=this.lineNumberWidth);for(var r=!1,x=!1,z=0,y=0;y<d.columns.length;y++)if(!d.columns[y].frozen&&!d.columns[y].hidden)var B=parseInt(d.columns[y].sizeCalculated?d.columns[y].sizeCalculated:d.columns[y].size),z=z+B;w.width()<z&&(r=!0);l.height()-u.height()<b(w).find("\x3etable").height()+(r?w2utils.scrollBarSize():0)&&(x=!0);this.fixedBody?(y=c.height()-(this.show.header?w2utils.getSize(f,"height"):0)-(this.show.toolbar?w2utils.getSize(k,"height"):0)-("none"!=h.css("display")?w2utils.getSize(h,"height"):0)-(this.show.footer?w2utils.getSize(m,"height"):0),l.css("height",y)):(y=w2utils.getSize(u,"height")+w2utils.getSize(b("#grid_"+d.name+"_records table",e),"height")+(r?w2utils.scrollBarSize():0),d.height=y+w2utils.getSize(c,"+height")+(d.show.header?w2utils.getSize(f,"height"):0)+(d.show.toolbar?w2utils.getSize(k,"height"):0)+("none"!=h.css("display")?w2utils.getSize(h,"height"):0)+(d.show.footer?w2utils.getSize(m,"height"):0),c.css("height",d.height),l.css("height",y),e.css("height",w2utils.getSize(c,"height")+w2utils.getSize(e,"+height")));y=this.records.length;0!=this.searchData.length&&(y=this.last.searchIds.length);this.fixedBody||(x=!1);r||x?(u.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),w.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+w2utils.getSize(u,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":r?"auto":"hidden","overflow-y":x?"auto":"hidden"})):(u.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td.w2ui-head-last").hide(),w.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+w2utils.getSize(u,"height")+"px",overflow:"hidden"}),0<w.length&&(this.last.scrollTop=0,this.last.scrollLeft=0));r?(q.css("margin-bottom",w2utils.scrollBarSize()),v.show()):(q.css("margin-bottom",0),v.hide());q.css({overflow:"hidden",top:d.headRowHeight+"px"});if(this.show.emptyRecords&&!x&&(r=Math.floor(w.height()/this.recordHeight)-1,e=0,w[0]&&(e=w[0].scrollHeight-r*this.recordHeight),e>=this.recordHeight&&(e-=this.recordHeight,r++),this.fixedBody)){for(;y<r;y++)a(y,this.recordHeight,this);a(r,e,this)}if(0<l.length){for(var A=x=parseInt(l.width())-(x?w2utils.scrollBarSize():0)-(this.show.lineNumbers?p:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,D=0,r=!1,y=0;y<this.columns.length;y++)l=this.columns[y],0<l.gridMinWidth&&(l.gridMinWidth>A&&!0!==l.hidden&&(r=l.hidden=!0),l.gridMinWidth<A&&!0===l.hidden&&(l.hidden=!1,r=!0));if(!0===r){this.refresh();return}for(y=0;y<this.columns.length;y++)l=this.columns[y],l.hidden||("px"==String(l.size).substr(String(l.size).length-2).toLowerCase()?(x-=parseFloat(l.size),this.columns[y].sizeCalculated=l.size,this.columns[y].sizeType="px"):(D+=parseFloat(l.size),this.columns[y].sizeType="%",delete l.sizeCorrected));if(100!=D&&0<D)for(y=0;y<this.columns.length;y++)l=this.columns[y],l.hidden||"%"!=l.sizeType||(l.sizeCorrected=Math.round(1E4*parseFloat(l.size)/D)/100+"%");for(y=0;y<this.columns.length;y++)l=this.columns[y],l.hidden||"%"!=l.sizeType||(this.columns[y].sizeCalculated=null!=this.columns[y].sizeCorrected?Math.floor(x*parseFloat(l.sizeCorrected)/100)-1+"px":Math.floor(x*parseFloat(l.size)/100)-1+"px")}for(y=x=0;y<this.columns.length;y++)l=this.columns[y],l.hidden||(null==l.min&&(l.min=20),parseInt(l.sizeCalculated)<parseInt(l.min)&&(l.sizeCalculated=l.min+"px"),parseInt(l.sizeCalculated)>parseInt(l.max)&&(l.sizeCalculated=l.max+"px"),x+=parseInt(l.sizeCalculated));var C=parseInt(A)-parseInt(x);if(0<C&&0<D)for(y=0;;)if(l=this.columns[y],null==l)y=0;else{if(!l.hidden&&"px"!=l.sizeType&&(l.sizeCalculated=parseInt(l.sizeCalculated)+1+"px",C--,0===C))break;y++}else 0<C&&u.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();A=1;this.show.lineNumbers&&(A+=p);this.show.selectColumn&&(A+=26);this.show.expandColumn&&(A+=26);for(y=0;y<this.columns.length;y++)this.columns[y].hidden||this.columns[y].frozen&&(A+=parseInt(this.columns[y].sizeCalculated));t.css("width",A);q.css("width",A);g.css("width",A);v.css("width",A);u.css("left",A);w.css("left",A);h.css("left",A);u.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td").add(t.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td")).each(function(a,c){b(c).hasClass("w2ui-col-number")&&b(c).css("width",p);a=b(c).attr("col");if(null!=a){if("start"==a){for(var e=0,f=0;f<d.last.colStart;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}d.columns[a]&&b(c).css("width",d.columns[a].sizeCalculated)}if(b(c).hasClass("w2ui-head-last"))if(d.last.colEnd+1<d.columns.length){e=0;for(f=d.last.colEnd+1;f<d.columns.length;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}else b(c).css("width",w2utils.scrollBarSize()+(0<C&&0===D?C:0)+"px")});3==u.find("\x3e table \x3e tbody \x3e tr").length&&u.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td").add(t.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td")).html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"});w.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td").add(q.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td")).each(function(a,c){b(c).hasClass("w2ui-col-number")&&b(c).css("width",p);a=b(c).attr("col");if(null!=a){if("start"==a){for(var e=0,f=0;f<d.last.colStart;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}d.columns[a]&&b(c).css("width",d.columns[a].sizeCalculated)}if(b(c).hasClass("w2ui-grid-data-last")&&0===b(c).parents(".w2ui-grid-frecords").length)if(d.last.colEnd+1<d.columns.length){e=0;for(f=d.last.colEnd+1;f<d.columns.length;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}else b(c).css("width",(0<C&&0===D?C:0)+"px")});h.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td").add(g.find("\x3e table \x3e tbody \x3e tr:nth-child(1) td")).each(function(a,c){b(c).hasClass("w2ui-col-number")&&b(c).css("width",p);a=b(c).attr("col");if(null!=a){if("start"==a){for(var e=0,f=0;f<d.last.colStart;f++)!d.columns[f]||d.columns[f].frozen||d.columns[f].hidden||(e+=parseInt(d.columns[f].sizeCalculated));b(c).css("width",e+"px")}d.columns[a]&&b(c).css("width",d.columns[a].sizeCalculated)}b(c).hasClass("w2ui-grid-data-last")&&0===b(c).parents(".w2ui-grid-frecords").length&&b(c).css("width",w2utils.scrollBarSize()+(0<C&&0===D?C:0)+"px")});this.nextPageShow();this.initResize();this.refreshRanges();(this.last.scrollTop||this.last.scrollLeft)&&0<w.length&&(u.prop("scrollLeft",this.last.scrollLeft),w.prop("scrollTop",this.last.scrollTop),w.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){for(var a='\x3ctable cellspacing\x3d"0" onclick\x3d"event.stopPropagation()"\x3e\x3ctbody\x3e',d=!1,e=0;e<this.searches.length;e++){var c=this.searches[e];c.type=String(c.type).toLowerCase();if(!c.hidden){var f="";0==d&&(f='\x3cbutton class\x3d"w2ui-btn close-btn" onclick\x3d"obj \x3d w2ui[\''+this.name+"']; if (obj) obj.searchClose()\"\x3eX\x3c/button\x3e",d=!0);null==c.inTag&&(c.inTag="");null==c.outTag&&(c.outTag="");null==c.style&&(c.style="");null==c.type&&(c.type="text");var k='\x3cselect id\x3d"grid_'+this.name+"_operator_"+e+'" class\x3d"w2ui-input" onclick\x3d"event.stopPropagation();"   onchange\x3d"w2ui[\''+this.name+"'].initOperator(this, "+e+')"\x3e',h=c.operators,g="",m=this.operators[this.operatorsMap[c.type]];null!=h&&(m=h);for(h=0;h<m.length;h++){var l=m[h],u=l;Array.isArray(l)?(u=l[1],l=l[0],null==u&&(u=l)):b.isPlainObject(l)&&(u=l.text,l=l.oper);g+='\x3coption value\x3d"'+l+'"\x3e'+w2utils.lang(u)+"\x3c/option\x3e\n"}a+='\x3ctr\x3e    \x3ctd class\x3d"close-btn"\x3e'+f+'\x3c/td\x3e    \x3ctd class\x3d"caption"\x3e'+(c.caption||"")+'\x3c/td\x3e    \x3ctd class\x3d"operator"\x3e'+(k+g+"\x3c/select\x3e")+'\x3c/td\x3e    \x3ctd class\x3d"value"\x3e';switch(c.type){case "text":case "alphanumeric":case "hex":case "color":case "list":case "combo":case "enum":f="width: 250px;";-1!=["hex","color"].indexOf(c.type)&&(f="width: 90px;");a+='\x3cinput rel\x3d"search" type\x3d"text" id\x3d"grid_'+this.name+"_field_"+e+'" name\x3d"'+c.field+'"    class\x3d"w2ui-input" style\x3d"'+f+c.style+'" '+c.inTag+"/\x3e";break;case "int":case "float":case "money":case "currency":case "percent":case "date":case "time":case "datetime":f="width: 90px";"datetime"==c.type&&(f="width: 140px;");a+='\x3cinput rel\x3d"search" type\x3d"text" class\x3d"w2ui-input" style\x3d"'+f+c.style+'" id\x3d"grid_'+this.name+"_field_"+e+'" name\x3d"'+c.field+'" '+c.inTag+'/\x3e\x3cspan id\x3d"grid_'+this.name+"_range_"+e+'" style\x3d"display: none"\x3e\x26#160;-\x26#160;\x26#160;\x3cinput rel\x3d"search" type\x3d"text" class\x3d"w2ui-input" style\x3d"'+f+c.style+'" id\x3d"grid_'+this.name+"_field2_"+e+'" name\x3d"'+c.field+'" '+c.inTag+"/\x3e\x3c/span\x3e";break;case "select":a+='\x3cselect rel\x3d"search" class\x3d"w2ui-input" style\x3d"'+c.style+'" id\x3d"grid_'+this.name+"_field_"+e+'"  name\x3d"'+c.field+'" '+c.inTag+'  onclick\x3d"event.stopPropagation();"\x3e\x3c/select\x3e'}a+=c.outTag+"    \x3c/td\x3e\x3c/tr\x3e"}}return a+='\x3ctr\x3e    \x3ctd colspan\x3d"4" class\x3d"actions"\x3e        \x3cdiv\x3e        \x3cbutton class\x3d"w2ui-btn" onclick\x3d"obj \x3d w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\"\x3e"+w2utils.lang("Reset")+'\x3c/button\x3e        \x3cbutton class\x3d"w2ui-btn w2ui-btn-blue" onclick\x3d"obj \x3d w2ui[\''+this.name+"']; if (obj) { obj.search(); }\"\x3e"+w2utils.lang("Search")+"\x3c/button\x3e        \x3c/div\x3e    \x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e"},initOperator:function(a,d){var e=this.searches[d],c=b("#grid_"+this.name+"_range_"+d,this.box);d=b("#grid_"+this.name+"_field_"+d,this.box);var f=d.parent().find("span input");d.show();c.hide();switch(b(a).val()){case "between":c.show();f.w2field(e.type,e.options);break;case "not null":case "null":d.hide(),d.val("1"),d.change()}},initSearches:function(){for(var a=this,d=0;d<this.searches.length;d++){var e=this.searches[d],c=this.getSearchData(e.field);e.type=String(e.type).toLowerCase();var f=a.operators[a.operatorsMap[e.type]];e.operators&&(f=e.operators);var k=f[0];b.isPlainObject(k)&&(k=k.oper);"object"!=typeof e.options&&(e.options={});"text"==e.type&&(k="begins");for(var h=0;h<f.length;h++){var g=f[h];b.isPlainObject(g)&&(g=g.oper);if(e.operator==g){k=e.operator;break}}switch(e.type){case "text":case "alphanumeric":b("#grid_"+this.name+"_field_"+d).w2field(e.type,e.options);break;case "int":case "float":case "hex":case "color":case "money":case "currency":case "percent":case "date":case "time":case "datetime":b("#grid_"+this.name+"_field_"+d).w2field(e.type,e.options);b("#grid_"+this.name+"_field2_"+d).w2field(e.type,e.options);setTimeout(function(){b("#grid_"+a.name+"_field_"+d).keydown();b("#grid_"+a.name+"_field2_"+d).keydown()},1);break;case "list":case "combo":case "enum":f=e.options;"list"==e.type&&(f.selected={});"enum"==e.type&&(f.selected=[]);c&&(f.selected=c.value);b("#grid_"+this.name+"_field_"+d).w2field(e.type,b.extend({openOnFocus:!0},f));c&&null!=c.text&&b("#grid_"+this.name+"_field_"+d,a.box).data("selected",{id:c.value,text:c.text});break;case "select":f='\x3coption value\x3d""\x3e--\x3c/option\x3e';for(h=0;h<e.options.items.length;h++)if(g=e.options.items[h],b.isPlainObject(e.options.items[h])){var m=g.id,l=g.text;null==m&&null!=g.value&&(m=g.value);null==l&&null!=g.caption&&(l=g.caption);null==m&&(m="");f+='\x3coption value\x3d"'+m+'"\x3e'+l+"\x3c/option\x3e"}else f+='\x3coption value\x3d"'+g+'"\x3e'+g+"\x3c/option\x3e";b("#grid_"+this.name+"_field_"+d,a.box).html(f)}null!=c?("int"==c.type&&-1!=["in","not in"].indexOf(c.operator)&&b("#grid_"+this.name+"_field_"+d).w2field("clear").val(c.value),b("#grid_"+this.name+"_operator_"+d).val(c.operator).trigger("change"),b.isArray(c.value)?-1!=["in","not in"].indexOf(c.operator)?b("#grid_"+this.name+"_field_"+d).val(c.value).trigger("change"):(b("#grid_"+this.name+"_field_"+d).val(c.value[0]).trigger("change"),b("#grid_"+this.name+"_field2_"+d).val(c.value[1]).trigger("change")):null!=c.value&&b("#grid_"+this.name+"_field_"+d,a.box).val(c.value).trigger("change")):b("#grid_"+this.name+"_operator_"+d).val(k).trigger("change")}b("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel\x3dsearch]").on("keypress",function(c){13==c.keyCode&&(a.search(),b().w2overlay({name:a.name+"-searchOverlay"}))})},getColumnsHTML:function(){function a(){var a="\x3ctr\x3e",b="\x3ctr\x3e",c;""!=e.columnGroups[e.columnGroups.length-1].caption&&e.columnGroups.push({caption:""});e.show.lineNumbers&&(a+='\x3ctd class\x3d"w2ui-head w2ui-col-number"\x3e    \x3cdiv style\x3d"height: 27px"\x3e\x26#160;\x3c/div\x3e\x3c/td\x3e');e.show.selectColumn&&(a+='\x3ctd class\x3d"w2ui-head w2ui-col-select"\x3e    \x3cdiv style\x3d"height: 25px"\x3e\x26#160;\x3c/div\x3e\x3c/td\x3e');e.show.expandColumn&&(a+='\x3ctd class\x3d"w2ui-head w2ui-col-expand"\x3e    \x3cdiv style\x3d"height: 25px"\x3e\x26#160;\x3c/div\x3e\x3c/td\x3e');for(var d=0,b=b+('\x3ctd id\x3d"grid_'+e.name+'_column_start" class\x3d"w2ui-head" col\x3d"start" style\x3d"border-right: 0"\x3e\x3c/td\x3e'),f=0;f<e.columnGroups.length;f++){var h=e.columnGroups[f],k=e.columns[d];null!=h.colspan&&(h.span=h.colspan);if(null==h.span||h.span!=parseInt(h.span))h.span=1;c=0;for(var g=d;g<d+h.span;g++)e.columns[g]&&!e.columns[g].hidden&&c++;f==e.columnGroups.length-1&&c++;if(!(0>=c)){if(!0===h.master){for(var g="",p=0;p<e.sortData.length;p++)e.sortData[p].field==k.field&&(/asc/i.test(e.sortData[p].direction)&&(g="w2ui-sort-up"),/desc/i.test(e.sortData[p].direction)&&(g="w2ui-sort-down"));p="";!1!==k.resizable&&(p='\x3cdiv class\x3d"w2ui-resizer" name\x3d"'+d+'"\x3e\x3c/div\x3e');var r="";k&&k.editable&&"checkbox"==k.editable.type&&!k.editable.onlyChk&&!0!==k.editable.noall&&(void 0==e.checkSel&&(e.checkSel=[]),r='\x3cinput type\x3d"checkbox" '+(1==this.checkSel[d]?"checked":"")+"  onclick\x3d\"w2ui['"+e.name+"'].clickChkSel(this,"+d+",'"+k.field+"','"+(k.editable.check?k.editable.check:"")+"', event);\" \x3e");c='\x3ctd id\x3d"grid_'+e.name+"_column_"+d+'" class\x3d"w2ui-head '+g+'" col\x3d"'+d+'"     rowspan\x3d"2" colspan\x3d"'+c+'"     oncontextmenu \x3d "w2ui[\''+e.name+"'].contextMenu(null, "+d+', event);"    onclick\x3d"w2ui[\''+e.name+"'].columnClick('"+k.field+"', event);\"    ondblclick\x3d\"w2ui['"+e.name+"'].columnDblClick('"+k.field+"', event);\"\x3e"+p+'    \x3cdiv class\x3d"w2ui-col-group w2ui-col-header '+(g?"w2ui-col-sorted":"")+'"\x3e        \x3cdiv class\x3d"'+g+'"\x3e\x3c/div\x3e'+r+(k.caption?k.caption:"\x26#160;")+"    \x3c/div\x3e\x3c/td\x3e"}else c='\x3ctd id\x3d"grid_'+e.name+"_column_"+d+'" class\x3d"w2ui-head" col\x3d"'+d+'"         colspan\x3d"'+c+'"\x3e    \x3cdiv class\x3d"w2ui-col-group"\x3e'+(h.caption?h.caption:"\x26#160;")+"    \x3c/div\x3e\x3c/td\x3e";k&&k.frozen?a+=c:b+=c}d+=h.span}b+='\x3ctd id\x3d"grid_'+e.name+'_column_end" class\x3d"w2ui-head" col\x3d"end"\x3e\x3c/td\x3e\x3c/tr\x3e';return[a+"\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e",b]}function b(a){var b='\x3ctr style\x3d"height:'+e.headRowHeight+'px" \x3e',c='\x3ctr style\x3d"height:'+e.headRowHeight+'px" \x3e';e.show.lineNumbers&&(b+='\x3ctd class\x3d"w2ui-head w2ui-col-number"        onclick\x3d"w2ui[\''+e.name+"'].columnClick('line-number', event);\"       ondblclick\x3d\"w2ui['"+e.name+"'].columnDblClick('line-number', event);\"\x3e    \x3cdiv\x3e#\x3c/div\x3e\x3c/td\x3e");e.show.selectColumn&&(b+='\x3ctd class\x3d"w2ui-head w2ui-col-select"       onclick\x3d"if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble \x3d true;"\x3e    \x3cdiv\x3e        \x3cinput type\x3d"checkbox" id\x3d"grid_'+e.name+'_check_all" tabindex\x3d"-1"            style\x3d"'+(0==e.multiSelect?"display: none;":"")+'"            onmousedown\x3d"if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble \x3d true;"            onclick\x3d"var grid \x3d w2ui[\''+e.name+"'];               if (this.checked) grid.selectAll(); else grid.selectNone();               if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble \x3d true;               clearTimeout(grid.last.kbd_timer); /* keep focus */            \"/\x3e    \x3c/div\x3e\x3c/td\x3e");e.show.expandColumn&&(b+='\x3ctd class\x3d"w2ui-head w2ui-col-expand"\x3e    \x3cdiv\x3e\x26#160;\x3c/div\x3e\x3c/td\x3e');for(var d=0,f=0,h,c=c+('\x3ctd id\x3d"grid_'+e.name+'_column_start" class\x3d"w2ui-head" col\x3d"start" style\x3d"border-right: 0"\x3e\x3c/td\x3e'),k=0;k<e.columns.length;k++){var g=e.columns[k];k==f&&(h=e.columnGroups[d++]||{},f+=h.span);if(!((k<e.last.colStart||k>e.last.colEnd)&&!g.frozen||g.hidden||!0===h.master&&!a)){var n=e.getColumnCellHTML(k);g&&g.frozen?b+=n:c+=n}}return[b+'\x3ctd class\x3d"w2ui-head w2ui-head-last"\x3e\x3cdiv\x3e\x26#160;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e',c+'\x3ctd class\x3d"w2ui-head w2ui-head-last" col\x3d"end"\x3e\x3cdiv\x3e\x26#160;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e']}var e=this,c="",f="";if(this.show.columnHeaders)if(0<this.columnGroups.length)var f=b(!0),k=a(),h=b(!1),c=f[0]+k[0]+h[0],f=f[1]+k[1]+h[1];else f=b(!0),c=f[0],f=f[1];return[c,f]},getColumnCellHTML:function(a){var b=this.columns[a];if(null==b)return"";for(var e=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-reorder-cols-head ",c="",f=0;f<this.sortData.length;f++)this.sortData[f].field==b.field&&(/asc/i.test(this.sortData[f].direction)&&(c="w2ui-sort-up"),/desc/i.test(this.sortData[f].direction)&&(c="w2ui-sort-down"));var k=this.last.selection.columns,h=!1,g;for(g in k)for(f=0;f<k[g].length;f++)k[g][f]==a&&(h=!0);f="";b&&b.editable&&"checkbox"==b.editable.type&&!b.editable.onlyChk&&!0!==b.editable.noall&&(void 0==this.checkSel&&(this.checkSel=[]),f='\x3cinput type\x3d"checkbox" '+(1==this.checkSel[a]?"checked":"")+"  onclick\x3d\"w2ui['"+this.name+"'].clickChkSel(this,"+a+",'"+b.field+"','"+(b.editable.check?b.editable.check:"")+"', event);\" \x3e");return'\x3ctd id\x3d"grid_'+this.name+"_column_"+a+'" col\x3d"'+a+'" class\x3d"w2ui-head '+c+e+'" '+(b.hAlign?" style\x3d'text-align:"+b.hAlign+";' ":"")+("normal"==this.columnTooltip&&b.tooltip?'title\x3d"'+b.tooltip+'" ':"")+"    onmouseover \x3d \"w2ui['"+this.name+"'].columnTooltipShow('"+a+"', event);\"    onmouseout  \x3d \"w2ui['"+this.name+"'].columnTooltipHide('"+a+"', event);\"    oncontextmenu \x3d \"w2ui['"+this.name+"'].contextMenu(null, "+a+', event);"    onclick\x3d"w2ui[\''+this.name+"'].columnClick('"+b.field+"', event);\"    ondblclick\x3d\"w2ui['"+this.name+"'].columnDblClick('"+b.field+"', event);\"\x3e"+(!1!==b.resizable?'\x3cdiv class\x3d"w2ui-resizer" name\x3d"'+a+'"\x3e\x3c/div\x3e':"")+'    \x3cdiv class\x3d"w2ui-col-header '+(c?"w2ui-col-sorted":"")+" "+(h?"w2ui-col-selected":"")+'"\x3e        \x3cdiv class\x3d"'+c+'  huanh"\x3e\x3c/div\x3e'+f+(b.caption?b.caption:"\x26#160;")+"    \x3c/div\x3e\x3c/td\x3e"},clickChkSel:function(a,d,e,c,f){if(0!=$F.sL(e)){a=b(a).is(":checked");void 0==this.checkSel&&(this.checkSel=[]);this.checkSel[d]=a;d=this.records.length;c=1==a?0==$F.sL(c)?1:c:"";for(a=0;a<d;a++)this.records[a][e]=c;this.refresh()}},columnTooltipShow:function(a){if("normal"!=this.columnTooltip){var d=b(this.box).find("#grid_"+this.name+"_column_"+a),e=this.columns[a],c=this.columnTooltip;d.prop("_mouse_over",!0);setTimeout(function(){!0===d.prop("_mouse_over")&&!0!==d.prop("_mouse_tooltip")&&(d.prop("_mouse_tooltip",!0),d.w2tag(e.tooltip,{position:c}))},1)}},columnTooltipHide:function(a){if("normal"!=this.columnTooltip){var d=b(this.box).find("#grid_"+this.name+"_column_"+a);d.removeProp("_mouse_over");setTimeout(function(){!0!==d.prop("_mouse_over")&&!0===d.prop("_mouse_tooltip")&&(d.removeProp("_mouse_tooltip"),d.w2tag())},1)}},getRecordsHTML:function(){var a=this.records.length;0!=this.searchData.length&&(a=this.last.searchIds.length);this.last.show_extra=a>this.vs_start?this.vs_extra:this.vs_start;var d=b("#grid_"+this.name+"_records",this.box),e=Math.floor((0<d.length?d.height():0)/this.recordHeight)+this.last.show_extra+1;if(!this.fixedBody||e>a)e=a;for(var c=this.getRecordHTML(-1,0),f="\x3ctable\x3e\x3ctbody\x3e"+c[0],k="\x3ctable\x3e\x3ctbody\x3e"+c[1],f=f+('\x3ctr id\x3d"grid_'+this.name+'_frec_top" line\x3d"top" style\x3d"height: 0px"\x3e    \x3ctd colspan\x3d"2000"\x3e\x3c/td\x3e\x3c/tr\x3e'),k=k+('\x3ctr id\x3d"grid_'+this.name+'_rec_top" line\x3d"top" style\x3d"height: 0px"\x3e    \x3ctd colspan\x3d"2000"\x3e\x3c/td\x3e\x3c/tr\x3e'),h=0,g=0;g<e+h;g++)c=this.getRecordHTML(g,g+1),""==c[0]?d.length>e+h&&h++:(f+=c[0],k+=c[1]);this.emptyNewRow&&e>=this.records.length-1&&(c=this.getRecordHTML(this.records.length,this.records.length+1),f+=c[0],k+=c[1]);f+='\x3ctr id\x3d"grid_'+this.name+'_frec_bottom" line\x3d"bottom" style\x3d"height: '+(a-e)*this.recordHeight+'px"\x3e    \x3ctd colspan\x3d"2000" style\x3d"border: 0"\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr id\x3d"grid_'+this.name+'_frec_more" style\x3d"display: none; visibility: hidden"\x3e    \x3ctd colspan\x3d"2000" class\x3d"w2ui-load-more"\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e';k+='\x3ctr id\x3d"grid_'+this.name+'_rec_bottom" line\x3d"bottom" style\x3d"height: '+(a-e)*this.recordHeight+'px"\x3e    \x3ctd colspan\x3d"2000" style\x3d"border: 0"\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr id\x3d"grid_'+this.name+'_rec_more" style\x3d"display: none"\x3e    \x3ctd colspan\x3d"2000" class\x3d"w2ui-load-more"\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e';this.last.range_start=0;this.last.range_end=e+(this.emptyNewRow?1:0);return[f,k]},getSummaryHTML:function(){if(0!==this.summary.length){for(var a=this.getRecordHTML(-1,0),b="\x3ctable\x3e\x3ctbody\x3e"+a[0],e="\x3ctable\x3e\x3ctbody\x3e"+a[1],c=0;c<this.summary.length;c++)a=this.getRecordHTML(c,c+1,!0),b+=a[0],e+=a[1];return[b+"\x3c/tbody\x3e\x3c/table\x3e",e+"\x3c/tbody\x3e\x3c/table\x3e"]}},scroll:function(a){function d(){e.markSearch&&(clearTimeout(e.last.marker_timer),e.last.marker_timer=setTimeout(function(){for(var a=[],c=0;c<e.searchData.length;c++){var d=e.searchData[c],f=e.getSearch(d.field);f&&!f.hidden&&-1==a.indexOf(d.value)&&a.push(d.value)}0<a.length&&b(e.box).find(".w2ui-grid-data \x3e div").w2marker(a)},50))}(new Date).getTime();var e=this,c=b("#grid_"+this.name+"_records",e.box),f=b("#grid_"+this.name+"_frecords",e.box);if(a){var k=a.target.scrollTop;a=a.target.scrollLeft;e.last.scrollTop=k;e.last.scrollLeft=a;b("#grid_"+e.name+"_columns",e.box)[0].scrollLeft=a;b("#grid_"+e.name+"_summary",e.box)[0].scrollLeft=a;f[0].scrollTop=k}this.last.bubbleEl&&(b(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);var h=a=null;e.disableCVS||0<e.columnGroups.length||c.width();a=0;h=e.columns.length-1;if(null!=a&&(0>a&&(a=0),0>h&&(h=0),a==h&&(0<a?a--:h++),a!=e.last.colStart||h!=e.last.colEnd)){var k=b(e.box),g=Math.abs(h-e.last.colEnd);if(5>Math.abs(a-e.last.colStart)&&5>g){var g=k.find(".w2ui-grid-columns #grid_"+e.name+"_column_start"),m=k.find(".w2ui-grid-columns .w2ui-head-last"),l=k.find("#grid_"+e.name+"_records .w2ui-grid-data-spacer"),u=k.find("#grid_"+e.name+"_records .w2ui-grid-data-last"),t=k.find("#grid_"+e.name+"_summary .w2ui-grid-data-spacer"),w=k.find("#grid_"+e.name+"_summary .w2ui-grid-data-last");if(a>e.last.colStart)for(var q=e.last.colStart;q<a;q++)k.find("#grid_"+e.name+"_columns #grid_"+e.name+"_column_"+q).remove(),k.find("#grid_"+e.name+'_records td[col\x3d"'+q+'"]').remove(),k.find("#grid_"+e.name+'_summary td[col\x3d"'+q+'"]').remove();if(h<e.last.colEnd)for(q=e.last.colEnd;q>h;q--)k.find("#grid_"+e.name+"_columns #grid_"+e.name+"_column_"+q).remove(),k.find("#grid_"+e.name+'_records td[col\x3d"'+q+'"]').remove(),k.find("#grid_"+e.name+'_summary td[col\x3d"'+q+'"]').remove();if(a<e.last.colStart)for(q=e.last.colStart-1;q>=a;q--)e.columns[q]&&(e.columns[q].frozen||e.columns[q].hidden)||(g.after(e.getColumnCellHTML(q)),l.each(function(a,c){a=b(c).parent().attr("index");var d='\x3ctd class\x3d"w2ui-grid-data" col\x3d"'+q+'" style\x3d"height: 0px"\x3e\x3c/td\x3e';null!=a&&(d=e.getCellHTML(parseInt(a),q,!1));b(c).after(d)}),t.each(function(a,c){a=b(c).parent().attr("index");var d='\x3ctd class\x3d"w2ui-grid-data" col\x3d"'+q+'" style\x3d"height: 0px"\x3e\x3c/td\x3e';null!=a&&(d=e.getCellHTML(parseInt(a),q,!0));b(c).after(d)}));if(h>e.last.colEnd)for(q=e.last.colEnd+1;q<=h;q++)e.columns[q]&&(e.columns[q].frozen||e.columns[q].hidden)||(m.before(e.getColumnCellHTML(q)),u.each(function(a,c){a=b(c).parent().attr("index");var d='\x3ctd class\x3d"w2ui-grid-data" col\x3d"'+q+'" style\x3d"height: 0px"\x3e\x3c/td\x3e';null!=a&&(d=e.getCellHTML(parseInt(a),q,!1));b(c).before(d)}),w.each(function(a,c){a=b(c).parent().attr("index");a=e.getCellHTML(parseInt(a),q,!0);b(c).before(a)}));e.last.colStart=a;e.last.colEnd=h}else{e.last.colStart=a;e.last.colEnd=h;a=this.getColumnsHTML();var h=this.getRecordsHTML(),g=this.getSummaryHTML(),m=k.find("#grid_"+this.name+"_columns"),v=k.find("#grid_"+this.name+"_records"),l=k.find("#grid_"+this.name+"_frecords"),p=k.find("#grid_"+this.name+"_summary");m.find("tbody").html(a[1]);l.html(h[0]);v.prepend(h[1]);null!=g&&p.html(g[1]);setTimeout(function(){v.find("\x3e table").not("table:first-child").remove();p[0]&&(p[0].scrollLeft=e.last.scrollLeft)},1)}e.resizeRecords()}k=this.records.length;0!=this.searchData.length&&(k=this.last.searchIds.length);if(0!==k&&0!==c.length&&0!==c.height()){this.last.show_extra=k>this.vs_start?this.vs_extra:this.vs_start;if(!(c.height()<k*this.recordHeight&&"hidden"==c.css("overflow-y")||(a=Math.round(c[0].scrollTop/this.recordHeight+1),h=a+(Math.round(c.height()/this.recordHeight)-1),a>k&&(a=k),h>=k-1&&(h=k),b("#grid_"+this.name+"_footer .w2ui-footer-right",e.box).html((e.show.statusRange?w2utils.formatNumber(this.offset+a)+"-"+w2utils.formatNumber(this.offset+h)+(-1!=this.total?" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total):""):"")+(e.show.statusBuffered?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(k)+(0<this.offset?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),!this.fixedBody||-1!=this.total&&this.total<=this.vs_start))){a=Math.floor(c[0].scrollTop/this.recordHeight)-this.last.show_extra;h=a+Math.floor(c.height()/this.recordHeight)+2*this.last.show_extra+1;1>a&&(a=1);h>this.total&&-1!=this.total&&(h=this.total);g=c.find("#grid_"+this.name+"_rec_top");m=c.find("#grid_"+this.name+"_rec_bottom");l=f.find("#grid_"+this.name+"_frec_top");u=f.find("#grid_"+this.name+"_frec_bottom");-1!=String(g.next().prop("id")).indexOf("_expanded_row")&&(g.next().remove(),l.next().remove());this.total>h&&-1!=String(m.prev().prop("id")).indexOf("_expanded_row")&&(m.prev().remove(),u.prev().remove());t=parseInt(g.next().attr("line"));w=parseInt(m.prev().attr("line"));if(t<a||1==t||this.last.pull_refresh){if(h<=w+this.last.show_extra-2&&h!=this.total){e.nextPageShow(c);return}for(this.last.pull_refresh=!1;;){t=f.find("#grid_"+this.name+"_frec_top").next();w=c.find("#grid_"+this.name+"_rec_top").next();if("bottom"==w.attr("line"))break;if(parseInt(w.attr("line"))<a)t.remove(),w.remove();else break}f=c.find("#grid_"+this.name+"_rec_bottom").prev();f=f.attr("line");"top"==f&&(f=a);for(q=parseInt(f)+1;q<=h;q++)this.records[q-1]&&(Array.isArray(this.getChild(this.records[q-1]))||this.setChildExpend(this.records[q-1],!1),t=this.getRecordHTML(q-1,q),m.before(t[1]),u.before(t[0]));this.emptyNewRow&&h>=this.records.length-1&&parseInt(f)+1<=h&&(t=this.getRecordHTML(this.records.length,this.records.length+1),m.before(t[1]),u.before(t[0]),h++)}else{if(a>=t-this.last.show_extra+2&&1<a){e.nextPageShow(c);return}for(;;){t=f.find("#grid_"+this.name+"_frec_bottom").prev();w=c.find("#grid_"+this.name+"_rec_bottom").prev();if("top"==w.attr("line"))break;if(parseInt(w.attr("line"))>h)t.remove(),w.remove();else break}f=c.find("#grid_"+this.name+"_rec_top").next();f=f.attr("line");"bottom"==f&&(f=h);for(q=parseInt(f)-1;q>=a;q--)this.records[q-1]&&(Array.isArray(this.getChild(this.records[q-1]))||this.setChildExpend(this.records[q-1],!1),t=this.getRecordHTML(q-1,q),g.after(t[1]),l.after(t[0]))}d();setTimeout(function(){e.refreshRanges()},0);f=(a-1)*e.recordHeight;k=(k-h)*e.recordHeight;0>k&&(k=0);g.css("height",f+"px");l.css("height",f+"px");m.css("height",k+"px");u.css("height",k+"px");e.last.range_start=a;e.last.range_end=h;c.height()}e.nextPageShow(c)}},nextPageShow:function(a){var d=this;if(d.hasNextRec)if(!d.autoLoad){a=b("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more",d.box);if("none"==a.css("display"))a.show().off("click").on("click",function(){b.isFunction(d.getNextRec)&&(d.pageIndex++,d.getNextRec(d.pageIndex)||d.pageIndex--)});(0<a.find("td .w2ui-spinner").length||-1==a.find("td").text().indexOf("Load"))&&a.find("td").html("\x3cdiv\x3e \u52a0\u8f7d \u4e0b\u4e00\u9875\u6570\u636e ...\x3c/div\x3e")}else{if(a){var e=a.height(),c=a.get(0).scrollHeight;.97<=a.scrollTop()/(c-e)&&b.isFunction(d.getNextRec)&&1!=d.getRecIng&&(d.getRecIng=1,d.pageIndex++,d.getNextRec(d.pageIndex)||d.pageIndex--,d.getRecIng=void 0)}}else b("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more",d.box).hide()},getNewRecId:function(){void 0==this.records.recid_?this.records.recid_=0:this.records.recid_++;return this.newKey+"_S_"+this.records.recid_},getRecordHTML:function(a,b,e,c){var d="",k="",h=this.last.selection;if(-1==a){d+='\x3ctr line\x3d"0"\x3e';this.show.lineNumbers&&(d+='\x3ctd class\x3d"w2ui-col-number" style\x3d"height: 0px;"\x3e\x3c/td\x3e');this.show.selectColumn&&(d+='\x3ctd class\x3d"w2ui-col-select" style\x3d"height: 0px;"\x3e\x3c/td\x3e');this.show.expandColumn&&(d+='\x3ctd class\x3d"w2ui-col-expand" style\x3d"height: 0px;"\x3e\x3c/td\x3e');k+='\x3ctr line\x3d"0"\x3e\x3ctd class\x3d"w2ui-grid-data w2ui-grid-data-spacer" col\x3d"start" style\x3d"height: 0px; width: 0px;"\x3e\x3c/td\x3e';for(h=0;h<this.columns.length;h++)b=this.columns[h],a='\x3ctd class\x3d"w2ui-grid-data" col\x3d"'+h+'" style\x3d"height: 0px;"\x3e\x3c/td\x3e',b.frozen&&!b.hidden?d+=a:b.hidden||h<this.last.colStart||h>this.last.colEnd||(k+=a);return[d+'\x3ctd class\x3d"w2ui-grid-data-last" style\x3d"height: 0px"\x3e\x3c/td\x3e\x3c/tr\x3e',k+'\x3ctd class\x3d"w2ui-grid-data-last" col\x3d"end" style\x3d"height: 0px"\x3e\x3c/td\x3e\x3c/tr\x3e']}if(!0!==e)if(0<this.searchData.length&&!c){if(a>=this.last.searchIds.length)return"";a=this.last.searchIds[a];c=this.records[a]}else a>=this.records.length?(c=[],c.recid=this.getNewRecId(),this.NewRecId=c.recid):c=this.records[a];else{if(a>=this.summary.length)return"";c=this.summary[a]}if(!c)return["",""];void 0==c.recid&&(c.recid=this.getNewRecId());if(this.showRowFunc&&!1===this.showRowFunc(a,c,this.records)||3==c.editFlag||4==c.editFlag)return["",""];null==c.recid&&null!=this.recid&&null!=c[this.recid]&&(c.recid=c[this.recid]);w2utils.escapeId(c.recid);var g=!1;-1!=h.indexes.indexOf(a)&&(g=!0);h=c.w2ui?c.w2ui.style:"";if(null==h||"string"!=typeof h)h="";var m=c.w2ui?c.w2ui["class"]:"";if(null==m||"string"!=typeof m)m="";d+='\x3ctr id\x3d"grid_'+this.name+"_frec_"+c.recid+'" recid\x3d"'+c.recid+'" line\x3d"'+b+'" index\x3d"'+a+'"  class\x3d"'+(0===b%2?"w2ui-even":"w2ui-odd")+" "+m+(g&&"row"==this.selectType?" w2ui-selected":"")+(c.w2ui&&!1===c.w2ui.editable?" w2ui-no-edit":"")+(!0===this.getChildExpend(c)?" w2ui-expanded":"")+'" '+(!0!==e?w2utils.isIOS?"    onclick  \x3d \"w2ui['"+this.name+"'].dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  \x3d \"w2ui['"+this.name+"'].click(jQuery(this).attr('recid'), event);\"    oncontextmenu \x3d \"w2ui['"+this.name+"'].contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover\x3d\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout \x3d\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style\x3d"height: '+this.recordHeight+"px; "+(g||""==h?h.replace("background-color","none"):h)+'" '+(""!=h?'custom_style\x3d"'+h+'"':"")+"\x3e";k+='\x3ctr id\x3d"grid_'+this.name+"_rec_"+c.recid+'" recid\x3d"'+c.recid+'" line\x3d"'+b+'" index\x3d"'+a+'"  class\x3d"'+(0===b%2?"w2ui-even":"w2ui-odd")+" "+m+(g&&"row"==this.selectType?" w2ui-selected":"")+(c.w2ui&&!1===c.w2ui.editable?" w2ui-no-edit":"")+(!0===this.getChildExpend(c)?" w2ui-expanded":"")+'" '+(!0!==e?w2utils.isIOS?"    onclick  \x3d \"var obj \x3d w2ui['"+this.name+"']; obj.dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  \x3d \"var obj \x3d w2ui['"+this.name+"']; obj.click(jQuery(this).attr('recid'), event);\"    oncontextmenu \x3d \"var obj \x3d w2ui['"+this.name+"']; obj.contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover\x3d\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout \x3d\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style\x3d"height: '+this.recordHeight+"px; "+(g||""==h?h.replace("background-color","none"):h)+'" '+(""!=h?'custom_style\x3d"'+h+'"':"")+"\x3e";this.show.lineNumbers&&(d+='\x3ctd id\x3d"grid_'+this.name+"_cell_"+a+"_number"+(e?"_s":"")+'"    class\x3d"w2ui-col-number '+(g?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style\x3d"cursor: move"':"")+"\x3e"+(!0!==e?this.getLineHTML(b,c):"")+"\x3c/td\x3e");this.show.selectColumn&&(d+='\x3ctd id\x3d"grid_'+this.name+"_cell_"+a+"_select"+(e?"_s":"")+'" class\x3d"w2ui-grid-data w2ui-col-select"\x3e'+(!0!==e?'    \x3cdiv\x3e        \x3cinput class\x3d"w2ui-grid-select-check" type\x3d"checkbox" tabindex\x3d"-1" '+(g?'checked\x3d"checked"':"")+' style\x3d"pointer-events: none"/\x3e    \x3c/div\x3e':"")+"\x3c/td\x3e");this.show.expandColumn&&(g=this.getChildExpend(c),b=!0===g?"-":"+","none"==g&&(b=""),"spinner"==g&&(b='\x3cdiv class\x3d"w2ui-spinner" style\x3d"width: 16px; margin: -2px 2px;"\x3e\x3c/div\x3e'),d+='\x3ctd id\x3d"grid_'+this.name+"_cell_"+a+"_expand"+(e?"_s":"")+'" class\x3d"w2ui-grid-data w2ui-col-expand"\x3e'+(!0!==e?'    \x3cdiv ondblclick\x3d"if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble \x3d true;"             onclick\x3d"w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble \x3d true;\"\x3e        "+b+" \x3c/div\x3e":"")+"\x3c/td\x3e");k+='\x3ctd class\x3d"w2ui-grid-data-spacer" col\x3d"start" style\x3d"border-right: 0"\x3e\x3c/td\x3e';for(h=g=0;;){m=1;b=this.columns[g];if(null==b)break;if(b.hidden)g++,0<h&&h--;else if(0<h){g++;if(null==this.columns[g])break;c.w2ui.colspan[this.columns[g-1].field]=0;h--}else{if(c.w2ui){var l=c.w2ui.colspan,u=this.columns[g].field;l&&0===l[u]&&delete l[u]}if(!(g<this.last.colStart||g>this.last.colEnd)||b.frozen){if(c.w2ui&&"object"==typeof c.w2ui.colspan&&(l=parseInt(c.w2ui.colspan[b.field])||null,1<l)){m=0;for(h=g;h<g+l&&!(h>=this.columns.length);h++)this.columns[h].hidden&&m++;m=l-m;h=l-1}m=this.getCellHTML(a,g,e,m);b.frozen?d+=m:k+=m}g++}}return[d+'\x3ctd class\x3d"w2ui-grid-data-last"\x3e\x3c/td\x3e\x3c/tr\x3e',k+'\x3ctd class\x3d"w2ui-grid-data-last" col\x3d"end"\x3e\x3c/td\x3e\x3c/tr\x3e']},getLineHTML:function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"},getCellHTML:function(a,d,e,c){var f=this.columns[d];if(null==f)return"";var k=!0!==e?this.records[a]:this.summary[a],h=this.getCellValue(a,d,e),g=this.getCellEditable(a,d),m="max-height: "+parseInt(this.recordHeight)+"px;",l=!e&&k&&k.w2ui&&k.w2ui.changes&&null!=k.w2ui.changes[f.field],u="",t=this.last.selection,w=!1,q="";-1!=t.indexes.indexOf(a)&&(w=!0);null==c&&(c=k&&k.w2ui&&k.w2ui.colspan&&k.w2ui.colspan[f.field]?k.w2ui.colspan[f.field]:1);var v=this.getChild(k);if(0===d&&k&&(Array.isArray(v)||this.getChildParId(k))){for(var p=0,r=this.get(this.getChildParId(k),!0);;)if(null!=r)if(p++,r=this.getChildParId(this.records[r]),void 0!=r)r=this.get(r,!0);else break;else break;if(this.getChildParId(k))for(r=0;r<p;r++)q+='\x3cspan class\x3d"w2ui-show-children w2ui-icon-empty"\x3e\x3c/span\x3e';q+='\x3cspan class\x3d"w2ui-show-children '+(v&&0<v.length?this.getChildExpend(k)?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick\x3d"event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"\x3e\x3c/span\x3e"}!0===f.info&&(f.info={});null!=f.info&&(f.info.icon||(f.info.icon="w2ui-icon-info"),q+='\x3cspan class\x3d"w2ui-info '+f.info.icon+'" style\x3d"'+(f.info.style||"")+'"  onclick\x3d"event.stopPropagation(); w2ui[\''+this.name+"'].showBubble("+a+", "+d+')"\x3e\x3c/span\x3e');v="";if(f.ico)var x=e?-(a+1):a,v='\x3ci style\x3d"cursor: pointer;margin-left: 5px;" class\x3d"fa '+f.ico+'"  onclick\x3d"    var obj \x3d w2ui[\''+this.name+"'];     obj.icoClick.call(obj, this, "+x+", "+d+', event); "\x3e\x3c/i\x3e';if(f.fixBtns){if($F.isArrayAndNEP(f.fixBtns)){var z="",y=this,x=e?-(a+1):a;b.each(f.fixBtns,function(a,b){if(void 0===h||""===h||"0"===h+""||h===b[0])z+='\x3ca class\x3d"w2cell_link" onclick\x3d"w2ui[\''+y.name+"'].cellLblClick(this,"+x+","+d+',event);"\x3e'+b[1]+"\x3c/a\x3e"});h=z;u+="text-align: center;"}}else if(null!=f.render)if("function"==typeof f.render){if(h=b.trim(f.render.call(this,k,a,d,h)),4>h.length||"\x3cdiv"!=h.substr(0,4).toLowerCase())h='\x3cdiv style\x3d"'+m+'"'+("1"==this.columns[d].hx?" class\x3dhuanh":"")+" \x3e"+q+String(h)+v+"\x3c/div\x3e"}else"object"==typeof f.render?h='\x3cdiv style\x3d"'+m+'"'+("1"==this.columns[d].hx?" class\x3dhuanh":"")+"\x3e"+q+(f.render[h]||"")+v+"\x3c/div\x3e":"string"==typeof f.render&&(e=f.render.toLowerCase().indexOf(":"),r=[],-1==e?(r[0]=f.render.toLowerCase(),r[1]=""):(r[0]=f.render.toLowerCase().substr(0,e),r[1]=f.render.toLowerCase().substr(e+1)),e=w2utils.formatters[r[0]],h='\x3cdiv style\x3d"'+m+'"'+("1"==this.columns[d].hx?" class\x3dhuanh":"")+"\x3e"+q+("function"==typeof e?e(h,r[1]):"")+v+"\x3c/div\x3e");else{g&&-1!=["checkbox","check"].indexOf(g.type)?(x=e?-(a+1):a,m+="text-align: center;",h=f.editable.check?h==f.editable.check?'checked\x3d"checked"':"":h?'checked\x3d"checked"':"",h='\x3cinput tabindex\x3d"-1" type\x3d"checkbox" '+h+" onclick\x3d\"    var obj \x3d w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+x+", "+d+', event); "/\x3e',q=""):g&&"faImg"==g.type&&(x=e?-(a+1):a,m+="text-align: center;",h='\x3ca class\x3d"'+g.img+'" tabindex\x3d"-1"  onclick\x3d"    var obj \x3d w2ui[\''+this.name+"'];     obj.imgClick.call(obj, this, "+x+", "+d+', event); "\x3e\x3c/a\x3e',q="");if(this.show.recordTitles){var B=w2utils.stripTags(String(h).replace(/"/g,"''"));null!=f.title&&("function"==typeof f.title&&(B=f.title.call(this,k,a,d)),"string"==typeof f.title&&(B=f.title))}h='\x3cdiv style\x3d"'+m+'" title\x3d"'+(B||"")+'"'+("1"==this.columns[d].hx?" class\x3dhuanh":"")+"\x3e"+q+String(h)+v+"\x3c/div\x3e"}null==h&&(h="");"string"==typeof f.render&&(r=f.render.toLowerCase().split(":"),-1!="number int float money currency percent size".split(" ").indexOf(r[0])&&(u+="text-align: right;"));m=!1;w&&-1!=b.inArray(d,t.columns[a])&&(m=!0);return h='\x3ctd class\x3d"w2ui-grid-data'+(m?" w2ui-selected":"")+" "+(l?" w2ui-changed":"")+'"    id\x3d"grid_'+this.name+"_data_"+a+"_"+d+'" col\x3d"'+d+'"    style\x3d"'+u+(null!=f.style?f.style:"")+'" '+(null!=f.attr?f.attr:"")+(1<c?'colspan\x3d"'+c+'"':"")+"\x3e"+h+"\x3c/td\x3e"},showBubble:function(a,d){var e="",c=this.columns[d].info,f=this.records[a],k=b(this.box).find("#grid_"+this.name+"_data_"+a+"_"+d+" .w2ui-info");this.last.bubbleEl&&b(this.last.bubbleEl).w2tag();this.last.bubbleEl=k;if(null==c.fields){c.fields=[];for(var h=0;h<this.columns.length;h++){var g=this.columns[h];c.fields.push(g.field+("string"==typeof g.render?":"+g.render:""))}}var m=c.fields;"function"==typeof m&&(m=m(f,a,d));if("function"==typeof c.render)e=c.render(f,a,d);else if(b.isArray(m)){e='\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e';for(h=0;h<m.length;h++){var l=String(m[h]).split(":");if(""==l[0]||"-"==l[0]||"--"==l[0]||"---"==l[0])e+='\x3ctr\x3e\x3ctd colspan\x3d2\x3e\x3cdiv style\x3d"border-top: '+(""==l[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e';else{g=this.getColumn(l[0]);null==g&&(g={field:l[0],caption:l[0]});var u=g?this.parseField(f,g.field):"";1<l.length&&(w2utils.formatters[l[1]]?u=w2utils.formatters[l[1]](u,l[2]||null):console.log('ERROR: w2utils.formatters["'+l[1]+'"] does not exists.'));if(!0===c.showEmpty||null!=u&&""!=u)null!=c.maxLength&&"string"==typeof u&&u.length>c.maxLength&&(u=u.substr(0,c.maxLength)+"..."),e+="\x3ctr\x3e\x3ctd\x3e"+g.caption+"\x3c/td\x3e\x3ctd\x3e"+((0===u?"0":u)||"")+"\x3c/td\x3e\x3c/tr\x3e"}}e+="\x3c/table\x3e"}else if(b.isPlainObject(m)){var e='\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e',t;for(t in m)if(h=m[t],""==h||"-"==h||"--"==h||"---"==h)e+='\x3ctr\x3e\x3ctd colspan\x3d2\x3e\x3cdiv style\x3d"border-top: '+(""==h?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e';else if(l=String(h).split(":"),g=this.getColumn(l[0]),null==g&&(g={field:l[0],caption:l[0]}),u=g?this.parseField(f,g.field):"",1<l.length&&(w2utils.formatters[l[1]]?u=w2utils.formatters[l[1]](u,l[2]||null):console.log('ERROR: w2utils.formatters["'+l[1]+'"] does not exists.')),"function"==typeof h&&(u=h(f,a,d)),!0===c.showEmpty||null!=u&&""!=u)null!=c.maxLength&&"string"==typeof u&&u.length>c.maxLength&&(u=u.substr(0,c.maxLength)+"..."),e+="\x3ctr\x3e\x3ctd\x3e"+t+"\x3c/td\x3e\x3ctd\x3e"+(u||"")+"\x3c/td\x3e\x3c/tr\x3e";e+="\x3c/table\x3e"}b(k).w2tag(b.extend({html:e,left:-4,position:"bottom|top",className:"w2ui-info-bubble",style:"",hideOnClick:!0},c.options||{}))},getCellEditable:function(a,b){var d=this.columns[b],c=this.records[a];void 0==c&&a==this.records.length&&this.emptyNewRow&&(c=[]);if(!c||!d)return null;var f=c.w2ui?c.w2ui.editable:null;if(!1===f)return null;if(null==f||!0===f)f=d?d.editable:null,"function"===typeof f&&(d=this.getCellValue(a,b,!1),f=f.call(this,c,a,b,d));return f},getCellValue:function(a,d,e){d=this.columns[d];a=!0!==e?this.records[a]:this.summary[a];e=this.parseField(a,d.field);a&&a.w2ui&&a.w2ui.changes&&null!=a.w2ui.changes[d.field]&&(e=a.w2ui.changes[d.field]);b.isPlainObject(e)&&d.editable&&(null!=e.text&&(e=e.text),null!=e.id&&(e=e.id));null==e&&(e="");return e},getFooterHTML:function(){return'\x3cdiv\x3e    \x3cdiv class\x3d"w2ui-footer-left"\x3e\x3c/div\x3e    \x3cdiv class\x3d"w2ui-footer-right"\x3e\x3c/div\x3e    \x3cdiv class\x3d"w2ui-footer-center"\x3e\x3c/div\x3e\x3c/div\x3e'},status:function(a){if(null!=a)b("#grid_"+this.name+"_footer",this.box).find(".w2ui-footer-left").html(a);else{var d="";a=this.getSelection();0<a.length&&(this.show.statusSelection&&1<a.length&&(d=String(a.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected")),this.show.statusRecordID&&1==a.length&&(d=a[0],"object"==typeof d&&(d=d.recid+", "+w2utils.lang("Column")+": "+d.column),d=w2utils.lang("Record ID")+": "+d+" "));b("#grid_"+this.name+"_footer .w2ui-footer-left",this.box).html(d);1==a.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit");1<=a.length?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete")}},stateSave:function(a){if(!w2utils.hasLocalStorage)return null;for(var d={columns:[],show:b.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,caption:this.last.caption,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]},e=0;e<this.columns.length;e++){var c=this.columns[e];d.columns.push({field:c.field,hidden:c.hidden?!0:!1,frozen:c.frozen?!0:!1,size:c.size?c.size:null,sizeCalculated:c.sizeCalculated?c.sizeCalculated:null,sizeOriginal:c.sizeOriginal?c.sizeOriginal:null,sizeType:c.sizeType?c.sizeType:null})}for(e=0;e<this.sortData.length;e++)d.sortData.push(b.extend({},this.sortData[e]));for(e=0;e<this.searchData.length;e++)d.searchData.push(b.extend({},this.searchData[e]));if(!0!==a){a=this.trigger({phase:"before",type:"stateSave",target:this.name,state:d});if(!0===a.isCancelled){"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."});return}try{var f=b.parseJSON(localStorage.w2ui||"{}");f||(f={});f.states||(f.states={});f.states[this.stateId||this.name]=d;localStorage.w2ui=JSON.stringify(f)}catch(k){return delete localStorage.w2ui,null}this.trigger(b.extend(a,{phase:"after"}))}return d},stateRestore:function(a){var d=this;if(!a)try{if(!w2utils.hasLocalStorage)return!1;var e=b.parseJSON(localStorage.w2ui||"{}");e||(e={});e.states||(e.states={});a=e.states[this.stateId||this.name]}catch(m){return delete localStorage.w2ui,null}var c=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:a});if(!0===c.isCancelled)"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."});else{if(b.isPlainObject(a)){b.extend(this.show,a.show);b.extend(this.last,a.last);for(var f=this.last.scrollTop,k=this.last.scrollLeft,h=0;h<a.columns.length;h++){var e=a.columns[h],g=this.getColumn(e.field,!0);null!==g&&(b.extend(this.columns[g],e),h!==g&&this.columns.splice(h,0,this.columns.splice(g,1)[0]))}this.sortData.splice(0,this.sortData.length);for(h=0;h<a.sortData.length;h++)this.sortData.push(a.sortData[h]);this.searchData.splice(0,this.searchData.length);for(h=0;h<a.searchData.length;h++)this.searchData.push(a.searchData[h]);setTimeout(function(){0<d.sortData.length&&d.localSort();0<d.searchData.length&&d.localSearch();d.last.scrollTop=f;d.last.scrollLeft=k;d.refresh()},1)}this.trigger(b.extend(c,{phase:"after"}));return!0}},stateReset:function(){this.stateRestore(this.last.state);if(w2utils.hasLocalStorage)try{var a=b.parseJSON(localStorage.w2ui||"{}");a.states&&a.states[this.stateId||this.name]&&delete a.states[this.stateId||this.name];localStorage.w2ui=JSON.stringify(a)}catch(d){return delete localStorage.w2ui,null}},parseField:function(a,b){var d="";try{var d=a,c=String(b).split(".");for(a=0;a<c.length;a++)d=d[c[a]]}catch(f){d=""}return d},prepareData:function(){function a(c){for(var d=0;d<b.columns.length;d++){var e=b.columns[d];if(null!=c[e.field]&&"string"==typeof e.render){-1!="number int float money currency percent".split(" ").indexOf(e.render.split(":")[0])&&"number"!=typeof c[e.field]&&(c[e.field]=parseFloat(c[e.field]));if(-1!=["date","age"].indexOf(e.render.split(":")[0])&&!c[e.field+"_"]){var h=c[e.field];w2utils.isInt(h)&&(h=parseInt(h));c[e.field+"_"]=new Date(h)}if(-1!=["time"].indexOf(e.render)){if(w2utils.isTime(c[e.field])){var g=w2utils.isTime(c[e.field],!0),h=new Date;h.setHours(g.hours,g.minutes,g.seconds?g.seconds:0,0)}else g=c[e.field],w2utils.isInt(g)&&(g=parseInt(g)),g=null!=g?new Date(g):new Date,h=new Date,h.setHours(g.getHours(),g.getMinutes(),g.getSeconds(),0);c[e.field+"_"]||(c[e.field+"_"]=h)}}}if((d=b.getChild(c))&&!0!==b.getChildExpend(c))for(c=0;c<d.length;c++)a(d[c])}for(var b=this,e=0;e<this.records.length;e++)a(this.records[e])},nextCell:function(a,b,e){b+=1;if(b>=this.columns.length)return null;var c;this.records[a]&&(c=this.records[a].w2ui);var d=this.columns[b];c=c&&c.colspan&&!isNaN(c.colspan[d.field])?parseInt(c.colspan[d.field]):1;return null==d?null:d&&d.hidden||0===c||e&&(c=this.getCellEditable(a,b),null==c||-1!=["checkbox","check","faImg"].indexOf(c.type))?this.nextCell(a,b,e):b},prevCell:function(a,b,e){--b;if(0>b)return null;this.records[a]&&this.records[a].w2ui;var c=this.columns[b];return null==c?null:c&&c.hidden||e&&(c=this.getCellEditable(a,b),null==c||-1!=["checkbox","check","faImg"].indexOf(c.type))?this.prevCell(a,b,e):b},nextRow:function(a,d){var e=this.last.searchIds,c=null;if(a+1<this.records.length&&0===e.length||0<e.length&&a<e[e.length-1]){a++;if(0<e.length)for(;!(-1!=b.inArray(a,e)||a>this.records.length);)a++;e=this.records[a].w2ui;c=this.columns[d];c=0===(e&&e.colspan&&null!=c&&!isNaN(e.colspan[c.field])?parseInt(e.colspan[c.field]):1)?this.nextRow(a,d):a}else this.emptyNewRow&&a+1==this.records.length&&(c=a+1);return c},prevRow:function(a,d){var e=this.last.searchIds,c=null;if(0<a&&0===e.length||0<e.length&&a>e[0]){a--;if(0<e.length)for(;!(-1!=b.inArray(a,e)||0>a);)a--;e=this.records[a].w2ui;c=this.columns[d];c=0===(e&&e.colspan&&null!=c&&!isNaN(e.colspan[c.field])?parseInt(e.colspan[c.field]):1)?this.prevRow(a,d):a}return c},selectionSave:function(){this.last._selection=this.getSelection();return this.last._selection},selectionRestore:function(a){var d=(new Date).getTime();this.last.selection={indexes:[],columns:{}};for(var e=this.last.selection,c=this.last._selection,f=0;f<c.length;f++)if(b.isPlainObject(c[f])){var k=this.get(c[f].recid,!0);null!=k&&(-1==e.indexes.indexOf(k)&&e.indexes.push(k),e.columns[k]||(e.columns[k]=[]),e.columns[k].push(c[f].column))}else k=this.get(c[f],!0),null!=k&&e.indexes.push(k);delete this.last._selection;!0!==a&&this.refresh();return(new Date).getTime()-d},message:function(a,d){"string"==typeof a&&(a={width:300>a.length?350:550,height:300>a.length?170:250,body:'\x3cdiv class\x3d"w2ui-centered"\x3e'+a+"\x3c/div\x3e",buttons:'\x3cbutton class\x3d"w2ui-btn" onclick\x3d"w2ui[\''+this.name+"'].message()\"\x3eOk\x3c/button\x3e",onOpen:function(a){setTimeout(function(){b(this.box).find(".w2ui-btn").focus()},25)},onClose:function(a){"function"==typeof d&&d()}});w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},a)}};b.extend(g.prototype,w2utils.event);w2obj.grid=g})(jQuery);var w2popup={};(function(b){b.fn.w2popup=function(g,a){null==g&&(a={},g="open");b.isPlainObject(g)&&(a=g,g="open");g=g.toLowerCase();"load"===g&&"string"===typeof a&&(a=b.extend({url:a},2<arguments.length?arguments[2]:{}));"open"===g&&null!=a.url&&(g="load");a=a||{};var d={};if(0<b(this).length&&"open"==g){if(0<b(this).find("div[rel\x3dtitle], div[rel\x3dbody], div[rel\x3dbuttons]").length){if(0<b("#w2ui-popup").length){var e=b("#w2ui-popup").data("options");w2popup._prev={template:w2popup._template,title:e.title,body:e.body,buttons:e.buttons}}w2popup._template=this;0<b(this).find("div[rel\x3dtitle]").length&&(d.title=b(this).find("div[rel\x3dtitle]"));0<b(this).find("div[rel\x3dbody]").length&&(d.body=b(this).find("div[rel\x3dbody]"),d.style=b(this).find("div[rel\x3dbody]")[0].style.cssText);0<b(this).find("div[rel\x3dbuttons]").length&&(d.buttons=b(this).find("div[rel\x3dbuttons]"))}else d.title="\x26#160;",d.body=b(this).html();0!==parseInt(b(this).css("width"))&&(d.width=parseInt(b(this).css("width")));0!==parseInt(b(this).css("height"))&&(d.height=parseInt(b(this).css("height")))}return w2popup[g](b.extend({},d,a))};w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,open:function(g){var a=this;if("closing"==w2popup.status)setTimeout(function(){a.open.call(a,g)},100);else{var d=b("#w2ui-popup").data("options");g=b.extend({},this.defaults,d,{title:"",body:"",buttons:""},g,{maximized:!1});setTimeout(function(){b("#w2ui-popup").data("options",g)},100);0===b("#w2ui-popup").length&&(w2popup.onMax=null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null);g.onOpen&&(w2popup.onOpen=g.onOpen);g.onClose&&(w2popup.onClose=g.onClose);g.onMax&&(w2popup.onMax=g.onMax);g.onMin&&(w2popup.onMin=g.onMin);g.onToggle&&(w2popup.onToggle=g.onToggle);g.onKeydown&&(w2popup.onKeydown=g.onKeydown);g.width=parseInt(g.width);g.height=parseInt(g.height);var e,c;void 0==window.innerHeight?(e=parseInt(document.documentElement.offsetWidth),c=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(e+=21,c+=4)):(e=parseInt(window.innerWidth),c=parseInt(window.innerHeight));e-10<g.width&&(g.width=e-10);c-10<g.height&&(g.height=c-10);c=(c-g.height)/2*.6;e=(e-g.width)/2;if(0===b("#w2ui-popup").length){var f=this.trigger({phase:"before",type:"open",target:"popup",options:g,present:!1});if(!0===f.isCancelled)return;w2popup.status="opening";w2popup.lockScreen(g);d="";g.showClose&&(d+='\x3cdiv class\x3d"w2ui-popup-button w2ui-popup-close" onmousedown\x3d"event.stopPropagation()" onclick\x3d"w2popup.close()"\x3eClose\x3c/div\x3e');g.showMax&&(d+='\x3cdiv class\x3d"w2ui-popup-button w2ui-popup-max" onmousedown\x3d"event.stopPropagation()" onclick\x3d"w2popup.toggle()"\x3eMax\x3c/div\x3e');c='\x3cdiv id\x3d"w2ui-popup" class\x3d"w2ui-popup" style\x3d"opacity: 0; left: '+e+"px; top: "+c+"px;     width: "+parseInt(g.width)+"px; height: "+parseInt(g.height)+"px; "+w2utils.cssPrefix("transform","scale(0.8)",!0)+'"\x3e\x3c/div\x3e';b("body").append(c);c=b("#w2ui-popup");if(0<c.find("div[rel\x3dtitle], div[rel\x3dbody], div[rel\x3dbuttons]").length){var k=c.find("div[rel\x3dtitle]");0<k.length&&(g.title=k.html(),k.remove());k=c.find("div[rel\x3dbuttons]");0<k.length&&(g.buttons=k.html(),k.remove());k=c.find("div[rel\x3dbody]");g.body=0<k.length?k.html():c.html()}c='\x3cdiv class\x3d"w2ui-popup-title" style\x3d"'+(g.title?"":"display: none")+'"\x3e'+d+'\x3c/div\x3e\x3cdiv class\x3d"w2ui-box" style\x3d"'+(g.title?"":"top: 0px !important;")+(g.buttons?"":"bottom: 0px !important;")+'"\x3e    \x3cdiv class\x3d"w2ui-popup-body w2ui-popup-no-title'+(g.buttons?"":" w2ui-popup-no-buttons")+'" style\x3d"'+g.style+'"\x3e    \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"w2ui-popup-buttons" style\x3d"'+(g.buttons?"":"display: none")+'"\x3e\x3c/div\x3e\x3cinput class\x3d"w2ui-popup-hidden" style\x3d"position: absolute; top: -100px"/\x3e';b("#w2ui-popup").html(c);g.title&&b("#w2ui-popup .w2ui-popup-title").append(g.title);g.buttons&&b("#w2ui-popup .w2ui-popup-buttons").append(g.buttons);g.body&&b("#w2ui-popup .w2ui-popup-body").append(g.body);setTimeout(function(){b("#w2ui-popup").css("opacity","1").css(w2utils.cssPrefix({transition:g.speed+"s opacity, "+g.speed+"s -webkit-transform",transform:"scale(1)"}));a.focus()},1);setTimeout(function(){b("#w2ui-popup").css(w2utils.cssPrefix("transform",""));w2popup.status="open";setTimeout(function(){a.trigger(b.extend(f,{phase:"after"}))},100)},1E3*g.speed)}else{null==w2popup._prev&&null!=w2popup._template&&a.restoreTemplate();f=this.trigger({phase:"before",type:"open",target:"popup",options:g,present:!0});if(!0===f.isCancelled)return;w2popup.status="opening";null!=d&&(d.maximized||d.width==g.width&&d.height==g.height||w2popup.resize(g.width,g.height),g.prevSize=g.width+"px:"+g.height+"px",g.maximized=d.maximized);d=b("#w2ui-popup .w2ui-box").clone();d.removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(g.body);"string"==typeof g.body&&0<d.find("div[rel\x3dtitle], div[rel\x3dbody], div[rel\x3dbuttons]").length&&(k=d.find("div[rel\x3dtitle]"),0<k.length&&(g.title=k.html(),k.remove()),k=d.find("div[rel\x3dbuttons]"),0<k.length&&(g.buttons=k.html(),k.remove()),k=d.find("div[rel\x3dbody]"),g.body=0<k.length?k.html():d.html(),d.html(g.body));b("#w2ui-popup .w2ui-box").after(d);g.buttons?(b("#w2ui-popup .w2ui-popup-buttons").show().html("").append(g.buttons),b("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),b("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):(b("#w2ui-popup .w2ui-popup-buttons").hide().html(""),b("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),b("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px"));g.title?(b("#w2ui-popup .w2ui-popup-title").show().html((g.showClose?'\x3cdiv class\x3d"w2ui-popup-button w2ui-popup-close" onmousedown\x3d"event.stopPropagation()" onclick\x3d"w2popup.close()"\x3eClose\x3c/div\x3e':"")+(g.showMax?'\x3cdiv class\x3d"w2ui-popup-button w2ui-popup-max" onmousedown\x3d"event.stopPropagation()" onclick\x3d"w2popup.toggle()"\x3eMax\x3c/div\x3e':"")).append(g.title),b("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),b("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")):(b("#w2ui-popup .w2ui-popup-title").hide().html(""),b("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),b("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px"));var h=b("#w2ui-popup .w2ui-box")[0],n=b("#w2ui-popup .w2ui-box-temp")[0];w2utils.transition(h,n,g.transition,function(){a.restoreTemplate();b(h).remove();b(n).removeClass("w2ui-box-temp").addClass("w2ui-box");var c=b(n).find(".w2ui-popup-body");1==c.length&&(c[0].style.cssText=g.style);b("#w2ui-popup").data("prev-size",null);a.focus();w2popup.status="open";a.trigger(b.extend(f,{phase:"after"}))})}g._last_focus=b(":focus");if(g.keyboard)b(document).on("keydown",this.keydown);k={resizing:!1,mvMove:function(a){1==k.resizing&&(a||(a=window.event),k.div_x=a.screenX-k.x,k.div_y=a.screenY-k.y,b("#w2ui-popup").css(w2utils.cssPrefix({transition:"none",transform:"translate3d("+k.div_x+"px, "+k.div_y+"px, 0px)"})))},mvStop:function(a){1==k.resizing&&(a||(a=window.event),w2popup.status="open",k.div_x=a.screenX-k.x,k.div_y=a.screenY-k.y,b("#w2ui-popup").css({left:k.pos_x+k.div_x+"px",top:k.pos_y+k.div_y+"px"}).css(w2utils.cssPrefix({transition:"none",transform:"translate3d(0px, 0px, 0px)"})),k.resizing=!1,b(document).off("mousemove",k.mvMove),b(document).off("mouseup",k.mvStop),k.isLocked||w2popup.unlock())}};b("#w2ui-popup .w2ui-popup-title").on("mousedown",function(a){w2popup.get().maximized||(a||(a=window.event),w2popup.status="moving",k.resizing=!0,k.isLocked=1==b("#w2ui-popup \x3e .w2ui-lock").length?!0:!1,k.x=a.screenX,k.y=a.screenY,k.pos_x=b("#w2ui-popup").position().left,k.pos_y=b("#w2ui-popup").position().top,k.isLocked||w2popup.lock({opacity:0}),b(document).on("mousemove",k.mvMove),b(document).on("mouseup",k.mvStop),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault&&a.preventDefault())});return this}},keydown:function(g){var a=b("#w2ui-popup").data("options");if(!a||a.keyboard)if(a=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:a,originalEvent:g}),!0!==a.isCancelled){switch(g.keyCode){case 27:g.preventDefault(),0<b("#w2ui-popup .w2ui-message").length?w2popup.message():w2popup.close()}w2popup.trigger(b.extend(a,{phase:"after"}))}},close:function(g){var a=this;g=b.extend({},b("#w2ui-popup").data("options"),g);if(0!==b("#w2ui-popup").length&&"closed"!=this.status)if("opening"==this.status)setTimeout(function(){w2popup.close()},100);else{var d=this.trigger({phase:"before",type:"close",target:"popup",options:g});!0!==d.isCancelled&&(w2popup.status="closing",b("#w2ui-popup").css("opacity","0").css(w2utils.cssPrefix({transition:g.speed+"s opacity, "+g.speed+"s -webkit-transform",transform:"scale(0.9)"})),w2popup.unlockScreen(g),setTimeout(function(){a.restoreTemplate();b("#w2ui-popup").remove();w2popup.status="closed";0<g._last_focus.length&&g._last_focus.focus();a.trigger(b.extend(d,{phase:"after"}))},1E3*g.speed),g.keyboard&&b(document).off("keydown",this.keydown))}},toggle:function(){var g=this,a=b("#w2ui-popup").data("options"),d=this.trigger({phase:"before",type:"toggle",target:"popup",options:a});!0!==d.isCancelled&&(!0===a.maximized?w2popup.min():w2popup.max(),setTimeout(function(){g.trigger(b.extend(d,{phase:"after"}))},1E3*a.speed+50))},max:function(){var g=this,a=b("#w2ui-popup").data("options");if(!0!==a.maximized){var d=this.trigger({phase:"before",type:"max",target:"popup",options:a});!0!==d.isCancelled&&(w2popup.status="resizing",a.prevSize=b("#w2ui-popup").css("width")+":"+b("#w2ui-popup").css("height"),w2popup.resize(1E4,1E4,function(){w2popup.status="open";a.maximized=!0;g.trigger(b.extend(d,{phase:"after"}));b("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var a=b(this).attr("name");w2ui[a]&&w2ui[a].resize&&w2ui[a].resize()})}))}},min:function(){var g=this,a=b("#w2ui-popup").data("options");if(!0===a.maximized){var d=a.prevSize.split(":"),e=this.trigger({phase:"before",type:"min",target:"popup",options:a});!0!==e.isCancelled&&(w2popup.status="resizing",w2popup.resize(parseInt(d[0]),parseInt(d[1]),function(){w2popup.status="open";a.maximized=!1;a.prevSize=null;g.trigger(b.extend(e,{phase:"after"}));b("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var a=b(this).attr("name");w2ui[a]&&w2ui[a].resize&&w2ui[a].resize()})}))}},get:function(){return b("#w2ui-popup").data("options")},set:function(b){w2popup.open(b)},clear:function(){b("#w2ui-popup .w2ui-popup-title").html("");b("#w2ui-popup .w2ui-popup-body").html("");b("#w2ui-popup .w2ui-popup-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},message:function(g){var a=this;b().w2tag();g||(g={width:200,height:100});var d=parseInt(b("#w2ui-popup").width()),e=parseInt(b("#w2ui-popup").height());g.originalWidth=g.width;g.originalHeight=g.height;10>parseInt(g.width)&&(g.width=10);10>parseInt(g.height)&&(g.height=10);null==g.hideOnClick&&(g.hideOnClick=!1);var c=b("#w2ui-popup").data("options")||{},f=parseInt(b("#w2ui-popup \x3e .w2ui-popup-title").css("height"));if(null==g.width||g.width>c.width-10)g.width=c.width-10;if(null==g.height||g.height>c.height-f-5)g.height=c.height-f-5;0>g.originalHeight&&(g.height=e+g.originalHeight-f);0>g.originalWidth&&(g.width=d+2*g.originalWidth);var e=b("#w2ui-popup .w2ui-popup-title"),k=b("#w2ui-popup .w2ui-message").length;if(""===b.trim(g.html)&&""===b.trim(g.body)&&""===b.trim(g.buttons)){var h=b("#w2ui-popup #w2ui-message"+(k-1));g=h.data("options")||{};h.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+g.height+"px)"}));1==k?w2popup.unlock(150):b("#w2ui-popup #w2ui-message"+(k-2)).css("z-index",1500);setTimeout(function(){var b=h.data("prev_focus");h.remove();b&&0<b.length?b.focus():a.focus();if("function"==typeof g.onClose)g.onClose()},150)}else{if(""!==b.trim(g.body)||""!==b.trim(g.buttons))g.html='\x3cdiv class\x3d"w2ui-message-body"\x3e'+g.body+'\x3c/div\x3e\x3cdiv class\x3d"w2ui-message-buttons"\x3e'+g.buttons+"\x3c/div\x3e";b("#w2ui-popup .w2ui-message").css("z-index",1390);e.css("z-index",1501);b("#w2ui-popup .w2ui-box").before('\x3cdiv id\x3d"w2ui-message'+k+'" class\x3d"w2ui-message" style\x3d"display: none; z-index: 1500; '+(0===e.length?"top: 0px;":"top: "+w2utils.getSize(e,"height")+"px;")+(null!=g.width?"width: "+g.width+"px; left: "+(d-g.width)/2+"px;":"left: 10px; right: 10px;")+(null!=g.height?"height: "+g.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(!0===g.hideOnClick?'onclick\x3d"w2popup.message();"':"")+"\x3e\x3c/div\x3e");b("#w2ui-popup #w2ui-message"+k).data("options",g).data("prev_focus",b(":focus"));var n=b("#w2ui-popup #w2ui-message"+k).css("display");b("#w2ui-popup #w2ui-message"+k).css(w2utils.cssPrefix({transform:"none"==n?"translateY(-"+g.height+"px)":"translateY(0px)"}));"none"==n&&(b("#w2ui-popup #w2ui-message"+k).show().html(g.html),setTimeout(function(){b("#w2ui-popup #w2ui-message"+k).css(w2utils.cssPrefix({transform:"none"==n?"translateY(0px)":"translateY(-"+g.height+"px)"}))},1),0===k&&w2popup.lock(),setTimeout(function(){a.focus();b("#w2ui-popup #w2ui-message"+k).css(w2utils.cssPrefix({transition:"0s"}));if("function"==typeof g.onOpen)g.onOpen()},350))}},focus:function(){var g=null,a=b("#w2ui-popup");b(a).find("input:visible, button:visible, select:visible, textarea:visible").off(".keep-focus");var d=b("#w2ui-popup .w2ui-message").length-1,d=b("#w2ui-popup #w2ui-message"+d);if(0<d.length){var e=b(d[d.length-1]).find("button");0<e.length&&e[0].focus();g=d}else 0<a.length&&(e=a.find(".w2ui-popup-buttons button"),0<e.length&&e[0].focus(),g=a);b(g).find("input:visible, button:visible, select:visible, textarea:visible").on("blur.keep-focus",function(a){setTimeout(function(){var a=b(":focus");if(0<a.length&&!b(g).find("input:visible, button:visible, select:visible, textarea:visible").is(a)||a.hasClass("w2ui-popup-hidden"))a=b(g).find("input:visible, button:visible, select:visible, textarea:visible"),0<a.length&&a[0].focus()},1)})},lock:function(g,a){var d=Array.prototype.slice.call(arguments,0);d.unshift(b("#w2ui-popup"));w2utils.lock.apply(window,d)},unlock:function(g){w2utils.unlock(b("#w2ui-popup"),g)},lockScreen:function(g){if(0<b("#w2ui-lock").length)return!1;null==g&&(g=b("#w2ui-popup").data("options"));null==g&&(g={});g=b.extend({},w2popup.defaults,g);b("body").append('\x3cdiv id\x3d"w2ui-lock"     onmousewheel\x3d"if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble \x3d true; if (event.preventDefault) event.preventDefault(); else return false;"    style\x3d"position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+g.color+'; width: 100%; height: 100%; opacity: 0;"\x3e\x3c/div\x3e');setTimeout(function(){b("#w2ui-lock").css("opacity",g.opacity).css(w2utils.cssPrefix("transition",g.speed+"s opacity"))},1);if(1==g.modal)b("#w2ui-lock").on("mousedown",function(){b("#w2ui-lock").css("opacity","0.6").css(w2utils.cssPrefix("transition",".1s"))}),b("#w2ui-lock").on("mouseup",function(){setTimeout(function(){b("#w2ui-lock").css("opacity",g.opacity).css(w2utils.cssPrefix("transition",".1s"))},100)});else b("#w2ui-lock").on("mousedown",function(){w2popup.close()});return!0},unlockScreen:function(g){if(0===b("#w2ui-lock").length)return!1;null==g&&(g=b("#w2ui-popup").data("options"));null==g&&(g={});g=b.extend({},w2popup.defaults,g);b("#w2ui-lock").css("opacity","0").css(w2utils.cssPrefix("transition",g.speed+"s opacity"));setTimeout(function(){b("#w2ui-lock").remove()},1E3*g.speed);return!0},resizeMessages:function(){b("#w2ui-popup").data("options");b("#w2ui-popup .w2ui-message").each(function(){var g=b(this).data("options"),a=b("#w2ui-popup");10>parseInt(g.width)&&(g.width=10);10>parseInt(g.height)&&(g.height=10);var d=parseInt(a.find("\x3e .w2ui-popup-title").css("height")),e=parseInt(a.width()),a=parseInt(a.height());g.width=g.originalWidth;g.width>e-10&&(g.width=e-10);g.height=g.originalHeight;g.height>a-d-5&&(g.height=a-d-5);0>g.originalHeight&&(g.height=a+g.originalHeight-d);0>g.originalWidth&&(g.width=e+2*g.originalWidth);b(this).css({left:(e-g.width)/2+"px",width:g.width+"px",height:g.height+"px"})})},resize:function(g,a,d){var e=this,c=b("#w2ui-popup").data("options");g=parseInt(g);a=parseInt(a);var f,k;void 0==window.innerHeight?(f=parseInt(document.documentElement.offsetWidth),k=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(f+=21,k+=4)):(f=parseInt(window.innerWidth),k=parseInt(window.innerHeight));f-10<g&&(g=f-10);k-10<a&&(a=k-10);k=(k-a)/2*.6;f=(f-g)/2;b("#w2ui-popup").css(w2utils.cssPrefix({transition:c.speed+"s width, "+c.speed+"s height, "+c.speed+"s left, "+c.speed+"s top"})).css({top:k,left:f,width:g,height:a});var h=setInterval(function(){e.resizeMessages()},10);setTimeout(function(){clearInterval(h);c.width=g;c.height=a;e.resizeMessages();"function"==typeof d&&d()},1E3*c.speed+50)},restoreTemplate:function(){var g=b("#w2ui-popup").data("options");if(null!=g){var a=w2popup._template,d=g.title,e=g.body,g=g.buttons;w2popup._prev?(a=w2popup._prev.template,d=w2popup._prev.title,e=w2popup._prev.body,g=w2popup._prev.buttons,delete w2popup._prev):delete w2popup._template;null!=a&&(a=b(a),0!==a.length&&("body"==b(e).attr("rel")?(d&&a.append(d),e&&a.append(e),g&&a.append(g)):a.append(e)))}}};b.extend(w2popup,w2utils.event)})(jQuery);var w2alert=function(b,g,a){var d=jQuery;null==g&&(g=w2utils.lang("Notification"));0<d("#w2ui-popup").length&&"closing"!=w2popup.status?w2popup.message({width:400,height:170,body:'\x3cdiv class\x3d"w2ui-centered w2ui-alert-msg" style\x3d"font-size: 13px;"\x3e'+b+"\x3c/div\x3e",buttons:'\x3cbutton onclick\x3d"w2popup.message();" class\x3d"w2ui-popup-btn w2ui-btn"\x3e'+w2utils.lang("Ok")+"\x3c/button\x3e",onOpen:function(){d("#w2ui-popup .w2ui-message .w2ui-popup-btn").focus()},onClose:function(){"function"==typeof a&&a()}}):w2popup.open({width:450,height:220,showMax:!1,showClose:!1,title:g,body:'\x3cdiv class\x3d"w2ui-centered w2ui-alert-msg" style\x3d"font-size: 13px;"\x3e'+b+"\x3c/div\x3e",buttons:'\x3cbutton onclick\x3d"w2popup.close();" class\x3d"w2ui-popup-btn w2ui-btn"\x3e'+w2utils.lang("Ok")+"\x3c/button\x3e",onOpen:function(a){setTimeout(function(){d("#w2ui-popup .w2ui-popup-btn").focus()},1)},onKeydown:function(a){d("#w2ui-popup .w2ui-popup-btn").focus().addClass("clicked")},onClose:function(){"function"==typeof a&&a()}});return{ok:function(b){a=b;return this},done:function(b){a=b;return this}}},w2confirm=function(b,g,a){var d=jQuery,e={},c={msg:"",title:w2utils.lang("Confirmation"),width:0<d("#w2ui-popup").length?400:450,height:0<d("#w2ui-popup").length?170:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,callBack:null};1==arguments.length&&"object"==typeof b?d.extend(e,c,b):"function"==typeof g?d.extend(e,c,{msg:b,callBack:g}):d.extend(e,c,{msg:b,title:g,callBack:a});"object"==typeof e.btn_yes&&(e.yes_text=e.btn_yes.text||e.yes_text,e.yes_class=e.btn_yes["class"]||e.yes_class,e.yes_style=e.btn_yes.style||e.yes_style,e.yes_callBack=e.btn_yes.callBack||e.yes_callBack);"object"==typeof e.btn_no&&(e.no_text=e.btn_no.text||e.no_text,e.no_class=e.btn_no["class"]||e.no_class,e.no_style=e.btn_no.style||e.no_style,e.no_callBack=e.btn_no.callBack||e.no_callBack);0<d("#w2ui-popup").length&&"closing"!=w2popup.status&&w2popup.get()?(e.width>w2popup.get().width&&(e.width=w2popup.get().width),e.height>w2popup.get().height-50&&(e.height=w2popup.get().height-50),w2popup.message({width:e.width,height:e.height,body:'\x3cdiv class\x3d"w2ui-centered w2ui-confirm-msg" style\x3d"font-size: 13px;"\x3e'+e.msg+"\x3c/div\x3e",buttons:'\x3cbutton id\x3d"Yes" class\x3d"w2ui-popup-btn w2ui-btn '+e.yes_class+'" style\x3d"'+e.yes_style+'"\x3e'+w2utils.lang(e.yes_text)+'\x3c/button\x3e\x3cbutton id\x3d"No" class\x3d"w2ui-popup-btn w2ui-btn '+e.no_class+'" style\x3d"'+e.no_style+'"\x3e'+w2utils.lang(e.no_text)+"\x3c/button\x3e",onOpen:function(){d("#w2ui-popup .w2ui-message .w2ui-btn").on("click.w2confirm",function(a){w2popup._confirm_btn=a.target.id;w2popup.message()})},onClose:function(){d("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2confirm");setTimeout(function(){"function"==typeof e.callBack&&e.callBack(w2popup._confirm_btn);"Yes"==w2popup._confirm_btn&&"function"==typeof e.yes_callBack&&e.yes_callBack();"No"==w2popup._confirm_btn&&"function"==typeof e.no_callBack&&e.no_callBack()},300)}})):(w2utils.isInt(e.height)||(e.height+=50),w2popup.open({width:e.width,height:e.height,title:e.title,modal:!0,showClose:!1,body:'\x3cdiv class\x3d"w2ui-centered w2ui-confirm-msg" style\x3d"font-size: 13px;"\x3e'+e.msg+"\x3c/div\x3e",buttons:'\x3cbutton id\x3d"Yes" class\x3d"w2ui-popup-btn w2ui-btn '+e.yes_class+'" style\x3d"'+e.yes_style+'"\x3e'+w2utils.lang(e.yes_text)+'\x3c/button\x3e\x3cbutton id\x3d"No" class\x3d"w2ui-popup-btn w2ui-btn '+e.no_class+'" style\x3d"'+e.no_style+'"\x3e'+w2utils.lang(e.no_text)+"\x3c/button\x3e",onOpen:function(a){setTimeout(function(){d("#w2ui-popup .w2ui-popup-btn").on("click",function(a){w2popup.close();"function"==typeof e.callBack&&e.callBack(a.target.id);"Yes"==a.target.id&&"function"==typeof e.yes_callBack&&e.yes_callBack();"No"==a.target.id&&"function"==typeof e.no_callBack&&e.no_callBack()});d("#w2ui-popup .w2ui-popup-btn#Yes").focus()},1)},onKeydown:function(a){if(0===d("#w2ui-popup .w2ui-message").length)switch(a.originalEvent.keyCode){case 13:d("#w2ui-popup .w2ui-popup-btn#Yes").focus().addClass("clicked");w2popup.close();break;case 27:d("#w2ui-popup .w2ui-popup-btn#No").focus().click(),w2popup.close()}}}));return{yes:function(a){e.yes_callBack=a;return this},no:function(a){e.no_callBack=a;return this}}},w2prompt=function(b,g,a){var d=jQuery,e={},c={label:"",value:"",attrs:"",title:w2utils.lang("Notification"),ok_text:w2utils.lang("Ok"),cancel_text:w2utils.lang("Cancel"),width:0<d("#w2ui-popup").length?400:450,height:0<d("#w2ui-popup").length?170:220,callBack:null};1==arguments.length&&"object"==typeof b?d.extend(e,c,b):"function"==typeof g?d.extend(e,c,{label:b,callBack:g}):d.extend(e,c,{label:b,title:g,callBack:a});0<d("#w2ui-popup").length&&"closing"!=w2popup.status&&w2popup.get()?(e.width>w2popup.get().width&&(e.width=w2popup.get().width),e.height>w2popup.get().height-50&&(e.height=w2popup.get().height-50),w2popup.message({width:e.width,height:e.height,body:'\x3cdiv class\x3d"w2ui-centered" style\x3d"font-size: 13px;"\x3e   \x3clabel style\x3d"margin-right: 10px;"\x3e'+e.label+':\x3c/label\x3e   \x3cinput id\x3d"w2prompt" '+e.attrs+"\x3e\x3c/div\x3e",buttons:'\x3cbutton id\x3d"Ok" class\x3d"w2ui-popup-btn w2ui-btn"\x3e'+e.ok_text+'\x3c/button\x3e\x3cbutton id\x3d"Cancel" class\x3d"w2ui-popup-btn w2ui-btn"\x3e'+e.cancel_text+"\x3c/button\x3e",onOpen:function(){d("#w2prompt").val(e.value);d("#w2ui-popup .w2ui-message .w2ui-btn#Ok").on("click.w2prompt",function(a){w2popup._prompt_value=d("#w2prompt").val();w2popup.message()});d("#w2ui-popup .w2ui-message .w2ui-btn#Cancel").on("click.w2prompt",function(a){w2popup._prompt_value=null;w2popup.message()});setTimeout(function(){d("#w2prompt").focus()},100)},onClose:function(){d("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2prompt");setTimeout(function(){"function"==typeof e.callBack&&null!=w2popup._prompt_value&&e.callBack(w2popup._prompt_value)},300)}})):(w2utils.isInt(e.height)||(e.height+=50),w2popup.open({width:e.width,height:e.height,title:e.title,modal:!0,showClose:!1,body:'\x3cdiv class\x3d"w2ui-centered" style\x3d"font-size: 13px;"\x3e\x3clabel style\x3d"margin-right: 10px;"\x3e'+e.label+':\x3c/label\x3e\x3cinput id\x3d"w2prompt"\x3e\x3c/div\x3e',buttons:'\x3cbutton id\x3d"Ok" class\x3d"w2ui-popup-btn w2ui-btn"\x3e'+e.ok_text+'\x3c/button\x3e\x3cbutton id\x3d"Cancel" class\x3d"w2ui-popup-btn w2ui-btn"\x3e'+e.cancel_text+"\x3c/button\x3e",onOpen:function(a){setTimeout(function(){d("#w2prompt").val(e.value);d("#w2prompt").w2field("text");d("#w2ui-popup .w2ui-popup-btn#Ok").on("click",function(a){w2popup._prompt_value=d("#w2prompt").val();w2popup.close();"function"==typeof e.callBack&&e.callBack(w2popup._prompt_value)});d("#w2ui-popup .w2ui-popup-btn#Cancel").on("click",function(a){w2popup._prompt_value=null;w2popup.close()});d("#w2ui-popup .w2ui-popup-btn#Ok");setTimeout(function(){d("#w2prompt").focus()},100)},1)},onKeydown:function(a){if(0===d("#w2ui-popup .w2ui-message").length)switch(a.originalEvent.keyCode){case 13:d("#w2ui-popup .w2ui-popup-btn#Ok").focus().addClass("clicked");w2popup.close();break;case 27:w2popup.close()}}}));return{change:function(a){d("#w2prompt").on("keyup",a).keyup();return this},ok:function(a){e.callBack=a;return this}}};(function(b){var g=function(a){this.active=this.name=this.box=null;this.flow="down";this.tooltip="top|left";this.tabs=[];this.style=this.right="";b.extend(this,{handlers:[]});b.extend(!0,this,w2obj.tabs,a)};b.fn.w2tabs=function(a){if(b.isPlainObject(a)){if(w2utils.checkName(a,"w2tabs")){for(var d=a.tabs||[],e=new g(a),c=0;c<d.length;c++)e.tabs[c]=b.extend({},g.prototype.tab,d[c]);0!==b(this).length&&e.render(b(this)[0]);return w2ui[e.name]=e}}else return d=w2ui[b(this).attr("name")],d?0<arguments.length?(d[a]&&d[a].apply(d,Array.prototype.slice.call(arguments,1)),this):d:null};g.prototype={onClick:null,onClose:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,tab:{id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null},add:function(a){return this.insert(null,a)},insert:function(a,d){b.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){if(null==d[e].id){console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+this.name+")");break}if(!w2utils.checkUniqueId(d[e].id,this.tabs,"tabs",this.name))break;var c=b.extend({},g.prototype.tab,d[e]);if(null==a)this.tabs.push(c);else{var f=this.get(a,!0);this.tabs=this.tabs.slice(0,f).concat([c],this.tabs.slice(f))}this.refresh(d[e].id);this.resize()}},remove:function(){for(var a=0,d=-1,e=0;e<arguments.length;e++){var c=this.get(arguments[e]);if(!c)return!1;a++;var f=this.get(c.id,!0);this.active==c.id&&(d=f);if(this.onClose)this.onClose({object:c});this.tabs.splice(f,1);b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(c.id)).remove()}this.resize();var k;if(-1<d&&(d>=this.tabs.length?0<this.tabs.length&&(k=this.tabs[this.tabs.length-1]):k=this.tabs[d],k)){this.active=k.id;if(this.onClick)this.onClick({tab:k});this.refresh()}return a},select:function(a){if(this.active==a||null==this.get(a))return!1;this.active=a;this.refresh();return!0},set:function(a,d){var e=this.get(a,!0);if(null==e)return!1;b.extend(this.tabs[e],d);this.refresh(a);return!0},get:function(a,b){if(0===arguments.length){for(var d=[],c=0;c<this.tabs.length;c++)null!=this.tabs[c].id&&d.push(this.tabs[c].id);return d}for(d=0;d<this.tabs.length;d++)if(this.tabs[d].id==a)return!0===b?d:this.tabs[d];return null},show:function(){for(var a=this,b=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&!1!==f.hidden&&(b++,f.hidden=!1,e.push(f.id))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b]);a.resize()},15);return b},hide:function(){for(var a=this,b=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&!0!==f.hidden&&(b++,f.hidden=!0,e.push(f.id))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b]);a.resize()},15);return b},enable:function(){for(var a=this,b=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&!1!==f.disabled&&(b++,f.disabled=!1,e.push(f.id))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b])},15);return b},disable:function(){for(var a=this,b=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&!0!==f.disabled&&(b++,f.disabled=!0,e.push(f.id))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b])},15);return b},tooltipShow:function(a,d,e){if(null!=this.tooltip){var c=b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(a));a=this.get(a);var f=this.tooltip,g=a.tooltip;"function"==typeof g&&(g=g.call(this,a));c.prop("_mouse_over",!0);setTimeout(function(){!0===c.prop("_mouse_over")&&!0!==c.prop("_mouse_tooltip")&&(c.prop("_mouse_tooltip",!0),c.w2tag(w2utils.lang(g),{position:f}));1==e&&c.w2tag(w2utils.lang(g),{position:f})},1)}},tooltipHide:function(a){if(null!=this.tooltip){var d=b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(a));this.get(a);d.removeProp("_mouse_over");setTimeout(function(){!0!==d.prop("_mouse_over")&&!0===d.prop("_mouse_tooltip")&&(d.removeProp("_mouse_tooltip"),d.w2tag())},1)}},refresh:function(a){var d=(new Date).getTime();"up"==this.flow?b(this.box).addClass("w2ui-tabs-up"):b(this.box).removeClass("w2ui-tabs-up");var e=this.trigger({phase:"before",type:"refresh",target:null!=a?a:this.name,object:this.get(a)});if(!0!==e.isCancelled){if(null==a)for(a=0;a<this.tabs.length;a++)this.refresh(this.tabs[a].id);else{var c=this.get(a);if(null==c)return!1;null==c.text&&null!=c.caption&&(c.text=c.caption);null==c.tooltip&&null!=c.hint&&(c.tooltip=c.hint);var f=c.text;"function"==typeof f&&(f=f.call(this,c));null==f&&(f="");var g=b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(c.id)),h="";c.closable&&!c.disabled&&(h='\x3cdiv class\x3d"w2ui-tab-close"     onmouseover \x3d "w2ui[\''+this.name+"'].tooltipShow('"+c.id+"', event);\"    onmouseout  \x3d \"w2ui['"+this.name+"'].tooltipHide('"+c.id+"', event);\"    onclick\x3d\"w2ui['"+this.name+"'].animateClose('"+c.id+"', event);\"\x3e\x3c/div\x3e");f=h+'    \x3cdiv class\x3d"w2ui-tab'+(this.active===c.id?" active":"")+(c.closable?" closable":"")+(c["class"]?" "+c["class"]:"")+'" style\x3d"'+c.style+'"         onmouseover \x3d "'+(c.disabled?"":"w2ui['"+this.name+"'].tooltipShow('"+c.id+"', event);")+'"        onmouseout  \x3d "'+(c.disabled?"":"w2ui['"+this.name+"'].tooltipHide('"+c.id+"', event);")+'"        onclick\x3d"w2ui[\''+this.name+"'].click('"+c.id+"', event);\"\x3e"+w2utils.lang(f)+"\x3c/div\x3e";0===g.length?(g="",c.hidden&&(g+="display: none;"),c.disabled&&(g+="opacity: 0.2;"),c='\x3ctd id\x3d"tabs_'+this.name+"_tab_"+c.id+'" style\x3d"'+g+'" valign\x3d"middle"\x3e'+f+"\x3c/td\x3e",this.get(a,!0)!==this.tabs.length-1&&0<b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(a,!0))+1].id)).length?b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(a,!0))+1].id)).before(c):b(this.box).find("#tabs_"+this.name+"_right").before(c)):(g.html(f),c.hidden?g.css("display","none"):g.css("display",""),c.disabled?g.css({opacity:"0.2"}):g.css({opacity:"1"}))}b("#tabs_"+this.name+"_right").html(this.right);this.trigger(b.extend(e,{phase:"after"}));return(new Date).getTime()-d}},render:function(a){var d=(new Date).getTime(),e=this.trigger({phase:"before",type:"render",target:this.name,box:a});if(!0!==e.isCancelled){null!=a&&(0<b(this.box).find("\x3e table #tabs_"+this.name+"_right").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=a);if(!this.box)return!1;a='\x3cdiv class\x3d"w2ui-scroll-wrapper" onmousedown\x3d"var el\x3dw2ui[\''+this.name+'\']; if (el) el.resize();"\x3e\x3ctable cellspacing\x3d"0" cellpadding\x3d"1" width\x3d"100%"\x3e\x3ctbody\x3e    \x3ctr\x3e\x3ctd width\x3d"100%" id\x3d"tabs_'+this.name+'_right" align\x3d"right"\x3e'+this.right+'\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv class\x3d"w2ui-scroll-left" onclick\x3d"var el\x3dw2ui[\''+this.name+"']; if (el) el.scroll('left');\"\x3e\x3c/div\x3e\x3cdiv class\x3d\"w2ui-scroll-right\" onclick\x3d\"var el\x3dw2ui['"+this.name+"']; if (el) el.scroll('right');\"\x3e\x3c/div\x3e";b(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(a);0<b(this.box).length&&(b(this.box)[0].style.cssText+=this.style);this.trigger(b.extend(e,{phase:"after"}));this.refresh();this.resize();return(new Date).getTime()-d}},scroll:function(a){var d=this,e=b(this.box).find(".w2ui-scroll-wrapper"),c=e.scrollLeft(),f;switch(a){case "left":a=e.outerWidth();f=e.find(":first").outerWidth();c=c-a+50;0>=c&&(c=0);e.animate({scrollLeft:c},300);break;case "right":a=e.outerWidth(),f=e.find(":first").outerWidth(),c=c+a-50,c>=f-a&&(c=f-a),e.animate({scrollLeft:c},300)}setTimeout(function(){d.resize()},350)},resize:function(){var a=(new Date).getTime(),d=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==d.isCancelled){var e=b(this.box);e.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var c=e.find(".w2ui-scroll-wrapper");c.find(":first").outerWidth()>c.outerWidth()&&(0<c.scrollLeft()&&e.find(".w2ui-scroll-left").show(),c.scrollLeft()<c.find(":first").outerWidth()-c.outerWidth()&&e.find(".w2ui-scroll-right").show());this.trigger(b.extend(d,{phase:"after"}));return(new Date).getTime()-a}},destroy:function(){var a=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==a.isCancelled&&(0<b(this.box).find("\x3e table #tabs_"+this.name+"_right").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger(b.extend(a,{phase:"after"})))},click:function(a,d){var e=this.get(a);if(null==e||e.disabled)return!1;d=this.trigger({phase:"before",type:"click",target:a,tab:e,object:e,originalEvent:d});!0!==d.isCancelled&&(b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active"),this.active=e.id,this.trigger(b.extend(d,{phase:"after"})),this.refresh(a))},animateClose:function(a,d){var e=this.get(a);if(null==e||e.disabled)return!1;d=this.trigger({phase:"before",type:"close",target:a,object:this.get(a),originalEvent:d});!0!==d.isCancelled&&(b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e.id)).css(w2utils.cssPrefix("transition",".2s")).css("opacity","0"),this.remove(a),this.trigger(b.extend(d,{phase:"after"})),this.refresh())},animateInsert:function(a,d){if(null!=this.get(a)&&b.isPlainObject(d)&&w2utils.checkUniqueId(d.id,this.tabs,"tabs",this.name)&&0===b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(d.id)).length){null==d.text&&null!=d.caption&&(d.text=d.caption);var e='\x3cdiv id\x3d"_tmp_tabs" class\x3d"w2ui-reset w2ui-tabs" style\x3d"position: absolute; top: -1000px;"\x3e\x3ctable cellspacing\x3d"0" cellpadding\x3d"1" width\x3d"100%"\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd id\x3d"_tmp_simple_tab" style\x3d"" valign\x3d"middle"\x3e'+(d.closable?'\x3cdiv class\x3d"w2ui-tab-close"\x3e\x3c/div\x3e':"")+'    \x3cdiv class\x3d"w2ui-tab '+(this.active===d.id?"active":"")+'"\x3e'+d.text+"\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e";b("body").append(e);var e='\x3cdiv style\x3d"width: 1px; '+w2utils.cssPrefix("transition",".2s",!0)+'"\x3e\x26#160;\x3c/div\x3e',c="";d.hidden&&(c+="display: none;");d.disabled&&(c+="opacity: 0.2;");e='\x3ctd id\x3d"tabs_'+this.name+"_tab_"+d.id+'" style\x3d"'+c+'" valign\x3d"middle"\x3e'+e+"\x3c/td\x3e";this.get(a,!0)!==this.tabs.length&&0<b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(a,!0))].id)).length?b(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(a,!0))].id)).before(e):b(this.box).find("#tabs_"+this.name+"_right").before(e);var f=this;setTimeout(function(){var a=b("#_tmp_simple_tab").width();b("#_tmp_tabs").remove();b("#tabs_"+f.name+"_tab_"+w2utils.escapeId(d.id)+" \x3e div").css("width",a+"px")},1);setTimeout(function(){f.insert(a,d)},200)}}};b.extend(g.prototype,w2utils.event);w2obj.tabs=g})(jQuery);(function(b){var g=function(a){this.name=this.box=null;this.items=[];this.right="";this.tooltip="top|left";b.extend(!0,this,w2obj.toolbar,a)};b.fn.w2toolbar=function(a){if(b.isPlainObject(a)){if(w2utils.checkName(a,"w2toolbar")){var d=a.items||[],e=new g(a);b.extend(e,{items:[],handlers:[]});for(var c=0;c<d.length;c++)if(e.items[c]=b.extend({},g.prototype.item,d[c]),"menu-check"==e.items[c].type){var f=e.items[c];Array.isArray(f.selected)||(f.selected=[]);if(Array.isArray(f.items))for(var k=0;k<f.items.length;k++){var h=f.items[k];h.checked&&-1==f.selected.indexOf(h.id)&&f.selected.push(h.id);h.checked||-1==f.selected.indexOf(h.id)||(h.checked=!0);null==h.checked&&(h.checked=!1)}}else if("menu-radio"==e.items[c].type&&(f=e.items[c],Array.isArray(f.items)))for(k=0;k<f.items.length;k++)h=f.items[k],h.checked&&null==f.selected?f.selected=h.id:h.checked=!1,h.checked||f.selected!=h.id||(h.checked=!0),null==h.checked&&(h.checked=!1);0!==b(this).length&&e.render(b(this)[0]);return w2ui[e.name]=e}}else return d=w2ui[b(this).attr("name")],d?0<arguments.length?(d[a]&&d[a].apply(d,Array.prototype.slice.call(arguments,1)),this):d:null};g.prototype={onClick:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,item:{id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,img:null,icon:null,route:null,arrow:!0,style:null,color:null,transparent:null,group:null,items:null,selected:null,overlay:{},onClick:null,onRefresh:null},add:function(a){this.insert(null,a)},insert:function(a,d){b.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){if(null==d[e].type){console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');break}if(-1==b.inArray(String(d[e].type),"button check radio drop menu menu-radio menu-check color text-color break html spacer".split(" "))){console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');break}if(null==d[e].id&&"break"!=d[e].type&&"spacer"!=d[e].type){console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');break}if(!w2utils.checkUniqueId(d[e].id,this.items,"toolbar items",this.name))break;var c=b.extend({},g.prototype.item,d[e]);if(null==a)this.items.push(c);else{var f=this.get(a,!0);this.items=this.items.slice(0,f).concat([c],this.items.slice(f))}this.refresh(c.id);this.resize()}},remove:function(){for(var a=0,d=0;d<arguments.length;d++){var e=this.get(arguments[d]);e&&-1==String(arguments[d]).indexOf(":")&&(a++,b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(e.id)).remove(),e=this.get(e.id,!0),null!=e&&this.items.splice(e,1))}this.resize();return a},set:function(a,d){var e=this.get(a);if(null==e)return!1;b.extend(e,d);this.refresh(String(a).split(":")[0]);return!0},get:function(a,b){if(0===arguments.length){for(var d=[],c=0;c<this.items.length;c++)null!=this.items[c].id&&d.push(this.items[c].id);return d}d=String(a).split(":");for(c=0;c<this.items.length;c++){var f=this.items[c];if(-1!=["menu","menu-radio","menu-check"].indexOf(f.type)&&2==d.length&&f.id==d[0])for(var g=0;g<f.items.length;g++){var h=f.items[g];if(h.id==d[1]||null==h.id&&h.text==d[1])return 1==b?g:h}else if(f.id==d[0])return 1==b?c:f}return null},setStateByKey:function(a,b){var d=this.get(a);if(d){var c=this;1==b?d.hidden=!0:2==b?(d.disabled=!0,d.hidden=!1):(d.hidden=!1,d.disabled=!1);setTimeout(function(){c.refresh(a);c.tooltipHide(a);c.resize()},15)}},setStateByCls:function(a,b){for(var d=this,c=[],f=0;f<d.items.length;f++){var g=d.items[f];g.cls==a&&(1==b?g.hidden=!0:2==b?(g.disabled=!0,g.hidden=!1):(g.hidden=!1,g.disabled=!1),c.push(g.id))}0<c.length&&setTimeout(function(){for(var a=0;a<c.length;a++)d.refresh(c[a]),d.tooltipHide(c[a]);d.resize()},15)},show:function(){for(var a=this,b=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&(b++,f.hidden=!1,e.push(String(arguments[c]).split(":")[0]))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b]);a.resize()},15);return b},hide:function(){for(var a=this,b=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&(b++,f.hidden=!0,e.push(String(arguments[c]).split(":")[0]))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b]),a.tooltipHide(e[b]);a.resize()},15);return b},enable:function(){for(var a=this,b=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&(b++,f.disabled=!1,e.push(String(arguments[c]).split(":")[0]))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b])},15);return b},disable:function(){for(var a=this,b=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&(b++,f.disabled=!0,e.push(String(arguments[c]).split(":")[0]))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b]),a.tooltipHide(e[b])},15);return b},check:function(){for(var a=this,b=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&-1==String(arguments[c]).indexOf(":")&&(b++,f.checked=!0,e.push(String(arguments[c]).split(":")[0]))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b])},15);return b},uncheck:function(){for(var a=this,d=0,e=[],c=0;c<arguments.length;c++){var f=this.get(arguments[c]);f&&-1==String(arguments[c]).indexOf(":")&&(-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(f.type)&&f.checked&&setTimeout(function(){b("#tb_"+a.name+"_item_"+w2utils.escapeId(f.id)).w2overlay({name:a.name})},1),d++,f.checked=!1,e.push(String(arguments[c]).split(":")[0]))}setTimeout(function(){for(var b=0;b<e.length;b++)a.refresh(e[b])},15);return d},click:function(a,d){var e=this,c=String(a).split(":"),f=this.get(c[0]);if(1<c.length)(a=this.get(a))&&!a.disabled&&e.menuClick({name:e.name,item:f,subItem:a,originalEvent:d});else if(f&&!f.disabled&&(c=this.trigger({phase:"before",type:"click",target:null!=a?a:this.name,item:f,object:f,originalEvent:d}),!0!==c.isCancelled)){var g="#tb_"+this.name+"_item_"+w2utils.escapeId(f.id)+" table.w2ui-button";b(g).removeClass("down");if("radio"==f.type){for(var h=0;h<this.items.length;h++){var n=this.items[h];null!=n&&n.id!=f.id&&"radio"===n.type&&n.group==f.group&&n.checked&&(n.checked=!1,this.refresh(n.id))}f.checked=!0;b(g).addClass("checked")}-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(f.type)&&(e.tooltipHide(a),f.checked?setTimeout(function(){b("#tb_"+e.name+"_item_"+w2utils.escapeId(f.id)).w2overlay({name:e.name});f.checked=!1;e.refresh(f.id)},1):setTimeout(function(){function a(a){f.checked=!1;b(g).removeClass("checked")}var c=b("#tb_"+e.name+"_item_"+w2utils.escapeId(f.id));b.isPlainObject(f.overlay)||(f.overlay={});var h=(c.width()-50)/2;19<h&&(h=19);"drop"==f.type&&c.w2overlay(f.html,b.extend({name:e.name,left:h,top:3},f.overlay,{onHide:function(b){a()}}));if(-1!=["menu","menu-radio","menu-check"].indexOf(f.type)){var k="normal";"menu-radio"==f.type&&(k="radio",f.items.forEach(function(a){a.checked=f.selected==a.id?!0:!1}));"menu-check"==f.type&&(k="check",f.items.forEach(function(a){b.isArray(f.selected)&&-1!=f.selected.indexOf(a.id)?a.checked=!0:a.checked=!1}));c.w2menu(b.extend({name:e.name,items:f.items,left:h,top:3,itemId:"id",itemText:"text",itemIco:"icon",itemImg:"img"},f.overlay,{type:k,select:function(a){e.menuClick({name:e.name,item:f,subItem:a.item,originalEvent:a.originalEvent,keepOpen:a.keepOpen})},onHide:function(b){a()}}))}-1!=["color","text-color"].indexOf(f.type)&&(null==f.transparent&&(f.transparent=!0),b(c).w2color({color:f.color,transparent:f.transparent},function(b,c){null!=b&&e.colorClick({name:e.name,item:f,color:b,originalEvent:d.originalEvent});a()}))},1));-1!="check menu menu-radio menu-check drop color text-color".split(" ").indexOf(f.type)&&(f.checked=!f.checked,f.checked?b(g).addClass("checked"):b(g).removeClass("checked"));d&&-1!=["button","check","radio"].indexOf(f.type)&&this.tooltipShow(a,d,!0);this.trigger(b.extend(c,{phase:"after"}))}},scroll:function(a){var d=this,e=b(this.box).find(".w2ui-scroll-wrapper"),c=e.scrollLeft(),f;switch(a){case "left":a=e.outerWidth();f=e.find(":first").outerWidth();c=c-a+50;0>=c&&(c=0);e.animate({scrollLeft:c},300);break;case "right":a=e.outerWidth(),f=e.find(":first").outerWidth(),c=c+a-50,c>=f-a&&(c=f-a),e.animate({scrollLeft:c},300)}setTimeout(function(){d.resize()},350)},render:function(a){var d=(new Date).getTime(),e=this.trigger({phase:"before",type:"render",target:this.name,box:a});if(!0!==e.isCancelled&&(null!=a&&(0<b(this.box).find("\x3e table #tb_"+this.name+"_right").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=a),this.box)){a='\x3cdiv class\x3d"w2ui-scroll-wrapper" onmousedown\x3d"var el\x3dw2ui[\''+this.name+'\']; if (el) el.resize();"\x3e\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" width\x3d"100%"\x3e\x3ctbody\x3e\x3ctr\x3e';for(var c=0;c<this.items.length;c++){var f=this.items[c];null!=f&&(null==f.id&&(f.id="item_"+c),a="spacer"==f.type?a+('\x3ctd width\x3d"100%" id\x3d"tb_'+this.name+"_item_"+f.id+'" align\x3d"right"\x3e\x3c/td\x3e'):a+('\x3ctd id\x3d"tb_'+this.name+"_item_"+f.id+'" style\x3d"'+(f.hidden?"display: none":"")+'"     class\x3d"'+(f.disabled?"disabled":"")+'" valign\x3d"middle"\x3e\x3c/td\x3e'))}a+='\x3ctd width\x3d"100%" id\x3d"tb_'+this.name+'_right" align\x3d"right"\x3e'+this.right+"\x3c/td\x3e";a+='\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv class\x3d"w2ui-scroll-left" onclick\x3d"var el\x3dw2ui[\''+this.name+"']; if (el) el.scroll('left');\"\x3e\x3c/div\x3e\x3cdiv class\x3d\"w2ui-scroll-right\" onclick\x3d\"var el\x3dw2ui['"+this.name+"']; if (el) el.scroll('right');\"\x3e\x3c/div\x3e";b(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(a);0<b(this.box).length&&(b(this.box)[0].style.cssText+=this.style);this.refresh();this.resize();this.trigger(b.extend(e,{phase:"after"}));return(new Date).getTime()-d}},refresh:function(a){var d=(new Date).getTime(),e=this.trigger({phase:"before",type:"refresh",target:null!=a?a:this.name,item:this.get(a)});if(!0!==e.isCancelled)if(null==a)for(a=0;a<this.items.length;a++)d=this.items[a],null==d.id&&(d.id="item_"+a),this.refresh(d.id);else{var c=this.get(a);if(null==c)return!1;if("function"==typeof c.onRefresh){var f=this.trigger({phase:"before",type:"refresh",target:a,item:c,object:c});if(!0===f.isCancelled)return}var g=b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(c.id)),h=this.getItemHTML(c);0===g.length?(h="spacer"==c.type?'\x3ctd width\x3d"100%" id\x3d"tb_'+this.name+"_item_"+c.id+'" align\x3d"right"\x3e\x3c/td\x3e':'\x3ctd id\x3d"tb_'+this.name+"_item_"+c.id+'" style\x3d"'+(c.hidden?"display: none":"")+'"     class\x3d"'+(c.disabled?"disabled":"")+'" valign\x3d"middle"\x3e'+h+"\x3c/td\x3e",this.get(a,!0)==this.items.length-1?b(this.box).find("#tb_"+this.name+"_right").before(h):b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(a,!0))+1].id)).before(h)):(-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(c.type)&&0==c.checked&&0<b("#w2ui-overlay-"+this.name).length&&b("#w2ui-overlay-"+this.name)[0].hide(),g.html(h),c.hidden?g.css("display","none"):g.css("display",""),c.disabled?g.addClass("disabled"):g.removeClass("disabled"));"function"==typeof c.onRefresh&&this.trigger(b.extend(f,{phase:"after"}));this.trigger(b.extend(e,{phase:"after"}));return(new Date).getTime()-d}},resize:function(){var a=(new Date).getTime(),d=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==d.isCancelled){var e=b(this.box);e.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var c=e.find(".w2ui-scroll-wrapper");c.find(":first").outerWidth()>c.outerWidth()&&(0<c.scrollLeft()&&e.find(".w2ui-scroll-left").show(),c.scrollLeft()<c.find(":first").outerWidth()-c.outerWidth()&&e.find(".w2ui-scroll-right").show());this.trigger(b.extend(d,{phase:"after"}));return(new Date).getTime()-a}},destroy:function(){var a=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==a.isCancelled&&(0<b(this.box).find("\x3e table #tb_"+this.name+"_right").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),b(this.box).html(""),delete w2ui[this.name],this.trigger(b.extend(a,{phase:"after"})))},getItemHTML:function(a){var b="";null!=a.caption&&null==a.text&&(a.text=a.caption);null==a.text&&(a.text="");null==a.tooltip&&null!=a.hint&&(a.tooltip=a.hint);null==a.tooltip&&(a.tooltip="");var e="\x3ctd\x3e\x26#160;\x3c/td\x3e",c=a.text;"function"==typeof c&&(c=c.call(this,a));a.img&&(e='\x3ctd\x3e\x3cdiv class\x3d"w2ui-tb-image w2ui-icon '+a.img+'"\x3e\x3c/div\x3e\x3c/td\x3e');a.icon&&(e='\x3ctd\x3e\x3cdiv class\x3d"w2ui-tb-image"\x3e\x3cspan class\x3d"'+a.icon+'"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/td\x3e');if(""===b)switch(a.type){case "color":case "text-color":"string"==typeof a.color&&"#"==a.color.substr(0,1)&&(a.color=a.color.substr(1)),"color"==a.type&&(c='\x3cdiv style\x3d"height: 12px; width: 12px; margin-top: 1px; border: 1px solid #8A8A8A; border-radius: 1px; box-shadow: 0px 0px 1px #fff;         background-color: #'+(null!=a.color?a.color:"fff")+'; float: left;"\x3e\x3c/div\x3e'+(a.text?'\x3cdiv style\x3d"margin-left: 17px;"\x3e'+w2utils.lang(a.text)+"\x3c/div\x3e":"")),"text-color"==a.type&&(c='\x3cdiv style\x3d"color: #'+(null!=a.color?a.color:"444")+';"\x3e'+(a.text?w2utils.lang(a.text):"\x3cb\x3eAa\x3c/b\x3e")+"\x3c/div\x3e");case "menu":case "menu-check":case "menu-radio":case "button":case "check":case "radio":case "drop":b+='\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"        class\x3d"w2ui-button '+(a.checked?"checked":"")+'"        onclick     \x3d "var el\x3dw2ui[\''+this.name+"']; if (el) el.click('"+a.id+'\', event);"        onmouseover \x3d "'+(a.disabled?"":"jQuery(this).addClass('over'); w2ui['"+this.name+"'].tooltipShow('"+a.id+"', event);")+'"       onmouseout  \x3d "'+(a.disabled?"":"jQuery(this).removeClass('over').removeClass('down'); w2ui['"+this.name+"'].tooltipHide('"+a.id+"', event);")+'"       onmousedown \x3d "'+(a.disabled?"":"jQuery(this).addClass('down');")+'"       onmouseup   \x3d "'+(a.disabled?"":"jQuery(this).removeClass('down');")+'"\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd\x3e  \x3ctable cellpadding\x3d"1" cellspacing\x3d"0"\x3e\x3ctbody\x3e  \x3ctr\x3e'+e+(""!==c?'\x3ctd class\x3d"w2ui-tb-caption" nowrap\x3d"nowrap" style\x3d"'+(a.style?a.style:"")+'"\x3e'+w2utils.lang(c)+"\x3c/td\x3e":"")+(null!=a.count?'\x3ctd class\x3d"w2ui-tb-count" nowrap\x3d"nowrap"\x3e\x3cspan\x3e'+a.count+"\x3c/span\x3e\x3c/td\x3e":"")+(-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(a.type)&&!1!==a.arrow?'\x3ctd class\x3d"w2ui-tb-down" nowrap\x3d"nowrap"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/td\x3e':"")+"  \x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e";break;case "break":b+='\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctbody\x3e\x3ctr\x3e    \x3ctd\x3e\x3cdiv class\x3d"w2ui-break"\x3e\x26#160;\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e';break;case "html":b+='\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctbody\x3e\x3ctr\x3e    \x3ctd nowrap\x3d"nowrap"\x3e'+("function"==typeof a.html?a.html.call(this,a):a.html)+"\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e"}return"\x3cdiv\x3e"+b+"\x3c/div\x3e"},tooltipShow:function(a,d,e){if(null!=this.tooltip){var c=b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(a)),f=this.get(a),g=this.tooltip,h=f.tooltip;"function"==typeof h&&(h=h.call(this,f));c.prop("_mouse_over",!0);setTimeout(function(){if(!0===c.prop("_mouse_over")&&!0!==c.prop("_mouse_tooltip")){c.prop("_mouse_tooltip",!0);if(-1!="menu menu-radio menu-check drop color text-color".split(" ").indexOf(f.type)&&1==f.checked)return;c.w2tag(w2utils.lang(h),{position:g})}1==e&&c.w2tag(w2utils.lang(h),{position:g})},1)}},tooltipHide:function(a,d){if(null!=this.tooltip){var e=b(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(a));this.get(a);e.removeProp("_mouse_over");setTimeout(function(){!0!==e.prop("_mouse_over")&&!0===e.prop("_mouse_tooltip")&&(e.removeProp("_mouse_tooltip"),e.w2tag())},1)}},menuClick:function(a){if(a.item&&!a.item.disabled){var d=this.trigger({phase:"before",type:"click",target:a.item.id+":"+a.subItem.id,item:a.item,subItem:a.subItem,originalEvent:a.originalEvent});if(!0!==d.isCancelled){var e=a.subItem,c=this.get(a.item.id);"menu-radio"==c.type&&(c.selected=e.id,a.item.items.forEach(function(a){a.checked=!1}),e.checked=!0);if("menu-check"==c.type){b.isArray(c.selected)||(c.selected=[]);var f=c.selected.indexOf(e.id);-1==f?(c.selected.push(e.id),e.checked=!0):(c.selected.splice(f,1),e.checked=!1)}this.refresh(a.item.id);this.trigger(b.extend(d,{phase:"after"}))}}},colorClick:function(a){if(a.item&&!a.item.disabled){var d=this.trigger({phase:"before",type:"click",target:a.item.id,item:a.item,color:a.color,originalEvent:a.originalEvent});!0!==d.isCancelled&&(a.item.color=a.color,this.refresh(a.item.id),this.trigger(b.extend(d,{phase:"after"})))}}};b.extend(g.prototype,w2utils.event);w2obj.toolbar=g})(jQuery);(function(b){var g=function(a){this.parent=this.sidebar=this.box=this.name=null;this.nodes=[];this.menu=[];this.icon=this.img=this.selected=null;this.bottomHTML=this.topHTML=this.style="";this.flatButton=!1;this.keyboard=!0;this.hasFocus=this.flat=!1;b.extend(!0,this,w2obj.sidebar,a)};b.fn.w2sidebar=function(a){if(b.isPlainObject(a)){if(w2utils.checkName(a,"w2sidebar")){var d=a.nodes,e=new g(a);b.extend(e,{handlers:[],nodes:[]});null!=d&&e.add(e,d);0!==b(this).length&&e.render(b(this)[0]);e.sidebar=e;return w2ui[e.name]=e}}else return d=w2ui[b(this).attr("name")],d?0<arguments.length?(d[a]&&d[a].apply(d,Array.prototype.slice.call(arguments,1)),this):d:null};g.prototype={onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onExpand:null,onCollapse:null,onKeydown:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onFocus:null,onBlur:null,onFlat:null,node:{id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,groupShowHide:!0,collapsible:!0,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},add:function(a,b){1==arguments.length&&(b=arguments[0],a=this);"string"==typeof a&&(a=this.get(a));return this.insert(a,null,b)},insert:function(a,d,e){var c,f,k,h;if(2==arguments.length)if(e=arguments[1],d=arguments[0],null!=d){c=this.get(d);if(null==c)return b.isArray(e)||(e=[e]),c=null!=e[0].caption?e[0].caption:e[0].text,console.log('ERROR: Cannot insert node "'+c+'" because cannot find node "'+d+'" to insert before.'),null;a=this.get(d).parent}else a=this;"string"==typeof a&&(a=this.get(a));b.isArray(e)||(e=[e]);for(var n=0;n<e.length;n++)if(k=e[n],null!=this.get(this,k.id))c=null!=k.caption?k.caption:k.text,console.log("ERROR: Cannot insert node with id\x3d"+k.id+" (text: "+c+") because another node with the same id already exists.");else{f=b.extend({},g.prototype.node,k);f.sidebar=this;f.parent=a;h=f.nodes||[];f.nodes=[];if(null==d)a.nodes.push(f);else{c=this.get(a,d,!0);if(null==c)return c=null!=k.caption?k.caption:k.text,console.log('ERROR: Cannot insert node "'+c+'" because cannot find node "'+d+'" to insert before.'),null;a.nodes.splice(c,0,f)}0<h.length&&this.insert(f,null,h)}this.refresh(a.id);return f},remove:function(){for(var a=0,b,e=0;e<arguments.length;e++)if(b=this.get(arguments[e]),null!=b){null!=this.selected&&this.selected===b.id&&(this.selected=null);var c=this.get(b.parent,arguments[e],!0);null!=c&&(b.parent.nodes[c].selected&&b.sidebar.unselect(b.id),b.parent.nodes.splice(c,1),a++)}0<a&&1==arguments.length?this.refresh(b.parent.id):this.refresh();return a},set:function(a,d,e){2==arguments.length&&(e=d,d=a,a=this);"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return null;for(var c=0;c<a.nodes.length;c++){if(a.nodes[c].id===d){var f=e.nodes;b.extend(a.nodes[c],e,{nodes:[]});null!=f&&this.add(a.nodes[c],f);this.refresh(d);return!0}if(this.set(a.nodes[c],d,e))return!0}return!1},get:function(a,b,e){if(0===arguments.length){for(var c=[],d=this.find({}),g=0;g<d.length;g++)null!=d[g].id&&c.push(d[g].id);return c}if(1==arguments.length||2==arguments.length&&!0===b)e=b,b=a,a=this;"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return null;for(c=0;c<a.nodes.length;c++){if(a.nodes[c].id==b)return!0===e?c:a.nodes[c];if((d=this.get(a.nodes[c],b,e))||0===d)return d}return null},find:function(a,b,e){1==arguments.length&&(b=a,a=this);e||(e=[]);"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return e;for(var c=0;c<a.nodes.length;c++){var d=!0,g;for(g in b)a.nodes[c][g]!=b[g]&&(d=!1);d&&e.push(a.nodes[c]);0<a.nodes[c].nodes.length&&(e=this.find(a.nodes[c],b,e))}return e},hide:function(){for(var a=0,b=0;b<arguments.length;b++){var e=this.get(arguments[b]);null!=e&&(e.hidden=!0,a++)}1==arguments.length?this.refresh(arguments[0]):this.refresh();return a},show:function(){for(var a=0,b=0;b<arguments.length;b++){var e=this.get(arguments[b]);null!=e&&(e.hidden=!1,a++)}1==arguments.length?this.refresh(arguments[0]):this.refresh();return a},disable:function(){for(var a=0,b=0;b<arguments.length;b++){var e=this.get(arguments[b]);null!=e&&(e.disabled=!0,e.selected&&this.unselect(e.id),a++)}1==arguments.length?this.refresh(arguments[0]):this.refresh();return a},enable:function(){for(var a=0,b=0;b<arguments.length;b++){var e=this.get(arguments[b]);null!=e&&(e.disabled=!1,a++)}1==arguments.length?this.refresh(arguments[0]):this.refresh();return a},select:function(a){var d=this.get(a);if(!d)return!1;this.scrollIntoView(a);if(this.selected==a&&d.selected)return!1;this.unselect(this.selected);b(this.box).find("#node_"+w2utils.escapeId(a)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");d.selected=!0;this.selected=a;return!0},unselect:function(a){0===arguments.length&&(a=this.selected);var d=this.get(a);if(!d)return!1;d.selected=!1;b(this.box).find("#node_"+w2utils.escapeId(a)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected");this.selected==a&&(this.selected=null);return!0},toggle:function(a){var b=this.get(a);if(null==b)return!1;if(b.plus)this.set(a,{plus:!1}),this.expand(a),this.refresh(a);else return 0!==b.nodes.length&&b.collapsible?this.get(a).expanded?this.collapse(a):this.expand(a):!1},collapse:function(a){var d=this,e=this.get(a),c=this.trigger({phase:"before",type:"collapse",target:a,object:e});if(!0!==c.isCancelled)return b(this.box).find("#node_"+w2utils.escapeId(a)+"_sub").slideUp(200),b(this.box).find("#node_"+w2utils.escapeId(a)+" .w2ui-node-dots:first-child").html('\x3cdiv class\x3d"w2ui-expand"\x3e+\x3c/div\x3e'),e.expanded=!1,this.trigger(b.extend(c,{phase:"after"})),setTimeout(function(){d.refresh(a)},200),!0},collapseAll:function(a){null==a&&(a=this);"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return!1;for(var b=0;b<a.nodes.length;b++)!0===a.nodes[b].expanded&&(a.nodes[b].expanded=!1),a.nodes[b].nodes&&0<a.nodes[b].nodes.length&&this.collapseAll(a.nodes[b]);this.refresh(a.id);return!0},expand:function(a){var d=this,e=this.get(a),c=this.trigger({phase:"before",type:"expand",target:a,object:e});if(!0!==c.isCancelled)return b(this.box).find("#node_"+w2utils.escapeId(a)+"_sub").slideDown(200),b(this.box).find("#node_"+w2utils.escapeId(a)+" .w2ui-node-dots:first-child").html('\x3cdiv class\x3d"w2ui-expand"\x3e-\x3c/div\x3e'),e.expanded=!0,this.trigger(b.extend(c,{phase:"after"})),setTimeout(function(){d.refresh(a)},200),!0},expandAll:function(a){null==a&&(a=this);"string"==typeof a&&(a=this.get(a));if(null==a.nodes)return!1;for(var b=0;b<a.nodes.length;b++)!1===a.nodes[b].expanded&&(a.nodes[b].expanded=!0),a.nodes[b].nodes&&0<a.nodes[b].nodes.length&&this.expandAll(a.nodes[b]);this.refresh(a.id)},expandParents:function(a){a=this.get(a);if(null==a)return!1;a.parent&&(a.parent.expanded||(a.parent.expanded=!0,this.refresh(a.parent.id)),this.expandParents(a.parent.id));return!0},click:function(a,d){var e=this,c=this.get(a);if(null!=c&&!c.disabled&&!c.group){b(e.box).find(".w2ui-node.w2ui-selected").each(function(a,c){a=b(c).attr("id").replace("node_","");a=e.get(a);null!=a&&(a.selected=!1);b(c).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")});var f=b(e.box).find("#node_"+w2utils.escapeId(a)),g=b(e.box).find("#node_"+w2utils.escapeId(e.selected));f.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");setTimeout(function(){var h=e.trigger({phase:"before",type:"click",target:a,originalEvent:d,node:c,object:c});!0===h.isCancelled?(f.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),g.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected")):(null!=g&&(g.selected=!1),e.get(a).selected=!0,e.selected=a,e.trigger(b.extend(h,{phase:"after"})))},1)}},focus:function(a){var d=this;a=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:a});if(!0===a.isCancelled)return!1;this.hasFocus=!0;b(this.box).find(".w2ui-selected").removeClass("w2ui-inactive");setTimeout(function(){var a=b(d.box).find("#sidebar_"+d.name+"_focus");a.is(":focus")||a.focus()},10);this.trigger(b.extend(a,{phase:"after"}))},blur:function(a){a=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:a});if(!0===a.isCancelled)return!1;this.hasFocus=!1;b(this.box).find(".w2ui-selected").addClass("w2ui-inactive");this.trigger(b.extend(a,{phase:"after"}))},keydown:function(a){function d(a,b){null==a||a.hidden||a.disabled||a.group||(h.click(a.id,b),setTimeout(function(){h.scrollIntoView()},50))}function e(a,b){for(a=b(a);null!=a&&(a.hidden||a.disabled)&&!a.group;)a=b(a);return a}function c(a,b){if(null==a)return null;var d=a.parent,e=h.get(a.id,!0);a.expanded&&0<a.nodes.length&&!0!==b?(a=a.nodes[0],a=a.hidden||a.disabled||a.group?c(a):a):a=d&&e+1<d.nodes.length?d.nodes[e+1]:c(d,!0);null!=a&&(a.hidden||a.disabled||a.group)&&(a=c(a));return a}function f(a){if(null==a)return null;var b=a.parent;a=h.get(a.id,!0);b=0<a?g(b.nodes[a-1]):b;null!=b&&(b.hidden||b.disabled||b.group)&&(b=f(b));return b}function g(a){return a.expanded&&0<a.nodes.length?(a=a.nodes[a.nodes.length-1],a.hidden||a.disabled||a.group?f(a):g(a)):a}var h=this,n=h.get(h.selected);if(!0===h.keyboard){n||(n=h.nodes[0]);var m=h.trigger({phase:"before",type:"keydown",target:h.name,originalEvent:a});!0!==m.isCancelled&&((13==a.keyCode||32==a.keyCode)&&0<n.nodes.length&&h.toggle(h.selected),37==a.keyCode&&(0<n.nodes.length&&n.expanded?h.collapse(h.selected):(d(n.parent),n.parent.group||h.collapse(n.parent.id))),39==a.keyCode&&(0<n.nodes.length||n.plus)&&!n.expanded&&h.expand(h.selected),38==a.keyCode&&d(e(n,f)),40==a.keyCode&&d(e(n,c)),-1!=b.inArray(a.keyCode,[13,32,37,38,39,40])&&(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()),h.trigger(b.extend(m,{phase:"after"})))}},scrollIntoView:function(a){null==a&&(a=this.selected);if(null!=this.get(a)){var d=b(this.box).find(".w2ui-sidebar-div");a=b(this.box).find("#node_"+w2utils.escapeId(a));var e=a.offset().top-d.offset().top;(e+a.height()>d.height()||0>=e)&&d.animate({scrollTop:d.scrollTop()+e-d.height()/2+a.height()},250,"linear")}},dblClick:function(a,d){var e=this.get(a);d=this.trigger({phase:"before",type:"dblClick",target:a,originalEvent:d,object:e});!0!==d.isCancelled&&(this.toggle(a),this.trigger(b.extend(d,{phase:"after"})))},contextMenu:function(a,d){var e=this,c=e.get(a);a!=e.selected&&e.click(a);var f=e.trigger({phase:"before",type:"contextMenu",target:a,originalEvent:d,object:c,allowOnDisabled:!1});!0===f.isCancelled||c.disabled&&!f.allowOnDisabled||(0<e.menu.length&&b(e.box).find("#node_"+w2utils.escapeId(a)).w2menu({items:e.menu,contextMenu:!0,originalEvent:d,onSelect:function(b){e.menuClick(a,parseInt(b.index),b.originalEvent)}}),d.preventDefault&&d.preventDefault(),e.trigger(b.extend(f,{phase:"after"})))},menuClick:function(a,d,e){a=this.trigger({phase:"before",type:"menuClick",target:a,originalEvent:e,menuIndex:d,menuItem:this.menu[d]});!0!==a.isCancelled&&this.trigger(b.extend(a,{phase:"after"}))},goFlat:function(){var a=this.trigger({phase:"before",type:"flat",goFlat:!this.flat});!0!==a.isCancelled&&(this.flat=!this.flat,this.refresh(),this.trigger(b.extend(a,{phase:"after"})))},render:function(a){var d=(new Date).getTime(),e=this,c=this.trigger({phase:"before",type:"render",target:this.name,box:a});if(!0!==c.isCancelled&&(null!=a&&(0<b(this.box).find("\x3e div \x3e div.w2ui-sidebar-div").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=a),this.box)){b(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('\x3cdiv\x3e\x3cinput id\x3d"sidebar_'+this.name+'_focus" style\x3d"position: absolute; top: 0; right: 0; width: 1px; z-index: -1; opacity: 0"/\x3e\x3cdiv class\x3d"w2ui-sidebar-top"\x3e\x3c/div\x3e\x3cdiv class\x3d"w2ui-sidebar-div scroll"\x3e\x3c/div\x3e\x3cdiv class\x3d"w2ui-sidebar-bottom"\x3e\x3c/div\x3e\x3c/div\x3e');b(this.box).find("\x3e div").css({width:b(this.box).width()+"px",height:b(this.box).height()+"px"});0<b(this.box).length&&(b(this.box)[0].style.cssText+=this.style);a="";1==this.flatButton&&(a='\x3cdiv class\x3d"w2ui-flat-'+(this.flat?"right":"left")+" fa fa-angle-"+(this.flat?"right":"left")+'" onclick\x3d"w2ui[\''+this.name+"'].goFlat()\"\x3e\x3c/div\x3e");if(""!==this.topHTML||""!==a)b(this.box).find(".w2ui-sidebar-top").html(this.topHTML+a),b(this.box).find(".w2ui-sidebar-div").css("top",b(this.box).find(".w2ui-sidebar-top").height()+"px");""!==this.bottomHTML&&(b(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),b(this.box).find(".w2ui-sidebar-div").css("bottom",b(this.box).find(".w2ui-sidebar-bottom").height()+"px"));var f;b(this.box).find("#sidebar_"+this.name+"_focus").on("focus",function(a){clearTimeout(f);e.hasFocus||e.focus(a)}).on("blur",function(a){f=setTimeout(function(){e.hasFocus&&e.blur(a)},100)}).on("keydown",function(a){9!=a.keyCode&&w2ui[e.name].keydown.call(w2ui[e.name],a)});b(this.box).off("mousedown").on("mousedown",function(a){setTimeout(function(){if(-1==["INPUT","TEXTAREA","SELECT"].indexOf(a.target.tagName.toUpperCase())){var c=b(e.box).find("#sidebar_"+e.name+"_focus");if(!c.is(":focus")){if(b(a.target).hasClass("w2ui-node")){var d=b(a.target).position().top+b(e.box).find(".w2ui-sidebar-top").height()+a.offsetY;c.css({top:d+"px",left:"0px"})}c.focus()}}},1)});this.trigger(b.extend(c,{phase:"after"}));this.refresh();return(new Date).getTime()-d}},refresh:function(a){function d(a){var b;b=a.img;null==b&&(b=this.img);var c=a.icon;null==c&&(c=this.icon);for(var d=a.parent,e=0;d&&null!=d.parent;)d.group&&e--,d=d.parent,e++;null!=a.caption&&(a.text=a.caption);a.group?(b='\x3cdiv class\x3d"w2ui-node-group w2ui-level-'+e+'" id\x3d"node_'+a.id+'"   onclick\x3d"w2ui[\''+g.name+"'].toggle('"+a.id+"')\"   oncontextmenu\x3d\"w2ui['"+g.name+"'].contextMenu('"+a.id+"', event);\"   onmouseout\x3d\"jQuery(this).find('span:nth-child(1)').css('color', 'transparent')\"    onmouseover\x3d\"jQuery(this).find('span:nth-child(1)').css('color', 'inherit')\"\x3e"+(a.groupShowHide&&a.collapsible?"\x3cspan\x3e"+(!a.hidden&&a.expanded?w2utils.lang("Hide"):w2utils.lang("Show"))+"\x3c/span\x3e":"\x3cspan\x3e\x3c/span\x3e")+("function"==typeof a.text?a.text.call(g,a):"\x3cspan\x3e"+a.text+"\x3c/span\x3e")+'\x3c/div\x3e\x3cdiv class\x3d"w2ui-node-sub" id\x3d"node_'+a.id+'_sub" style\x3d"'+a.style+";"+(!a.hidden&&a.expanded?"":"display: none;")+'"\x3e\x3c/div\x3e',g.flat&&(b='\x3cdiv class\x3d"w2ui-node-group" id\x3d"node_'+a.id+'"\x3e\x3cspan\x3e\x26#160;\x3c/span\x3e\x3c/div\x3e\x3cdiv id\x3d"node_'+a.id+'_sub" style\x3d"'+a.style+";"+(!a.hidden&&a.expanded?"":"display: none;")+'"\x3e\x3c/div\x3e')):(a.selected&&!a.disabled&&(g.selected=a.id),d="",b&&(d='\x3cdiv class\x3d"w2ui-node-image w2ui-icon '+b+(a.selected&&!a.disabled?" w2ui-icon-selected":"")+'"\x3e\x3c/div\x3e'),c&&(d='\x3cdiv class\x3d"w2ui-node-image"\x3e\x3cspan class\x3d"'+c+'"\x3e\x3c/span\x3e\x3c/div\x3e'),c=a.text,"function"==typeof a.text&&(c=a.text.call(g,a)),b='\x3cdiv class\x3d"w2ui-node w2ui-level-'+e+" "+(a.selected?"w2ui-selected":"")+" "+(a.disabled?"w2ui-disabled":"")+'" id\x3d"node_'+a.id+'" style\x3d"'+(a.hidden?"display: none;":"")+'"    ondblclick\x3d"w2ui[\''+g.name+"'].dblClick('"+a.id+"', event);\"    oncontextmenu\x3d\"w2ui['"+g.name+"'].contextMenu('"+a.id+"', event);\"    onClick\x3d\"w2ui['"+g.name+"'].click('"+a.id+'\', event); "\x3e\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" style\x3d"margin-left:'+18*e+"px; padding-right:"+18*e+'px"\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd class\x3d"w2ui-node-dots" nowrap\x3d"nowrap" onclick\x3d"w2ui[\''+g.name+"'].toggle('"+a.id+'\');         if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble \x3d true;"\x3e    \x3cdiv class\x3d"w2ui-expand"\x3e'+(0<a.nodes.length?a.expanded?"-":"+":a.plus?"+":"")+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"w2ui-node-data" nowrap\x3d"nowrap"\x3e'+d+(a.count||0===a.count?'\x3cdiv class\x3d"w2ui-node-count"\x3e'+a.count+"\x3c/div\x3e":"")+'\x3cdiv class\x3d"w2ui-node-caption"\x3e'+c+'\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv class\x3d"w2ui-node-sub" id\x3d"node_'+a.id+'_sub" style\x3d"'+a.style+";"+(!a.hidden&&a.expanded?"":"display: none;")+'"\x3e\x3c/div\x3e',g.flat&&(b='\x3cdiv class\x3d"w2ui-node w2ui-level-'+e+" "+(a.selected?"w2ui-selected":"")+" "+(a.disabled?"w2ui-disabled":"")+'" id\x3d"node_'+a.id+'" style\x3d"'+(a.hidden?"display: none;":"")+"\"    onmouseover\x3d\"jQuery(this).find('.w2ui-node-data').w2tag($F.base64decode('"+$F.base64encode(c+(a.count||0===a.count?' - \x3cspan class\x3d"w2ui-node-count"\x3e'+a.count+"\x3c/span\x3e":""))+"'),                { id: '"+a.id+"', left: -5 })\"    onmouseout\x3d\"jQuery(this).find('.w2ui-node-data').w2tag(null, { id: '"+a.id+"' })\"    ondblclick\x3d\"w2ui['"+g.name+"'].dblClick('"+a.id+"', event);\"    oncontextmenu\x3d\"w2ui['"+g.name+"'].contextMenu('"+a.id+"', event);\"    onClick\x3d\"w2ui['"+g.name+"'].click('"+a.id+'\', event); "\x3e\x3cdiv class\x3d"w2ui-node-data w2ui-node-flat"\x3e'+d+'\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"w2ui-node-sub" id\x3d"node_'+a.id+'_sub" style\x3d"'+a.style+";"+(!a.hidden&&a.expanded?"":"display: none;")+'"\x3e\x3c/div\x3e'));return b}var e=(new Date).getTime(),c=this.trigger({phase:"before",type:"refresh",target:null!=a?a:this.name,fullRefresh:null!=a?!1:!0});if(!0!==c.isCancelled){var f="";1==this.flatButton&&(f='\x3cdiv class\x3d"w2ui-flat-'+(this.flat?"right":"left")+" fa fa-angle-"+(this.flat?"right":"left")+'" onclick\x3d"w2ui[\''+this.name+"'].goFlat()\"\x3e\x3c/div\x3e");if(""!==this.topHTML||""!==f)b(this.box).find(".w2ui-sidebar-top").html(this.topHTML+f),b(this.box).find(".w2ui-sidebar-div").css("top",b(this.box).find(".w2ui-sidebar-top").height()+"px");""!==this.bottomHTML&&(b(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),b(this.box).find(".w2ui-sidebar-div").css("bottom",b(this.box).find(".w2ui-sidebar-bottom").height()+"px"));b(this.box).find("\x3e div").removeClass("w2ui-sidebar-flat").addClass(this.flat?"w2ui-sidebar-flat":"").css({width:b(this.box).width()+"px",height:b(this.box).height()+"px"});var g=this,h;if(null==a)a=this,f=".w2ui-sidebar-div";else{a=this.get(a);if(null==a)return;f="#node_"+w2utils.escapeId(a.id)+"_sub"}var n;if(a!==this){var m="#node_"+w2utils.escapeId(a.id);n=d(a);b(this.box).find(m).before('\x3cdiv id\x3d"sidebar_'+this.name+'_tmp"\x3e\x3c/div\x3e');b(this.box).find(m).remove();b(this.box).find(f).remove();b("#sidebar_"+this.name+"_tmp").before(n);b("#sidebar_"+this.name+"_tmp").remove()}b(this.box).find(f).html("");for(m=0;m<a.nodes.length;m++)if(h=a.nodes[m],n=d(h),b(this.box).find(f).append(n),0!==h.nodes.length)this.refresh(h.id);else{n=this.trigger({phase:"before",type:"refresh",target:h.id});if(!0===n.isCancelled)return;this.trigger(b.extend(n,{phase:"after"}))}this.trigger(b.extend(c,{phase:"after"}));return(new Date).getTime()-e}},resize:function(a){var d=this;void 0==d.sizeTimer&&(d.sizeTimer=setInterval(function(){if(0==b(d.box).is(":hidden")){var e=(new Date).getTime(),c=d.trigger({phase:"before",type:"resize",target:this.name});if(!0!==c.isCancelled)return b(d.box).css("overflow","hidden"),""!==d.topHTML&&b(d.box).find(".w2ui-sidebar-div").css("top",b(d.box).find(".w2ui-sidebar-top").height()+"px"),""!==this.bottomHTML&&b(d.box).find(".w2ui-sidebar-div").css("bottom",b(d.box).find(".w2ui-sidebar-bottom").height()+"px"),b(d.box).find("\x3e div").css({width:b(d.box).width()+"px",height:b(d.box).height()+"px"}),d.trigger(b.extend(c,{phase:"after"})),clearInterval(d.sizeTimer),void 0==d.sizeTimer,a&&b.isFunction(a)&&a(),(new Date).getTime()-e}},200))},destroy:function(){var a=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==a.isCancelled&&(0<b(this.box).find("\x3e div \x3e div.w2ui-sidebar-div").length&&b(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.sizeTimer&&clearInterval(this.sizeTimer),delete w2ui[this.name],this.trigger(b.extend(a,{phase:"after"})))},lock:function(a,b){var d=Array.prototype.slice.call(arguments,0);d.unshift(this.box);w2utils.lock.apply(window,d)},unlock:function(a){w2utils.unlock(this.box,a)}};b.extend(g.prototype,w2utils.event);w2obj.sidebar=g})(jQuery);(function(b){var g=function(a){this.el=null;this.helpers={};this.type=a.type||"text";this.options=b.extend(!0,{},a);this.onSearch=a.onSearch||null;this.onRequest=a.onRequest||null;this.onLoad=a.onLoad||null;this.onError=a.onError||null;this.onClick=a.onClick||null;this.onAdd=a.onAdd||null;this.onNew=a.onNew||null;this.onRemove=a.onRemove||null;this.onMouseOver=a.onMouseOver||null;this.onMouseOut=a.onMouseOut||null;this.onIconClick=a.onIconClick||null;this.onScroll=a.onScroll||null;this.tmp={};delete this.options.type;delete this.options.onSearch;delete this.options.onRequest;delete this.options.onLoad;delete this.options.onError;delete this.options.onClick;delete this.options.onMouseOver;delete this.options.onMouseOut;delete this.options.onIconClick;delete this.options.onScroll;b.extend(!0,this,w2obj.field)};b.fn.w2field=function(a,d){if(0===this.length){var e=g.prototype;if(e[a])return e[a].apply(e,Array.prototype.slice.call(arguments,1))}else{if(0===arguments.length)return b(this).data("w2field");"string"==typeof a&&"object"==typeof d&&(a=b.extend(!0,{},d,{type:a}));"string"==typeof a&&null==d&&(a={type:a});a.type=String(a.type).toLowerCase();return this.each(function(c,d){c=b(d).data("w2field");if(null!=c&&(c.clear(),"clear"==a.type))return;c=new g(a);b.extend(c,{handlers:[]});d&&(c.el=b(d)[0]);c.init();b(d).data("w2field",c);return c})}};g.prototype={custom:{},addType:function(a,b){a=String(a).toLowerCase();this.custom[a]=b;return!0},removeType:function(a){a=String(a).toLowerCase();if(!this.custom[a])return!1;delete this.custom[a];return!0},init:function(){var a=this,d=this.options,e;if("function"==typeof this.custom[this.type])this.custom[this.type].call(this,d);else if(-1==["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase()))console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);else{switch(this.type){case "text":case "int":case "float":case "money":case "currency":case "percent":case "alphanumeric":case "bin":case "hex":e={min:null,max:null,step:1,autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""};d=this.options=b.extend(!0,{},e,d);d.numberRE=new RegExp("["+d.groupSymbol+"]","g");d.moneyRE=new RegExp("["+d.currencyPrefix+d.currencySuffix+d.groupSymbol+"]","g");d.percentRE=new RegExp("["+d.groupSymbol+"%]","g");-1!=["text","alphanumeric","hex","bin"].indexOf(this.type)&&(d.arrows=!1,d.keyboard=!1);this.addPrefix();this.addSuffix();break;case "color":e={prefix:"#",suffix:'\x3cdiv style\x3d"width: '+(parseInt(b(this.el).css("font-size"))||12)+'px"\x3e\x26#160;\x3c/div\x3e',arrows:!1,keyboard:!1,transparent:!0};b.extend(d,e);this.addPrefix();this.addSuffix();b(this.el).attr("maxlength",6);""!==b(this.el).val()&&setTimeout(function(){a.change()},1);break;case "date":e={format:w2utils.settings.dateFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{},blockWeekDays:null};d=this.options=b.extend(!0,{},e,d);null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",d.format);break;case "time":e={format:w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",noMinutes:!1};d=this.options=b.extend(!0,{},e,d);null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",d.format);break;case "datetime":e={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1};d=this.options=b.extend(!0,{},e,d);null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",d.placeholder||d.format);break;case "list":case "combo":e={itemId:0,itemText:1,itemIco:null,itemImg:null,items:[],selected:{},recId:null,recText:null,method:null,interval:350,minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,match:"begins",silent:!0,icon:null,iconStyle:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1};if("list"==this.type){e.openOnFocus=!0;b(this.el).addClass("w2ui-select");if(d.selected&&!b.isPlainObject(d.selected)&&d.items)for(var c=0;c<d.items.length;c++){var f=d.items[c];if(f&&f[d.itemId]==d.selected){d.selected=b.extend(!0,{},f);break}}this.watchSize()}this.options=d=b.extend({},e,d,{align:"both",altRows:!0});b.isPlainObject(d.selected)||(d.selected={});b(this.el).data("selected",d.selected);"list"==this.type&&this.addFocus();this.addPrefix();this.addSuffix();setTimeout(function(){a.refresh()},10);b(this.el).attr("autocomplete","off");null!=d.selected.text&&b(this.el).val(d.selected.text);break;case "enum":e={items:[],selected:[],max:0,recId:null,recText:null,interval:350,method:null,minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",silent:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null};d=b.extend({},e,d,{align:"both",suffix:"",altRows:!0});d.items=this.normMenu(d.items);d.selected=this.normMenu(d.selected);this.options=d;b.isArray(d.selected)||(d.selected=[]);b(this.el).data("selected",d.selected);this.addSuffix();this.addMulti();this.watchSize();break;case "file":e={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},this.options=d=b.extend({},e,d,{align:"both",altRows:!0}),b.isArray(d.selected)||(d.selected=[]),b(this.el).data("selected",d.selected),null==b(this.el).attr("placeholder")&&b(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange:function(b){a.change.call(a,b)},onClick:function(b){a.click.call(a,b)},onFocus:function(b){a.focus.call(a,b)},onBlur:function(b){a.blur.call(a,b)},onKeydown:function(b){a.keyDown.call(a,b)},onKeyup:function(b){a.keyUp.call(a,b)},onKeypress:function(b){a.keyPress.call(a,b)}};b(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box"));this.change(b.Event("change"))}},watchSize:function(){var a=this,d=b(a.el).data("tmp")||{};d.sizeTimer=setInterval(function(){0<b(a.el).parents("body").length?a.resize():clearInterval(d.sizeTimer)},200);b(a.el).data("tmp",d)},get:function(){var a;if(-1!=["list","enum","file"].indexOf(this.type))if(a=b(this.el).data("selected")){if(a=a[this.options.itemId],!a)return""}else a="";else a=b(this.el).val();return a},set:function(a,d){if(-1!=["list","enum","file"].indexOf(this.type)){if("list"==this.type){if(void 0!=a&&""!=(a+"").trim()){d=this.options.items;var e=this.options.itemId;if(b.isArray(d)){var c,f=d.length;for(c=0;c<f;c++)if(d[c][e]==a){b(this.el).data("selected",d[c]).change();this.refresh();return}}}b(this.el).data("selected","")}else"list"!=this.type&&d?(null==b(this.el).data("selected")&&b(this.el).data("selected",[]),b(this.el).data("selected").push(a),b(this.el).change()):(a="enum"==this.type?[a]:a,b(this.el).data("selected",a).change());this.refresh()}else b(this.el).val(a)},setIndex:function(a,d){if(-1!=["list","enum"].indexOf(this.type)){var e=this.options.items;if(e&&e[a])return"list"!=this.type&&d?(null==b(this.el).data("selected")&&b(this.el).data("selected",[]),b(this.el).data("selected").push(e[a]),b(this.el).change()):(a="enum"==this.type?[e[a]]:e[a],b(this.el).data("selected",a).change()),this.refresh(),!0}return!1},clear:function(){var a=this.options;-1!=["money","currency"].indexOf(this.type)&&b(this.el).val(b(this.el).val().replace(a.moneyRE,""));"percent"==this.type&&b(this.el).val(b(this.el).val().replace(/%/g,""));"color"==this.type&&b(this.el).removeAttr("maxlength");"list"==this.type&&b(this.el).removeClass("w2ui-select");this.type="clear";a=b(this.el).data("tmp");if(this.tmp){null!=a&&(b(this.el).height("auto"),a&&a["old-padding-left"]&&b(this.el).css("padding-left",a["old-padding-left"]),a&&a["old-padding-right"]&&b(this.el).css("padding-right",a["old-padding-right"]),a&&a["old-background-color"]&&b(this.el).css("background-color",a["old-background-color"]),a&&a["old-border-color"]&&b(this.el).css("border-color",a["old-border-color"]),clearInterval(a.sizeTimer));b(this.el).val(this.clean(b(this.el).val())).removeClass("w2field").removeData().off(".w2field");for(var d in this.helpers)b(this.helpers[d]).remove();this.helpers={}}},refresh:function(){var a=this,d=this.options,e=b(this.el).data("selected"),c=(new Date).getTime();-1!=["list"].indexOf(this.type)&&(b(a.el).parent().css("white-space","nowrap"),a.helpers.prefix&&a.helpers.prefix.hide(),setTimeout(function(){if(a.helpers.focus){!b.isEmptyObject(e)&&d.icon?d.prefix='\x3cspan class\x3d"w2ui-icon '+d.icon+'"style\x3d"cursor: pointer; font-size: 12px; display: inline-block; margin-top: -1px; color: #7F98AD;'+d.iconStyle+'"\x3e\x3c/span\x3e':d.prefix="";a.addPrefix();var c=a.helpers.focus.find("input");""===b(c).val()?(b(c).css("text-indent","-9999em").prev().css("opacity",0),b(a.el).val(e&&null!=e[a.options.itemText]?w2utils.lang(e[a.options.itemText]):"")):(b(c).css("text-indent",0).prev().css("opacity",1),b(a.el).val(""),setTimeout(function(){a.helpers.prefix&&a.helpers.prefix.hide();d.icon?(b(c).css("margin-left","17px"),b(a.helpers.focus).find(".icon-search").attr("style","position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;width: 11px !important; opacity: 1; display: block")):(b(c).css("margin-left","0px"),b(a.helpers.focus).find(".icon-search").attr("style","position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;width: 0px !important; opacity: 0; display: none"))},1));b(a.el).prop("readonly")||b(a.el).prop("disabled")?setTimeout(function(){b(a.helpers.prefix).css("opacity","0.6");b(a.helpers.suffix).css("opacity","0.6")},1):setTimeout(function(){b(a.helpers.prefix).css("opacity","1");b(a.helpers.suffix).css("opacity","1")},1)}},1));if(-1!=["enum","file"].indexOf(this.type)){var f="";if(e)for(var g=0;g<e.length;g++)var h=e[g],n="",n="function"==typeof d.renderItem?d.renderItem(h,g,'\x3cdiv class\x3d"w2ui-list-remove" title\x3d"'+w2utils.lang("Remove")+'" index\x3d"'+g+'"\x3e\x26#160;\x26#160;\x3c/div\x3e'):'\x3cdiv class\x3d"w2ui-list-remove" title\x3d"'+w2utils.lang("Remove")+'" index\x3d"'+g+'"\x3e\x26#160;\x26#160;\x3c/div\x3e'+("enum"==a.type?h.text:h.name+'\x3cspan class\x3d"file-size"\x3e - '+w2utils.formatSize(h.size)+"\x3c/span\x3e"),f=f+('\x3cli index\x3d"'+g+'" style\x3d"max-width: '+parseInt(d.maxWidth)+"px; "+(h.style?h.style:"")+'"\x3e'+n+"\x3c/li\x3e");var m=a.helpers.multi,g=m.find("ul");m.attr("style",m.attr("style")+";"+d.style);b(a.el).css("z-index","-1");b(a.el).prop("readonly")||b(a.el).prop("disabled")?setTimeout(function(){m[0].scrollTop=0;m.addClass("w2ui-readonly").find("li").css("opacity","0.9").parent().find("li.nomouse").hide().find("input").prop("readonly",!0).parents("ul").find(".w2ui-list-remove").hide()},1):setTimeout(function(){m.removeClass("w2ui-readonly").find("li").css("opacity","1").parent().find("li.nomouse").show().find("input").prop("readonly",!1).parents("ul").find(".w2ui-list-remove").show()},1);m.find(".w2ui-enum-placeholder").remove();g.find("li").not("li.nomouse").remove();""!==f?g.prepend(f):null!=b(a.el).attr("placeholder")&&""===m.find("input").val()&&(f="padding-top: "+b(this.el).css("padding-top")+";padding-left: "+b(this.el).css("padding-left")+"; box-sizing: "+b(this.el).css("box-sizing")+"; line-height: "+b(this.el).css("line-height")+"; font-size: "+b(this.el).css("font-size")+"; font-family: "+b(this.el).css("font-family")+"; ",m.prepend('\x3cdiv class\x3d"w2ui-enum-placeholder" style\x3d"'+f+'"\x3e'+b(a.el).attr("placeholder")+"\x3c/div\x3e"));m.off("scroll.w2field").on("scroll.w2field",function(c){c=a.trigger({phase:"before",type:"scroll",target:a.el,originalEvent:c});!0!==c.isCancelled&&a.trigger(b.extend(c,{phase:"after"}))}).find("li").data("mouse","out").on("click",function(c){var d="LI"==c.target.tagName.toUpperCase()?c.target:b(c.target).parents("LI"),f=e[b(d).attr("index")];if(!b(d).hasClass("nomouse"))if(c.stopPropagation(),b(c.target).hasClass("w2ui-list-remove")){if(!b(a.el).prop("readonly")&&!b(a.el).prop("disabled")){var g=a.trigger({phase:"before",type:"remove",target:a.el,originalEvent:c.originalEvent,item:f});!0!==g.isCancelled&&(b().w2overlay(),e.splice(b(c.target).attr("index"),1),b(a.el).trigger("change"),b(c.target).parent().fadeOut("fast"),setTimeout(function(){a.refresh();a.trigger(b.extend(g,{phase:"after"}))},300))}}else g=a.trigger({phase:"before",type:"click",target:a.el,originalEvent:c.originalEvent,item:f}),!0!==g.isCancelled&&("file"==a.type&&(c="",/image/i.test(f.type)&&(c='\x3cdiv style\x3d"padding: 3px;"\x3e    \x3cimg src\x3d"'+(f.content?"data:"+f.type+";base64,"+f.content:"")+'" style\x3d"max-width: 300px;"         onload\x3d"var w \x3d jQuery(this).width(); var h \x3d jQuery(this).height();             if (w \x3c 300 \x26 h \x3c 300) return;             if (w \x3e\x3d h \x26\x26 w \x3e 300) jQuery(this).width(300);            if (w \x3c h \x26\x26 h \x3e 300) jQuery(this).height(300);"        onerror\x3d"this.style.display \x3d \'none\'"    \x3e\x3c/div\x3e'),c+='\x3cdiv style\x3d"padding: 8px;"\x3e    \x3ctable cellpadding\x3d"2"\x3e\x3ctbody\x3e    \x3ctr\x3e\x3ctd style\x3d"padding: 3px; text-align: right; color: #777;"\x3e'+w2utils.lang("Name")+':\x3c/td\x3e\x3ctd style\x3d"padding: 3px"\x3e'+f.name+'\x3c/td\x3e\x3c/tr\x3e    \x3ctr\x3e\x3ctd style\x3d"padding: 3px; text-align: right; color: #777;"\x3e'+w2utils.lang("Size")+':\x3c/td\x3e\x3ctd style\x3d"padding: 3px"\x3e'+w2utils.formatSize(f.size)+'\x3c/td\x3e\x3c/tr\x3e    \x3ctr\x3e\x3ctd style\x3d"padding: 3px; text-align: right; color: #777;"\x3e'+w2utils.lang("Type")+':\x3c/td\x3e\x3ctd style\x3d"padding: 3px"\x3e        \x3cspan style\x3d"width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap\x3d"nowrap";"\x3e'+f.type+'\x3c/span\x3e    \x3c/td\x3e\x3c/tr\x3e    \x3ctr\x3e\x3ctd style\x3d"padding: 3px; text-align: right; color: #777;"\x3e'+w2utils.lang("Modified")+':\x3c/td\x3e\x3ctd style\x3d"padding: 3px"\x3e'+w2utils.date(f.modified)+"\x3c/td\x3e\x3c/tr\x3e    \x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e",b("#w2ui-overlay").remove(),b(d).w2overlay(c)),a.trigger(b.extend(g,{phase:"after"})))}).on("mouseover",function(c){var d="LI"==c.target.tagName.toUpperCase()?c.target:b(c.target).parents("LI");if(!b(d).hasClass("nomouse")){if("out"==b(d).data("mouse")){var f=e[b(c.target).attr("index")];c=a.trigger({phase:"before",type:"mouseOver",target:a.el,originalEvent:c.originalEvent,item:f});if(!0===c.isCancelled)return;a.trigger(b.extend(c,{phase:"after"}))}b(d).data("mouse","over")}}).on("mouseout",function(c){var d="LI"==c.target.tagName.toUpperCase()?c.target:b(c.target).parents("LI");b(d).hasClass("nomouse")||(b(d).data("mouse","leaving"),setTimeout(function(){if("leaving"==b(d).data("mouse")){b(d).data("mouse","out");var f=e[b(c.target).attr("index")],f=a.trigger({phase:"before",type:"mouseOut",target:a.el,originalEvent:c.originalEvent,item:f});!0!==f.isCancelled&&a.trigger(b.extend(f,{phase:"after"}))}},0))});b(this.el).height("auto");f=b(m).find("\x3e div.w2ui-multi-items").height()+2*w2utils.getSize(m,"+height");26>f&&(f=26);f>d.maxHeight&&(f=d.maxHeight);0<m.length&&(m[0].scrollTop=1E3);g=w2utils.getSize(b(this.el),"height")-2;g>f&&(f=g);b(m).css({height:f+"px",overflow:f==d.maxHeight?"auto":"hidden"});f<d.maxHeight&&b(m).prop("scrollTop",0);b(this.el).css({height:f+2+"px"});"enum"==a.type&&(f=a.helpers.multi.find("input"),f.width(8*(f.val().length+2)+"px"))}return(new Date).getTime()-c},reset:function(){var a=this.type;this.clear();this.type=a;this.init()},resize:function(){var a=b(this.el).width(),d=b(this.el).height();if(!(this.tmp.current_width==a&&0<d)){var e=this.helpers.focus,d=this.helpers.multi,c=this.helpers.suffix,f=this.helpers.prefix;e&&e.width(b(this.el).width());d&&(e=w2utils.getSize(this.el,"width")-parseInt(b(this.el).css("margin-left"),10)-parseInt(b(this.el).css("margin-right"),10),b(d).width(e));c&&(this.options.suffix='\x3cdiv class\x3d"arrow-down" style\x3d"margin-top: '+(parseInt(b(this.el).height())-6)/2+'px;"\x3e\x3c/div\x3e',this.addSuffix());f&&this.addPrefix();this.tmp.current_width=a}},clean:function(a){if("number"==typeof a)return a;var d=this.options;a=String(a).trim();-1!=["int","float","money","currency","percent"].indexOf(this.type)&&("string"==typeof a&&(d.autoFormat&&-1!=["money","currency"].indexOf(this.type)&&(a=String(a).replace(d.moneyRE,"")),d.autoFormat&&"percent"==this.type&&(a=String(a).replace(d.percentRE,"")),d.autoFormat&&-1!=["int","float"].indexOf(this.type)&&(a=String(a).replace(d.numberRE,"")),a=a.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),parseFloat(a)==a&&(null!=d.min&&a<d.min&&(a=d.min,b(this.el).val(d.min)),null!=d.max&&a>d.max&&(a=d.max,b(this.el).val(d.max))),a=""!==a&&w2utils.isFloat(a)?Number(a):"");return a},format:function(a){return a},change:function(a){var d=this,e=d.options;if(-1!=["int","float","money","currency","percent"].indexOf(this.type)){var c=b(this.el).val(),f=this.format(this.clean(b(this.el).val()));if(""!==c&&c!=f)return b(this.el).val(f).change(),a.stopPropagation(),a.preventDefault(),!1}"color"==this.type&&(a="#"+b(this.el).val(),6!=b(this.el).val().length&&3!=b(this.el).val().length&&(a=""),b(this.el).next().find("div").css("background-color",a),b(d.el).is(":focus")&&this.updateOverlay());-1!=["list","enum","file"].indexOf(this.type)&&(d.refresh(),setTimeout(function(){d.refresh()},5));-1!=["date","time","datetime"].indexOf(this.type)&&(a=parseInt(d.el.value),w2utils.isInt(d.el.value)&&3E3<a&&("time"==this.type&&b(d.el).val(w2utils.formatTime(new Date(a),e.format)).change(),"date"==this.type&&b(d.el).val(w2utils.formatDate(new Date(a),e.format)).change(),"datetime"==this.type&&b(d.el).val(w2utils.formatDateTime(new Date(a),e.format)).change()))},click:function(a){-1!=["list","combo","enum"].indexOf(this.type)&&(b(this.el).is(":focus")||this.focus(a));-1!=["date","time","color","datetime"].indexOf(this.type)&&this.updateOverlay()},focus:function(a){var d=this;if(-1!==["color","date","time","datetime"].indexOf(d.type)){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();setTimeout(function(){d.updateOverlay()},150)}if(-1!=["list","combo","enum"].indexOf(d.type)){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();d.resize();setTimeout(function(){"list"==d.type&&b(d.el).is(":focus")?b(d.helpers.focus).find("input").focus():(d.search(),setTimeout(function(){d.updateOverlay()},1))},1)}"file"==d.type&&b(d.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"})},blur:function(a){var d=this;a=d.options;var e=b(d.el).val().trim();-1!="color date time list combo enum datetime".split(" ").indexOf(d.type)&&0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();-1==["int","float","money","currency","percent"].indexOf(d.type)||""===e||d.checkType(e)||(b(d.el).val("").change(),!1===a.silent&&(b(d.el).w2tag("Not a valid number"),setTimeout(function(){b(d.el).w2tag("")},3E3)));-1!=["date","time","datetime"].indexOf(d.type)&&(""===e||d.inRange(d.el.value)?"date"!=d.type||""===e||w2utils.isDate(d.el.value,a.format)?"time"!=d.type||""===e||w2utils.isTime(d.el.value)?"datetime"!=d.type||""===e||w2utils.isDateTime(d.el.value,a.format)||(b(d.el).val("").removeData("selected").change(),!1===a.silent&&(b(d.el).w2tag("Not a valid date"),setTimeout(function(){b(d.el).w2tag("")},3E3))):(b(d.el).val("").removeData("selected").change(),!1===a.silent&&(b(d.el).w2tag("Not a valid time"),setTimeout(function(){b(d.el).w2tag("")},3E3))):(b(d.el).val("").removeData("selected").change(),!1===a.silent&&(b(d.el).w2tag("Not a valid date"),setTimeout(function(){b(d.el).w2tag("")},3E3))):(b(d.el).val("").removeData("selected").change(),!1===a.silent&&(b(d.el).w2tag("Not in range"),setTimeout(function(){b(d.el).w2tag("")},3E3))));"enum"==d.type&&b(d.helpers.multi).find("input").val("").width(20);"file"==d.type&&b(d.helpers.multi).css({outline:"none"})},keyPress:function(a){var b=this;if(-1!="int float money currency percent hex bin color alphanumeric".split(" ").indexOf(b.type)){if(a.metaKey||a.ctrlKey||a.altKey||a.charCode!=a.keyCode&&0<a.keyCode)return;var e=String.fromCharCode(a.charCode);if(!b.checkType(e,!0)&&13!=a.keyCode)return a.preventDefault(),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1}-1!=["date","time","datetime"].indexOf(b.type)&&9!==a.keyCode&&setTimeout(function(){b.updateOverlay()},1)},keyDown:function(a,d){var e=this,c=e.options;d=a.keyCode||d&&d.keyCode;if(-1!=["int","float","money","currency","percent"].indexOf(e.type)){if(!c.keyboard||b(e.el).prop("readonly")||b(e.el).prop("disabled"))return;var f=!1,g=parseFloat(b(e.el).val().replace(c.moneyRE,""))||0,h=c.step;if(a.ctrlKey||a.metaKey)h=10;switch(d){case 38:if(a.shiftKey)break;b(e.el).val(g+h<=c.max||null==c.max?Number((g+h).toFixed(12)):c.max).change();f=!0;break;case 40:a.shiftKey||(b(e.el).val(g-h>=c.min||null==c.min?Number((g-h).toFixed(12)):c.min).change(),f=!0)}f&&(a.preventDefault(),setTimeout(function(){e.el.setSelectionRange(e.el.value.length,e.el.value.length)},0))}if("date"==e.type){if(!c.keyboard||b(e.el).prop("readonly")||b(e.el).prop("disabled"))return;f=!1;g=864E5;h=1;if(a.ctrlKey||a.metaKey)h=10;var n=w2utils.isDate(b(e.el).val(),c.format,!0);n||(n=new Date,g=0);switch(d){case 38:if(a.shiftKey)break;f=w2utils.formatDate(n.getTime()+g,c.format);10==h&&(f=w2utils.formatDate(new Date(n.getFullYear(),n.getMonth()+1,n.getDate()),c.format));b(e.el).val(f).change();f=!0;break;case 40:a.shiftKey||(f=w2utils.formatDate(n.getTime()-g,c.format),10==h&&(f=w2utils.formatDate(new Date(n.getFullYear(),n.getMonth()-1,n.getDate()),c.format)),b(e.el).val(f).change(),f=!0)}f&&(a.preventDefault(),setTimeout(function(){e.el.setSelectionRange(e.el.value.length,e.el.value.length);e.updateOverlay()},0))}if("time"==e.type){if(!c.keyboard||b(e.el).prop("readonly")||b(e.el).prop("disabled"))return;f=!1;h=a.ctrlKey||a.metaKey?60:1;g=b(e.el).val();g=e.toMin(g)||e.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(d){case 38:if(a.shiftKey)break;g+=h;f=!0;break;case 40:a.shiftKey||(g-=h,f=!0)}f&&(b(e.el).val(e.fromMin(g)).change(),a.preventDefault(),setTimeout(function(){e.el.setSelectionRange(e.el.value.length,e.el.value.length)},0))}if("datetime"==e.type){if(!c.keyboard||b(e.el).prop("readonly")||b(e.el).prop("disabled"))return;f=!1;g=864E5;h=1;if(a.ctrlKey||a.metaKey)h=10;n=b(e.el).val();n=w2utils.isDateTime(n,this.options.format,!0);n||(n=new Date,g=0);switch(d){case 38:if(a.shiftKey)break;f=w2utils.formatDateTime(n.getTime()+g,c.format);10==h&&(f=w2utils.formatDateTime(new Date(n.getFullYear(),n.getMonth()+1,n.getDate()),c.format));b(e.el).val(f).change();f=!0;break;case 40:a.shiftKey||(f=w2utils.formatDateTime(n.getTime()-g,c.format),10==h&&(f=w2utils.formatDateTime(new Date(n.getFullYear(),n.getMonth()-1,n.getDate()),c.format)),b(e.el).val(f).change(),f=!0)}f&&(a.preventDefault(),setTimeout(function(){e.el.setSelectionRange(e.el.value.length,e.el.value.length);e.updateOverlay()},0))}if("color"==e.type){if(b(e.el).prop("readonly")||b(e.el).prop("disabled"))return;86==a.keyCode&&(a.ctrlKey||a.metaKey)&&(b(e.el).prop("maxlength",7),setTimeout(function(){var a=b(e).val();"#"==a.substr(0,1)&&(a=a.substr(1));w2utils.isHex(a)||(a="");b(e).val(a).prop("maxlength",6).change()},20));if((a.ctrlKey||a.metaKey)&&!a.shiftKey){f=h=null;switch(d){case 38:h="up";break;case 40:h="down";break;case 39:h="right";break;case 37:h="left"}e.el.nav&&null!=h&&(f=e.el.nav(h),b(e.el).val(f).change(),a.preventDefault())}}if(-1!=["list","combo","enum"].indexOf(e.type)&&!b(e.el).prop("readonly")&&!b(e.el).prop("disabled")){var h=b(e.el).data("selected"),m=b(e.el),f=!1;-1!=["list","enum"].indexOf(e.type)&&("list"==e.type&&(m=b(e.helpers.focus).find("input")),"enum"==e.type&&(m=b(e.helpers.multi).find("input")),-1==[37,38,39,40].indexOf(d)&&setTimeout(function(){e.refresh()},1),86==a.keyCode&&(a.ctrlKey||a.metaKey)&&setTimeout(function(){e.refresh();e.search();e.request()},50));switch(d){case 27:"list"==e.type&&(""!==m.val()&&m.val(""),a.stopPropagation());break;case 13:if(0===b("#w2ui-overlay").length)break;d=c.items[c.index];if("enum"==e.type){if(null!=d){g=e.trigger({phase:"before",type:"add",target:e.el,originalEvent:a.originalEvent,item:d});if(!0===g.isCancelled)return;d=g.item;h.length>=c.max&&0<c.max&&h.pop();delete d.hidden;delete e.tmp.force_open;h.push(d);b(e.el).change();m.val("").width(20);e.refresh()}else{d={id:m.val(),text:m.val()};g=e.trigger({phase:"before",type:"new",target:e.el,originalEvent:a.originalEvent,item:d});if(!0===g.isCancelled)return;d=g.item;"function"==typeof e.onNew&&(h.length>=c.max&&0<c.max&&h.pop(),delete e.tmp.force_open,h.push(d),b(e.el).change(),m.val("").width(20),e.refresh())}e.trigger(b.extend(g,{phase:"after"}))}else d&&b(e.el).data("selected",d).val(d.text).change(),""===b(e.el).val()&&b(e.el).data("selected")&&b(e.el).removeData("selected").val("").change(),"list"==e.type&&(m.val(""),e.refresh()),e.tmp.force_hide=!0;break;case 8:case 46:if("enum"==e.type&&8==d&&""===m.val()&&0<h.length){d=h[h.length-1];g=e.trigger({phase:"before",type:"remove",target:e.el,originalEvent:a.originalEvent,item:d});if(!0===g.isCancelled)return;h.pop();b(e.el).trigger("change");e.refresh();e.trigger(b.extend(g,{phase:"after"}))}"list"==e.type&&""===m.val()&&(b(e.el).data("selected",{}).change(),e.refresh());break;case 38:c.index=w2utils.isInt(c.index)?parseInt(c.index):0;for(c.index--;0<c.index&&c.items[c.index].hidden;)c.index--;if(0===c.index&&c.items[c.index].hidden)for(;c.items[c.index]&&c.items[c.index].hidden;)c.index++;f=!0;break;case 40:c.index=w2utils.isInt(c.index)?parseInt(c.index):-1;for(c.index++;c.index<c.items.length-1&&c.items[c.index].hidden;)c.index++;if(c.index==c.items.length-1&&c.items[c.index].hidden)for(;c.items[c.index]&&c.items[c.index].hidden;)c.index--;""===m.val()&&0===b("#w2ui-overlay").length?e.tmp.force_open=!0:f=!0}f?(0>c.index&&(c.index=0),c.index>=c.items.length&&(c.index=c.items.length-1),e.updateOverlay(f),a.preventDefault(),setTimeout(function(){if("enum"==e.type){var a=m.get(0);a.setSelectionRange(a.value.length,a.value.length)}else"list"==e.type?(a=m.get(0),a.setSelectionRange(a.value.length,a.value.length)):e.el.setSelectionRange(e.el.value.length,e.el.value.length)},0)):"enum"==e.type&&m.width(8*(m.val().length+2)+"px")}},keyUp:function(a){"color"==this.type&&86==a.keyCode&&(a.ctrlKey||a.metaKey)&&b(this).prop("maxlength",6);if(-1!=["list","combo","enum"].indexOf(this.type)&&!b(this.el).prop("readonly")&&!b(this.el).prop("disabled")&&-1==[16,17,18,20,37,39,91].indexOf(a.keyCode)){var d=b(this.helpers.focus).find("input");0===d.length&&(d=b(this.el));var e=this.trigger({phase:"before",type:"search",originalEvent:a,target:d,search:d.val()});!0!==e.isCancelled&&(this.tmp.force_hide||this.request(),1==d.val().length&&this.refresh(),0!==b("#w2ui-overlay").length&&-1!=[38,40].indexOf(a.keyCode)||this.search(),this.trigger(b.extend(e,{phase:"after"})))}},clearCache:function(){this.options.items=[];this.tmp.xhr_loading=!1;this.tmp.xhr_search="";this.tmp.xhr_total=-1},search:function(){var a=this.options,d=b(this.el).val(),e=this.el,c=[],f=b(this.el).data("selected");if("enum"==this.type){var e=b(this.helpers.multi).find("input"),d=e.val(),g;for(g in f)f[g]&&c.push(f[g][a.itemId])}else if("list"==this.type)for(g in e=b(this.helpers.focus).find("input"),d=e.val(),f)f[g]&&c.push(f[g][a.itemId]);e={};!0!==this.tmp.xhr_loading?(a.tmpHideList=e,a.index=-1,a.spinner=!1,this.updateOverlay(),setTimeout(function(){var c=b("#w2ui-overlay").html()||"";a.markSearch&&-1!=c.indexOf("$.fn.w2menuHandler")&&b("#w2ui-overlay").w2marker(d)},1)):(a.items.splice(0,a.cacheMax),a.spinner=!0,this.updateOverlay())},updateOverlay:function(a){var d=this,e=this.options;if("color"==this.type){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;b(this.el).w2color({color:b(this.el).val(),transparent:e.transparent},function(a){null!=a&&b(d.el).val(a).change()})}if("date"==this.type){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0===b("#w2ui-overlay").length&&b(d.el).w2overlay('\x3cdiv class\x3d"w2ui-reset w2ui-calendar" onclick\x3d"event.stopPropagation();"\x3e\x3c/div\x3e',{css:{"background-color":"#f5f5f5"}});var c,f,g=w2utils.isDate(b(d.el).val(),d.options.format,!0);g&&(c=g.getMonth()+1,f=g.getFullYear());(function u(a,c){b("#w2ui-overlay \x3e div \x3e div").html(d.getMonthHTML(a,c,b(d.el).val()));b("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(b(this).next().hasClass("w2ui-calendar-jump"))b(this).next().remove();else{var a,c;b(this).after('\x3cdiv class\x3d"w2ui-calendar-jump" style\x3d""\x3e\x3c/div\x3e');b(this).next().hide().html(d.getYearHTML()).fadeIn(100);setTimeout(function(){b("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){b(this).hasClass("w2ui-jump-month")&&(b(this).parent().find(".w2ui-jump-month").removeClass("selected"),b(this).addClass("selected"),c=b(this).attr("name"));b(this).hasClass("w2ui-jump-year")&&(b(this).parent().find(".w2ui-jump-year").removeClass("selected"),b(this).addClass("selected"),a=b(this).attr("name"));null!=a&&null!=c&&(b("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){u(parseInt(c)+1,a)},100))});b("#w2ui-overlay .w2ui-calendar-jump \x3e:last-child").prop("scrollTop",2800)},1)}});b("#w2ui-overlay .w2ui-date").on("mousedown",function(){var a=b(this).attr("date");b(d.el).val(a).change();b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)});b("#w2ui-overlay .previous").on("mousedown",function(){var a=d.options.current.split("/");a[0]=parseInt(a[0])-1;u(a[0],a[1])});b("#w2ui-overlay .next").on("mousedown",function(){var a=d.options.current.split("/");a[0]=parseInt(a[0])+1;u(a[0],a[1])})})(c,f)}if("time"==this.type){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0===b("#w2ui-overlay").length&&b(d.el).w2overlay('\x3cdiv class\x3d"w2ui-reset w2ui-calendar-time" onclick\x3d"event.stopPropagation();"\x3e\x3c/div\x3e',{css:{"background-color":"#fff"}});b("#w2ui-overlay \x3e div").html(d.getHourHTML());b("#w2ui-overlay .w2ui-time").on("mousedown",function(a){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});a=b(this).attr("hour");b(d.el).val(a+":00").change()});if(null==this.options.noMinutes||!1===this.options.noMinutes)b("#w2ui-overlay .w2ui-time").on("mouseup",function(){var a=b(this).attr("hour");0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();b(d.el).w2overlay('\x3cdiv class\x3d"w2ui-reset w2ui-calendar-time"\x3e\x3c/div\x3e',{css:{"background-color":"#fff"}});b("#w2ui-overlay \x3e div").html(d.getMinHTML(a));b("#w2ui-overlay .w2ui-time").on("mousedown",function(){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var c=b(this).attr("min");b(d.el).val(a+":"+(10>c?0:"")+c+"").change()}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})});else b("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("datetime"==this.type){if(b(d.el).prop("readonly")||b(d.el).prop("disabled"))return;0<b("#w2ui-overlay .w2ui-time").length&&b("#w2ui-overlay")[0].hide();0===b("#w2ui-overlay").length&&b(d.el).w2overlay('\x3cdiv class\x3d"w2ui-reset w2ui-calendar" onclick\x3d"event.stopPropagation();"\x3e\x3c/div\x3e',{css:{"background-color":"#f5f5f5"}});if(g=w2utils.isDateTime(b(d.el).val(),d.options.format,!0))c=g.getMonth()+1,f=g.getFullYear();var h=null;(function u(a,c){b("#w2ui-overlay \x3e div \x3e div").html(d.getMonthHTML(a,c,b(d.el).val())+(e.btn_now?'\x3cdiv class\x3d"w2ui-calendar-now now"\x3e'+w2utils.lang("Current Date \x26 Time")+"\x3c/div\x3e":""));b("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(b(this).next().hasClass("w2ui-calendar-jump"))b(this).next().remove();else{var a,c;b(this).after('\x3cdiv class\x3d"w2ui-calendar-jump" style\x3d""\x3e\x3c/div\x3e');b(this).next().hide().html(d.getYearHTML()).fadeIn(200);setTimeout(function(){b("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){b(this).hasClass("w2ui-jump-month")&&(b(this).parent().find(".w2ui-jump-month").removeClass("selected"),b(this).addClass("selected"),c=b(this).attr("name"));b(this).hasClass("w2ui-jump-year")&&(b(this).parent().find(".w2ui-jump-year").removeClass("selected"),b(this).addClass("selected"),a=b(this).attr("name"));null!=a&&null!=c&&(b("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){u(parseInt(c)+1,a)},100))});b("#w2ui-overlay .w2ui-calendar-jump \x3e:last-child").prop("scrollTop",2800)},1)}});b("#w2ui-overlay .w2ui-date").on("mousedown",function(){var a=b(this).attr("date");b(d.el).val(a).change();b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});h=new Date(b(this).attr("data-date"))}).on("mouseup",function(){var a,c;0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();b(d.el).w2overlay('\x3cdiv class\x3d"w2ui-reset w2ui-calendar-time"\x3e\x3c/div\x3e',{css:{"background-color":"#fff"}});b("#w2ui-overlay \x3e div").html(d.getHourHTML());b("#w2ui-overlay .w2ui-time").on("mousedown",function(c){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});a=b(this).attr("hour");h.setHours(a);c=w2utils.formatDateTime(h,d.options.format);b(d.el).val(c).change()});if(null==d.options.noMinutes||!1===d.options.noMinutes)b("#w2ui-overlay .w2ui-time").on("mouseup",function(){var e=b(this).attr("hour");0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide();b(d.el).w2overlay('\x3cdiv class\x3d"w2ui-reset w2ui-calendar-time"\x3e\x3c/div\x3e',{css:{"background-color":"#fff"}});b("#w2ui-overlay \x3e div").html(d.getMinHTML(e));b("#w2ui-overlay .w2ui-time").on("mousedown",function(){b(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});c=b(this).attr("min");h.setHours(a,c);var e=w2utils.formatDateTime(h,d.options.format);b(d.el).val(e).change()}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})});else b("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})});b("#w2ui-overlay .previous").on("mousedown",function(){var a=d.options.current.split("/");a[0]=parseInt(a[0])-1;u(a[0],a[1])});b("#w2ui-overlay .next").on("mousedown",function(){var a=d.options.current.split("/");a[0]=parseInt(a[0])+1;u(a[0],a[1])});b("#w2ui-overlay .now").on("mousedown",function(){var a=w2utils.formatDateTime(new Date,d.options.format);b(d.el).val(a).change();return!1}).on("mouseup",function(){setTimeout(function(){0<b("#w2ui-overlay").length&&b("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})})(c,f)}if(-1!=["list","combo","enum"].indexOf(this.type)){f=c=this.el;"enum"==this.type&&(c=b(this.helpers.multi),f=b(c).find("input"));if("list"==this.type){var n=this.options.itemId,m=b(f).data("selected");b.isEmptyObject(m)||-1!=e.index||e.items.forEach(function(a,b){a[n]==m[n]&&(e.index=b)});f=b(this.helpers.focus).find("input")}b(f).is(":focus")&&(!1===e.openOnFocus&&""===b(f).val()&&!0!==d.tmp.force_open?b().w2overlay():d.tmp.force_hide?(b().w2overlay(),setTimeout(function(){delete d.tmp.force_hide},1)):(""!==b(f).val()&&delete d.tmp.force_open,f=w2utils.lang("No matches"),0===e.items.length&&(f=w2utils.lang("Empty list")),null!=e.msgNoItems&&(f=e.msgNoItems),"function"==f&&(f=f(e)),b(c).w2menu(a?"refresh-index":"refresh",b.extend(!0,{},e,{tmpHideList:e.tmpHideList,itemId:e.itemId,itemText:e.itemText,itemIco:e.itemIco,itemImg:e.itemImg,search:!1,render:e.renderDrop,maxHeight:e.maxDropHeight,maxWidth:e.maxDropWidth,msgNoItems:f,onSelect:function(a){if("enum"==d.type){var c=b(d.el).data("selected");if(a.item){var f=d.trigger({phase:"before",type:"add",target:d.el,originalEvent:a.originalEvent,item:a.item});!0!==f.isCancelled&&(c.length>=e.max&&0<e.max&&c.pop(),delete a.item.hidden,c.push(a.item),b(d.el).data("selected",c).change(),b(d.helpers.multi).find("input").val("").width(20),d.refresh(),0<b("#w2ui-overlay").length&&b("#w2ui-overlay")[0].hide(),d.trigger(b.extend(f,{phase:"after"})))}}else b(d.el).data("selected",a.item).val(a.item[a.options.itemText]).change(),d.helpers.focus&&d.helpers.focus.find("input").val("")}}))))}},inRange:function(a,d){var e=!1;if("date"==this.type){var c=w2utils.isDate(a,this.options.format,!0);if(c){if(this.options.start||this.options.end){var f="string"==typeof this.options.start?this.options.start:b(this.options.start).val(),g="string"==typeof this.options.end?this.options.end:b(this.options.end).val(),f=w2utils.isDate(f,this.options.format,!0),g=w2utils.isDate(g,this.options.format,!0),h=new Date(c);f||(f=h);g||(g=h);h>=f&&h<=g&&(e=!0)}else e=!0;this.options.blocked&&-1!=b.inArray(a,this.options.blocked)&&(e=!1);if(null!=this.options.blockWeekDays&&void 0!=this.options.blockWeekDays&&void 0!=this.options.blockWeekDays.length)for(d=this.options.blockWeekDays.length,a=0;a<d;a++)c.getDay()==this.options.blockWeekDays[a]&&(e=!1)}}else if("time"==this.type)this.options.start||this.options.end?(c=this.toMin(a),a=this.toMin(this.options.start),d=this.toMin(this.options.end),a||(a=c),d||(d=c),c>=a&&c<=d&&(e=!0)):e=!0;else if("datetime"==this.type&&(c=w2utils.isDateTime(a,this.options.format,!0))&&(this.options.start||this.options.end?("object"==typeof this.options.start&&this.options.start instanceof Date?f=this.options.start:(f="string"==typeof this.options.start?this.options.start:b(this.options.start).val(),f=""!==f.trim()?w2utils.isDateTime(f,this.options.format,!0):""),"object"==typeof this.options.end&&this.options.end instanceof Date?g=this.options.end:(g="string"==typeof this.options.end?this.options.end:b(this.options.end).val(),g=""!==g.trim()?w2utils.isDateTime(g,this.options.format,!0):""),h=c,f||(f=h),g||(g=h),d&&f instanceof Date&&(f.setHours(0),f.setMinutes(0),f.setSeconds(0)),h>=f&&h<=g&&(e=!0)):e=!0,e&&this.options.blocked))for(a=0;a<this.options.blocked.length;a++)if(d=this.options.blocked[a],"string"==typeof d&&(d=w2utils.isDateTime(d,this.options.format,!0)),"object"==typeof d&&d instanceof Date&&d.getFullYear()==c.getFullYear()&&d.getMonth()==c.getMonth()&&d.getDate()==c.getDate()){e=!1;break}return e},checkType:function(a,b){switch(this.type){case "int":if(b&&-1!=["-",this.options.groupSymbol].indexOf(a))break;return w2utils.isInt(a.replace(this.options.numberRE,""));case "percent":a=a.replace(/%/g,"");case "float":if(b&&-1!=["-",w2utils.settings.decimalSymbol,this.options.groupSymbol].indexOf(a))break;return w2utils.isFloat(a.replace(this.options.numberRE,""));case "money":case "currency":if(b&&-1!=["-",this.options.decimalSymbol,this.options.groupSymbol,this.options.currencyPrefix,this.options.currencySuffix].indexOf(a))break;return w2utils.isFloat(a.replace(this.options.moneyRE,""));case "bin":return w2utils.isBin(a);case "hex":case "color":return w2utils.isHex(a);case "alphanumeric":return w2utils.isAlphaNumeric(a)}return!0},addPrefix:function(){var a=this;setTimeout(function(){if("clear"!==a.type){var d;d=b(a.el).data("tmp")||{};d["old-padding-left"]&&b(a.el).css("padding-left",d["old-padding-left"]);d["old-padding-left"]=b(a.el).css("padding-left");b(a.el).data("tmp",d);a.helpers.prefix&&b(a.helpers.prefix).remove();""!==a.options.prefix&&(b(a.el).before('\x3cdiv class\x3d"w2ui-field-helper"\x3e'+a.options.prefix+"\x3c/div\x3e"),d=b(a.el).prev(),d.css({color:b(a.el).css("color"),"font-family":b(a.el).css("font-family"),"font-size":b(a.el).css("font-size"),"padding-top":b(a.el).css("padding-top"),"padding-bottom":b(a.el).css("padding-bottom"),"padding-left":b(a.el).css("padding-left"),"padding-right":0,"margin-top":parseInt(b(a.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(b(a.el).css("margin-bottom"),10)+1+"px","margin-left":b(a.el).css("margin-left"),"margin-right":0}).on("click",function(d){a.options.icon&&"function"==typeof a.onIconClick?(d=a.trigger({phase:"before",type:"iconClick",target:a.el,el:b(this).find("span.w2ui-icon")[0]}),!0!==d.isCancelled&&a.trigger(b.extend(d,{phase:"after"}))):"list"==a.type?b(a.helpers.focus).find("input").focus():b(a.el).focus()}),b(a.el).css("padding-left",d.width()+parseInt(b(a.el).css("padding-left"),10)+"px"),a.helpers.prefix=d)}},1)},addSuffix:function(){var a=this,d,e;setTimeout(function(){if("clear"!==a.type){var c=b(a.el).data("tmp")||{};c["old-padding-right"]&&b(a.el).css("padding-right",c["old-padding-right"]);c["old-padding-right"]=b(a.el).css("padding-right");b(a.el).data("tmp",c);e=parseInt(b(a.el).css("padding-right"),10);a.options.arrows&&(a.helpers.arrows&&b(a.helpers.arrows).remove(),b(a.el).after('\x3cdiv class\x3d"w2ui-field-helper" style\x3d"border: 1px solid transparent"\x3e\x26#160;    \x3cdiv class\x3d"w2ui-field-up" type\x3d"up"\x3e        \x3cdiv class\x3d"arrow-up" type\x3d"up"\x3e\x3c/div\x3e    \x3c/div\x3e    \x3cdiv class\x3d"w2ui-field-down" type\x3d"down"\x3e        \x3cdiv class\x3d"arrow-down" type\x3d"down"\x3e\x3c/div\x3e    \x3c/div\x3e\x3c/div\x3e'),w2utils.getSize(a.el,"height"),d=b(a.el).next(),d.css({color:b(a.el).css("color"),"font-family":b(a.el).css("font-family"),"font-size":b(a.el).css("font-size"),height:b(a.el).height()+parseInt(b(a.el).css("padding-top"),10)+parseInt(b(a.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt(b(a.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(d.width()+parseInt(b(a.el).css("margin-right"),10)+12)+"px").on("mousedown",function(c){function d(){clearTimeout(f.data("_field_update_timer"));f.off("mouseup",d)}function e(d){b(a.el).focus();a.keyDown(b.Event("keydown"),{keyCode:"up"==b(c.target).attr("type")?38:40});!1!==d&&b("body").data("_field_update_timer",setTimeout(e,60))}var f=b("body");f.on("mouseup",d);f.data("_field_update_timer",setTimeout(e,700));e(!1)}),e+=d.width()+12,b(a.el).css("padding-right",e+"px"),a.helpers.arrows=d);""!==a.options.suffix&&(a.helpers.suffix&&b(a.helpers.suffix).remove(),b(a.el).after('\x3cdiv class\x3d"w2ui-field-helper"\x3e'+a.options.suffix+"\x3c/div\x3e"),d=b(a.el).next(),d.css({color:b(a.el).css("color"),"font-family":b(a.el).css("font-family"),"font-size":b(a.el).css("font-size"),"padding-top":b(a.el).css("padding-top"),"padding-bottom":b(a.el).css("padding-bottom"),"padding-left":"3px","padding-right":b(a.el).css("padding-right"),"margin-top":parseInt(b(a.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(b(a.el).css("margin-bottom"),10)+1+"px"}).on("click",function(c){"list"==a.type?b(a.helpers.focus).find("input").focus():b(a.el).focus()}),d.css("margin-left","-"+(w2utils.getSize(d,"width")+parseInt(b(a.el).css("margin-right"),10)+2)+"px"),e+=d.width()+3,b(a.el).css("padding-right",e+"px"),a.helpers.suffix=d)}},1)},addFocus:function(){var a=this,d;b(a.helpers.focus).remove();var e=b(a.el).attr("tabIndex");e&&-1!=e&&(a.el._tabIndex=e);a.el._tabIndex&&(e=a.el._tabIndex);null==e&&(e=-1);e='\x3cdiv class\x3d"w2ui-field-helper"\x3e    \x3cdiv class\x3d"w2ui-icon icon-search" style\x3d"opacity: 0; display: none"\x3e\x3c/div\x3e    \x3cinput class\x3d"w2uitxt" type\x3d"text" autocomplete\x3d"off" tabIndex\x3d"'+e+'"/\x3e\x3c/div\x3e';b(a.el).attr("tabindex",-1).before(e);e=b(a.el).prev();a.helpers.focus=e;e.css({width:b(a.el).width(),"margin-top":b(a.el).css("margin-top"),"margin-left":parseInt(b(a.el).css("margin-left"))+parseInt(b(a.el).css("padding-left"))+"px","margin-bottom":b(a.el).css("margin-bottom"),"margin-right":b(a.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",opacity:1,margin:0,border:"1px solid transparent",padding:b(a.el).css("padding-top"),"padding-left":0,"margin-left":0,"background-color":"transparent"});e.find("input").on("click",function(c){0===b("#w2ui-overlay").length&&a.focus(c);c.stopPropagation()}).on("focus",function(c){d=b(a.el).attr("placeholder");b(a.el).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"});b(this).val("");b(a.el).triggerHandler("focus");c.stopPropagation?c.stopPropagation():c.cancelBubble=!0}).on("blur",function(c){b(a.el).css("outline","none");b(this).val("");a.refresh();b(a.el).triggerHandler("blur");c.stopPropagation?c.stopPropagation():c.cancelBubble=!0;null!=d&&b(a.el).attr("placeholder",d)}).on("keydown",function(c){var e=this;a.keyDown(c);setTimeout(function(){""===e.value?b(a.el).attr("placeholder",d):b(a.el).attr("placeholder","")},10)}).on("keyup",function(b){a.keyUp(b)}).on("keypress",function(b){a.keyPress(b)});e.on("click",function(a){b(this).find("input").focus()});a.refresh()},addMulti:function(){var a=this;b(a.helpers.multi).remove();var d="",e="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+b(a.el).css("margin-left")+"; margin-right   : "+b(a.el).css("margin-right")+"; width          : "+(w2utils.getSize(a.el,"width")-parseInt(b(a.el).css("margin-left"),10)-parseInt(b(a.el).css("margin-right"),10))+"px;";"enum"==a.type&&((d=b(a.el).attr("tabIndex"))&&-1!=d&&(a.el._tabIndex=d),a.el._tabIndex&&(d=a.el._tabIndex),null==d&&(d=-1),d='\x3cdiv class\x3d"w2ui-field-helper w2ui-list" style\x3d"'+e+'; box-sizing: border-box"\x3e    \x3cdiv style\x3d"padding: 0px; margin: 0px; display: inline-block" class\x3d"w2ui-multi-items"\x3e    \x3cul\x3e        \x3cli style\x3d"padding-left: 0px; padding-right: 0px" class\x3d"nomouse"\x3e            \x3cinput type\x3d"text" style\x3d"width: 20px; margin: -3px 0 0; padding: 2px 0; border-color: white" autocomplete\x3d"off"'+(b(a.el).prop("readonly")?' readonly\x3d"readonly"':"")+(b(a.el).prop("disabled")?' disabled\x3d"disabled"':"")+' tabindex\x3d"'+d+'"/\x3e        \x3c/li\x3e    \x3c/ul\x3e    \x3c/div\x3e\x3c/div\x3e');"file"==a.type&&(d='\x3cdiv class\x3d"w2ui-field-helper w2ui-list" style\x3d"'+e+'; box-sizing: border-box"\x3e   \x3cdiv style\x3d"position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;"\x3e       \x3cinput class\x3d"w2uitxt file-input" type\x3d"file" style\x3d"width: 100%; height: 100%; opacity: 0;" name\x3d"attachment" multiple tabindex\x3d"-1"'+(b(a.el).prop("readonly")?' readonly\x3d"readonly"':"")+(b(a.el).prop("disabled")?' disabled\x3d"disabled"':"")+(b(a.el).attr("accept")?' accept\x3d"'+b(a.el).attr("accept")+'"':"")+'/\x3e   \x3c/div\x3e    \x3cdiv style\x3d"position: absolute; padding: 0px; margin: 0px; display: inline-block" class\x3d"w2ui-multi-items"\x3e        \x3cul\x3e\x3cli style\x3d"padding-left: 0px; padding-right: 0px" class\x3d"nomouse"\x3e\x3c/li\x3e\x3c/ul\x3e    \x3c/div\x3e\x3c/div\x3e');e=b(a.el).data("tmp")||{};e["old-background-color"]=b(a.el).css("background-color");e["old-border-color"]=b(a.el).css("border-color");b(a.el).data("tmp",e);b(a.el).before(d).css({"background-color":"transparent","border-color":"transparent"});var c=b(a.el).prev();a.helpers.multi=c;"enum"==a.type&&(b(a.el).attr("tabindex",-1),c.find("input").on("click",function(c){0===b("#w2ui-overlay").length&&a.focus(c);b(a.el).triggerHandler("click")}).on("focus",function(d){b(c).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"});b(a.el).triggerHandler("focus");d.stopPropagation?d.stopPropagation():d.cancelBubble=!0}).on("blur",function(d){b(c).css("outline","none");b(a.el).triggerHandler("blur");d.stopPropagation?d.stopPropagation():d.cancelBubble=!0}).on("keyup",function(b){a.keyUp(b)}).on("keydown",function(b){a.keyDown(b)}).on("keypress",function(b){a.keyPress(b)}),c.on("click",function(a){b(this).find("input").focus()}));"file"==a.type&&(b(a.el).css("outline","none"),c.on("click",function(d){b(a.el).focus();b(a.el).prop("readonly")||b(a.el).prop("disabled")||(a.blur(d),a.resize(),setTimeout(function(){c.find("input").click()},10))}).on("dragenter",function(d){b(a.el).prop("readonly")||b(a.el).prop("disabled")||b(c).addClass("w2ui-file-dragover")}).on("dragleave",function(d){b(a.el).prop("readonly")||b(a.el).prop("disabled")||0===b(d.target).parents(".w2ui-field-helper").length&&b(c).removeClass("w2ui-file-dragover")}).on("drop",function(d){if(!b(a.el).prop("readonly")&&!b(a.el).prop("disabled")){b(c).removeClass("w2ui-file-dragover");for(var e=d.originalEvent.dataTransfer.files,f=0,g=e.length;f<g;f++)a.addFile.call(a,e[f]);d.preventDefault();d.stopPropagation()}}).on("dragover",function(a){a.preventDefault();a.stopPropagation()}),c.find("input").on("click",function(a){a.stopPropagation()}).on("change",function(){if("undefined"!==typeof this.files)for(var b=0,c=this.files.length;b<c;b++)a.addFile.call(a,this.files[b])}));a.refresh()},addFile:function(a){var d=this,e=this.options,c=b(d.el).data("selected"),f={name:a.name,type:a.type,modified:a.lastModifiedDate,size:a.size,content:null,file:a},g=0,h=0;if(c)for(var n=0;n<c.length;n++){if(c[n].name==a.name&&c[n].size==a.size)return;g+=c[n].size;h++}var m=d.trigger({phase:"before",type:"add",target:d.el,file:f,total:h,totalSize:g});!0!==m.isCancelled&&(0!==e.maxFileSize&&f.size>e.maxFileSize?(a="Maximum file size is "+w2utils.formatSize(e.maxFileSize),!1===e.silent&&b(d.el).w2tag(a),console.log("ERROR: "+a)):0!==e.maxSize&&g+f.size>e.maxSize?(a="Maximum total size is "+w2utils.formatSize(e.maxSize),!1===e.silent&&b(d.el).w2tag(a),console.log("ERROR: "+a)):0!==e.max&&h>=e.max?(a="Maximum number of files is "+e.max,!1===e.silent&&b(d.el).w2tag(a),console.log("ERROR: "+a)):(c.push(f),"undefined"!==typeof FileReader&&!0===e.readContent?(e=new FileReader,e.onload=function(){return function(a){a=a.target.result;var c=a.indexOf(",");f.content=a.substr(c+1);d.refresh();b(d.el).trigger("change");d.trigger(b.extend(m,{phase:"after"}))}}(),e.readAsDataURL(a)):(d.refresh(),b(d.el).trigger("change"))))},normMenu:function(a){if(b.isArray(a)){for(var d=0;d<a.length;d++)"string"==typeof a[d]?a[d]={id:a[d],text:a[d]}:(null!=a[d].text&&null==a[d].id&&(a[d].id=a[d].text),null==a[d].text&&null!=a[d].id&&(a[d].text=a[d].id),null!=a[d].caption&&(a[d].text=a[d].caption));return a}if("function"==typeof a)return this.normMenu(a());if("object"==typeof a){var e=[];for(d in a)e.push({id:d,text:a[d]});return e}},getMonthHTML:function(a,b,e){var c=new Date,d=w2utils.settings.fullmonths,g="31 28 31 30 31 30 31 31 30 31 30 31".split(" "),h=c.getFullYear()+"/"+(Number(c.getMonth())+1)+"/"+c.getDate(),n=w2utils.settings.fulldays.slice(),m=w2utils.settings.shortdays.slice();"M"!=w2utils.settings.weekStarts&&(n.unshift(n.pop()),m.unshift(m.pop()));var l=this.options;null==l&&(l={});b=w2utils.isInt(b)?parseInt(b):c.getFullYear();a=w2utils.isInt(a)?parseInt(a):c.getMonth()+1;12<a&&(a-=12,b++);if(1>a||0===a)a+=12,b--;g[1]=b/4==Math.floor(b/4)?"29":"28";l.current=a+"/"+b;for(var c=new Date(b,a-1,1),c=c.getDay(),u="",t=0;t<m.length;t++)u+='\x3ctd title\x3d"'+n[t]+'"\x3e'+m[t]+"\x3c/td\x3e";d='\x3cdiv class\x3d"w2ui-calendar-title title"\x3e    \x3cdiv class\x3d"w2ui-calendar-previous previous"\x3e \x3cdiv\x3e\x3c/div\x3e \x3c/div\x3e    \x3cdiv class\x3d"w2ui-calendar-next next"\x3e \x3cdiv\x3e\x3c/div\x3e \x3c/div\x3e '+d[a-1]+", "+b+'\x3c/div\x3e\x3ctable class\x3d"w2ui-calendar-days" cellspacing\x3d"0"\x3e\x3ctbody\x3e    \x3ctr class\x3d"w2ui-day-title"\x3e'+u+"\x3c/tr\x3e    \x3ctr\x3e";n=1;"M"!=w2utils.settings.weekStarts&&c++;"datetime"===this.type&&(e=w2utils.isDateTime(e,l.format,!0),e=w2utils.formatDate(e,w2utils.settings.dateFormat));for(m=1;43>m;m++){if(0===c&&1==m){for(u=0;6>u;u++)d+='\x3ctd class\x3d"w2ui-day-empty"\x3e\x26#160;\x3c/td\x3e';m+=6}else if(m<c||n>g[a-1]){d+='\x3ctd class\x3d"w2ui-day-empty"\x3e\x26#160;\x3c/td\x3e';0===m%7&&(d+="\x3c/tr\x3e\x3ctr\x3e");continue}var w=b+"/"+a+"/"+n,u=new Date(w),t="";6===u.getDay()&&(t=" w2ui-saturday");0===u.getDay()&&(t=" w2ui-sunday");w==h&&(t+=" w2ui-today");var q=n,v="",p="",r;"datetime"===this.type?(r=w2utils.formatDateTime(w,l.format),w=w2utils.formatDate(w,w2utils.settings.dateFormat)):w=r=w2utils.formatDate(w,l.format);l.colored&&void 0!==l.colored[w]&&(v=l.colored[w].split(":"),p="background-color: "+v[0]+";",v="color: "+v[1]+";");d+='\x3ctd class\x3d"'+(this.inRange(r,!0)?"w2ui-date "+(w==e?"w2ui-date-selected":""):"w2ui-blocked")+t+'"    style\x3d"'+v+p+'" date\x3d"'+r+'" data-date\x3d"'+u+'"\x3e'+q+"\x3c/td\x3e";if(0===m%7||0===c&&1==m)d+="\x3c/tr\x3e\x3ctr\x3e";n++}return d+"\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e"},getYearHTML:function(){for(var a=w2utils.settings.shortmonths,b="",e="",c=0;c<a.length;c++)b+='\x3cdiv class\x3d"w2ui-jump-month" name\x3d"'+c+'"\x3e'+a[c]+"\x3c/div\x3e";a=(new Date).getFullYear();for(c=a-100;c<=a+50;c++)e+='\x3cdiv class\x3d"w2ui-jump-year" name\x3d"'+c+'"\x3e'+c+"\x3c/div\x3e";return"\x3cdiv\x3e"+b+"\x3c/div\x3e\x3cdiv\x3e"+e+"\x3c/div\x3e"},getHourHTML:function(){var a=[],b=this.options;null==b&&(b={format:w2utils.settings.timeFormat});for(var e=0;24>e;e++){var c=e+":00";a[Math.floor(e/8)]||(a[Math.floor(e/8)]="");var f=this.fromMin(this.toMin(c)),g=this.fromMin(this.toMin(c)+59);if("datetime"===this.type)var h=w2utils.isDateTime(this.el.value,b.format,!0),n=b.format.split(" ")[0].trim(),f=w2utils.formatDate(h,n)+" "+f,g=w2utils.formatDate(h,n)+" "+g;a[Math.floor(e/8)]+='\x3cdiv class\x3d"'+(this.inRange(f)||this.inRange(g)?"w2ui-time ":"w2ui-blocked")+'" hour\x3d"'+e+'"\x3e'+c+"\x3c/div\x3e"}return'\x3cdiv class\x3d"w2ui-calendar"\x3e   \x3cdiv class\x3d"w2ui-calendar-title"\x3e'+w2utils.lang("Select Hour")+'\x3c/div\x3e   \x3cdiv class\x3d"w2ui-calendar-time"\x3e\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e       \x3ctd\x3e'+a[0]+"\x3c/td\x3e       \x3ctd\x3e"+a[1]+"\x3c/td\x3e       \x3ctd\x3e"+a[2]+"\x3c/td\x3e   \x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e"},getMinHTML:function(a){null==a&&(a=0);var b=this.options;null==b&&(b={format:w2utils.settings.timeFormat});for(var e=[],c=0;60>c;c+=5){var f=a+":"+(10>c?0:"")+c+" ",g=f,h=20>c?0:40>c?1:2;e[h]||(e[h]="");if("datetime"===this.type)var n=w2utils.isDateTime(this.el.value,b.format,!0),m=b.format.split(" ")[0].trim(),g=w2utils.formatDate(n,m)+" "+g;e[h]+='\x3cdiv class\x3d"'+(this.inRange(g)?"w2ui-time ":"w2ui-blocked")+'" min\x3d"'+c+'"\x3e'+f+"\x3c/div\x3e"}return'\x3cdiv class\x3d"w2ui-calendar"\x3e   \x3cdiv class\x3d"w2ui-calendar-title"\x3e'+w2utils.lang("Select Minute")+'\x3c/div\x3e   \x3cdiv class\x3d"w2ui-calendar-time"\x3e\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e       \x3ctd\x3e'+e[0]+"\x3c/td\x3e       \x3ctd\x3e"+e[1]+"\x3c/td\x3e       \x3ctd\x3e"+e[2]+"\x3c/td\x3e   \x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e"},toMin:function(a){if("string"!=typeof a)return null;var b=a.split(":");if(2===b.length)b[0]=parseInt(b[0]),b[1]=parseInt(b[1]),-1!=a.indexOf("pm")&&12!=b[0]&&(b[0]+=12);else return null;return 60*b[0]+b[1]},fromMin:function(a){1440<=a&&(a%=1440);0>a&&(a=1440+a);var b=Math.floor(a/60);a=(10>a%60?"0":"")+a%60;var e=this.options;null==e&&(e={format:w2utils.settings.timeFormat});return-1!=e.format.indexOf("h24")?b+":"+a:(12>=b?b:b-12)+":"+a+" "+(12<=b?"pm":"am")}};b.extend(g.prototype,w2utils.event);w2obj.field=g})(jQuery);